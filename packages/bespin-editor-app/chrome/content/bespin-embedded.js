/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

(function(){var _1=[["dojo","bespindojo"],["th","bespinth"],["dijit","bespindijit"]];if((_1||(typeof djConfig!="undefined"&&djConfig.scopeMap))&&(typeof window!="undefined")){var _2="",_3="",_4="",_5={},_6={};_1=_1||djConfig.scopeMap;for(var i=0;i<_1.length;i++){var _8=_1[i];_2+="var "+_8[0]+" = {}; "+_8[1]+" = "+_8[0]+";"+_8[1]+"._scopeName = '"+_8[1]+"';";_3+=(i==0?"":",")+_8[0];_4+=(i==0?"":",")+_8[1];_5[_8[0]]=_8[1];_6[_8[1]]=_8[0];}eval(_2+"dojo._scopeArgs = ["+_4+"];");dojo._scopePrefixArgs=_3;dojo._scopePrefix="(function("+_3+"){";dojo._scopeSuffix="})("+_4+")";dojo._scopeMap=_5;dojo._scopeMapRev=_6;}(function(){if(typeof this["loadFirebugConsole"]=="function"){this["loadFirebugConsole"]();}else{this.console=this.console||{};var cn=["assert","count","debug","dir","dirxml","error","group","groupEnd","info","profile","profileEnd","time","timeEnd","trace","warn","log"];var i=0,tn;while((tn=cn[i++])){if(!console[tn]){(function(){var _c=tn+"";console[_c]=("log" in console)?function(){var a=Array.apply({},arguments);a.unshift(_c+":");console["log"](a.join(" "));}:function(){};})();}}}if(typeof dojo=="undefined"){this.dojo={_scopeName:"dojo",_scopePrefix:"",_scopePrefixArgs:"",_scopeSuffix:"",_scopeMap:{},_scopeMapRev:{}};}var d=dojo;if(typeof dijit=="undefined"){this.dijit={_scopeName:"dijit"};}if(typeof dojox=="undefined"){this.dojox={_scopeName:"dojox"};}if(!d._scopeArgs){d._scopeArgs=[dojo,dijit,dojox];}d.global=this;d.config={isDebug:false,debugAtAllCosts:false};if(typeof djConfig!="undefined"){for(var _f in djConfig){d.config[_f]=djConfig[_f];}}dojo.locale=d.config.locale;var rev="$Rev: 17136 $".match(/\d+/);dojo.version={major:0,minor:2,patch:2,flag:"",revision:rev?+rev[0]:NaN,toString:function(){with(d.version){return major+"."+minor+"."+patch+flag+" ("+revision+")";}}};if(typeof OpenAjax!="undefined"){OpenAjax.hub.registerLibrary(dojo._scopeName,"http://dojotoolkit.org",d.version.toString());}var _11={};dojo._mixin=function(obj,_13){for(var x in _13){if(_11[x]===undefined||_11[x]!=_13[x]){obj[x]=_13[x];}}if(d.isIE&&_13){var p=_13.toString;if(typeof p=="function"&&p!=obj.toString&&p!=_11.toString&&p!="\nfunction toString() {\n    [native code]\n}\n"){obj.toString=_13.toString;}}return obj;};dojo.mixin=function(obj,_17){if(!obj){obj={};}for(var i=1,l=arguments.length;i<l;i++){d._mixin(obj,arguments[i]);}return obj;};dojo._getProp=function(_1a,_1b,_1c){var obj=_1c||d.global;for(var i=0,p;obj&&(p=_1a[i]);i++){if(i==0&&this._scopeMap[p]){p=this._scopeMap[p];}obj=(p in obj?obj[p]:(_1b?obj[p]={}:undefined));}return obj;};dojo.setObject=function(_20,_21,_22){var _23=_20.split("."),p=_23.pop(),obj=d._getProp(_23,true,_22);return obj&&p?(obj[p]=_21):undefined;};dojo.getObject=function(_26,_27,_28){return d._getProp(_26.split("."),_27,_28);};dojo.exists=function(_29,obj){return !!d.getObject(_29,false,obj);};dojo["eval"]=function(_2b){return d.global.eval?d.global.eval(_2b):eval(_2b);};d.deprecated=d.experimental=function(){};})();(function(){var d=dojo;d.mixin(d,{_loadedModules:{},_inFlightCount:0,_hasResource:{},_modulePrefixes:{dojo:{name:"dojo",value:"."},doh:{name:"doh",value:"../util/doh"},tests:{name:"tests",value:"tests"}},_moduleHasPrefix:function(_2d){var mp=this._modulePrefixes;return !!(mp[_2d]&&mp[_2d].value);},_getModulePrefix:function(_2f){var mp=this._modulePrefixes;if(this._moduleHasPrefix(_2f)){return mp[_2f].value;}return _2f;},_loadedUrls:[],_postLoad:false,_loaders:[],_unloaders:[],_loadNotifying:false});dojo._loadPath=function(_31,_32,cb){var uri=((_31.charAt(0)=="/"||_31.match(/^\w+:/))?"":this.baseUrl)+_31;try{return !_32?this._loadUri(uri,cb):this._loadUriAndCheck(uri,_32,cb);}catch(e){console.error(e);return false;}};dojo._loadUri=function(uri,cb){if(this._loadedUrls[uri]){return true;}var _37=this._getText(uri,true);if(!_37){return false;}this._loadedUrls[uri]=true;this._loadedUrls.push(uri);if(cb){_37="("+_37+")";}else{_37=this._scopePrefix+_37+this._scopeSuffix;}if(d.isMoz){_37+="\r\n//@ sourceURL="+uri;}var _38=d["eval"](_37);if(cb){cb(_38);}return true;};dojo._loadUriAndCheck=function(uri,_3a,cb){var ok=false;try{ok=this._loadUri(uri,cb);}catch(e){console.error("failed loading "+uri+" with error: "+e);}return !!(ok&&this._loadedModules[_3a]);};dojo.loaded=function(){this._loadNotifying=true;this._postLoad=true;var mll=d._loaders;this._loaders=[];for(var x=0;x<mll.length;x++){mll[x]();}this._loadNotifying=false;if(d._postLoad&&d._inFlightCount==0&&mll.length){d._callLoaded();}};dojo.unloaded=function(){var mll=d._unloaders;while(mll.length){(mll.pop())();}};d._onto=function(arr,obj,fn){if(!fn){arr.push(obj);}else{if(fn){var _43=(typeof fn=="string")?obj[fn]:fn;arr.push(function(){_43.call(obj);});}}};dojo.addOnLoad=function(obj,_45){d._onto(d._loaders,obj,_45);if(d._postLoad&&d._inFlightCount==0&&!d._loadNotifying){d._callLoaded();}};var dca=d.config.addOnLoad;if(dca){d.addOnLoad[(dca instanceof Array?"apply":"call")](d,dca);}dojo._modulesLoaded=function(){if(d._postLoad){return;}if(d._inFlightCount>0){console.warn("files still in flight!");return;}d._callLoaded();};dojo._callLoaded=function(){if(typeof setTimeout=="object"||(dojo.config.useXDomain&&d.isOpera)){if(dojo.isAIR){setTimeout(function(){dojo.loaded();},0);}else{setTimeout(dojo._scopeName+".loaded();",0);}}else{d.loaded();}};dojo._getModuleSymbols=function(_47){var _48=_47.split(".");for(var i=_48.length;i>0;i--){var _4a=_48.slice(0,i).join(".");if((i==1)&&!this._moduleHasPrefix(_4a)){_48[0]="../"+_48[0];}else{var _4b=this._getModulePrefix(_4a);if(_4b!=_4a){_48.splice(0,i,_4b);break;}}}return _48;};dojo._global_omit_module_check=false;dojo.loadInit=function(_4c){_4c();};dojo._loadModule=dojo.require=function(_4d,_4e){_4e=this._global_omit_module_check||_4e;var _4f=this._loadedModules[_4d];if(_4f){return _4f;}var _50=this._getModuleSymbols(_4d).join("/")+".js";var _51=(!_4e)?_4d:null;var ok=this._loadPath(_50,_51);if(!ok&&!_4e){throw new Error("Could not load '"+_4d+"'; last tried '"+_50+"'");}if(!_4e&&!this._isXDomain){_4f=this._loadedModules[_4d];if(!_4f){throw new Error("symbol '"+_4d+"' is not defined after loading '"+_50+"'");}}return _4f;};dojo.provide=function(_53){_53=_53+"";return (d._loadedModules[_53]=d.getObject(_53,true));};dojo.platformRequire=function(_54){var _55=_54.common||[];var _56=_55.concat(_54[d._name]||_54["default"]||[]);for(var x=0;x<_56.length;x++){var _58=_56[x];if(_58.constructor==Array){d._loadModule.apply(d,_58);}else{d._loadModule(_58);}}};dojo.requireIf=function(_59,_5a){if(_59===true){var _5b=[];for(var i=1;i<arguments.length;i++){_5b.push(arguments[i]);}d.require.apply(d,_5b);}};dojo.requireAfterIf=d.requireIf;dojo.registerModulePath=function(_5d,_5e){d._modulePrefixes[_5d]={name:_5d,value:_5e};};dojo.requireLocalization=function(_5f,_60,_61,_62){d.require("dojo.i18n");d.i18n._requireLocalization.apply(d.hostenv,arguments);};var ore=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$");var ire=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");dojo._Url=function(){var n=null;var _a=arguments;var uri=[_a[0]];for(var i=1;i<_a.length;i++){if(!_a[i]){continue;}var _69=new d._Url(_a[i]+"");var _6a=new d._Url(uri[0]+"");if(_69.path==""&&!_69.scheme&&!_69.authority&&!_69.query){if(_69.fragment!=n){_6a.fragment=_69.fragment;}_69=_6a;}else{if(!_69.scheme){_69.scheme=_6a.scheme;if(!_69.authority){_69.authority=_6a.authority;if(_69.path.charAt(0)!="/"){var _6b=_6a.path.substring(0,_6a.path.lastIndexOf("/")+1)+_69.path;var _6c=_6b.split("/");for(var j=0;j<_6c.length;j++){if(_6c[j]=="."){if(j==_6c.length-1){_6c[j]="";}else{_6c.splice(j,1);j--;}}else{if(j>0&&!(j==1&&_6c[0]=="")&&_6c[j]==".."&&_6c[j-1]!=".."){if(j==(_6c.length-1)){_6c.splice(j,1);_6c[j-1]="";}else{_6c.splice(j-1,2);j-=2;}}}}_69.path=_6c.join("/");}}}}uri=[];if(_69.scheme){uri.push(_69.scheme,":");}if(_69.authority){uri.push("//",_69.authority);}uri.push(_69.path);if(_69.query){uri.push("?",_69.query);}if(_69.fragment){uri.push("#",_69.fragment);}}this.uri=uri.join("");var r=this.uri.match(ore);this.scheme=r[2]||(r[1]?"":n);this.authority=r[4]||(r[3]?"":n);this.path=r[5];this.query=r[7]||(r[6]?"":n);this.fragment=r[9]||(r[8]?"":n);if(this.authority!=n){r=this.authority.match(ire);this.user=r[3]||n;this.password=r[4]||n;this.host=r[6]||r[7];this.port=r[9]||n;}};dojo._Url.prototype.toString=function(){return this.uri;};dojo.moduleUrl=function(_6f,url){var loc=d._getModuleSymbols(_6f).join("/");if(!loc){return null;}if(loc.lastIndexOf("/")!=loc.length-1){loc+="/";}var _72=loc.indexOf(":");if(loc.charAt(0)!="/"&&(_72==-1||_72>loc.indexOf("/"))){loc=d.baseUrl+loc;}return new d._Url(loc,url);};})();if(typeof window!="undefined"){dojo.isBrowser=true;dojo._name="browser";(function(){var d=dojo;if(document&&document.getElementsByTagName){var _74=document.getElementsByTagName("script");var _75=/dojo(\.xd)?\.js(\W|$)/i;for(var i=0;i<_74.length;i++){var src=_74[i].getAttribute("src");if(!src){continue;}var m=src.match(_75);if(m){if(!d.config.baseUrl){d.config.baseUrl=src.substring(0,m.index);}var cfg=_74[i].getAttribute("djConfig");if(cfg){var _7a=eval("({ "+cfg+" })");for(var x in _7a){dojo.config[x]=_7a[x];}}break;}}}d.baseUrl=d.config.baseUrl;var n=navigator;var dua=n.userAgent,dav=n.appVersion,tv=parseFloat(dav);if(dua.indexOf("Opera")>=0){d.isOpera=tv;}if(dua.indexOf("AdobeAIR")>=0){d.isAIR=1;}d.isKhtml=(dav.indexOf("Konqueror")>=0)?tv:0;d.isWebKit=parseFloat(dua.split("WebKit/")[1])||undefined;d.isChrome=parseFloat(dua.split("Chrome/")[1])||undefined;var _80=Math.max(dav.indexOf("WebKit"),dav.indexOf("Safari"),0);if(_80&&!dojo.isChrome){d.isSafari=parseFloat(dav.split("Version/")[1]);if(!d.isSafari||parseFloat(dav.substr(_80+7))<=419.3){d.isSafari=2;}}if(dua.indexOf("Gecko")>=0&&!d.isKhtml&&!d.isWebKit){d.isMozilla=d.isMoz=tv;}if(d.isMoz){d.isFF=parseFloat(dua.split("Firefox/")[1]||dua.split("Minefield/")[1]||dua.split("Shiretoko/")[1])||undefined;}if(document.all&&!d.isOpera){d.isIE=parseFloat(dav.split("MSIE ")[1])||undefined;if(d.isIE>=8&&document.documentMode!=5){d.isIE=document.documentMode;}}if(dojo.isIE&&window.location.protocol==="file:"){dojo.config.ieForceActiveXXhr=true;}var cm=document.compatMode;d.isQuirks=cm=="BackCompat"||cm=="QuirksMode"||d.isIE<6;d.locale=dojo.config.locale||(d.isIE?n.userLanguage:n.language).toLowerCase();d._XMLHTTP_PROGIDS=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];d._xhrObj=function(){var _82,_83;if(!dojo.isIE||!dojo.config.ieForceActiveXXhr){try{_82=new XMLHttpRequest();}catch(e){}}if(!_82){for(var i=0;i<3;++i){var _85=d._XMLHTTP_PROGIDS[i];try{_82=new ActiveXObject(_85);}catch(e){_83=e;}if(_82){d._XMLHTTP_PROGIDS=[_85];break;}}}if(!_82){throw new Error("XMLHTTP not available: "+_83);}return _82;};d._isDocumentOk=function(_86){var _87=_86.status||0;return (_87>=200&&_87<300)||_87==304||_87==1223||(!_87&&(location.protocol=="file:"||location.protocol=="chrome:"));};var _88=window.location+"";var _89=document.getElementsByTagName("base");var _8a=(_89&&_89.length>0);d._getText=function(uri,_8c){var _8d=this._xhrObj();if(!_8a&&dojo._Url){uri=(new dojo._Url(_88,uri)).toString();}if(d.config.cacheBust){uri+="";uri+=(uri.indexOf("?")==-1?"?":"&")+String(d.config.cacheBust).replace(/\W+/g,"");}_8d.open("GET",uri,false);try{_8d.send(null);if(!d._isDocumentOk(_8d)){var err=Error("Unable to load "+uri+" status:"+_8d.status);err.status=_8d.status;err.responseText=_8d.responseText;throw err;}}catch(e){if(_8c){return null;}throw e;}return _8d.responseText;};var _w=window;var _90=function(_91,fp){var _93=_w[_91]||function(){};_w[_91]=function(){fp.apply(_w,arguments);_93.apply(_w,arguments);};};d._windowUnloaders=[];d.windowUnloaded=function(){var mll=d._windowUnloaders;while(mll.length){(mll.pop())();}};var _95=0;d.addOnWindowUnload=function(obj,_97){d._onto(d._windowUnloaders,obj,_97);if(!_95){_95=1;_90("onunload",d.windowUnloaded);}};var _98=0;d.addOnUnload=function(obj,_9a){d._onto(d._unloaders,obj,_9a);if(!_98){_98=1;_90("onbeforeunload",dojo.unloaded);}};})();dojo._initFired=false;dojo._loadInit=function(e){dojo._initFired=true;var _9c=e&&e.type?e.type.toLowerCase():"load";if(arguments.callee.initialized||(_9c!="domcontentloaded"&&_9c!="load")){return;}arguments.callee.initialized=true;if("_khtmlTimer" in dojo){clearInterval(dojo._khtmlTimer);delete dojo._khtmlTimer;}if(dojo._inFlightCount==0){dojo._modulesLoaded();}};if(!dojo.config.afterOnLoad){if(document.addEventListener){if(dojo.isWebKit>525||dojo.isOpera||dojo.isFF>=3||(dojo.isMoz&&dojo.config.enableMozDomContentLoaded===true)){document.addEventListener("DOMContentLoaded",dojo._loadInit,null);}window.addEventListener("load",dojo._loadInit,null);}if(dojo.isAIR){window.addEventListener("load",dojo._loadInit,null);}else{if((dojo.isWebKit<525)||dojo.isKhtml){dojo._khtmlTimer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){dojo._loadInit();}},10);}}}if(dojo.isIE){if(!dojo.config.afterOnLoad){document.write("<scr"+"ipt defer src=\"//:\" "+"onreadystatechange=\"if(this.readyState=='complete'){"+dojo._scopeName+"._loadInit();}\">"+"</scr"+"ipt>");}try{document.namespaces.add("v","urn:schemas-microsoft-com:vml");document.createStyleSheet().addRule("v\\:*","behavior:url(#default#VML);  display:inline-block");}catch(e){}}}(function(){var mp=dojo.config["modulePaths"];if(mp){for(var _9e in mp){dojo.registerModulePath(_9e,mp[_9e]);}}})();if(dojo.config.isDebug){dojo.require("dojo._firebug.firebug");}if(dojo.config.debugAtAllCosts){dojo.config.useXDomain=true;dojo.require("dojo._base._loader.loader_xd");dojo.require("dojo._base._loader.loader_debug");dojo.require("dojo.i18n");}if(!dojo._hasResource["dojo._base.lang"]){dojo._hasResource["dojo._base.lang"]=true;dojo.provide("dojo._base.lang");dojo.isString=function(it){return !!arguments.length&&it!=null&&(typeof it=="string"||it instanceof String);};dojo.isArray=function(it){return it&&(it instanceof Array||typeof it=="array");};dojo.isFunction=(function(){var _a1=function(it){var t=typeof it;return it&&(t=="function"||it instanceof Function);};return dojo.isSafari?function(it){if(typeof it=="function"&&it=="[object NodeList]"){return false;}return _a1(it);}:_a1;})();dojo.isObject=function(it){return it!==undefined&&(it===null||typeof it=="object"||dojo.isArray(it)||dojo.isFunction(it));};dojo.isArrayLike=function(it){var d=dojo;return it&&it!==undefined&&!d.isString(it)&&!d.isFunction(it)&&!(it.tagName&&it.tagName.toLowerCase()=="form")&&(d.isArray(it)||isFinite(it.length));};dojo.isAlien=function(it){return it&&!dojo.isFunction(it)&&/\{\s*\[native code\]\s*\}/.test(String(it));};dojo.extend=function(_a9,_aa){for(var i=1,l=arguments.length;i<l;i++){dojo._mixin(_a9.prototype,arguments[i]);}return _a9;};dojo._hitchArgs=function(_ad,_ae){var pre=dojo._toArray(arguments,2);var _b0=dojo.isString(_ae);return function(){var _b1=dojo._toArray(arguments);var f=_b0?(_ad||dojo.global)[_ae]:_ae;return f&&f.apply(_ad||this,pre.concat(_b1));};};dojo.hitch=function(_b3,_b4){if(arguments.length>2){return dojo._hitchArgs.apply(dojo,arguments);}if(!_b4){_b4=_b3;_b3=null;}if(dojo.isString(_b4)){_b3=_b3||dojo.global;if(!_b3[_b4]){throw (["dojo.hitch: scope[\"",_b4,"\"] is null (scope=\"",_b3,"\")"].join(""));}return function(){return _b3[_b4].apply(_b3,arguments||[]);};}return !_b3?_b4:function(){return _b4.apply(_b3,arguments||[]);};};dojo.delegate=dojo._delegate=(function(){function TMP(){};return function(obj,_b7){TMP.prototype=obj;var tmp=new TMP();if(_b7){dojo._mixin(tmp,_b7);}return tmp;};})();(function(){var _b9=function(obj,_bb,_bc){return (_bc||[]).concat(Array.prototype.slice.call(obj,_bb||0));};var _bd=function(obj,_bf,_c0){var arr=_c0||[];for(var x=_bf||0;x<obj.length;x++){arr.push(obj[x]);}return arr;};dojo._toArray=dojo.isIE?function(obj){return ((obj.item)?_bd:_b9).apply(this,arguments);}:_b9;})();dojo.partial=function(_c4){var arr=[null];return dojo.hitch.apply(dojo,arr.concat(dojo._toArray(arguments)));};dojo.clone=function(o){if(!o){return o;}if(dojo.isArray(o)){var r=[];for(var i=0;i<o.length;++i){r.push(dojo.clone(o[i]));}return r;}if(!dojo.isObject(o)){return o;}if(o.nodeType&&o.cloneNode){return o.cloneNode(true);}if(o instanceof Date){return new Date(o.getTime());}r=new o.constructor();for(i in o){if(!(i in r)||r[i]!=o[i]){r[i]=dojo.clone(o[i]);}}return r;};dojo.trim=String.prototype.trim?function(str){return str.trim();}:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"");};}if(!dojo._hasResource["dojo._base.declare"]){dojo._hasResource["dojo._base.declare"]=true;dojo.provide("dojo._base.declare");dojo.declare=function(_cb,_cc,_cd){var dd=arguments.callee,_cf;if(dojo.isArray(_cc)){_cf=_cc;_cc=_cf.shift();}if(_cf){dojo.forEach(_cf,function(m,i){if(!m){throw (_cb+": mixin #"+i+" is null");}_cc=dd._delegate(_cc,m);});}var _d2=dd._delegate(_cc);_cd=_cd||{};_d2.extend(_cd);dojo.extend(_d2,{declaredClass:_cb,_constructor:_cd.constructor});_d2.prototype.constructor=_d2;return dojo.setObject(_cb,_d2);};dojo.mixin(dojo.declare,{_delegate:function(_d3,_d4){var bp=(_d3||0).prototype,mp=(_d4||0).prototype,dd=dojo.declare;var _d8=dd._makeCtor();dojo.mixin(_d8,{superclass:bp,mixin:mp,extend:dd._extend});if(_d3){_d8.prototype=dojo._delegate(bp);}dojo.extend(_d8,dd._core,mp||0,{_constructor:null,preamble:null});_d8.prototype.constructor=_d8;_d8.prototype.declaredClass=(bp||0).declaredClass+"_"+(mp||0).declaredClass;return _d8;},_extend:function(_d9){var i,fn;for(i in _d9){if(dojo.isFunction(fn=_d9[i])&&!0[i]){fn.nom=i;fn.ctor=this;}}dojo.extend(this,_d9);},_makeCtor:function(){return function(){this._construct(arguments);};},_core:{_construct:function(_dc){var c=_dc.callee,s=c.superclass,ct=s&&s.constructor,m=c.mixin,mct=m&&m.constructor,a=_dc,ii,fn;if(a[0]){if(((fn=a[0].preamble))){a=fn.apply(this,a)||a;}}if((fn=c.prototype.preamble)){a=fn.apply(this,a)||a;}if(ct&&ct.apply){ct.apply(this,a);}if(mct&&mct.apply){mct.apply(this,a);}if((ii=c.prototype._constructor)){ii.apply(this,_dc);}if(this.constructor.prototype==c.prototype&&(ct=this.postscript)){ct.apply(this,_dc);}},_findMixin:function(_e5){var c=this.constructor,p,m;while(c){p=c.superclass;m=c.mixin;if(m==_e5||(m instanceof _e5.constructor)){return p;}if(m&&m._findMixin&&(m=m._findMixin(_e5))){return m;}c=p&&p.constructor;}},_findMethod:function(_e9,_ea,_eb,has){var p=_eb,c,m,f;do{c=p.constructor;m=c.mixin;if(m&&(m=this._findMethod(_e9,_ea,m,has))){return m;}if((f=p[_e9])&&(has==(f==_ea))){return p;}p=c.superclass;}while(p);return !has&&(p=this._findMixin(_eb))&&this._findMethod(_e9,_ea,p,has);},inherited:function(_f1,_f2,_f3){var a=arguments;if(!dojo.isString(a[0])){_f3=_f2;_f2=_f1;_f1=_f2.callee.nom;}a=_f3||_f2;var c=_f2.callee,p=this.constructor.prototype,fn,mp;if(this[_f1]!=c||p[_f1]==c){mp=(c.ctor||0).superclass||this._findMethod(_f1,c,p,true);if(!mp){throw (this.declaredClass+": inherited method \""+_f1+"\" mismatch");}p=this._findMethod(_f1,c,mp,false);}fn=p&&p[_f1];if(!fn){throw (mp.declaredClass+": inherited method \""+_f1+"\" not found");}return fn.apply(this,a);}}});}if(!dojo._hasResource["dojo._base.connect"]){dojo._hasResource["dojo._base.connect"]=true;dojo.provide("dojo._base.connect");dojo._listener={getDispatcher:function(){return function(){var ap=Array.prototype,c=arguments.callee,ls=c._listeners,t=c.target;var r=t&&t.apply(this,arguments);var lls;lls=[].concat(ls);for(var i in lls){if(!(i in ap)){lls[i].apply(this,arguments);}}return r;};},add:function(_100,_101,_102){_100=_100||dojo.global;var f=_100[_101];if(!f||!f._listeners){var d=dojo._listener.getDispatcher();d.target=f;d._listeners=[];f=_100[_101]=d;}return f._listeners.push(_102);},remove:function(_105,_106,_107){var f=(_105||dojo.global)[_106];if(f&&f._listeners&&_107--){delete f._listeners[_107];}}};dojo.connect=function(obj,_10a,_10b,_10c,_10d){var a=arguments,args=[],i=0;args.push(dojo.isString(a[0])?null:a[i++],a[i++]);var a1=a[i+1];args.push(dojo.isString(a1)||dojo.isFunction(a1)?a[i++]:null,a[i++]);for(var l=a.length;i<l;i++){args.push(a[i]);}return dojo._connect.apply(this,args);};dojo._connect=function(obj,_113,_114,_115){var l=dojo._listener,h=l.add(obj,_113,dojo.hitch(_114,_115));return [obj,_113,h,l];};dojo.disconnect=function(_118){if(_118&&_118[0]!==undefined){dojo._disconnect.apply(this,_118);delete _118[0];}};dojo._disconnect=function(obj,_11a,_11b,_11c){_11c.remove(obj,_11a,_11b);};dojo._topics={};dojo.subscribe=function(_11d,_11e,_11f){return [_11d,dojo._listener.add(dojo._topics,_11d,dojo.hitch(_11e,_11f))];};dojo.unsubscribe=function(_120){if(_120){dojo._listener.remove(dojo._topics,_120[0],_120[1]);}};dojo.publish=function(_121,args){var f=dojo._topics[_121];if(f){f.apply(this,args||[]);}};dojo.connectPublisher=function(_124,obj,_126){var pf=function(){dojo.publish(_124,arguments);};return (_126)?dojo.connect(obj,_126,pf):dojo.connect(obj,pf);};}if(!dojo._hasResource["dojo._base.Deferred"]){dojo._hasResource["dojo._base.Deferred"]=true;dojo.provide("dojo._base.Deferred");dojo.Deferred=function(_128){this.chain=[];this.id=this._nextId();this.fired=-1;this.paused=0;this.results=[null,null];this.canceller=_128;this.silentlyCancelled=false;};dojo.extend(dojo.Deferred,{_nextId:(function(){var n=1;return function(){return n++;};})(),cancel:function(){var err;if(this.fired==-1){if(this.canceller){err=this.canceller(this);}else{this.silentlyCancelled=true;}if(this.fired==-1){if(!(err instanceof Error)){var res=err;var msg="Deferred Cancelled";if(err&&err.toString){msg+=": "+err.toString();}err=new Error(msg);err.dojoType="cancel";err.cancelResult=res;}this.errback(err);}}else{if((this.fired==0)&&(this.results[0] instanceof dojo.Deferred)){this.results[0].cancel();}}},_resback:function(res){this.fired=((res instanceof Error)?1:0);this.results[this.fired]=res;this._fire();},_check:function(){if(this.fired!=-1){if(!this.silentlyCancelled){throw new Error("already called!");}this.silentlyCancelled=false;return;}},callback:function(res){this._check();this._resback(res);},errback:function(res){this._check();if(!(res instanceof Error)){res=new Error(res);}this._resback(res);},addBoth:function(cb,cbfn){var _132=dojo.hitch.apply(dojo,arguments);return this.addCallbacks(_132,_132);},addCallback:function(cb,cbfn){return this.addCallbacks(dojo.hitch.apply(dojo,arguments));},addErrback:function(cb,cbfn){return this.addCallbacks(null,dojo.hitch.apply(dojo,arguments));},addCallbacks:function(cb,eb){this.chain.push([cb,eb]);if(this.fired>=0){this._fire();}return this;},_fire:function(){var _139=this.chain;var _13a=this.fired;var res=this.results[_13a];var self=this;var cb=null;while((_139.length>0)&&(this.paused==0)){var f=_139.shift()[_13a];if(!f){continue;}var func=function(){var ret=f(res);if(typeof ret!="undefined"){res=ret;}_13a=((res instanceof Error)?1:0);if(res instanceof dojo.Deferred){cb=function(res){self._resback(res);self.paused--;if((self.paused==0)&&(self.fired>=0)){self._fire();}};this.paused++;}};if(dojo.config.debugAtAllCosts){func.call(this);}else{try{func.call(this);}catch(err){_13a=1;res=err;}}}this.fired=_13a;this.results[_13a]=res;if((cb)&&(this.paused)){res.addBoth(cb);}}});}if(!dojo._hasResource["dojo._base.json"]){dojo._hasResource["dojo._base.json"]=true;dojo.provide("dojo._base.json");dojo.fromJson=function(json){return eval("("+json+")");};dojo._escapeString=function(str){return ("\""+str.replace(/(["\\])/g,"\\$1")+"\"").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r");};dojo.toJsonIndentStr="\t";dojo.toJson=function(it,_145,_146){if(it===undefined){return "undefined";}var _147=typeof it;if(_147=="number"||_147=="boolean"){return it+"";}if(it===null){return "null";}if(dojo.isString(it)){return dojo._escapeString(it);}var _148=arguments.callee;var _149;_146=_146||"";var _14a=_145?_146+dojo.toJsonIndentStr:"";var tf=it.__json__||it.json;if(dojo.isFunction(tf)){_149=tf.call(it);if(it!==_149){return _148(_149,_145,_14a);}}if(it.nodeType&&it.cloneNode){throw new Error("Can't serialize DOM nodes");}var sep=_145?" ":"";var _14d=_145?"\n":"";if(dojo.isArray(it)){var res=dojo.map(it,function(obj){var val=_148(obj,_145,_14a);if(typeof val!="string"){val="undefined";}return _14d+_14a+val;});return "["+res.join(","+sep)+_14d+_146+"]";}if(_147=="function"){return null;}var _151=[],key;for(key in it){var _153,val;if(typeof key=="number"){_153="\""+key+"\"";}else{if(typeof key=="string"){_153=dojo._escapeString(key);}else{continue;}}val=_148(it[key],_145,_14a);if(typeof val!="string"){continue;}_151.push(_14d+_14a+_153+":"+sep+val);}return "{"+_151.join(","+sep)+_14d+_146+"}";};}if(!dojo._hasResource["dojo._base.array"]){dojo._hasResource["dojo._base.array"]=true;dojo.provide("dojo._base.array");(function(){var _155=function(arr,obj,cb){return [dojo.isString(arr)?arr.split(""):arr,obj||dojo.global,dojo.isString(cb)?new Function("item","index","array",cb):cb];};dojo.mixin(dojo,{indexOf:function(_159,_15a,_15b,_15c){var step=1,end=_159.length||0,i=0;if(_15c){i=end-1;step=end=-1;}if(_15b!=undefined){i=_15b;}if((_15c&&i>end)||i<end){for(;i!=end;i+=step){if(_159[i]==_15a){return i;}}}return -1;},lastIndexOf:function(_15f,_160,_161){return dojo.indexOf(_15f,_160,_161,true);},forEach:function(arr,_163,_164){if(!arr||!arr.length){return;}var _p=_155(arr,_164,_163);arr=_p[0];for(var i=0,l=arr.length;i<l;++i){_p[2].call(_p[1],arr[i],i,arr);}},_everyOrSome:function(_168,arr,_16a,_16b){var _p=_155(arr,_16b,_16a);arr=_p[0];for(var i=0,l=arr.length;i<l;++i){var _16f=!!_p[2].call(_p[1],arr[i],i,arr);if(_168^_16f){return _16f;}}return _168;},every:function(arr,_171,_172){return this._everyOrSome(true,arr,_171,_172);},some:function(arr,_174,_175){return this._everyOrSome(false,arr,_174,_175);},map:function(arr,_177,_178){var _p=_155(arr,_178,_177);arr=_p[0];var _17a=(arguments[3]?(new arguments[3]()):[]);for(var i=0,l=arr.length;i<l;++i){_17a.push(_p[2].call(_p[1],arr[i],i,arr));}return _17a;},filter:function(arr,_17e,_17f){var _p=_155(arr,_17f,_17e);arr=_p[0];var _181=[];for(var i=0,l=arr.length;i<l;++i){if(_p[2].call(_p[1],arr[i],i,arr)){_181.push(arr[i]);}}return _181;}});})();}if(!dojo._hasResource["dojo._base.Color"]){dojo._hasResource["dojo._base.Color"]=true;dojo.provide("dojo._base.Color");(function(){var d=dojo;dojo.Color=function(_185){if(_185){this.setColor(_185);}};dojo.Color.named={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]};dojo.extend(dojo.Color,{r:255,g:255,b:255,a:1,_set:function(r,g,b,a){var t=this;t.r=r;t.g=g;t.b=b;t.a=a;},setColor:function(_18b){if(d.isString(_18b)){d.colorFromString(_18b,this);}else{if(d.isArray(_18b)){d.colorFromArray(_18b,this);}else{this._set(_18b.r,_18b.g,_18b.b,_18b.a);if(!(_18b instanceof d.Color)){this.sanitize();}}}return this;},sanitize:function(){return this;},toRgb:function(){var t=this;return [t.r,t.g,t.b];},toRgba:function(){var t=this;return [t.r,t.g,t.b,t.a];},toHex:function(){var arr=d.map(["r","g","b"],function(x){var s=this[x].toString(16);return s.length<2?"0"+s:s;},this);return "#"+arr.join("");},toCss:function(_191){var t=this,rgb=t.r+", "+t.g+", "+t.b;return (_191?"rgba("+rgb+", "+t.a:"rgb("+rgb)+")";},toString:function(){return this.toCss(true);}});dojo.blendColors=function(_194,end,_196,obj){var t=obj||new d.Color();d.forEach(["r","g","b","a"],function(x){t[x]=_194[x]+(end[x]-_194[x])*_196;if(x!="a"){t[x]=Math.round(t[x]);}});return t.sanitize();};dojo.colorFromRgb=function(_19a,obj){var m=_19a.toLowerCase().match(/^rgba?\(([\s\.,0-9]+)\)/);return m&&dojo.colorFromArray(m[1].split(/\s*,\s*/),obj);};dojo.colorFromHex=function(_19d,obj){var t=obj||new d.Color(),bits=(_19d.length==4)?4:8,mask=(1<<bits)-1;_19d=Number("0x"+_19d.substr(1));if(isNaN(_19d)){return null;}d.forEach(["b","g","r"],function(x){var c=_19d&mask;_19d>>=bits;t[x]=bits==4?17*c:c;});t.a=1;return t;};dojo.colorFromArray=function(a,obj){var t=obj||new d.Color();t._set(Number(a[0]),Number(a[1]),Number(a[2]),Number(a[3]));if(isNaN(t.a)){t.a=1;}return t.sanitize();};dojo.colorFromString=function(str,obj){var a=d.Color.named[str];return a&&d.colorFromArray(a,obj)||d.colorFromRgb(str,obj)||d.colorFromHex(str,obj);};})();}if(!dojo._hasResource["dojo._base"]){dojo._hasResource["dojo._base"]=true;dojo.provide("dojo._base");}if(!dojo._hasResource["dojo._base.window"]){dojo._hasResource["dojo._base.window"]=true;dojo.provide("dojo._base.window");dojo.doc=window["document"]||null;dojo.body=function(){return dojo.doc.body||dojo.doc.getElementsByTagName("body")[0];};dojo.setContext=function(_1aa,_1ab){dojo.global=_1aa;dojo.doc=_1ab;};dojo.withGlobal=function(_1ac,_1ad,_1ae,_1af){var _1b0=dojo.global;try{dojo.global=_1ac;return dojo.withDoc.call(null,_1ac.document,_1ad,_1ae,_1af);}finally{dojo.global=_1b0;}};dojo.withDoc=function(_1b1,_1b2,_1b3,_1b4){var _1b5=dojo.doc,_1b6=dojo._bodyLtr;try{dojo.doc=_1b1;delete dojo._bodyLtr;if(_1b3&&dojo.isString(_1b2)){_1b2=_1b3[_1b2];}return _1b2.apply(_1b3,_1b4||[]);}finally{dojo.doc=_1b5;if(_1b6!==undefined){dojo._bodyLtr=_1b6;}}};}if(!dojo._hasResource["dojo._base.event"]){dojo._hasResource["dojo._base.event"]=true;dojo.provide("dojo._base.event");(function(){var del=(dojo._event_listener={add:function(node,name,fp){if(!node){return;}name=del._normalizeEventName(name);fp=del._fixCallback(name,fp);var _1bb=name;if(!dojo.isIE&&(name=="mouseenter"||name=="mouseleave")){var ofp=fp;name=(name=="mouseenter")?"mouseover":"mouseout";fp=function(e){if(dojo.isFF<=2){try{e.relatedTarget.tagName;}catch(e2){return;}}if(!dojo.isDescendant(e.relatedTarget,node)){return ofp.call(this,e);}};}node.addEventListener(name,fp,false);return fp;},remove:function(node,_1bf,_1c0){if(node){_1bf=del._normalizeEventName(_1bf);if(!dojo.isIE&&(_1bf=="mouseenter"||_1bf=="mouseleave")){_1bf=(_1bf=="mouseenter")?"mouseover":"mouseout";}node.removeEventListener(_1bf,_1c0,false);}},_normalizeEventName:function(name){return name.slice(0,2)=="on"?name.slice(2):name;},_fixCallback:function(name,fp){return name!="keypress"?fp:function(e){return fp.call(this,del._fixEvent(e,this));};},_fixEvent:function(evt,_1c6){switch(evt.type){case "keypress":del._setKeyChar(evt);break;}return evt;},_setKeyChar:function(evt){evt.keyChar=evt.charCode?String.fromCharCode(evt.charCode):"";evt.charOrCode=evt.keyChar||evt.keyCode;},_punctMap:{106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39}});dojo.fixEvent=function(evt,_1c9){return del._fixEvent(evt,_1c9);};dojo.stopEvent=function(evt){evt.preventDefault();evt.stopPropagation();};var _1cb=dojo._listener;dojo._connect=function(obj,_1cd,_1ce,_1cf,_1d0){var _1d1=obj&&(obj.nodeType||obj.attachEvent||obj.addEventListener);var lid=_1d1?(_1d0?2:1):0,l=[dojo._listener,del,_1cb][lid];var h=l.add(obj,_1cd,dojo.hitch(_1ce,_1cf));return [obj,_1cd,h,lid];};dojo._disconnect=function(obj,_1d6,_1d7,_1d8){([dojo._listener,del,_1cb][_1d8]).remove(obj,_1d6,_1d7);};dojo.keys={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145};if(dojo.isIE){var _1d9=function(e,code){try{return (e.keyCode=code);}catch(e){return 0;}};var iel=dojo._listener;var _1dd=(dojo._ieListenersName="_"+dojo._scopeName+"_listeners");if(!dojo.config._allow_leaks){_1cb=iel=dojo._ie_listener={handlers:[],add:function(_1de,_1df,_1e0){_1de=_1de||dojo.global;var f=_1de[_1df];if(!f||!f[_1dd]){var d=dojo._getIeDispatcher();d.target=f&&(ieh.push(f)-1);d[_1dd]=[];f=_1de[_1df]=d;}return f[_1dd].push(ieh.push(_1e0)-1);},remove:function(_1e4,_1e5,_1e6){var f=(_1e4||dojo.global)[_1e5],l=f&&f[_1dd];if(f&&l&&_1e6--){delete ieh[l[_1e6]];delete l[_1e6];}}};var ieh=iel.handlers;}dojo.mixin(del,{add:function(node,_1ea,fp){if(!node){return;}_1ea=del._normalizeEventName(_1ea);if(_1ea=="onkeypress"){var kd=node.onkeydown;if(!kd||!kd[_1dd]||!kd._stealthKeydownHandle){var h=del.add(node,"onkeydown",del._stealthKeyDown);kd=node.onkeydown;kd._stealthKeydownHandle=h;kd._stealthKeydownRefs=1;}else{kd._stealthKeydownRefs++;}}return iel.add(node,_1ea,del._fixCallback(fp));},remove:function(node,_1ef,_1f0){_1ef=del._normalizeEventName(_1ef);iel.remove(node,_1ef,_1f0);if(_1ef=="onkeypress"){var kd=node.onkeydown;if(--kd._stealthKeydownRefs<=0){iel.remove(node,"onkeydown",kd._stealthKeydownHandle);delete kd._stealthKeydownHandle;}}},_normalizeEventName:function(_1f2){return _1f2.slice(0,2)!="on"?"on"+_1f2:_1f2;},_nop:function(){},_fixEvent:function(evt,_1f4){if(!evt){var w=_1f4&&(_1f4.ownerDocument||_1f4.document||_1f4).parentWindow||window;evt=w.event;}if(!evt){return (evt);}evt.target=evt.srcElement;evt.currentTarget=(_1f4||evt.srcElement);evt.layerX=evt.offsetX;evt.layerY=evt.offsetY;var se=evt.srcElement,doc=(se&&se.ownerDocument)||document;var _1f8=((dojo.isIE<6)||(doc["compatMode"]=="BackCompat"))?doc.body:doc.documentElement;var _1f9=dojo._getIeDocumentElementOffset();evt.pageX=evt.clientX+dojo._fixIeBiDiScrollLeft(_1f8.scrollLeft||0)-_1f9.x;evt.pageY=evt.clientY+(_1f8.scrollTop||0)-_1f9.y;if(evt.type=="mouseover"){evt.relatedTarget=evt.fromElement;}if(evt.type=="mouseout"){evt.relatedTarget=evt.toElement;}evt.stopPropagation=del._stopPropagation;evt.preventDefault=del._preventDefault;return del._fixKeys(evt);},_fixKeys:function(evt){switch(evt.type){case "keypress":var c=("charCode" in evt?evt.charCode:evt.keyCode);if(c==10){c=0;evt.keyCode=13;}else{if(c==13||c==27){c=0;}else{if(c==3){c=99;}}}evt.charCode=c;del._setKeyChar(evt);break;}return evt;},_stealthKeyDown:function(evt){var kp=evt.currentTarget.onkeypress;if(!kp||!kp[_1dd]){return;}var k=evt.keyCode;var _1ff=k!=13&&k!=32&&k!=27&&(k<48||k>90)&&(k<96||k>111)&&(k<186||k>192)&&(k<219||k>222);if(_1ff||evt.ctrlKey){var c=_1ff?0:k;if(evt.ctrlKey){if(k==3||k==13){return;}else{if(c>95&&c<106){c-=48;}else{if((!evt.shiftKey)&&(c>=65&&c<=90)){c+=32;}else{c=del._punctMap[c]||c;}}}}var faux=del._synthesizeEvent(evt,{type:"keypress",faux:true,charCode:c});kp.call(evt.currentTarget,faux);evt.cancelBubble=faux.cancelBubble;evt.returnValue=faux.returnValue;_1d9(evt,faux.keyCode);}},_stopPropagation:function(){this.cancelBubble=true;},_preventDefault:function(){this.bubbledKeyCode=this.keyCode;if(this.ctrlKey){_1d9(this,0);}this.returnValue=false;}});dojo.stopEvent=function(evt){evt=evt||window.event;del._stopPropagation.call(evt);del._preventDefault.call(evt);};}del._synthesizeEvent=function(evt,_204){var faux=dojo.mixin({},evt,_204);del._setKeyChar(faux);faux.preventDefault=function(){evt.preventDefault();};faux.stopPropagation=function(){evt.stopPropagation();};return faux;};if(dojo.isOpera){dojo.mixin(del,{_fixEvent:function(evt,_207){switch(evt.type){case "keypress":var c=evt.which;if(c==3){c=99;}c=c<41&&!evt.shiftKey?0:c;if(evt.ctrlKey&&!evt.shiftKey&&c>=65&&c<=90){c+=32;}return del._synthesizeEvent(evt,{charCode:c});}return evt;}});}if(dojo.isWebKit){del._add=del.add;del._remove=del.remove;dojo.mixin(del,{add:function(node,_20a,fp){if(!node){return;}var _20c=del._add(node,_20a,fp);if(del._normalizeEventName(_20a)=="keypress"){_20c._stealthKeyDownHandle=del._add(node,"keydown",function(evt){var k=evt.keyCode;var _20f=k!=13&&k!=32&&k!=27&&(k<48||k>90)&&(k<96||k>111)&&(k<186||k>192)&&(k<219||k>222);if(_20f||evt.ctrlKey){var c=_20f?0:k;if(evt.ctrlKey){if(k==3||k==13){return;}else{if(c>95&&c<106){c-=48;}else{if(!evt.shiftKey&&c>=65&&c<=90){c+=32;}else{c=del._punctMap[c]||c;}}}}var faux=del._synthesizeEvent(evt,{type:"keypress",faux:true,charCode:c});fp.call(evt.currentTarget,faux);}});}return _20c;},remove:function(node,_213,_214){if(node){if(_214._stealthKeyDownHandle){del._remove(node,"keydown",_214._stealthKeyDownHandle);}del._remove(node,_213,_214);}},_fixEvent:function(evt,_216){switch(evt.type){case "keypress":if(evt.faux){return evt;}var c=evt.charCode;c=c>=32?c:0;return del._synthesizeEvent(evt,{charCode:c,faux:true});}return evt;}});}})();if(dojo.isIE){dojo._ieDispatcher=function(args,_219){var ap=Array.prototype,h=dojo._ie_listener.handlers,c=args.callee,ls=c[dojo._ieListenersName],t=h[c.target];var r=t&&t.apply(_219,args);var lls=[].concat(ls);for(var i in lls){if(!(i in ap)){h[lls[i]].apply(_219,args);}}return r;};dojo._getIeDispatcher=function(){return new Function(dojo._scopeName+"._ieDispatcher(arguments, this)");};dojo._event_listener._fixCallback=function(fp){var f=dojo._event_listener._fixEvent;return function(e){return fp.call(this,f(e,this));};};}}if(!dojo._hasResource["dojo._base.html"]){dojo._hasResource["dojo._base.html"]=true;dojo.provide("dojo._base.html");try{document.execCommand("BackgroundImageCache",false,true);}catch(e){}if(dojo.isIE||dojo.isOpera){dojo.byId=function(id,doc){if(dojo.isString(id)){var _d=doc||dojo.doc;var te=_d.getElementById(id);if(te&&(te.attributes.id.value==id||te.id==id)){return te;}else{var eles=_d.all[id];if(!eles||eles.nodeName){eles=[eles];}var i=0;while((te=eles[i++])){if((te.attributes&&te.attributes.id&&te.attributes.id.value==id)||te.id==id){return te;}}}}else{return id;}};}else{dojo.byId=function(id,doc){return dojo.isString(id)?(doc||dojo.doc).getElementById(id):id;};}(function(){var d=dojo;var _22e=null;d.addOnWindowUnload(function(){_22e=null;});dojo._destroyElement=dojo.destroy=function(node){node=d.byId(node);try{if(!_22e||_22e.ownerDocument!=node.ownerDocument){_22e=node.ownerDocument.createElement("div");}_22e.appendChild(node.parentNode?node.parentNode.removeChild(node):node);_22e.innerHTML="";}catch(e){}};dojo.isDescendant=function(node,_231){try{node=d.byId(node);_231=d.byId(_231);while(node){if(node===_231){return true;}node=node.parentNode;}}catch(e){}return false;};dojo.setSelectable=function(node,_233){node=d.byId(node);if(d.isMozilla){node.style.MozUserSelect=_233?"":"none";}else{if(d.isKhtml||d.isWebKit){node.style.KhtmlUserSelect=_233?"auto":"none";}else{if(d.isIE){var v=(node.unselectable=_233?"":"on");d.query("*",node).forEach("item.unselectable = '"+v+"'");}}}};var _235=function(node,ref){var _238=ref.parentNode;if(_238){_238.insertBefore(node,ref);}};var _239=function(node,ref){var _23c=ref.parentNode;if(_23c){if(_23c.lastChild==ref){_23c.appendChild(node);}else{_23c.insertBefore(node,ref.nextSibling);}}};dojo.place=function(node,_23e,_23f){_23e=d.byId(_23e);if(d.isString(node)){node=node.charAt(0)=="<"?d._toDom(node,_23e.ownerDocument):d.byId(node);}if(typeof _23f=="number"){var cn=_23e.childNodes;if(!cn.length||cn.length<=_23f){_23e.appendChild(node);}else{_235(node,cn[_23f<0?0:_23f]);}}else{switch(_23f){case "before":_235(node,_23e);break;case "after":_239(node,_23e);break;case "replace":_23e.parentNode.replaceChild(node,_23e);break;case "only":d.empty(_23e);_23e.appendChild(node);break;case "first":if(_23e.firstChild){_235(node,_23e.firstChild);break;}default:_23e.appendChild(node);}}return node;};dojo.boxModel="content-box";if(d.isIE){var _dcm=document.compatMode;d.boxModel=_dcm=="BackCompat"||_dcm=="QuirksMode"||d.isIE<6?"border-box":"content-box";}var gcs;if(d.isWebKit){gcs=function(node){var s;if(node instanceof HTMLElement){var dv=node.ownerDocument.defaultView;s=dv.getComputedStyle(node,null);if(!s&&node.style){node.style.display="";s=dv.getComputedStyle(node,null);}}return s||{};};}else{if(d.isIE){gcs=function(node){return node.nodeType==1?node.currentStyle:{};};}else{gcs=function(node){return node instanceof HTMLElement?node.ownerDocument.defaultView.getComputedStyle(node,null):{};};}}dojo.getComputedStyle=gcs;if(!d.isIE){d._toPixelValue=function(_248,_249){return parseFloat(_249)||0;};}else{d._toPixelValue=function(_24a,_24b){if(!_24b){return 0;}if(_24b=="medium"){return 4;}if(_24b.slice&&_24b.slice(-2)=="px"){return parseFloat(_24b);}with(_24a){var _24c=style.left;var _24d=runtimeStyle.left;runtimeStyle.left=currentStyle.left;try{style.left=_24b;_24b=style.pixelLeft;}catch(e){_24b=0;}style.left=_24c;runtimeStyle.left=_24d;}return _24b;};}var px=d._toPixelValue;var astr="DXImageTransform.Microsoft.Alpha";var af=function(n,f){try{return n.filters.item(astr);}catch(e){return f?{}:null;}};dojo._getOpacity=d.isIE?function(node){try{return af(node).Opacity/100;}catch(e){return 1;}}:function(node){return gcs(node).opacity;};dojo._setOpacity=d.isIE?function(node,_256){var ov=_256*100;node.style.zoom=1;af(node,1).Enabled=!(_256==1);if(!af(node)){node.style.filter+=" progid:"+astr+"(Opacity="+ov+")";}else{af(node,1).Opacity=ov;}if(node.nodeName.toLowerCase()=="tr"){d.query("> td",node).forEach(function(i){d._setOpacity(i,_256);});}return _256;}:function(node,_25a){return node.style.opacity=_25a;};var _25b={left:true,top:true};var _25c=/margin|padding|width|height|max|min|offset/;var _25d=function(node,type,_260){type=type.toLowerCase();if(d.isIE){if(_260=="auto"){if(type=="height"){return node.offsetHeight;}if(type=="width"){return node.offsetWidth;}}if(type=="fontweight"){switch(_260){case 700:return "bold";case 400:default:return "normal";}}}if(!(type in _25b)){_25b[type]=_25c.test(type);}return _25b[type]?px(node,_260):_260;};var _261=d.isIE?"styleFloat":"cssFloat",_262={"cssFloat":_261,"styleFloat":_261,"float":_261};dojo.style=function(node,_264,_265){var n=d.byId(node),args=arguments.length,op=(_264=="opacity");_264=_262[_264]||_264;if(args==3){return op?d._setOpacity(n,_265):n.style[_264]=_265;}if(args==2&&op){return d._getOpacity(n);}var s=gcs(n);if(args==2&&!d.isString(_264)){for(var x in _264){d.style(node,x,_264[x]);}return s;}return (args==1)?s:_25d(n,_264,s[_264]||n.style[_264]);};dojo._getPadExtents=function(n,_26c){var s=_26c||gcs(n),l=px(n,s.paddingLeft),t=px(n,s.paddingTop);return {l:l,t:t,w:l+px(n,s.paddingRight),h:t+px(n,s.paddingBottom)};};dojo._getBorderExtents=function(n,_271){var ne="none",s=_271||gcs(n),bl=(s.borderLeftStyle!=ne?px(n,s.borderLeftWidth):0),bt=(s.borderTopStyle!=ne?px(n,s.borderTopWidth):0);return {l:bl,t:bt,w:bl+(s.borderRightStyle!=ne?px(n,s.borderRightWidth):0),h:bt+(s.borderBottomStyle!=ne?px(n,s.borderBottomWidth):0)};};dojo._getPadBorderExtents=function(n,_277){var s=_277||gcs(n),p=d._getPadExtents(n,s),b=d._getBorderExtents(n,s);return {l:p.l+b.l,t:p.t+b.t,w:p.w+b.w,h:p.h+b.h};};dojo._getMarginExtents=function(n,_27c){var s=_27c||gcs(n),l=px(n,s.marginLeft),t=px(n,s.marginTop),r=px(n,s.marginRight),b=px(n,s.marginBottom);if(d.isWebKit&&(s.position!="absolute")){r=l;}return {l:l,t:t,w:l+r,h:t+b};};dojo._getMarginBox=function(node,_283){var s=_283||gcs(node),me=d._getMarginExtents(node,s);var l=node.offsetLeft-me.l,t=node.offsetTop-me.t,p=node.parentNode;if(d.isMoz){var sl=parseFloat(s.left),st=parseFloat(s.top);if(!isNaN(sl)&&!isNaN(st)){l=sl,t=st;}else{if(p&&p.style){var pcs=gcs(p);if(pcs.overflow!="visible"){var be=d._getBorderExtents(p,pcs);l+=be.l,t+=be.t;}}}}else{if(d.isOpera||(d.isIE>7&&!d.isQuirks)){if(p){be=d._getBorderExtents(p);l-=be.l;t-=be.t;}}}return {l:l,t:t,w:node.offsetWidth+me.w,h:node.offsetHeight+me.h};};dojo._getContentBox=function(node,_28e){var s=_28e||gcs(node),pe=d._getPadExtents(node,s),be=d._getBorderExtents(node,s),w=node.clientWidth,h;if(!w){w=node.offsetWidth,h=node.offsetHeight;}else{h=node.clientHeight,be.w=be.h=0;}if(d.isOpera){pe.l+=be.l;pe.t+=be.t;}return {l:pe.l,t:pe.t,w:w-pe.w-be.w,h:h-pe.h-be.h};};dojo._getBorderBox=function(node,_295){var s=_295||gcs(node),pe=d._getPadExtents(node,s),cb=d._getContentBox(node,s);return {l:cb.l-pe.l,t:cb.t-pe.t,w:cb.w+pe.w,h:cb.h+pe.h};};dojo._setBox=function(node,l,t,w,h,u){u=u||"px";var s=node.style;if(!isNaN(l)){s.left=l+u;}if(!isNaN(t)){s.top=t+u;}if(w>=0){s.width=w+u;}if(h>=0){s.height=h+u;}};dojo._isButtonTag=function(node){return node.tagName=="BUTTON"||node.tagName=="INPUT"&&node.getAttribute("type").toUpperCase()=="BUTTON";};dojo._usesBorderBox=function(node){var n=node.tagName;return d.boxModel=="border-box"||n=="TABLE"||d._isButtonTag(node);};dojo._setContentSize=function(node,_2a4,_2a5,_2a6){if(d._usesBorderBox(node)){var pb=d._getPadBorderExtents(node,_2a6);if(_2a4>=0){_2a4+=pb.w;}if(_2a5>=0){_2a5+=pb.h;}}d._setBox(node,NaN,NaN,_2a4,_2a5);};dojo._setMarginBox=function(node,_2a9,_2aa,_2ab,_2ac,_2ad){var s=_2ad||gcs(node),bb=d._usesBorderBox(node),pb=bb?_2b1:d._getPadBorderExtents(node,s);if(d.isWebKit){if(d._isButtonTag(node)){var ns=node.style;if(_2ab>=0&&!ns.width){ns.width="4px";}if(_2ac>=0&&!ns.height){ns.height="4px";}}}var mb=d._getMarginExtents(node,s);if(_2ab>=0){_2ab=Math.max(_2ab-pb.w-mb.w,0);}if(_2ac>=0){_2ac=Math.max(_2ac-pb.h-mb.h,0);}d._setBox(node,_2a9,_2aa,_2ab,_2ac);};var _2b1={l:0,t:0,w:0,h:0};dojo.marginBox=function(node,box){var n=d.byId(node),s=gcs(n),b=box;return !b?d._getMarginBox(n,s):d._setMarginBox(n,b.l,b.t,b.w,b.h,s);};dojo.contentBox=function(node,box){var n=d.byId(node),s=gcs(n),b=box;return !b?d._getContentBox(n,s):d._setContentSize(n,b.w,b.h,s);};var _2be=function(node,prop){if(!(node=(node||0).parentNode)){return 0;}var val,_2c2=0,_b=d.body();while(node&&node.style){if(gcs(node).position=="fixed"){return 0;}val=node[prop];if(val){_2c2+=val-0;if(node==_b){break;}}node=node.parentNode;}return _2c2;};dojo._docScroll=function(){var _b=d.body(),_w=d.global,de=d.doc.documentElement;return {y:(_w.pageYOffset||de.scrollTop||_b.scrollTop||0),x:(_w.pageXOffset||d._fixIeBiDiScrollLeft(de.scrollLeft)||_b.scrollLeft||0)};};dojo._isBodyLtr=function(){return ("_bodyLtr" in d)?d._bodyLtr:d._bodyLtr=gcs(d.body()).direction=="ltr";};dojo._getIeDocumentElementOffset=function(){var de=d.doc.documentElement;if(d.isIE<7){return {x:d._isBodyLtr()||window.parent==window?de.clientLeft:de.offsetWidth-de.clientWidth-de.clientLeft,y:de.clientTop};}else{if(d.isIE<8){return {x:de.getBoundingClientRect().left,y:de.getBoundingClientRect().top};}else{return {x:0,y:0};}}};dojo._fixIeBiDiScrollLeft=function(_2c8){var dd=d.doc;if(d.isIE<8&&!d._isBodyLtr()){var de=dd.compatMode=="BackCompat"?dd.body:dd.documentElement;return _2c8+de.clientWidth-de.scrollWidth;}return _2c8;};dojo._abs=function(node,_2cc){var db=d.body(),dh=d.body().parentNode,ret;if(node["getBoundingClientRect"]){var _2d0=node.getBoundingClientRect();ret={x:_2d0.left,y:_2d0.top};if(d.isFF>=3){var cs=gcs(dh);ret.x-=px(dh,cs.marginLeft)+px(dh,cs.borderLeftWidth);ret.y-=px(dh,cs.marginTop)+px(dh,cs.borderTopWidth);}if(d.isIE){var _2d2=d._getIeDocumentElementOffset();ret.x-=_2d2.x+(d.isQuirks?db.clientLeft:0);ret.y-=_2d2.y+(d.isQuirks?db.clientTop:0);}}else{ret={x:0,y:0};if(node["offsetParent"]){ret.x-=_2be(node,"scrollLeft");ret.y-=_2be(node,"scrollTop");var _2d3=node;do{var n=_2d3.offsetLeft,t=_2d3.offsetTop;ret.x+=isNaN(n)?0:n;ret.y+=isNaN(t)?0:t;cs=gcs(_2d3);if(_2d3!=node){if(d.isFF){ret.x+=2*px(_2d3,cs.borderLeftWidth);ret.y+=2*px(_2d3,cs.borderTopWidth);}else{ret.x+=px(_2d3,cs.borderLeftWidth);ret.y+=px(_2d3,cs.borderTopWidth);}}if(d.isFF&&cs.position=="static"){var _2d6=_2d3.parentNode;while(_2d6!=_2d3.offsetParent){var pcs=gcs(_2d6);if(pcs.position=="static"){ret.x+=px(_2d3,pcs.borderLeftWidth);ret.y+=px(_2d3,pcs.borderTopWidth);}_2d6=_2d6.parentNode;}}_2d3=_2d3.offsetParent;}while((_2d3!=dh)&&_2d3);}else{if(node.x&&node.y){ret.x+=isNaN(node.x)?0:node.x;ret.y+=isNaN(node.y)?0:node.y;}}}if(_2cc){var _2d8=d._docScroll();ret.x+=_2d8.x;ret.y+=_2d8.y;}return ret;};dojo.coords=function(node,_2da){var n=d.byId(node),s=gcs(n),mb=d._getMarginBox(n,s);var abs=d._abs(n,_2da);mb.x=abs.x;mb.y=abs.y;return mb;};var _2df=d.isIE<8;var _2e0=function(name){switch(name.toLowerCase()){case "tabindex":return _2df?"tabIndex":"tabindex";case "readonly":return "readOnly";case "class":return "className";case "for":case "htmlfor":return _2df?"htmlFor":"for";default:return name;}};var _2e2={colspan:"colSpan",enctype:"enctype",frameborder:"frameborder",method:"method",rowspan:"rowSpan",scrolling:"scrolling",shape:"shape",span:"span",type:"type",valuetype:"valueType",classname:"className",innerhtml:"innerHTML"};dojo.hasAttr=function(node,name){node=d.byId(node);var _2e5=_2e0(name);_2e5=_2e5=="htmlFor"?"for":_2e5;var attr=node.getAttributeNode&&node.getAttributeNode(_2e5);return attr?attr.specified:false;};var _2e7={},_ctr=0,_2e9=dojo._scopeName+"attrid",_2ea={col:1,colgroup:1,table:1,tbody:1,tfoot:1,thead:1,tr:1,title:1};dojo.attr=function(node,name,_2ed){node=d.byId(node);var args=arguments.length;if(args==2&&!d.isString(name)){for(var x in name){d.attr(node,x,name[x]);}return;}name=_2e0(name);if(args==3){if(d.isFunction(_2ed)){var _2f0=d.attr(node,_2e9);if(!_2f0){_2f0=_ctr++;d.attr(node,_2e9,_2f0);}if(!_2e7[_2f0]){_2e7[_2f0]={};}var h=_2e7[_2f0][name];if(h){d.disconnect(h);}else{try{delete node[name];}catch(e){}}_2e7[_2f0][name]=d.connect(node,name,_2ed);}else{if(typeof _2ed=="boolean"){node[name]=_2ed;}else{if(name==="style"&&!d.isString(_2ed)){d.style(node,_2ed);}else{if(name=="className"){node.className=_2ed;}else{if(name==="innerHTML"){if(d.isIE&&node.tagName.toLowerCase() in _2ea){d.empty(node);node.appendChild(d._toDom(_2ed,node.ownerDocument));}else{node[name]=_2ed;}}else{node.setAttribute(name,_2ed);}}}}}}else{var prop=_2e2[name.toLowerCase()];if(prop){return node[prop];}var _2f3=node[name];return (typeof _2f3=="boolean"||typeof _2f3=="function")?_2f3:(d.hasAttr(node,name)?node.getAttribute(name):null);}};dojo.removeAttr=function(node,name){d.byId(node).removeAttribute(_2e0(name));};dojo.create=function(tag,_2f7,_2f8,pos){var doc=d.doc;if(_2f8){_2f8=d.byId(_2f8);doc=_2f8.ownerDocument;}if(d.isString(tag)){tag=doc.createElement(tag);}if(_2f7){d.attr(tag,_2f7);}if(_2f8){d.place(tag,_2f8,pos);}return tag;};d.empty=d.isIE?function(node){node=d.byId(node);for(var c;c=node.lastChild;){d.destroy(c);}}:function(node){d.byId(node).innerHTML="";};var _2fe={option:["select"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},_2ff=/<\s*([\w\:]+)/,_300={},_301=0,_302="__"+d._scopeName+"ToDomId";for(var _303 in _2fe){var tw=_2fe[_303];tw.pre=_303=="option"?"<select multiple=\"multiple\">":"<"+tw.join("><")+">";tw.post="</"+tw.reverse().join("></")+">";}d._toDom=function(frag,doc){doc=doc||d.doc;var _307=doc[_302];if(!_307){doc[_302]=_307=++_301+"";_300[_307]=doc.createElement("div");}frag+="";var _308=frag.match(_2ff),tag=_308?_308[1].toLowerCase():"",_30a=_300[_307],wrap,i,fc,df;if(_308&&_2fe[tag]){wrap=_2fe[tag];_30a.innerHTML=wrap.pre+frag+wrap.post;for(i=wrap.length;i;--i){_30a=_30a.firstChild;}}else{_30a.innerHTML=frag;}if(_30a.childNodes.length==1){return _30a.removeChild(_30a.firstChild);}df=doc.createDocumentFragment();while(fc=_30a.firstChild){df.appendChild(fc);}return df;};var _30e="className";dojo.hasClass=function(node,_310){return ((" "+d.byId(node)[_30e]+" ").indexOf(" "+_310+" ")>=0);};dojo.addClass=function(node,_312){node=d.byId(node);var cls=node[_30e];if((" "+cls+" ").indexOf(" "+_312+" ")<0){node[_30e]=cls+(cls?" ":"")+_312;}};dojo.removeClass=function(node,_315){node=d.byId(node);var t=d.trim((" "+node[_30e]+" ").replace(" "+_315+" "," "));if(node[_30e]!=t){node[_30e]=t;}};dojo.toggleClass=function(node,_318,_319){if(_319===undefined){_319=!d.hasClass(node,_318);}d[_319?"addClass":"removeClass"](node,_318);};})();}if(!dojo._hasResource["dojo._base.NodeList"]){dojo._hasResource["dojo._base.NodeList"]=true;dojo.provide("dojo._base.NodeList");(function(){var d=dojo;var ap=Array.prototype,aps=ap.slice,apc=ap.concat;var tnl=function(a){a.constructor=d.NodeList;dojo._mixin(a,d.NodeList.prototype);return a;};var _320=function(f,a,o){a=[0].concat(aps.call(a,0));o=o||d.global;return function(node){a[0]=node;return f.apply(o,a);};};var _325=function(f,o){return function(){this.forEach(_320(f,arguments,o));return this;};};var _328=function(f,o){return function(){return this.map(_320(f,arguments,o));};};var _32b=function(f,o){return function(){return this.filter(_320(f,arguments,o));};};var _32e=function(f,g,o){return function(){var a=arguments,body=_320(f,a,o);if(g.call(o||d.global,a)){return this.map(body);}this.forEach(body);return this;};};var _334=function(a){return a.length==1&&d.isString(a[0]);};var _336=function(node){var p=node.parentNode;if(p){p.removeChild(node);}};dojo.NodeList=function(){return tnl(Array.apply(null,arguments));};var nl=d.NodeList,nlp=nl.prototype;nl._wrap=tnl;nl._adaptAsMap=_328;nl._adaptAsForEach=_325;nl._adaptAsFilter=_32b;nl._adaptWithCondition=_32e;d.forEach(["slice","splice"],function(name){var f=ap[name];nlp[name]=function(){return tnl(f.apply(this,arguments));};});d.forEach(["indexOf","lastIndexOf","every","some"],function(name){var f=d[name];nlp[name]=function(){return f.apply(d,[this].concat(aps.call(arguments,0)));};});d.forEach(["attr","style"],function(name){nlp[name]=_32e(d[name],_334);});d.forEach(["connect","addClass","removeClass","toggleClass","empty"],function(name){nlp[name]=_325(d[name]);});dojo.extend(dojo.NodeList,{concat:function(item){var t=d.isArray(this)?this:aps.call(this,0),m=d.map(arguments,function(a){return a&&!d.isArray(a)&&(a.constructor===NodeList||a.constructor==nl)?aps.call(a,0):a;});return tnl(apc.apply(t,m));},map:function(func,obj){return tnl(d.map(this,func,obj));},forEach:function(_347,_348){d.forEach(this,_347,_348);return this;},coords:_328(d.coords),place:function(_349,_34a){var item=d.query(_349)[0];return this.forEach(function(node){d.place(node,item,_34a);});},orphan:function(_34d){return (_34d?d._filterQueryResult(this,_34d):this).forEach(_336);},adopt:function(_34e,_34f){return d.query(_34e).place(item[0],_34f);},query:function(_350){if(!_350){return this;}var ret=this.map(function(node){return d.query(_350,node).filter(function(_353){return _353!==undefined;});});return tnl(apc.apply([],ret));},filter:function(_354){var a=arguments,_356=this,_357=0;if(d.isString(_354)){_356=d._filterQueryResult(this,a[0]);if(a.length==1){return _356;}_357=1;}return tnl(d.filter(_356,a[_357],a[_357+1]));},addContent:function(_358,_359){var c=d.isString(_358)?d._toDom(_358,this[0]&&this[0].ownerDocument):_358,i,l=this.length-1;for(i=0;i<l;++i){d.place(c.cloneNode(true),this[i],_359);}if(l>=0){d.place(c,this[l],_359);}return this;},instantiate:function(_35c,_35d){var c=d.isFunction(_35c)?_35c:d.getObject(_35c);_35d=_35d||{};return this.forEach(function(node){new c(_35d,node);});},at:function(){var t=new dojo.NodeList();d.forEach(arguments,function(i){if(this[i]){t.push(this[i]);}},this);return t;}});d.forEach(["blur","focus","change","click","error","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","submit"],function(evt){var _oe="on"+evt;nlp[_oe]=function(a,b){return this.connect(_oe,a,b);};});})();}if(!dojo._hasResource["dojo._base.query"]){dojo._hasResource["dojo._base.query"]=true;if(typeof dojo!="undefined"){dojo.provide("dojo._base.query");}(function(d){var trim=d.trim;var each=d.forEach;var qlc=d._queryListCtor=d.NodeList;var _36a=d.isString;var _36b=function(){return d.doc;};var _36c=(d.isWebKit&&((_36b().compatMode)=="BackCompat"));var _36d=!!_36b().firstChild["children"]?"children":"childNodes";var _36e=">~+";var _36f=false;var _370=function(){return true;};var _371=function(_372){if(_36e.indexOf(_372.slice(-1))>=0){_372+=" * ";}else{_372+=" ";}var ts=function(s,e){return trim(_372.slice(s,e));};var _376=[];var _377=-1,_378=-1,_379=-1,_37a=-1,_37b=-1,inId=-1,_37d=-1,lc="",cc="",_380;var x=0,ql=_372.length,_383=null,_cp=null;var _385=function(){if(_37d>=0){var tv=(_37d==x)?null:ts(_37d,x);_383[(_36e.indexOf(tv)<0)?"tag":"oper"]=tv;_37d=-1;}};var _387=function(){if(inId>=0){_383.id=ts(inId,x).replace(/\\/g,"");inId=-1;}};var _388=function(){if(_37b>=0){_383.classes.push(ts(_37b+1,x).replace(/\\/g,""));_37b=-1;}};var _389=function(){_387();_385();_388();};var _38a=function(){_389();if(_37a>=0){_383.pseudos.push({name:ts(_37a+1,x)});}_383.loops=(_383.pseudos.length||_383.attrs.length||_383.classes.length);_383.oquery=_383.query=ts(_380,x);_383.otag=_383.tag=(_383["oper"])?null:(_383.tag||"*");if(_383.tag){_383.tag=_383.tag.toUpperCase();}if(_376.length&&(_376[_376.length-1].oper)){_383.infixOper=_376.pop();_383.query=_383.infixOper.query+" "+_383.query;}_376.push(_383);_383=null;};for(;lc=cc,cc=_372.charAt(x),x<ql;x++){if(lc=="\\"){continue;}if(!_383){_380=x;_383={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return (_36f)?this.otag:this.tag;}};_37d=x;}if(_377>=0){if(cc=="]"){if(!_cp.attr){_cp.attr=ts(_377+1,x);}else{_cp.matchFor=ts((_379||_377+1),x);}var cmf=_cp.matchFor;if(cmf){if((cmf.charAt(0)=="\"")||(cmf.charAt(0)=="'")){_cp.matchFor=cmf.slice(1,-1);}}_383.attrs.push(_cp);_cp=null;_377=_379=-1;}else{if(cc=="="){var _38c=("|~^$*".indexOf(lc)>=0)?lc:"";_cp.type=_38c+cc;_cp.attr=ts(_377+1,x-_38c.length);_379=x+1;}}}else{if(_378>=0){if(cc==")"){if(_37a>=0){_cp.value=ts(_378+1,x);}_37a=_378=-1;}}else{if(cc=="#"){_389();inId=x+1;}else{if(cc=="."){_389();_37b=x;}else{if(cc==":"){_389();_37a=x;}else{if(cc=="["){_389();_377=x;_cp={};}else{if(cc=="("){if(_37a>=0){_cp={name:ts(_37a+1,x),value:null};_383.pseudos.push(_cp);}_378=x;}else{if((cc==" ")&&(lc!=cc)){_38a();}}}}}}}}}return _376;};var _38d=function(_38e,_38f){if(!_38e){return _38f;}if(!_38f){return _38e;}return function(){return _38e.apply(window,arguments)&&_38f.apply(window,arguments);};};var _390=function(i,arr){var r=arr||[];if(i){r.push(i);}return r;};var _394=function(n){return (1==n.nodeType);};var _396="";var _397=function(elem,attr){if(!elem){return _396;}if(attr=="class"){return elem.className||_396;}if(attr=="for"){return elem.htmlFor||_396;}if(attr=="style"){return elem.style.cssText||_396;}return (_36f?elem.getAttribute(attr):elem.getAttribute(attr,2))||_396;};var _39a={"*=":function(attr,_39c){return function(elem){return (_397(elem,attr).indexOf(_39c)>=0);};},"^=":function(attr,_39f){return function(elem){return (_397(elem,attr).indexOf(_39f)==0);};},"$=":function(attr,_3a2){var tval=" "+_3a2;return function(elem){var ea=" "+_397(elem,attr);return (ea.lastIndexOf(_3a2)==(ea.length-_3a2.length));};},"~=":function(attr,_3a7){var tval=" "+_3a7+" ";return function(elem){var ea=" "+_397(elem,attr)+" ";return (ea.indexOf(tval)>=0);};},"|=":function(attr,_3ac){var _3ad=" "+_3ac+"-";return function(elem){var ea=" "+_397(elem,attr);return ((ea==_3ac)||(ea.indexOf(_3ad)==0));};},"=":function(attr,_3b1){return function(elem){return (_397(elem,attr)==_3b1);};}};var _3b3=(typeof _36b().firstChild.nextElementSibling=="undefined");var _ns=!_3b3?"nextElementSibling":"nextSibling";var _ps=!_3b3?"previousElementSibling":"previousSibling";var _3b6=(_3b3?_394:_370);var _3b7=function(node){while(node=node[_ps]){if(_3b6(node)){return false;}}return true;};var _3b9=function(node){while(node=node[_ns]){if(_3b6(node)){return false;}}return true;};var _3bb=function(node){var root=node.parentNode;var i=0,tret=root[_36d],ci=(node["_i"]||-1),cl=(root["_l"]||-1);if(!tret){return -1;}var l=tret.length;if(cl==l&&ci>=0&&cl>=0){return ci;}root["_l"]=l;ci=-1;for(var te=root["firstElementChild"]||root["firstChild"];te;te=te[_ns]){if(_3b6(te)){te["_i"]=++i;if(node===te){ci=i;}}}return ci;};var _3c4=function(elem){return !((_3bb(elem))%2);};var _3c6=function(elem){return ((_3bb(elem))%2);};var _3c8={"checked":function(name,_3ca){return function(elem){return !!d.attr(elem,"checked");};},"first-child":function(){return _3b7;},"last-child":function(){return _3b9;},"only-child":function(name,_3cd){return function(node){if(!_3b7(node)){return false;}if(!_3b9(node)){return false;}return true;};},"empty":function(name,_3d0){return function(elem){var cn=elem.childNodes;var cnl=elem.childNodes.length;for(var x=cnl-1;x>=0;x--){var nt=cn[x].nodeType;if((nt===1)||(nt==3)){return false;}}return true;};},"contains":function(name,_3d7){var cz=_3d7.charAt(0);if(cz=="\""||cz=="'"){_3d7=_3d7.slice(1,-1);}return function(elem){return (elem.innerHTML.indexOf(_3d7)>=0);};},"not":function(name,_3db){var p=_371(_3db)[0];var _3dd={el:1};if(p.tag!="*"){_3dd.tag=1;}if(!p.classes.length){_3dd.classes=1;}var ntf=_3df(p,_3dd);return function(elem){return (!ntf(elem));};},"nth-child":function(name,_3e2){var pi=parseInt;if(_3e2=="odd"){return _3c6;}else{if(_3e2=="even"){return _3c4;}}if(_3e2.indexOf("n")!=-1){var _3e4=_3e2.split("n",2);var pred=_3e4[0]?((_3e4[0]=="-")?-1:pi(_3e4[0])):1;var idx=_3e4[1]?pi(_3e4[1]):0;var lb=0,ub=-1;if(pred>0){if(idx<0){idx=(idx%pred)&&(pred+(idx%pred));}else{if(idx>0){if(idx>=pred){lb=idx-idx%pred;}idx=idx%pred;}}}else{if(pred<0){pred*=-1;if(idx>0){ub=idx;idx=idx%pred;}}}if(pred>0){return function(elem){var i=_3bb(elem);return (i>=lb)&&(ub<0||i<=ub)&&((i%pred)==idx);};}else{_3e2=idx;}}var _3eb=pi(_3e2);return function(elem){return (_3bb(elem)==_3eb);};}};var _3ed=(d.isIE)?function(cond){var clc=cond.toLowerCase();if(clc=="class"){cond="className";}return function(elem){return (_36f?elem.getAttribute(cond):elem[cond]||elem[clc]);};}:function(cond){return function(elem){return (elem&&elem.getAttribute&&elem.hasAttribute(cond));};};var _3df=function(_3f3,_3f4){if(!_3f3){return _370;}_3f4=_3f4||{};var ff=null;if(!("el" in _3f4)){ff=_38d(ff,_394);}if(!("tag" in _3f4)){if(_3f3.tag!="*"){ff=_38d(ff,function(elem){return (elem&&(elem.tagName==_3f3.getTag()));});}}if(!("classes" in _3f4)){each(_3f3.classes,function(_3f7,idx,arr){var re=new RegExp("(?:^|\\s)"+_3f7+"(?:\\s|$)");ff=_38d(ff,function(elem){return re.test(elem.className);});ff.count=idx;});}if(!("pseudos" in _3f4)){each(_3f3.pseudos,function(_3fc){var pn=_3fc.name;if(_3c8[pn]){ff=_38d(ff,_3c8[pn](pn,_3fc.value));}});}if(!("attrs" in _3f4)){each(_3f3.attrs,function(attr){var _3ff;var a=attr.attr;if(attr.type&&_39a[attr.type]){_3ff=_39a[attr.type](a,attr.matchFor);}else{if(a.length){_3ff=_3ed(a);}}if(_3ff){ff=_38d(ff,_3ff);}});}if(!("id" in _3f4)){if(_3f3.id){ff=_38d(ff,function(elem){return (!!elem&&(elem.id==_3f3.id));});}}if(!ff){if(!("default" in _3f4)){ff=_370;}}return ff;};var _402=function(_403){return function(node,ret,bag){while(node=node[_ns]){if(_3b3&&(!_394(node))){continue;}if((!bag||_407(node,bag))&&_403(node)){ret.push(node);}break;}return ret;};};var _408=function(_409){return function(root,ret,bag){var te=root[_ns];while(te){if(_3b6(te)){if(bag&&!_407(te,bag)){break;}if(_409(te)){ret.push(te);}}te=te[_ns];}return ret;};};var _40e=function(_40f){_40f=_40f||_370;return function(root,ret,bag){var te,x=0,tret=root[_36d];while(te=tret[x++]){if(_3b6(te)&&(!bag||_407(te,bag))&&(_40f(te,x))){ret.push(te);}}return ret;};};var _416=function(node,root){var pn=node.parentNode;while(pn){if(pn==root){break;}pn=pn.parentNode;}return !!pn;};var _41a={};var _41b=function(_41c){var _41d=_41a[_41c.query];if(_41d){return _41d;}var io=_41c.infixOper;var oper=(io?io.oper:"");var _420=_3df(_41c,{el:1});var qt=_41c.tag;var _422=("*"==qt);var ecs=_36b()["getElementsByClassName"];if(!oper){if(_41c.id){_420=(!_41c.loops&&_422)?_370:_3df(_41c,{el:1,id:1});_41d=function(root,arr){var te=d.byId(_41c.id,(root.ownerDocument||root));if(!te||!_420(te)){return;}if(9==root.nodeType){return _390(te,arr);}else{if(_416(te,root)){return _390(te,arr);}}};}else{if(ecs&&/\{\s*\[native code\]\s*\}/.test(String(ecs))&&_41c.classes.length&&!_36c){_420=_3df(_41c,{el:1,classes:1,id:1});var _427=_41c.classes.join(" ");_41d=function(root,arr){var ret=_390(0,arr),te,x=0;var tret=root.getElementsByClassName(_427);while((te=tret[x++])){if(_420(te,root)){ret.push(te);}}return ret;};}else{if(!_422&&!_41c.loops){_41d=function(root,arr){var ret=_390(0,arr),te,x=0;var tret=root.getElementsByTagName(_41c.getTag());while((te=tret[x++])){ret.push(te);}return ret;};}else{_420=_3df(_41c,{el:1,tag:1,id:1});_41d=function(root,arr){var ret=_390(0,arr),te,x=0;var tret=root.getElementsByTagName(_41c.getTag());while((te=tret[x++])){if(_420(te,root)){ret.push(te);}}return ret;};}}}}else{var _43a={el:1};if(_422){_43a.tag=1;}_420=_3df(_41c,_43a);if("+"==oper){_41d=_402(_420);}else{if("~"==oper){_41d=_408(_420);}else{if(">"==oper){_41d=_40e(_420);}}}}return _41a[_41c.query]=_41d;};var _43b=function(root,_43d){var _43e=_390(root),qp,x,te,qpl=_43d.length,bag,ret;for(var i=0;i<qpl;i++){ret=[];qp=_43d[i];x=_43e.length-1;if(x>0){bag={};ret.nozip=true;}var gef=_41b(qp);while(te=_43e[x--]){gef(te,ret,bag);}if(!ret.length){break;}_43e=ret;}return ret;};var _447={},_448={};var _449=function(_44a){var _44b=_371(trim(_44a));if(_44b.length==1){var tef=_41b(_44b[0]);return function(root){var r=tef(root,new qlc());if(r){r.nozip=true;}return r;};}return function(root){return _43b(root,_44b);};};var nua=navigator.userAgent;var wk="WebKit/";var _452=(d.isWebKit&&(nua.indexOf(wk)>0)&&(parseFloat(nua.split(wk)[1])>528));var _453=d.isIE?"commentStrip":"nozip";var qsa="querySelectorAll";var _455=(!!_36b()[qsa]&&(!d.isSafari||(d.isSafari>3.1)||_452));var _456=function(_457,_458){if(_455){var _459=_448[_457];if(_459&&!_458){return _459;}}var _45a=_447[_457];if(_45a){return _45a;}var qcz=_457.charAt(0);var _45c=(-1==_457.indexOf(" "));if((_457.indexOf("#")>=0)&&(_45c)){_458=true;}var _45d=(_455&&(!_458)&&(_36e.indexOf(qcz)==-1)&&(!d.isIE||(_457.indexOf(":")==-1))&&(!(_36c&&(_457.indexOf(".")>=0)))&&(_457.indexOf(":contains")==-1)&&(_457.indexOf("|=")==-1));if(_45d){var tq=(_36e.indexOf(_457.charAt(_457.length-1))>=0)?(_457+" *"):_457;return _448[_457]=function(root){try{if(!((9==root.nodeType)||_45c)){throw "";}var r=root[qsa](tq);r[_453]=true;return r;}catch(e){return _456(_457,true)(root);}};}else{var _461=_457.split(/\s*,\s*/);return _447[_457]=((_461.length<2)?_449(_457):function(root){var _463=0,ret=[],tp;while((tp=_461[_463++])){ret=ret.concat(_449(tp)(root));}return ret;});}};var _466=0;var _467=d.isIE?function(node){if(_36f){return (node.getAttribute("_uid")||node.setAttribute("_uid",++_466)||_466);}else{return node.uniqueID;}}:function(node){return (node._uid||(node._uid=++_466));};var _407=function(node,bag){if(!bag){return 1;}var id=_467(node);if(!bag[id]){return bag[id]=1;}return 0;};var _46d="_zipIdx";var _zip=function(arr){if(arr&&arr.nozip){return (qlc._wrap)?qlc._wrap(arr):arr;}var ret=new qlc();if(!arr||!arr.length){return ret;}if(arr[0]){ret.push(arr[0]);}if(arr.length<2){return ret;}_466++;if(d.isIE&&_36f){var _471=_466+"";arr[0].setAttribute(_46d,_471);for(var x=1,te;te=arr[x];x++){if(arr[x].getAttribute(_46d)!=_471){ret.push(te);}te.setAttribute(_46d,_471);}}else{if(d.isIE&&arr.commentStrip){try{for(var x=1,te;te=arr[x];x++){if(_394(te)){ret.push(te);}}}catch(e){}}else{if(arr[0]){arr[0][_46d]=_466;}for(var x=1,te;te=arr[x];x++){if(arr[x][_46d]!=_466){ret.push(te);}te[_46d]=_466;}}}return ret;};d.query=function(_474,root){qlc=d._queryListCtor;if(!_474){return new qlc();}if(_474.constructor==qlc){return _474;}if(!_36a(_474)){return new qlc(_474);}if(_36a(root)){root=d.byId(root);if(!root){return new qlc();}}root=root||_36b();var od=root.ownerDocument||root.documentElement;_36f=(root.contentType&&root.contentType=="application/xml")||(d.isOpera&&(root.doctype||od.toString()=="[object XMLDocument]"))||(!!od)&&(d.isIE?od.xml:(root.xmlVersion||od.xmlVersion));var r=_456(_474)(root);if(r&&r.nozip&&!qlc._wrap){return r;}return _zip(r);};d.query.pseudos=_3c8;d._filterQueryResult=function(_478,_479){var _47a=new d._queryListCtor();var _47b=_3df(_371(_479)[0]);for(var x=0,te;te=_478[x];x++){if(_47b(te)){_47a.push(te);}}return _47a;};})(this["queryPortability"]||this["acme"]||dojo);}if(!dojo._hasResource["dojo._base.xhr"]){dojo._hasResource["dojo._base.xhr"]=true;dojo.provide("dojo._base.xhr");(function(){var _d=dojo;function _47f(obj,name,_482){var val=obj[name];if(_d.isString(val)){obj[name]=[val,_482];}else{if(_d.isArray(val)){val.push(_482);}else{obj[name]=_482;}}};dojo.formToObject=function(_484){var ret={};var _486="file|submit|image|reset|button|";_d.forEach(dojo.byId(_484).elements,function(item){var _in=item.name;var type=(item.type||"").toLowerCase();if(_in&&type&&_486.indexOf(type)==-1&&!item.disabled){if(type=="radio"||type=="checkbox"){if(item.checked){_47f(ret,_in,item.value);}}else{if(item.multiple){ret[_in]=[];_d.query("option",item).forEach(function(opt){if(opt.selected){_47f(ret,_in,opt.value);}});}else{_47f(ret,_in,item.value);if(type=="image"){ret[_in+".x"]=ret[_in+".y"]=ret[_in].x=ret[_in].y=0;}}}}});return ret;};dojo.objectToQuery=function(map){var enc=encodeURIComponent;var _48d=[];var _48e={};for(var name in map){var _490=map[name];if(_490!=_48e[name]){var _491=enc(name)+"=";if(_d.isArray(_490)){for(var i=0;i<_490.length;i++){_48d.push(_491+enc(_490[i]));}}else{_48d.push(_491+enc(_490));}}}return _48d.join("&");};dojo.formToQuery=function(_493){return _d.objectToQuery(_d.formToObject(_493));};dojo.formToJson=function(_494,_495){return _d.toJson(_d.formToObject(_494),_495);};dojo.queryToObject=function(str){var ret={};var qp=str.split("&");var dec=decodeURIComponent;_d.forEach(qp,function(item){if(item.length){var _49b=item.split("=");var name=dec(_49b.shift());var val=dec(_49b.join("="));if(_d.isString(ret[name])){ret[name]=[ret[name]];}if(_d.isArray(ret[name])){ret[name].push(val);}else{ret[name]=val;}}});return ret;};dojo._blockAsync=false;dojo._contentHandlers={text:function(xhr){return xhr.responseText;},json:function(xhr){return _d.fromJson(xhr.responseText||null);},"json-comment-filtered":function(xhr){if(!dojo.config.useCommentedJson){console.warn("Consider using the standard mimetype:application/json."+" json-commenting can introduce security issues. To"+" decrease the chances of hijacking, use the standard the 'json' handler and"+" prefix your json with: {}&&\n"+"Use djConfig.useCommentedJson=true to turn off this message.");}var _4a1=xhr.responseText;var _4a2=_4a1.indexOf("/*");var _4a3=_4a1.lastIndexOf("*/");if(_4a2==-1||_4a3==-1){throw new Error("JSON was not comment filtered");}return _d.fromJson(_4a1.substring(_4a2+2,_4a3));},javascript:function(xhr){return _d.eval(xhr.responseText);},xml:function(xhr){var _4a6=xhr.responseXML;if(_d.isIE&&(!_4a6||!_4a6.documentElement)){var ms=function(n){return "MSXML"+n+".DOMDocument";};var dp=["Microsoft.XMLDOM",ms(6),ms(4),ms(3),ms(2)];_d.some(dp,function(p){try{var dom=new ActiveXObject(p);dom.async=false;dom.loadXML(xhr.responseText);_4a6=dom;}catch(e){return false;}return true;});}return _4a6;}};dojo._contentHandlers["json-comment-optional"]=function(xhr){var _4ad=_d._contentHandlers;if(xhr.responseText&&xhr.responseText.indexOf("/*")!=-1){return _4ad["json-comment-filtered"](xhr);}else{return _4ad["json"](xhr);}};dojo._ioSetArgs=function(args,_4af,_4b0,_4b1){var _4b2={args:args,url:args.url};var _4b3=null;if(args.form){var form=_d.byId(args.form);var _4b5=form.getAttributeNode("action");_4b2.url=_4b2.url||(_4b5?_4b5.value:null);_4b3=_d.formToObject(form);}var _4b6=[{}];if(_4b3){_4b6.push(_4b3);}if(args.content){_4b6.push(args.content);}if(args.preventCache){_4b6.push({"dojo.preventCache":new Date().valueOf()});}_4b2.query=_d.objectToQuery(_d.mixin.apply(null,_4b6));_4b2.handleAs=args.handleAs||"text";var d=new _d.Deferred(_4af);d.addCallbacks(_4b0,function(_4b8){return _4b1(_4b8,d);});var ld=args.load;if(ld&&_d.isFunction(ld)){d.addCallback(function(_4ba){return ld.call(args,_4ba,_4b2);});}var err=args.error;if(err&&_d.isFunction(err)){d.addErrback(function(_4bc){return err.call(args,_4bc,_4b2);});}var _4bd=args.handle;if(_4bd&&_d.isFunction(_4bd)){d.addBoth(function(_4be){return _4bd.call(args,_4be,_4b2);});}d.ioArgs=_4b2;return d;};var _4bf=function(dfd){dfd.canceled=true;var xhr=dfd.ioArgs.xhr;var _at=typeof xhr.abort;if(_at=="function"||_at=="object"||_at=="unknown"){xhr.abort();}var err=dfd.ioArgs.error;if(!err){err=new Error("xhr cancelled");err.dojoType="cancel";}return err;};var _4c4=function(dfd){var ret=_d._contentHandlers[dfd.ioArgs.handleAs](dfd.ioArgs.xhr);return ret===undefined?null:ret;};var _4c7=function(_4c8,dfd){console.error(_4c8);return _4c8;};var _4ca=null;var _4cb=[];var _4cc=function(){var now=(new Date()).getTime();if(!_d._blockAsync){for(var i=0,tif;i<_4cb.length&&(tif=_4cb[i]);i++){var dfd=tif.dfd;var func=function(){if(!dfd||dfd.canceled||!tif.validCheck(dfd)){_4cb.splice(i--,1);}else{if(tif.ioCheck(dfd)){_4cb.splice(i--,1);tif.resHandle(dfd);}else{if(dfd.startTime){if(dfd.startTime+(dfd.ioArgs.args.timeout||0)<now){_4cb.splice(i--,1);var err=new Error("timeout exceeded");err.dojoType="timeout";dfd.errback(err);dfd.cancel();}}}}};if(dojo.config.debugAtAllCosts){func.call(this);}else{try{func.call(this);}catch(e){dfd.errback(e);}}}}if(!_4cb.length){clearInterval(_4ca);_4ca=null;return;}};dojo._ioCancelAll=function(){try{_d.forEach(_4cb,function(i){try{i.dfd.cancel();}catch(e){}});}catch(e){}};if(_d.isIE){_d.addOnWindowUnload(_d._ioCancelAll);}_d._ioWatch=function(dfd,_4d5,_4d6,_4d7){var args=dfd.ioArgs.args;if(args.timeout){dfd.startTime=(new Date()).getTime();}_4cb.push({dfd:dfd,validCheck:_4d5,ioCheck:_4d6,resHandle:_4d7});if(!_4ca){_4ca=setInterval(_4cc,50);}if(args.sync){_4cc();}};var _4d9="application/x-www-form-urlencoded";var _4da=function(dfd){return dfd.ioArgs.xhr.readyState;};var _4dc=function(dfd){return 4==dfd.ioArgs.xhr.readyState;};var _4de=function(dfd){var xhr=dfd.ioArgs.xhr;if(_d._isDocumentOk(xhr)){dfd.callback(dfd);}else{var err=new Error("Unable to load "+dfd.ioArgs.url+" status:"+xhr.status);err.status=xhr.status;err.responseText=xhr.responseText;dfd.errback(err);}};dojo._ioAddQueryToUrl=function(_4e2){if(_4e2.query.length){_4e2.url+=(_4e2.url.indexOf("?")==-1?"?":"&")+_4e2.query;_4e2.query=null;}};dojo.xhr=function(_4e3,args,_4e5){var dfd=_d._ioSetArgs(args,_4bf,_4c4,_4c7);dfd.ioArgs.xhr=_d._xhrObj(dfd.ioArgs.args);if(_4e5){if("postData" in args){dfd.ioArgs.query=args.postData;}else{if("putData" in args){dfd.ioArgs.query=args.putData;}}}else{_d._ioAddQueryToUrl(dfd.ioArgs);}var _4e7=dfd.ioArgs;var xhr=_4e7.xhr;xhr.open(_4e3,_4e7.url,args.sync!==true,args.user||undefined,args.password||undefined);if(args.headers){for(var hdr in args.headers){if(hdr.toLowerCase()==="content-type"&&!args.contentType){args.contentType=args.headers[hdr];}else{xhr.setRequestHeader(hdr,args.headers[hdr]);}}}xhr.setRequestHeader("Content-Type",args.contentType||_4d9);if(!args.headers||!args.headers["X-Requested-With"]){xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");}if(dojo.config.debugAtAllCosts){xhr.send(_4e7.query);}else{try{xhr.send(_4e7.query);}catch(e){dfd.ioArgs.error=e;dfd.cancel();}}_d._ioWatch(dfd,_4da,_4dc,_4de);xhr=null;return dfd;};dojo.xhrGet=function(args){return _d.xhr("GET",args);};dojo.rawXhrPost=dojo.xhrPost=function(args){return _d.xhr("POST",args,true);};dojo.rawXhrPut=dojo.xhrPut=function(args){return _d.xhr("PUT",args,true);};dojo.xhrDelete=function(args){return _d.xhr("DELETE",args);};})();}if(!dojo._hasResource["dojo._base.fx"]){dojo._hasResource["dojo._base.fx"]=true;dojo.provide("dojo._base.fx");(function(){var d=dojo;var _4ef=d.mixin;dojo._Line=function(_4f0,end){this.start=_4f0;this.end=end;};dojo._Line.prototype.getValue=function(n){return ((this.end-this.start)*n)+this.start;};d.declare("dojo._Animation",null,{constructor:function(args){_4ef(this,args);if(d.isArray(this.curve)){this.curve=new d._Line(this.curve[0],this.curve[1]);}},duration:350,repeat:0,rate:10,_percent:0,_startRepeatCount:0,_fire:function(evt,args){if(this[evt]){if(dojo.config.debugAtAllCosts){this[evt].apply(this,args||[]);}else{try{this[evt].apply(this,args||[]);}catch(e){console.error("exception in animation handler for:",evt);console.error(e);}}}return this;},play:function(_4f6,_4f7){var _t=this;if(_t._delayTimer){_t._clearTimer();}if(_4f7){_t._stopTimer();_t._active=_t._paused=false;_t._percent=0;}else{if(_t._active&&!_t._paused){return _t;}}_t._fire("beforeBegin");var de=_4f6||_t.delay,_p=dojo.hitch(_t,"_play",_4f7);if(de>0){_t._delayTimer=setTimeout(_p,de);return _t;}_p();return _t;},_play:function(_4fb){var _t=this;if(_t._delayTimer){_t._clearTimer();}_t._startTime=new Date().valueOf();if(_t._paused){_t._startTime-=_t.duration*_t._percent;}_t._endTime=_t._startTime+_t.duration;_t._active=true;_t._paused=false;var _4fd=_t.curve.getValue(_t._percent);if(!_t._percent){if(!_t._startRepeatCount){_t._startRepeatCount=_t.repeat;}_t._fire("onBegin",[_4fd]);}_t._fire("onPlay",[_4fd]);_t._cycle();return _t;},pause:function(){var _t=this;if(_t._delayTimer){_t._clearTimer();}_t._stopTimer();if(!_t._active){return _t;}_t._paused=true;_t._fire("onPause",[_t.curve.getValue(_t._percent)]);return _t;},gotoPercent:function(_4ff,_500){var _t=this;_t._stopTimer();_t._active=_t._paused=true;_t._percent=_4ff;if(_500){_t.play();}return _t;},stop:function(_502){var _t=this;if(_t._delayTimer){_t._clearTimer();}if(!_t._timer){return _t;}_t._stopTimer();if(_502){_t._percent=1;}_t._fire("onStop",[_t.curve.getValue(_t._percent)]);_t._active=_t._paused=false;return _t;},status:function(){if(this._active){return this._paused?"paused":"playing";}return "stopped";},_cycle:function(){var _t=this;if(_t._active){var curr=new Date().valueOf();var step=(curr-_t._startTime)/(_t._endTime-_t._startTime);if(step>=1){step=1;}_t._percent=step;if(_t.easing){step=_t.easing(step);}_t._fire("onAnimate",[_t.curve.getValue(step)]);if(_t._percent<1){_t._startTimer();}else{_t._active=false;if(_t.repeat>0){_t.repeat--;_t.play(null,true);}else{if(_t.repeat==-1){_t.play(null,true);}else{if(_t._startRepeatCount){_t.repeat=_t._startRepeatCount;_t._startRepeatCount=0;}}}_t._percent=0;_t._fire("onEnd");_t._stopTimer();}}return _t;},_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer;}});var ctr=0,_508=[],_509=null,_50a={run:function(){}};dojo._Animation.prototype._startTimer=function(){if(!this._timer){this._timer=d.connect(_50a,"run",this,"_cycle");ctr++;}if(!_509){_509=setInterval(d.hitch(_50a,"run"),this.rate);}};dojo._Animation.prototype._stopTimer=function(){if(this._timer){d.disconnect(this._timer);this._timer=null;ctr--;}if(ctr<=0){clearInterval(_509);_509=null;ctr=0;}};var _50b=d.isIE?function(node){var ns=node.style;if(!ns.width.length&&d.style(node,"width")=="auto"){ns.width="auto";}}:function(){};dojo._fade=function(args){args.node=d.byId(args.node);var _50f=_4ef({properties:{}},args),_510=(_50f.properties.opacity={});_510.start=!("start" in _50f)?function(){return +d.style(_50f.node,"opacity")||0;}:_50f.start;_510.end=_50f.end;var anim=d.animateProperty(_50f);d.connect(anim,"beforeBegin",d.partial(_50b,_50f.node));return anim;};dojo.fadeIn=function(args){return d._fade(_4ef({end:1},args));};dojo.fadeOut=function(args){return d._fade(_4ef({end:0},args));};dojo._defaultEasing=function(n){return 0.5+((Math.sin((n+1.5)*Math.PI))/2);};var _515=function(_516){this._properties=_516;for(var p in _516){var prop=_516[p];if(prop.start instanceof d.Color){prop.tempColor=new d.Color();}}};_515.prototype.getValue=function(r){var ret={};for(var p in this._properties){var prop=this._properties[p],_51d=prop.start;if(_51d instanceof d.Color){ret[p]=d.blendColors(_51d,prop.end,r,prop.tempColor).toCss();}else{if(!d.isArray(_51d)){ret[p]=((prop.end-_51d)*r)+_51d+(p!="opacity"?prop.units||"px":0);}}}return ret;};dojo.animateProperty=function(args){args.node=d.byId(args.node);if(!args.easing){args.easing=d._defaultEasing;}var anim=new d._Animation(args);d.connect(anim,"beforeBegin",anim,function(){var pm={};for(var p in this.properties){if(p=="width"||p=="height"){this.node.display="block";}var prop=this.properties[p];prop=pm[p]=_4ef({},(d.isObject(prop)?prop:{end:prop}));if(d.isFunction(prop.start)){prop.start=prop.start();}if(d.isFunction(prop.end)){prop.end=prop.end();}var _523=(p.toLowerCase().indexOf("color")>=0);function _524(node,p){var v={height:node.offsetHeight,width:node.offsetWidth}[p];if(v!==undefined){return v;}v=d.style(node,p);return (p=="opacity")?+v:(_523?v:parseFloat(v));};if(!("end" in prop)){prop.end=_524(this.node,p);}else{if(!("start" in prop)){prop.start=_524(this.node,p);}}if(_523){prop.start=new d.Color(prop.start);prop.end=new d.Color(prop.end);}else{prop.start=(p=="opacity")?+prop.start:parseFloat(prop.start);}}this.curve=new _515(pm);});d.connect(anim,"onAnimate",d.hitch(d,"style",anim.node));return anim;};dojo.anim=function(node,_529,_52a,_52b,_52c,_52d){return d.animateProperty({node:node,duration:_52a||d._Animation.prototype.duration,properties:_529,easing:_52b,onEnd:_52c}).play(_52d||0);};})();}if(!dojo._hasResource["dojo._base.browser"]){dojo._hasResource["dojo._base.browser"]=true;dojo.provide("dojo._base.browser");dojo.forEach(dojo.config.require,function(i){dojo["require"](i);});}if(!dojo._hasResource["bespin.bespin"]){dojo._hasResource["bespin.bespin"]=true;(function(){dojo.provide("bespin.bespin");var _52f=0;var _530={};dojo.mixin(bespin,{versionNumber:"0.2.2",versionCodename:"Speedy Cirrus",apiVersion:"4",defaultTabSize:4,userSettingsProject:"BespinSettings",eventLog:{},publish:function(_531,args){this.eventLog[_531]=true;dojo.publish("bespin:"+_531,dojo.isArray(args)?args:[args||{}]);},fireAfter:function(_533,_534){var _535=_533.length;var done=function(){if(_535==0){_534();}};for(var i=0;i<_533.length;++i){var _538=_533[i];if(this.eventLog[_538]){--_535;}else{bespin.subscribe(_538,function(){--_535;done();});}done();}},subscribe:function(_539,_53a,_53b){if(_53b){var orig=_53a;var _53d=_52f++;_53a=function lazySubscriptionWrapper(){if(_530[_53d]){clearTimeout(_530[_53d]);}_530[_53d]=setTimeout(dojo.hitch(this,function(){orig.apply(this,arguments);delete _530[_53d];}),_53b);};}return dojo.subscribe("bespin:"+_539,_53a);},unsubscribe:dojo.unsubscribe,registeredComponents:{},register:function(id,_53f){this.registeredComponents[id]=_53f;bespin.publish("component:register",{id:id,object:_53f});return _53f;},get:function(id){return this.registeredComponents[id];},withComponent:function(id,func){var _543=this.get(id);if(_543){return func(_543);}},displayVersion:function(el){var el=dojo.byId(el)||dojo.byId("version");if(!el){return;}el.innerHTML="<a href=\"https://wiki.mozilla.org/Labs/Bespin/ReleaseNotes\" title=\"Read the release notes\">Version <span class=\"versionnumber\">"+this.versionNumber+"</span> \""+this.versionCodename+"\"</a>";}});})();}if(!dojo._hasResource["bespin.util.canvas"]){dojo._hasResource["bespin.util.canvas"]=true;dojo.provide("bespin.util.canvas");dojo.mixin(bespin.util.canvas,{fix:function(ctx){if(!ctx.fillText&&ctx.mozDrawText){ctx.fillText=function(_546,x,y,_549){ctx.translate(x,y);ctx.mozTextStyle=ctx.font;ctx.mozDrawText(_546);ctx.translate(-x,-y);};}if(!ctx.measureText&&ctx.mozMeasureText){ctx.measureText=function(text){if(ctx.font){ctx.mozTextStyle=ctx.font;}var _54b=ctx.mozMeasureText(text);return {width:_54b};};}if(ctx.measureText&&!ctx.html5MeasureText){ctx.html5MeasureText=ctx.measureText;ctx.measureText=function(text){var _54d=ctx.html5MeasureText(text);_54d.ascent=ctx.html5MeasureText("m").width;return _54d;};}if(!ctx.fillText){ctx.fillText=function(){};}if(!ctx.measureText){ctx.measureText=function(){return 10;};}return ctx;}});}if(!dojo._hasResource["bespin.util.keys"]){dojo._hasResource["bespin.util.keys"]=true;dojo.provide("bespin.util.keys");(function(){bespin.util.keys.Key={ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,FORWARD_SLASH:191,TILDE:192,BACK_SLASH:220};dojo.mixin(bespin.util.keys.Key,dojo.keys);var keys=bespin.util.keys.Key;bespin.util.keys.KeyCodeToName={};for(var key in keys){var _550=keys[key];if(typeof _550=="number"){bespin.util.keys.KeyCodeToName[_550]=key;}}})();bespin.util.keys.fillArguments=function(_551,args){var keys=_551.split(" ");args=args||{};var _554=[];dojo.forEach(keys,function(key){if(key.length>1){_554.push(key);}else{args.key=key;}});if(_554.length==0){args.modifiers="none";}else{args.modifiers=_554.join(",");}return args;};bespin.util.keys.PassThroughCharCodes=dojo.map(["k","l","n","o","t","w","+","-","~","0","1","2","3","4","5","6","7","8","9"],function(item){return item.charCodeAt(0);});bespin.util.keys.PassThroughKeyCodes=(function(){var Key=bespin.util.keys.Key;return [Key.C,Key.X,Key.V,Key.K,Key.L,Key.N,Key.O,Key.T,Key.W,Key.NUMPAD_PLUS,Key.NUMPAD_MINUS,Key.TILDE,Key.ZERO,Key.ONE,Key.TWO,Key.THREE,Key.FOUR,Key.FIVE,Key.SIX,Key.SEVEN,Key.EIGHT,Key.NINE];})();bespin.util.keys.passThroughToBrowser=function(e){var Key=bespin.util.keys.Key;if(!e.ctrlKey){return true;}else{if(e.metaKey||e.altKey){if(e.type=="keypress"){if(dojo.some(bespin.util.keys.PassThroughCharCodes,function(item){return (item==e.charCode);})){return true;}}else{if(dojo.some(bespin.util.keys.PassThroughKeyCodes,function(item){return (item==e.keyCode);})){return true;}}}}return false;};}if(!dojo._hasResource["bespin.client.settings"]){dojo._hasResource["bespin.client.settings"]=true;dojo.provide("bespin.client.settings");dojo.declare("bespin.client.settings.Core",null,{constructor:function(_55c){this.browserOverrides={};this.fromURL=new bespin.client.settings.URL();this.customEvents=new bespin.client.settings.Events(this);this.loadStore(_55c);},loadSession:function(){var _55d=bespin.get("editSession");var path=this.fromURL.get("path")||_55d.path;var _55f=this.fromURL.get("project")||_55d.project;bespin.publish("settings:init",{path:path,project:_55f});},defaultSettings:function(){return {"tabsize":"2","tabmode":"off","tabarrow":"on","fontsize":"10","autocomplete":"off","collaborate":"off","language":"auto","strictlines":"on","syntaxcheck":"off","syntaxengine":"simple","preview":"window","smartmove":"on","jslint":{}};},isOn:function(_560){return _560=="on"||_560=="true";},isOff:function(_561){return _561=="off"||_561=="false"||_561===undefined;},isSettingOn:function(key){return this.isOn(this.get(key));},isSettingOff:function(key){return this.isOff(this.get(key));},loadStore:function(_564){this.store=new (_564||bespin.client.settings.ServerFile)(this);},toList:function(){var _565=[];var _566=this.store.settings;for(var prop in _566){if(_566.hasOwnProperty(prop)){_565.push({"key":prop,"value":_566[prop]});}}return _565;},set:function(key,_569){this.store.set(key,_569);bespin.publish("settings:set:"+key,{value:_569});},setObject:function(key,_56b){this.set(key,dojo.toJson(_56b));},get:function(key){var _56d=this.fromURL.get(key);if(_56d){return _56d;}return this.store.get(key);},getObject:function(key){return dojo.fromJson(this.get(key));},unset:function(key){this.store.unset(key);},list:function(){if(typeof this.store["list"]=="function"){return this.store.list();}else{return this.toList();}}});dojo.declare("bespin.client.settings.InMemory",null,{constructor:function(_570){this.parent=_570;this.settings=this.parent.defaultSettings();bespin.publish("settings:loaded");},set:function(key,_572){this.settings[key]=_572;},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];}});dojo.declare("bespin.client.settings.Cookie",null,{constructor:function(_575){var _576=1;this.cookieSettings={expires:_576/24,path:"/"};var _577=dojo.fromJson(dojo.cookie("settings"));if(_577){this.settings=_577;}else{this.settings={"tabsize":"2","fontsize":"10","autocomplete":"off","collaborate":"off"};dojo.cookie("settings",dojo.toJson(this.settings),this.cookieSettings);}bespin.publish("settings:loaded");},set:function(key,_579){this.settings[key]=_579;dojo.cookie("settings",dojo.toJson(this.settings),this.cookieSettings);},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];dojo.cookie("settings",dojo.toJson(this.settings),this.cookieSettings);}});dojo.declare("bespin.client.settings.ServerAPI",null,{constructor:function(_57c){this.parent=_57c;this.server=bespin.get("server");this.settings=this.parent.defaultSettings();this.server.listSettings(dojo.hitch(this,function(_57d){this.settings=_57d;if(_57d["tabsize"]===undefined){this.settings=this.parent.defaultSettings();this.server.setSettings(this.settings);}bespin.publish("settings:loaded");}));},set:function(key,_57f){this.settings[key]=_57f;this.server.setSetting(key,_57f);},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];this.server.unsetSetting(key);}});dojo.declare("bespin.client.settings.ServerFile",null,{constructor:function(_582){this.parent=_582;this.server=bespin.get("server");this.settings=this.parent.defaultSettings();this.loaded=false;this._load();},set:function(key,_584){this.settings[key]=_584;if(key[0]!="_"){this._save();}},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];this._save();},_save:function(){if(!this.loaded){return;}var _587="";for(var key in this.settings){if(this.settings.hasOwnProperty(key)){_587+=key+" "+this.settings[key]+"\n";}}bespin.get("files").saveFile(bespin.userSettingsProject,{name:"settings",content:_587,timestamp:new Date().getTime()});},_load:function(){var self=this;var _58a=function(){if(!self.loaded){self.loaded=true;bespin.publish("settings:loaded");}};var _58b=function(){bespin.get("files").loadContents(bespin.userSettingsProject,"settings",function(file){dojo.forEach(file.content.split(/\n/),function(_58d){if(_58d.match(/^\s*#/)){return;}if(_58d.match(/\S+\s+\S+/)){var _58e=_58d.split(/\s+/);self.settings[dojo.trim(_58e[0])]=dojo.trim(_58e[1]);}});_58a();},_58a);};if(bespin.authenticated){_58b();}else{bespin.subscribe("authenticated",function(){_58b();});}}});dojo.declare("bespin.client.settings.URL",null,{constructor:function(_58f){this.results=dojo.queryToObject(this.stripHash(_58f||window.location.hash));},get:function(key){return this.results[key];},set:function(key,_592){this.results[key]=_592;},stripHash:function(url){var tobe=url.split("");tobe.shift();return tobe.join("");}});dojo.declare("bespin.client.settings.Events",null,{constructor:function(_595){var _596=bespin.get("editSession");var _597=bespin.get("editor");bespin.subscribe("settings:set",function(_598){var key=_598.key;var _59a=_598.value;_595.set(key,_59a);});bespin.subscribe("editor:openfile:opensuccess",function(_59b){_596.path=_59b.file.name;if(_596.syncHelper){_596.syncHelper.syncWithServer();}});bespin.subscribe("editor:openfile:opensuccess",function(_59c){var _59d=_59c.file.name.split(".");var type=_59d[_59d.length-1];if(type){bespin.publish("settings:language",{language:type});}});bespin.subscribe("settings:set:language",function(_59f){bespin.publish("settings:language",{language:_59f.value,fromCommand:true});});bespin.subscribe("settings:language",function(_5a0){var _5a1=_5a0.language;var _5a2=_5a0.fromCommand;var _5a3=_595.get("language")||"auto";if(_5a1==_597.language){return;}if(bespin.util.include(["auto","on"],_5a1)){var _5a4=window.location.hash.split(".");var type=_5a4[_5a4.length-1];if(type){_597.language=type;}}else{if(bespin.util.include(["auto","on"],_5a3)||_5a2){_597.language=_5a1;}else{if(_5a3=="off"){_597.language="off";}}}});bespin.subscribe("settings:set:collaborate",function(_5a6){_596.collaborate=_595.isOn(_5a6.value);});bespin.subscribe("settings:set:fontsize",function(_5a7){var _5a8=parseInt(_5a7.value);_597.theme.editorTextFont=_597.theme.editorTextFont.replace(/[0-9]{1,}pt/,_5a8+"pt");_597.theme.lineNumberFont=_597.theme.lineNumberFont.replace(/[0-9]{1,}pt/,_5a8+"pt");});bespin.subscribe("settings:set:theme",function(_5a9){var _5aa=_5a9.value;var _5ab=function(){var _5ac=bespin.themes[_5aa];if(_5ac){if(_5ac!=_597.theme){_597.theme=_5ac;bespin.publish("settings:set:fontsize",{value:_595.get("fontsize")});}return true;}return false;};if(_5aa){if(_5ab()){return true;}try{var dr=dojo.require;dr("bespin.themes."+_5aa);if(_5ab()){return true;}}catch(e){}bespin.get("files").loadContents(bespin.userSettingsProject,"/themes/"+_5aa+".js",dojo.hitch(this,function(file){try{eval(file.content);}catch(e){}if(!_5ab()){bespin.publish("message",{msg:"Sorry old chap. No theme called '"+_5aa+"'. Fancy making it?"});}}),function(){bespin.publish("message",{msg:"Sorry old chap. No theme called '"+_5aa+"'. Fancy making it?"});});}});bespin.subscribe("settings:set:keybindings",function(_5af){var _5b0=_5af.value;if(_5b0=="emacs"){bespin.publish("editor:bindkey",{modifiers:"ctrl",key:"b",action:"moveCursorLeft"});bespin.publish("editor:bindkey",{modifiers:"ctrl",key:"f",action:"moveCursorRight"});bespin.publish("editor:bindkey",{modifiers:"ctrl",key:"p",action:"moveCursorUp"});bespin.publish("editor:bindkey",{modifiers:"ctrl",key:"n",action:"moveCursorDown"});bespin.publish("editor:bindkey",{modifiers:"ctrl",key:"a",action:"moveToLineStart"});bespin.publish("editor:bindkey",{modifiers:"ctrl",key:"e",action:"moveToLineEnd"});}});bespin.subscribe("settings:set:debugmode",function(_5b1){_597.debugMode=_595.isOn(_5b1.value);if(_597.debugMode&&bespin.debug){bespin.debug.loadBreakpoints(function(){_597.paint(true);});}_597.paint(true);});bespin.subscribe("settings:set:cursorblink",function(_5b2){var ms=parseInt(_5b2.value);if(ms){_597.ui.toggleCursorFrequency=ms;}});var _5b4;bespin.subscribe("settings:set:trimonsave",function(_5b5){if(_595.isOn(_5b5.value)){_5b4=bespin.subscribe("editor:savefile:before",function(_5b6){bespin.publish("command:execute",{name:"trim"});});}else{bespin.unsubscribe(_5b4);}});bespin.subscribe("settings:set:syntaxcheck",function(data){if(_595.isOff(data.value)){bespin.publish("parser:stop");}else{bespin.publish("parser:start");}});bespin.subscribe("settings:init",function(_5b8){var path=_5b8.path;var _5ba=_5b8.project;if(_5ba&&(_596.project!=_5ba)){bespin.publish("project:set",{project:_5ba});}if(!_595.isSettingOn("hidewelcomescreen")){bespin.publish("wizard:show",{type:"newuser",warnOnFail:false,showonce:true});}var _5bb=_595.fromURL.get("new");if(_5bb){bespin.publish("editor:newfile",{project:_5ba,newfilename:path,content:_595.fromURL.get("content")||" "});}else{if(path){bespin.publish("editor:openfile",{filename:path});}else{var _5bc=_595.getObject("lastused");if(!_5bc){bespin.publish("project:set",{project:"SampleProject"});bespin.publish("editor:openfile",{filename:"readme.txt"});}else{bespin.publish("project:set",_5bc[0]);bespin.publish("editor:openfile",_5bc[0]);}}}});bespin.subscribe("settings:init",function(_5bd){for(var _5be in dojo._topics){var _5bf="bespin:settings:set:";if(_5be.indexOf(_5bf)==0){var _5c0=_5be.substring(_5bf.length);bespin.publish("settings:set:"+_5c0,{value:_595.get(_5c0)});}}});bespin.subscribe("settings:init",function(){if(_595.isOff(_595.get("autoconfig"))){return;}bespin.publish("editor:config:run");});}});}if(!dojo._hasResource["bespin.util.navigate"]){dojo._hasResource["bespin.util.navigate"]=true;dojo.provide("bespin.util.navigate");(function(){var go=function(url,_5c3){if(_5c3){window.open(url,"_blank");}else{location.href=url;}};dojo.mixin(bespin.util.navigate,{dashboard:function(_5c4){var _5c5=(new bespin.client.settings.URL()).get("fromDashboardPath");if(_5c5){go("dashboard.html#path="+_5c5,_5c4);}else{go("dashboard.html",_5c4);}},home:function(_5c6){go("index.html",_5c6);},quickEdit:function(_5c7){go("editor.html#new=true",_5c7);},editor:function(_5c8,path,opts){var url="editor.html#";var args=[];if(_5c8){args.push("project="+_5c8);}if(path){args.push("path="+path);}if(!opts){opts={};}if(opts.newFile){args.push("new=true");}if(opts.content){args.push("content="+escape(opts.content));}if(bespin.page.dashboard){var _5cd=bespin.page.dashboard.tree.getSelectedPath(true);if(_5cd){args.push("fromDashboardPath="+_5cd);}}if(args.length>0){url+=args.join("&");}go(url,opts.newTab);}});})();}if(!dojo._hasResource["bespin.util.path"]){dojo._hasResource["bespin.util.path"]=true;dojo.provide("bespin.util.path");dojo.mixin(bespin.util.path,{combine:function(){var args=Array.prototype.slice.call(arguments);var path=args.join("/");path=path.replace(/\/\/+/g,"/");path=path.replace(/^\s+|\s+$/g,"");return path;},directory:function(path){var dirs=path.split("/");if(dirs.length==1){return "";}else{if((dirs.length==2)&&dirs[dirs.length-1]==""){return path;}else{return dirs.slice(0,dirs.length-1).join("/");}}},makeDirectory:function(path){if(!/\/$/.test(path)){path+="/";}return path;},combineAsDirectory:function(){return this.makeDirectory(this.combine.apply(this,arguments));},escape:function(){return escape(this.combine.apply(this,arguments));}});}if(!dojo._hasResource["bespin.util.tokenobject"]){dojo._hasResource["bespin.util.tokenobject"]=true;dojo.provide("bespin.util.tokenobject");dojo.declare("bespin.util.TokenObject",null,{constructor:function(_5d3,_5d4){this._input=_5d3;this._options=_5d4||{};this._splitterRegex=new RegExp(this._options.splitBy||"\\s+");this.pieces=this.tokenize(_5d3.split(this._splitterRegex));if(this._options.params){this._nametoindex={};var _5d5=this._options.params.split(" ");for(var x=0;x<_5d5.length;x++){this._nametoindex[_5d5[x]]=x;if(!this._options["noshortcutvalues"]){this[_5d5[x]]=this.pieces[x];}}}},tokenize:function(_5d7){var _5d8=[];var _5d9;while(_5d9=_5d7.shift()){if(_5d9[0]=="\""||_5d9[0]=="'"){var _5da=[_5d9.substring(1,_5d9.length)];var _5db;while(_5db=_5d7.shift()){if(_5db[_5db.length-1]=="\""||_5db[_5db.length-1]=="'"){_5da.push(_5db.substring(0,_5db.length-1));break;}else{_5da.push(_5db);}}_5d8.push(_5da.join(" "));}else{_5d8.push(_5d9);}}return _5d8;},param:function(_5dc){return (typeof _5dc=="number")?this.pieces[_5dc]:this.pieces[this._nametoindex[_5dc]];},length:function(){return this.pieces.length;}});}if(!dojo._hasResource["bespin.util.util"]){dojo._hasResource["bespin.util.util"]=true;dojo.provide("bespin.util.util");bespin.util.queryToObject=function(str,_5de){var ret={};var qp=str.split(_5de);var dec=decodeURIComponent;dojo.forEach(qp,function(item){if(item.length){var _5e3=item.split("=");var name=dec(_5e3.shift());var val=dec(_5e3.join("="));if(dojo.isString(ret[name])){ret[name]=[ret[name]];}if(dojo.isArray(ret[name])){ret[name].push(val);}else{ret[name]=val;}}});return ret;};bespin.util.endsWith=function(str,end){return str.match(new RegExp(end+"$"));};bespin.util.include=function(_5e8,item){return dojo.indexOf(_5e8,item)>-1;};bespin.util.last=function(_5ea){if(dojo.isArray(_5ea)){return _5ea[_5ea.length-1];}};bespin.util.shrinkArray=function(_5eb){var _5ec=[];var _5ed=true;dojo.forEach(_5eb.reverse(),function(item){if(_5ed&&item===undefined){return;}_5ed=false;_5ec.push(item);});return _5ec.reverse();};bespin.util.makeArray=function(_5ef,_5f0){if(_5ef<1){return [];}if(!_5f0){_5f0=" ";}var _5f1=[];for(var i=0;i<_5ef;i++){_5f1.push(_5f0);}return _5f1;};bespin.util.leadingSpaces=function(row){var _5f4=0;for(var i=0;i<row.length;i++){if(row[i]==" "||row[i]==""||row[i]===undefined){_5f4++;}else{return _5f4;}}return _5f4;};bespin.util.englishFromCamel=function(_5f6){dojo.trim(_5f6.replace(/([A-Z])/g,function(str){return " "+str.toLowerCase();}));};bespin.util.isMac=function(){return navigator.appVersion.indexOf("Macintosh")>=0;};}if(!dojo._hasResource["bespin.util.mousewheelevent"]){dojo._hasResource["bespin.util.mousewheelevent"]=true;dojo.provide("bespin.util.mousewheelevent");dojo.mixin(bespin.util.mousewheelevent,{wheel:function(_5f8){var _5f9=0;if(!_5f8){_5f8=window.event;}if(_5f8.wheelDelta){_5f9=-(_5f8.wheelDelta/620);if(window.opera){_5f9=-_5f9;}}else{if(_5f8.detail){_5f9=_5f8.detail;}}return Math.round(_5f9);},axis:function(_5fa){var _5fb="vertical";if(_5fa.axis){if(_5fa.axis==_5fa.HORIZONTAL_AXIS){_5fb="horizontal";}}else{if(_5fa.wheelDeltaY||_5fa.wheelDeltaX){if(_5fa.wheelDeltaX==_5fa.wheelDelta){_5fb="horizontal";}}else{if(_5fa.shiftKey){_5fb="horizontal";}}}return _5fb;}});}if(!dojo._hasResource["bespin.util.urlbar"]){dojo._hasResource["bespin.util.urlbar"]=true;dojo.provide("bespin.util.urlbar");dojo.mixin(bespin.util.urlbar,{last:document.location.hash,check:function(){var hash=document.location.hash;if(this.last!=hash){var _5fd=new bespin.client.settings.URL(hash);bespin.publish("url:changed",{was:this.last,now:_5fd});this.last=hash;}}});setInterval(function(){dojo.hitch(bespin.util.urlbar,"check")();},200);}if(!dojo._hasResource["bespin.client.filesystem"]){dojo._hasResource["bespin.client.filesystem"]=true;dojo.provide("bespin.client.filesystem");dojo.declare("bespin.client.FileSystem",null,{constructor:function(_5fe){this.server=_5fe||bespin.get("server");},newFile:function(_5ff,path,_601){this.whenFileDoesNotExist(_5ff,path,{execute:function(){bespin.get("editSession").startSession(_5ff,path||"new.txt");_601();},elseFailed:function(){bespin.publish("message",{msg:"The file "+path+" already exists my friend."});}});},loadContents:function(_602,path,_604,_605){this.server.loadFile(_602,path,function(_606){if(/\n$/.test(_606)){_606=_606.substr(0,_606.length-1);}_604({name:path,content:_606,timestamp:new Date().getTime()});},_605);},collaborateOnFile:function(_607,path,_609){var _60a=bespin.get("settings").isSettingOn("collaborate");if(_60a&&!bespin.mobwrite){console.log("Missing bespin.mobwrite: Forcing 'collaborate' to off in filesystem.js:collaborateOnFile");_60a=false;}if(_60a){bespin.get("editSession").startSession(_607,path,_609);}else{this.loadContents(_607,path,_609);}},forceOpenFile:function(_60b,path,_60d){this.whenFileDoesNotExist(_60b,path,{execute:function(){if(!_60d){_60d=" ";}bespin.publish("editor:newfile",{project:_60b,newfilename:path,content:_60d});},elseFailed:function(){bespin.publish("editor:openfile",{project:_60b,filename:path});}});},projects:function(_60e){this.server.projects(_60e);},fileNames:function(_60f,_610){this.server.list(_60f,"",_610);},saveFile:function(_611,file){if(/\n$/.test(file.content)){file.content+="\n";}this.server.saveFile(_611,file.name,file.content,file.lastOp);},makeDirectory:function(_613,path,_615,_616){this.server.makeDirectory(_613,path,_615,_616);},removeDirectory:function(_617,path,_619,_61a){this.server.removeFile(_617,path,_619,_61a);},removeFile:function(_61b,path,_61d,_61e){this.server.removeFile(_61b,path,_61d,_61e);},closeFile:function(_61f,path,_621){this.server.closeFile(_61f,path,_621);},whenFileExists:function(_622,path,_624){this.server.list(_622,bespin.util.path.directory(path),function(_625){if(_625&&dojo.some(_625,function(file){return (file.name==path);})){_624["execute"]();}else{if(_624["elseFailed"]){_624["elseFailed"]();}}},function(xhr){if(_624["elseFailed"]){_624["elseFailed"](xhr);}});},whenFileDoesNotExist:function(_628,path,_62a){this.server.list(_628,bespin.util.path.directory(path),function(_62b){if(!_62b||!dojo.some(_62b,function(file){return (file.name==path);})){_62a["execute"]();}else{if(_62a["elseFailed"]){_62a["elseFailed"]();}}},function(xhr){_62a["execute"]();});}});}if(!dojo._hasResource["bespin.client.status"]){dojo._hasResource["bespin.client.status"]=true;dojo.provide("bespin.client.status");dojo.declare("bespin.client.settings.StatusChecker",null,{constructor:function(){this.interval=0;this.statusMessages=["Bob is editing the file brick.html","Emily is creating a new tag called 'v3.4'","Jessica is saving the file kidly.html","John is idle. Lazy git!","Mickey has checked in a set of 4 files to project 'Bank'","Don has created the function 'doCalculation' in class 'Bank'","Benji is deleting the function 'doCalculation' in class 'Bank'"];},start:function(){this.interval=setInterval(dojo.hitch(this,"updateStatus"),12000);},stop:function(){clearInterval(this.interval);},updateStatus:function(){var _62e=this.randomStatus();this.setStatus(_62e);},randomStatus:function(){var _62f=Math.floor(Math.random()*this.statusMessages.length);return this.statusMessages[_62f];},setStatus:function(_630){dojo.byId("message").innerHTML=_630;}});}if(!dojo._hasResource["bespin.client.server"]){dojo._hasResource["bespin.client.server"]=true;dojo.provide("bespin.client.server");dojo.declare("bespin.client.Server",null,{constructor:function(base){this.SERVER_BASE_URL=base||".";this._asyncCount=0;},request:function(_632,url,_634,_635){var _636=this;var xhr=new XMLHttpRequest();if(location.href.indexOf("file:")==0){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");}}catch(ex){}}if(_635){xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status&&xhr.status!=0&&(xhr.status>=200&&xhr.status<300)){var _638=xhr.responseText;if(_635["evalJSON"]&&_638){try{_638=dojo.fromJson(_638);}catch(syntaxException){console.log("Couldn't eval the JSON: "+_638+" (SyntaxError: "+syntaxException+")");}if(_635.serverAsync&&_638.taskname){bespin.publish("message",{msg:"Server is running : "+_638.taskname,tag:"autohide"});}}if(dojo.isFunction(_635["onSuccess"])){_635["onSuccess"](_638,xhr);}else{if(_635["log"]){console.log(_635["log"]);}}}else{var _639="on"+xhr.status;if(_635[_639]){_635[_639](xhr);}else{if(_635["onFailure"]){_635["onFailure"](xhr);}}}}};xhr.open(_632,this.SERVER_BASE_URL+url,true);var _63a=dojo.cookie("Domain-Token");if(!_63a){_63a=_636._randomPassword();dojo.cookie("Domain-Token",_63a);}xhr.setRequestHeader("X-Domain-Token",_63a);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(_635.headers){for(var key in _635.headers){if(_635.headers.hasOwnProperty(key)){xhr.setRequestHeader(key,_635.headers[key]);}}}if(_635.serverAsync){_636.asyncStarted();}xhr.send(_634);}else{var _63c=this.SERVER_BASE_URL+url;console.log("Are you sure you want to do a synchronous Ajax call? Really? "+_63c);xhr.open(_632,_63c,false);xhr.send(_634);return xhr.responseText;}},_randomPassword:function(){chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";pass="";for(var x=0;x<16;x++){var _63e=Math.floor(Math.random()*chars.length);pass+=chars.charAt(_63e);}return pass;},fetchResource:function(name,_640,_641){this.request("GET",name,null,{onSuccess:_640,onFailure:_641});},asyncStarted:function(){console.log("Starting new server-side async job.");if(this._asyncCount==0){this.processMessages();}this._asyncCount++;console.log("Count is now "+this._asyncCount);},asyncEnded:function(){console.log("Server-side async job done.");if(this._asyncCount>0){this._asyncCount--;}console.log("Count is now "+this._asyncCount);},login:function(user,pass,_644,_645){var url="/register/login/"+user;this.request("POST",url,"password="+escape(pass),{onSuccess:_644,on401:_645,log:"Login complete."});},signup:function(user,pass,_649,_64a,_64b,_64c){var url="/register/new/"+user;this.request("POST",url,"password="+escape(pass)+"&email="+escape(_649),{onSuccess:_64a,on401:_64b,on409:_64c,log:"Login complete."});},logout:function(_64e){var url="/register/logout/";this.request("POST",url,null,{log:"Logout complete.",onSuccess:_64e});},currentuser:function(_650,_651){var url="/register/userinfo/";return this.request("GET",url,null,{onSuccess:_650,on401:_651,evalJSON:true});},list:function(_653,path,_655,_656){var _653=_653||"";var url=bespin.util.path.combine("/file/list/",_653,path||"/");var opts={onSuccess:_655,evalJSON:true,log:"Listing files in: "+url};if(dojo.isFunction(_656)){opts.onFailure=_656;}this.request("GET",url,null,opts);},listAllFiles:function(_659,_65a,_65b){var _659=_659||"";var url=bespin.util.path.combine("/file/list_all/",_659,"/");var opts={onSuccess:_65a,evalJSON:true,log:"Listing all files in: "+url};if(dojo.isFunction(_65b)){opts.onFailure=_65b;}this.request("GET",url,null,opts);},projects:function(_65e){this.request("GET","/file/list/",null,{onSuccess:_65e,evalJSON:true});},saveFile:function(_65f,path,_661,_662){if(!_65f||!path){return;}var url=bespin.util.path.combine("/file/at",_65f,(path||""));if(_662){url+="?lastEdit="+_662;}this.request("PUT",url,_661,{log:"Saved file \""+_65f+"/"+path+"\""});},loadFile:function(_664,path,_666,_667){var _664=_664||"";var path=path||"";var url=bespin.util.path.combine("/file/at",_664,path);var opts={onSuccess:_666};if(dojo.isFunction(_667)){opts.onFailure=_667;}this.request("GET",url,null,opts);},removeFile:function(_66a,path,_66c,_66d){var _66a=_66a||"";var path=path||"";var url=bespin.util.path.combine("/file/at",_66a,path);var opts={onSuccess:_66c};if(dojo.isFunction(_66d)){opts.onFailure=_66d;}this.request("DELETE",url,null,opts);},makeDirectory:function(_670,path,_672,_673){if(!_670){return;}var url=bespin.util.path.combineAsDirectory("/file/at",_670,(path||""));var opts={};if(dojo.isFunction(_672)){opts.onSuccess=_672;}else{opts["log"]="Made a directory: [project="+_670+", path="+path+"]";}if(dojo.isFunction(_673)){opts.onFailure=_673;}this.request("PUT",url,null,opts);},removeDirectory:function(_676,path,_678,_679){if(!_676){return;}if(!path){path="";}var url=bespin.util.path.combineAsDirectory("/file/at",_676,path);var opts={};if(dojo.isFunction(_678)){opts.onSuccess=_678;}else{opts["log"]="Removed directory: [project="+_676+", path="+path+"]";}if(dojo.isFunction(_679)){opts.onFailure=_679;}this.request("DELETE",url,null,opts);},listOpen:function(_67c){this.request("GET","/file/listopen/",null,{onSuccess:_67c,evalJSON:true,log:"List open files."});},closeFile:function(_67d,path,_67f){var path=path||"";var url=bespin.util.path.combine("/file/close",_67d,path);this.request("POST",url,null,{onSuccess:_67f});},searchFiles:function(_681,_682,_683){var url=bespin.util.path.combine("/file/search",_681+"?q="+escape(_682));var opts={onSuccess:_683,evalJSON:true,log:"Listing searchfiles for: "+_681+", searchkey: "+_682};this.request("GET",url,null,opts);},editActions:function(_686,path,_688){var path=path||"";var url=bespin.util.path.combine("/edit/list",_686,path);this.request("GET",url,null,{onSuccess:_688,log:"Edit Actions Complete."});},editAfterActions:function(_68a,path,_68c,_68d){var path=path||"";var url=bespin.util.path.combine("/edit/recent",_68c,_68a,path);this.request("GET",url,null,{onSuccess:_68d,log:"Edit After Actions Complete."});},doAction:function(_68f,path,_691){var path=path||"";var url=bespin.util.path.combine("/edit",_68f,path);var sp="["+_691.join(",")+"]";this.request("PUT",url,sp,{onSuccess:function(){}});},exportProject:function(_694,_695){if(bespin.util.include(["zip","tgz","tar.gz"],_695)){var _696=document.createElement("iframe");_696.src=bespin.util.path.combine("/project/export",_694+"."+_695);_696.style.display="none";_696.style.height=_696.style.width="0";document.getElementsByTagName("body")[0].appendChild(_696);}},importProject:function(_697,url,opts){if(opts){var _69a=opts.onSuccess;opts.onSuccess=function(text,xhr){_69a(text,xhr);bespin.publish("project:imported",{project:_697,url:url});};}this.request("POST","/project/fromurl/"+_697,url,opts||{});},renameProject:function(_69d,_69e,opts){if(!opts){opts={log:"Renaming project from "+_69d+" to "+_69e};}if(_69d&&_69e){this.request("POST","/project/rename/"+_69d+"/",_69e,opts);}},listSettings:function(_6a0){if(typeof _6a0=="function"){this.request("GET","/settings/",null,{onSuccess:_6a0,evalJSON:true});}},getSetting:function(name,_6a2){if(typeof _6a2=="function"){this.request("GET","/settings/"+name,null,{onSuccess:_6a2});}},setSetting:function(name,_6a4,_6a5){var _6a6={};_6a6[name]=_6a4;this.setSettings(_6a6,(_6a5||function(){}));},setSettings:function(_6a7,_6a8){this.request("POST","/settings/",dojo.objectToQuery(_6a7),{onSuccess:(_6a8||function(){})});},unsetSetting:function(name,_6aa){this.request("DELETE","/settings/"+name,null,{onSuccess:(_6aa||function(){})});},vcs:function(_6ab,_6ac,opts){opts=opts||{};opts.serverAsync=true;this.request("POST","/vcs/command/"+_6ab+"/",dojo.toJson(_6ac),opts);},clone:function(data,opts){opts=opts||{};opts.serverAsync=true;this.request("POST","/vcs/clone/",data,opts);},setauth:function(_6b0,form,opts){this.request("POST","/vcs/setauth/"+_6b0+"/",dojo.formToQuery(form),opts||{});},getkey:function(_6b3,opts){if(_6b3==null){this.request("POST","/vcs/getkey/",null,opts||{});}else{this.request("POST","/vcs/getkey/","kcpass="+escape(_6b3),opts||{});}},remoteauth:function(_6b5,_6b6){this.request("GET","/vcs/remoteauth/"+escape(_6b5)+"/",null,{onSuccess:function(_6b7){var _6b8={project:_6b5,remoteauth:_6b7};bespin.publish("vcs:remoteauthUpdate",_6b8);_6b6(_6b7);}});},processMessages:function(){console.log("Message processing starting");var _6b9=this;function _6ba(){_6b9.request("POST","/messages/",null,{evalJSON:true,onSuccess:function(_6bb){for(var i=0;i<_6bb.length;i++){var _6bd=_6bb[i];var _6be=_6bd.eventName;if(_6be){bespin.publish(_6be,_6bd);}if(_6bd.asyncDone){_6b9.asyncEnded();}}if(_6b9._asyncCount>0){setTimeout(_6ba,1000);}},onFailure:function(_6bf){if(_6bf.asyncDone){_6b9.asyncEnded();}if(_6b9._asyncCount>0){setTimeout(_6ba,1000);}}});};_6ba();},fileTemplate:function(_6c0,path,_6c2,opts){var url=bespin.util.path.combine("/file/template",_6c0,path);this.request("PUT",url,dojo.toJson(_6c2),opts||{});},projectTemplate:function(_6c5,_6c6,opts){var url=bespin.util.path.combine("/project/template/",_6c5,"");this.request("POST",url,dojo.toJson(_6c6),opts||{});}});}if(!dojo._hasResource["bespin.client.session"]){dojo._hasResource["bespin.client.session"]=true;dojo.provide("bespin.client.session");dojo.declare("bespin.client.session.EditSession",null,{constructor:function(_6c9){this.editor=_6c9;},setUserinfo:function(_6ca){this.username=_6ca.username;this.amountUsed=_6ca.amountUsed;this.quota=_6ca.quota;},checkSameFile:function(_6cb,path){return ((this.project==_6cb)&&(this.path==path));},startSession:function(_6cd,path,_6cf){this.project=_6cd;this.path=path;if(typeof mobwrite!=="undefined"){mobwrite.share(this);}if(dojo.isFunction(_6cf)){_6cf({name:path,timestamp:new Date().getTime()});}},reportCollaborators:function(_6d0){var _6d1="";dojo.forEach(_6d0,function(_6d2){_6d1+="<div class='collab_person'>";_6d1+="  <div class='collab_icon'></div>";_6d1+="  <div class='collab_name'>"+_6d2+"</div>";_6d1+="  <div class='collab_description'>Editing</div>";_6d1+="</div>";});dojo.byId("collab_list").innerHTML=_6d1;},stopSession:function(){this.project=undefined;this.path=undefined;}});}if(!dojo._hasResource["bespin.editor.actions"]){dojo._hasResource["bespin.editor.actions"]=true;dojo.provide("bespin.editor.actions");dojo.declare("bespin.editor.Actions",null,{constructor:function(_6d3){this.editor=_6d3;this.model=this.editor.model;this.cursorManager=this.editor.cursorManager;this.ignoreRepaints=false;},handleCursorSelection:function(args){if(args.event.shiftKey){if(!this.editor.selection){this.editor.setSelection({startPos:bespin.editor.utils.copyPos(args.pos)});}this.editor.setSelection({startPos:this.editor.selection.startPos,endPos:bespin.editor.utils.copyPos(this.cursorManager.getCursorPosition())});}else{this.editor.setSelection(undefined);}},moveCursor:function(_6d5,args){var _6d7=this.cursorManager[_6d5](args);this.handleCursorSelection(args);this.repaint();args.pos=_6d7.newPos;return args;},moveCursorLeft:function(args){return this.moveCursor("moveLeft",args);},moveCursorRight:function(args){return this.moveCursor("moveRight",args);},moveCursorUp:function(args){return this.moveCursor("moveUp",args);},moveCursorDown:function(args){return this.moveCursor("moveDown",args);},moveToLineStart:function(args){return this.moveCursor("moveToLineStart",args);},moveToLineEnd:function(args){return this.moveCursor("moveToLineEnd",args);},moveToFileTop:function(args){return this.moveCursor("moveToTop",args);},moveToFileBottom:function(args){return this.moveCursor("moveToBottom",args);},movePageUp:function(args){return this.moveCursor("movePageUp",args);},movePageDown:function(args){return this.moveCursor("movePageDown",args);},moveWordLeft:function(args){return this.moveCursor("smartMoveLeft",args);},moveWordRight:function(args){return this.moveCursor("smartMoveRight",args);},deleteWordLeft:function(args){this.deleteChunk({endPos:args.pos,pos:this.moveCursor("smartMoveLeft",args).pos});return args;},deleteWordRight:function(args){this.deleteChunk({pos:args.pos,endPos:this.moveCursor("smartMoveRight",args).pos});return args;},undo:function(){this.editor.undoManager.undo();},redo:function(){this.editor.undoManager.redo();},selectAll:function(args){if(this.model.isEmpty()){return;}args.startPos={row:0,col:0};args.endPos={row:this.model.getRowCount()-1,col:this.editor.ui.getRowScreenLength(this.model.getRowCount()-1)};this.select(args);},select:function(args){if(args.startPos){this.editor.setSelection({startPos:args.startPos,endPos:args.endPos});this.cursorManager.moveCursor(args.endPos);}else{this.editor.setSelection(undefined);}},insertTab:function(args){if(this.editor.readonly){return;}var _6e9=bespin.get("settings");if(this.editor.getSelection()&&!args.undoInsertTab){this.indent(args);return;}var tab=args.tab;var _6eb=this.cursorManager.getCharacterLength("\t");if(!tab||!_6eb){if(_6e9&&_6e9.isSettingOn("tabmode")){tab="\t";}else{tab="";var _6ec=_6eb;while(_6ec-->0){tab+=" ";}_6eb=tab.length;}}delete this.editor.selection;this.model.insertCharacters(this.cursorManager.getModelPosition({row:args.pos.row,col:args.pos.col}),tab);this.cursorManager.moveCursor({row:args.pos.row,col:args.pos.col+_6eb});this.repaint();args.action="insertTab";var _6ed=args;var _6ee={action:"removeTab",queued:args.queued,pos:bespin.editor.utils.copyPos(args.pos),tab:tab};var _6ef=_6ee;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_6ef,_6ed));},removeTab:function(args){delete this.editor.selection;this.model.deleteCharacters(this.cursorManager.getModelPosition({row:args.pos.row,col:args.pos.col}),args.tab.length);this.cursorManager.moveCursor({row:args.pos.row,col:args.pos.col});this.repaint();args.action="removeTab";var _6f1=args;var _6f2={action:"insertTab",undoInsertTab:true,queued:args.queued,pos:bespin.editor.utils.copyPos(args.pos),tab:args.tab};var _6f3=_6f2;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_6f3,_6f1));},indent:function(args){var _6f5=args.historyIndent||false;var _6f6=!!_6f5;if(!_6f5){_6f5=new Array();}var _6f7=bespin.get("settings");var _6f8=args.selection||this.editor.getSelection();var _6f9=args.fakeSelection||false;var _6fa=_6f8.startPos.row;var _6fb=_6f8.endPos.row;var _6fc=this.cursorManager.getStringLength(this.model.getRowArray(_6fb).join(""));var _6fd=this.cursorManager.getStringLength(this.model.getRowArray(args.pos.row).join(""));var _6fe;var tab="";if(_6f7&&_6f7.isSettingOn("tabmode")){tab="\t";}else{var _700=this.editor.getTabSize();while(_700-->0){tab+=" ";}}for(var y=_6fa;y<=_6fb;y++){if(_6f6){_6fe=_6f5[y-_6fa];}else{if(tab!="\t"){_6fe=this.cursorManager.getLeadingWhitespace(y);_6fe=this.cursorManager.getNextTablevelRight(_6fe)-_6fe;_6fe=tab.substring(0,_6fe);}else{_6fe="\t";}}this.model.insertCharacters(this.cursorManager.getModelPosition({row:y,col:0}),_6fe);_6f5[y-_6fa]=_6fe;}var _702=this.cursorManager.getStringLength(this.model.getRowArray(args.pos.row).join(""))-_6fd;if(!_6f9){args.pos.col+=_702;_6f8.endPos.col+=this.cursorManager.getStringLength(this.model.getRowArray(_6fb).join(""))-_6fc;console.debug(_6f8.endPos);this.editor.setSelection(_6f8);}else{args.pos.col+=_702;}this.cursorManager.moveCursor({col:args.pos.col});this.repaint();args.action="indent";args.selection=_6f8;var _703=args;var _704={action:"unindent",queued:args.queued,selection:_6f8,fakeSelection:_6f9,historyIndent:_6f5,pos:bespin.editor.utils.copyPos(args.pos)};var _705=_704;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_705,_703));},unindent:function(args){var _707=args.historyIndent||false;if(!_707){var _708=[];}var _709=args.selection||this.editor.getSelection();var _70a=args.fakeSelection||false;if(!_709){_70a=true;_709={startPos:{row:args.pos.row,col:args.pos.col},endPos:{row:args.pos.row,col:args.pos.col}};}var _70b=_709.startPos.row;var _70c=_709.endPos.row;var _70d=this.cursorManager.getStringLength(this.model.getRowArray(_70c).join(""));var row=false;var _70f;var _710;for(var y=_70b;y<=_70c;y++){if(_707){_70f=_707[y-_70b].length;_710=(_707[y-_70b]=="\t"?this.editor.getTabSize():_707[y-_70b].length);}else{row=this.model.getRowArray(y);if(row.length>0&&row[0]=="\t"){_70f=1;_710=this.editor.getTabSize();}else{var _712=this.cursorManager.getLeadingWhitespace(y);_70f=this.cursorManager.getContinuousSpaceCount(0,this.editor.getTabSize(),y);_710=_70f;}_708.push(row.join("").substring(0,_70f));}if(_70f){this.model.deleteCharacters(this.cursorManager.getModelPosition({row:y,col:0}),_70f);}if(y==_70b){_709.startPos.col=Math.max(0,_709.startPos.col-_710);}if(y==_70c){if(!row){row=this.model.getRowArray(y);}var _713=_70d-this.cursorManager.getStringLength(row.join(""));_709.endPos.col=Math.max(0,_709.endPos.col-_713);args.pos.col=Math.max(0,args.pos.col-_713);}}this.cursorManager.moveCursor({col:args.pos.col});if(!_70a){this.editor.setSelection(_709);}_707=_707?_707:_708;this.repaint();args.action="unindent";args.selection=_709;var _714=args;var _715={action:"indent",queued:args.queued,selection:_709,fakeSelection:_70a,historyIndent:_707,pos:bespin.editor.utils.copyPos(args.pos)};var _716=_715;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_716,_714));},cutSelection:function(args){if(this.editor.readonly){return;}this.copySelection(args);this.deleteSelection(args);},copySelection:function(args){var _719=this.editor.getSelection();if(_719){var _71a=this.model.getChunk(_719);if(_71a){bespin.editor.clipboard.Manual.copy(_71a);}}},deleteSelectionAndInsertChunk:function(args){if(this.editor.readonly){return;}var _71c=args.queued;args.queued=true;var _71d=this.editor.getSelection();var _71e=this.deleteSelection(args);args.pos=bespin.editor.utils.copyPos(this.editor.getCursorPos());var _71f=this.insertChunk(args);args.queued=_71c;args.action="deleteSelectionAndInsertChunk";args.selection=_71d;var _720=args;var _721={action:"deleteChunkAndInsertChunkAndSelect",pos:bespin.editor.utils.copyPos(args.pos),endPos:_71f,queued:args.queued,chunk:_71e};var _722=_721;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_722,_720));},deleteChunkAndInsertChunkAndSelect:function(args){if(this.editor.readonly){return;}var _724=args.queued;args.queued=true;this.deleteChunk(args);this.insertChunkAndSelect(args);args.queued=_724;args.action="deleteChunkAndInsertChunkAndSelect";var _725=args;var _726={action:"deleteSelectionAndInsertChunk",pos:bespin.editor.utils.copyPos(args.pos),queued:args.queued,selection:args.selection};var _727=_726;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_727,_725));},pasteFromClipboard:function(args){if(this.editor.readonly){return;}var _729=(args.clipboard)?args.clipboard:bespin.editor.clipboard.Manual.data();if(_729===undefined){return;}args.chunk=_729;this.insertChunk(args);},insertChunk:function(args){if(this.editor.readonly){return;}if(this.editor.selection){this.deleteSelectionAndInsertChunk(args);}else{var pos=bespin.editor.utils.copyPos(this.cursorManager.getCursorPosition());pos=this.model.insertChunk(this.cursorManager.getModelPosition(pos),args.chunk);pos=this.cursorManager.getCursorPosition(pos);this.cursorManager.moveCursor(pos);this.repaint();args.action="insertChunk";var _72c=args;var _72d={action:"deleteChunk",pos:bespin.editor.utils.copyPos(args.pos),queued:args.queued,endPos:pos};var _72e=_72d;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_72e,_72c));return pos;}},deleteChunk:function(args){if(this.editor.readonly){return;}var _730=this.editor.getSelection({startPos:args.pos,endPos:args.endPos});var _731=this.model.deleteChunk(_730);this.cursorManager.moveCursor(_730.startPos);this.repaint();args.action="deleteChunk";var _732=args;var _733={action:"insertChunk",pos:bespin.editor.utils.copyPos(_730.startPos),queued:args.queued,chunk:_731};var _734=_733;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_734,_732));},joinLine:function(args){if(this.editor.readonly){return;}if(args.joinDirection=="up"){if(args.pos.row==0){return;}var _736=this.editor.ui.getRowScreenLength(args.pos.row-1);this.model.joinRow(args.pos.row-1);this.cursorManager.moveCursor({row:args.pos.row-1,col:_736});}else{if(args.pos.row>=this.model.getRowCount()-1){return;}this.model.joinRow(args.pos.row);}args.action="joinLine";var _737=args;var _738={action:"newline",pos:bespin.editor.utils.copyPos(this.editor.getCursorPos()),queued:args.queued};var _739=_738;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_739,_737));this.repaint();},killLine:function(args){if(this.editor.readonly){return;}this.editor.setSelection({startPos:{row:args.pos.row,col:0},endPos:{row:args.pos.row+1,col:0}});this.cutSelection(args);},deleteSelection:function(args){if(this.editor.readonly||!this.editor.selection){return;}var _73c=this.editor.getSelection();var _73d=this.model.getChunk(_73c);this.model.deleteChunk(_73c);args.action="deleteSelection";var _73e=args;var _73f={action:"insertChunkAndSelect",pos:bespin.editor.utils.copyPos(_73c.startPos),queued:args.queued,chunk:_73d};var _740=_73f;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_740,_73e));this.editor.setSelection(undefined);this.cursorManager.moveCursor(_73c.startPos);this.repaint();return _73d;},insertChunkAndSelect:function(args){if(this.editor.readonly){return;}var _742=this.cursorManager.getCursorPosition(this.model.insertChunk(this.cursorManager.getModelPosition(args.pos),args.chunk));args.action="insertChunkAndSelect";var _743=args;var _744={action:"deleteSelection",pos:bespin.editor.utils.copyPos(_742),queued:args.queued};var _745=_744;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_745,_743));this.editor.setSelection({startPos:args.pos,endPos:_742});this.cursorManager.moveCursor(_742);this.repaint();},backspace:function(args){if(this.editor.readonly){return;}if(this.editor.selection){this.deleteSelection(args);}else{if(args.pos.col>0){var _747=bespin.get("settings");if(_747&&_747.isSettingOn("smartmove")){var _748=this.editor.getTabSize();var _749=this.cursorManager.getContinuousSpaceCount(args.pos.col,this.cursorManager.getNextTablevelLeft(args.pos.col));if(_749==_748){var pos=args.pos;this.editor.selection={startPos:{row:pos.row,col:pos.col-_748},endPos:{row:pos.row,col:pos.col}};this.deleteSelection(args);return;}}this.cursorManager.moveCursor({col:Math.max(0,args.pos.col-1)});args.pos.col-=1;this.deleteCharacter(args);}else{args.joinDirection="up";this.joinLine(args);}}},deleteKey:function(args){if(this.editor.readonly){return;}if(this.editor.selection){this.deleteSelection(args);}else{if(args.pos.col<this.editor.ui.getRowScreenLength(args.pos.row)){var _74c=bespin.get("settings");if(_74c&&_74c.isSettingOn("smartmove")){var _74d=this.editor.getTabSize();var _74e=this.cursorManager.getContinuousSpaceCount(args.pos.col,this.cursorManager.getNextTablevelRight(args.pos.col));if(_74e==_74d){var pos=args.pos;this.editor.selection={startPos:{row:pos.row,col:pos.col},endPos:{row:pos.row,col:pos.col+_74d}};this.deleteSelection(args);return;}}this.deleteCharacter(args);}else{args.joinDirection="down";this.joinLine(args);}}},deleteCharacter:function(args){if(this.editor.readonly){return;}if(args.pos.col<this.editor.ui.getRowScreenLength(args.pos.row)){var _751=this.cursorManager.getModelPosition(args.pos);var _752=this.model.deleteCharacters(_751,1);this.repaint();args.action="deleteCharacter";var _753=args;var _754={action:"insertCharacter",pos:bespin.editor.utils.copyPos(args.pos),queued:args.queued,newchar:_752};var _755=_754;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_755,_753));}},newline:function(args){if(this.editor.readonly){return;}var _757=bespin.get("settings");var _758=(_757&&_757.get("autoindent"))?bespin.util.leadingSpaces(this.model.getRowArray(args.pos.row)):0;this.model.splitRow(this.cursorManager.getModelPosition(args.pos),_758);this.cursorManager.moveCursor({row:this.cursorManager.getCursorPosition().row+1,col:_758});args.action="newline";var _759=args;var _75a={action:"joinLine",joinDirection:"up",pos:bespin.editor.utils.copyPos(this.cursorManager.getCursorPosition()),queued:args.queued};var _75b=_75a;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_75b,_759));this.repaint();},deleteSelectionAndInsertCharacter:function(args){if(this.editor.readonly){return;}var _75d=args.queued;args.queued=true;var _75e=this.deleteSelection(args);args.pos=bespin.editor.utils.copyPos(this.editor.getCursorPos());this.insertCharacter(args);args.queued=_75d;args.action="deleteSelectionAndInsertCharacter";var _75f=args;var _760={action:"deleteCharacterAndInsertChunkAndSelect",pos:bespin.editor.utils.copyPos(args.pos),queued:args.queued,chunk:_75e};var _761=_760;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_761,_75f));},deleteCharacterAndInsertChunkAndSelect:function(args){if(this.editor.readonly){return;}var _763=args.queued;args.queued=true;this.deleteCharacter(args);this.insertChunkAndSelect(args);args.queued=_763;args.action="deleteCharacterAndInsertChunkAndSelect";var _764=args;var _765={action:"deleteSelectionAndInsertCharacter",pos:bespin.editor.utils.copyPos(args.pos),queued:args.queued};var _766=_765;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_766,_764));},insertCharacter:function(args){if(this.editor.readonly){return;}if(this.editor.selection){this.deleteSelectionAndInsertCharacter(args);}else{this.model.insertCharacters(this.cursorManager.getModelPosition(args.pos),args.newchar);this.cursorManager.moveRight(true);this.repaint();args.action="insertCharacter";var _768=args;var _769={action:"deleteCharacter",pos:bespin.editor.utils.copyPos(args.pos),queued:args.queued};var _76a=_769;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_76a,_768));}},moveCursorRowToCenter:function(args){var _76c=this.editor.getCursorPos().row;var _76d=Math.floor(this.editor.ui.visibleRows/2);if(_76c>(this.editor.ui.firstVisibleRow+_76d)){this.cursorManager.moveCursor({row:this.editor.getCursorPos().row+_76d});}else{this.cursorManager.moveCursor({row:this.editor.getCursorPos().row-_76d});}this.editor.ui.ensureCursorVisible();this.cursorManager.moveCursor({row:_76c});},getOppositeCase:function(_76e){if(!_76e){return undefined;}switch(_76e){case "u":return "l";break;case "l":return "u";break;}},selectionChangeCase:function(args){if(this.editor.readonly){return;}if(this.editor.selection){if(!args.selectionObject){args.selectionObject=this.editor.getSelection();}var _770=this.model.getChunk(args.selectionObject);var _771=_770.split("\n");for(i in _771){switch(args.stringCase){case "l":_771[i]=_771[i].toLowerCase();break;case "u":_771[i]=_771[i].toUpperCase();break;}}var _772=_771.join("\n");this.model.deleteChunk(args.selectionObject);this.model.insertChunk(args.selectionObject.startModelPos,_772);this.select(args.selectionObject);args.action="selectionChangeCase";var _773=args;var _774={action:"undoSelectionChangeCase",selectionObject:args.selectionObject,text:_770,stringCase:this.getOppositeCase(args.stringCase)};var _775=_774;this.editor.undoManager.addUndoOperation(new bespin.editor.UndoItem(_775,_773));}},undoSelectionChangeCase:function(args){if(this.editor.readonly){return;}this.model.deleteChunk(args.selectionObject);var _777=this.model.insertChunk(args.selectionObject.startModelPos,args.text);this.select(args.selectionObject);},startSearch:function(str,_779,_77a){if(str==""){this.editor.ui.setSearchString(false);this.editor.paint(true);dojo.byId("searchresult").style.display="none";return false;}if(str==this.editor.ui.searchString&&_779=="toolbar"){if(!_77a){this.findNext();}else{this.findPrev();}dojo.byId("searchresult").style.display="block";return;}this.editor.ui.setSearchString(str);var _77b=this.editor.model.getCountOfString(str);if(_77b!=0){var pos=bespin.editor.utils.copyPos(this.editor.cursorManager.getCursorPosition());if(!this.editor.ui.actions.findNext(true)){this.editor.cursorManager.moveCursor({col:0,row:0});this.editor.ui.actions.findNext();}}switch(_779){case "commandLine":var msg="Found "+_77b+" match";if(_77b>1){msg+="es";}msg+=" for your search for <em>"+str+"</em>";bespin.get("commandLine").showInfo(msg,true);break;case "searchwindow":var _77e=bespin.get("filesearch");if(_77e){_77e.setMatchesCount(_77b);}break;case "toolbar":var msg=+_77b+" Match";if(_77b>1){msg+="es";}dojo.byId("searchfeedback").innerHTML=msg;dojo.byId("searchresult").style.display="block";break;}this.editor.paint(true);},findNext:function(_77f){if(!this.editor.ui.searchString){return;}var pos=bespin.editor.utils.copyPos(this.cursorManager.getModelPosition());var sel=this.editor.getSelection();if(_77f&&sel!==undefined){pos.col-=sel.endModelPos.col-sel.startModelPos.col+1;}var _782=this.model.findNext(pos.row,pos.col,this.editor.ui.searchString);if(!_782){_782=this.model.findNext(0,0,this.editor.ui.searchString);}if(_782){this.editor.setSelection({startPos:this.cursorManager.getCursorPosition(_782.startPos),endPos:this.cursorManager.getCursorPosition(_782.endPos)});this.cursorManager.moveCursor(this.cursorManager.getCursorPosition(_782.endPos));this.editor.ui.ensureCursorVisible(true);this.repaint();return true;}else{return false;}},findPrev:function(){if(!this.editor.ui.searchString){return;}var pos=this.cursorManager.getModelPosition();var _784=this.model.findPrev(pos.row,pos.col,this.editor.ui.searchString);if(!_784){var _785=this.model.getRowCount()-1;_784=this.model.findPrev(_785,this.model.getRowArray(_785).length-1,this.editor.ui.searchString);}if(_784){this.editor.setSelection({startPos:this.cursorManager.getCursorPosition(_784.startPos),endPos:this.cursorManager.getCursorPosition(_784.endPos)});this.cursorManager.moveCursor(this.cursorManager.getCursorPosition(_784.endPos));this.editor.ui.ensureCursorVisible(true);this.repaint();}},escape:function(){bespin.publish("ui:escape");},toggleQuickopen:function(){var _786=bespin.get("quickopen");if(_786){_786.window.toggle();}},togglePieMenu:function(){var _787=bespin.get("piemenu");if(_787){_787.toggle();}},toggleFilesearch:function(){var _788=bespin.get("settings");if(_788&&!_788.isSettingOn("searchwindow")){dojo.byId("searchquery").focus();dojo.byId("searchquery").select();}else{var _789=bespin.get("filesearch");if(_789){_789.window.toggle();}}},focusCommandline:function(){var _78a=bespin.get("commandLine");if(_78a){_78a.commandLine.focus();}},repaint:function(){if(!this.ignoreRepaints){this.editor.ui.ensureCursorVisible();this.editor.paint();}}});}if(!dojo._hasResource["bespin.editor.clipboard"]){dojo._hasResource["bespin.editor.clipboard"]=true;dojo.provide("bespin.editor.clipboard");dojo.mixin(bespin.editor.clipboard,{install:function(_78b,_78c){if(this.uses&&typeof this.uses["uninstall"]=="function"){this.uses.uninstall();}this.uses=_78c;this.uses.install(_78b);},setup:function(_78d){if(dojo.isWebKit){this.install(_78d,new bespin.editor.clipboard.DOMEvents());}else{this.install(_78d,new bespin.editor.clipboard.HiddenWorld());}}});dojo.declare("bespin.editor.clipboard.DOMEvents",null,{install:function(_78e){var _78f=dojo.create("input",{type:"text",id:"copynpaster",style:"position: absolute; z-index: -400; top: -100px; left: -100px; width: 0; height: 0; border: none;"},dojo.body());var _790=function(e){return e.target.id=="command";};this.beforecopyHandle=dojo.connect(document,"beforecopy",function(e){if(_790(e)){return;}e.preventDefault();_78f.focus();});this.copyHandle=dojo.connect(document,"copy",function(e){if(_790(e)){return;}var _794=_78e.getSelectionAsText();if(_794&&_794!=""){e.preventDefault();e.clipboardData.setData("text/plain",_794);}dojo.byId("canvas").focus();});this.beforecutHandle=dojo.connect(document,"beforecut",function(e){if(_790(e)){return;}e.preventDefault();_78f.focus();});this.cutHandle=dojo.connect(document,"cut",function(e){if(_790(e)){return;}var _797=_78e.getSelection();if(_797){var _798=_78e.model.getChunk(_797);if(_798&&_798!=""){e.preventDefault();e.clipboardData.setData("text/plain",_798);_78e.ui.actions.deleteSelection(_797);}}dojo.byId("canvas").focus();});this.beforepasteHandle=dojo.connect(document,"beforepaste",function(e){if(_790(e)){return;}e.preventDefault();_78f.focus();});this.pasteHandle=dojo.connect(document,"paste",function(e){if(_790(e)){return;}e.preventDefault();var args=bespin.editor.utils.buildArgs();args.chunk=e.clipboardData.getData("text/plain");if(args.chunk){_78e.ui.actions.insertChunk(args);}dojo.byId("canvas").focus();_78f.value="";});dojo.connect(document,"dom:loaded",dojo.hitch(this,function(){this.keydownHandle=dojo.connect(_78f,"keydown",function(e){e.stopPropagation();});this.keypressHandle=dojo.connect(_78f,"keypress",function(e){e.stopPropagation();});}));},uninstall:function(){dojo.disconnect(this.keypressHandle);dojo.disconnect(this.keydownHandle);dojo.disconnect(this.beforepasteHandle);dojo.disconnect(this.pasteHandle);dojo.disconnect(this.beforecutHandle);dojo.disconnect(this.cutHandle);dojo.disconnect(this.beforecopyHandle);dojo.disconnect(this.copyHandle);}});dojo.declare("bespin.editor.clipboard.HiddenWorld",null,{install:function(_79e){var _79f=dojo.create("textarea",{tabIndex:"-1",autocomplete:"off",id:"copynpaster",style:"position: absolute; z-index: -400; top: -100px; left: -100px; width: 0; height: 0; border: none;"},dojo.body());var _7a0=function(text){_79f.value=text;_7a2();};var _7a2=function(){_79f.focus();_79f.select();setTimeout(function(){dojo.byId("canvas").focus();},0);};this.keyDown=dojo.connect(_79e.opts.actsAsComponent?_79e.canvas:document,"keydown",function(e){if((bespin.util.isMac()&&e.metaKey)||e.ctrlKey){if(e.keyCode==67){var _7a4=_79e.getSelectionAsText();if(_7a4&&_7a4!=""){_7a0(_7a4);}}else{if(e.keyCode==88){var _7a5=_79e.getSelection();if(_7a5){var _7a4=_79e.model.getChunk(_7a5);if(_7a4&&_7a4!=""){_7a0(_7a4);_79e.ui.actions.deleteSelection(_7a5);}}}else{if(e.keyCode==86){if(e.target==dojo.byId("command")){return;}_7a2();setTimeout(function(){var args=bespin.editor.utils.buildArgs();args.chunk=_79f.value;if(args.chunk){_79e.ui.actions.insertChunk(args);}},1);}}}}});},uninstall:function(){dojo.disconnect(this.keyDown);}});dojo.declare("bespin.editor.clipboard.EditorOnly",null,{install:function(){var _7a7=bespin.util.keys.fillArguments("CMD C");_7a7.action="copySelection";bespin.publish("editor:bindkey",_7a7);var _7a8=bespin.util.keys.fillArguments("CMD V");_7a8.action="pasteFromClipboard";bespin.publish("editor:bindkey",_7a8);var _7a9=bespin.util.keys.fillArguments("CMD X");_7a9.action="cutSelection";bespin.publish("editor:bindkey",_7a9);}});bespin.editor.clipboard.Manual=function(){var _7aa;return {copy:function(_7ab){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");}else{_7aa=_7ab;return;}}catch(ex){_7aa=_7ab;return;}var str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);str.data=_7ab;var _7ad=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!_7ad){return false;}_7ad.addDataFlavor("text/unicode");_7ad.setTransferData("text/unicode",str,_7ab.length*2);var _7ae=Components.interfaces.nsIClipboard;var clip=Components.classes["@mozilla.org/widget/clipboard;1"].getService(_7ae);if(!clip){return false;}clip.setData(_7ad,null,_7ae.kGlobalClipboard);},data:function(){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");}else{return _7aa;}}catch(ex){return _7aa;}var clip=Components.classes["@mozilla.org/widget/clipboard;1"].getService(Components.interfaces.nsIClipboard);if(!clip){return false;}var _7b1=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!_7b1){return false;}_7b1.addDataFlavor("text/unicode");clip.getData(_7b1,clip.kGlobalClipboard);var str={};var _7b3={};var _7b4="";_7b1.getTransferData("text/unicode",str,_7b3);if(str){str=str.value.QueryInterface(Components.interfaces.nsISupportsString);}if(str){_7b4=str.data.substring(0,_7b3.value/2);}return _7b4;}};}();}if(!dojo._hasResource["bespin.editor.cursor"]){dojo._hasResource["bespin.editor.cursor"]=true;dojo.provide("bespin.editor.cursor");dojo.declare("bespin.editor.CursorManager",null,{constructor:function(_7b5){this.editor=_7b5;this.position={row:0,col:0};this.virtualCol=0;},getCursorPosition:function(_7b6){if(_7b6!=undefined){var pos=bespin.editor.utils.copyPos(_7b6);var line=this.editor.model.getRowArray(pos.row);var _7b9=this.editor.getTabSize();if(line.indexOf("\t")!=-1){var tabs=0,_7bb=0;for(var i=0;i<_7b6.col;i++){if(line[i]=="\t"){pos.col+=_7b9-1-(_7bb%_7b9);tabs++;_7bb=0;}else{_7bb++;tabs=0;}}}return pos;}else{return this.position;}},getModelPosition:function(pos){pos=(pos!=undefined)?pos:this.position;var _7be=bespin.editor.utils.copyPos(pos);var line=this.editor.model.getRowArray(pos.row);var _7c0=this.editor.getTabSize();if(line.indexOf("\t")!=-1){var tabs=0,_7c2=0;for(var i=0;i<_7be.col;i++){if(line[i]=="\t"){_7be.col-=_7c0-1-(_7c2%_7c0);tabs++;_7c2=0;}else{_7c2++;tabs=0;}}}return _7be;},getCharacterLength:function(_7c4,_7c5){if(_7c4.length>1){return;}if(_7c5==undefined){_7c5=this.position.col;}if(_7c4=="\t"){var _7c6=this.editor.getTabSize();return (_7c6-(_7c5%_7c6));}else{return 1;}},getStringLength:function(str){if(!str||str.length==0){return 0;}var _7c8=0;str=str.split("");for(var x=0;x<str.length;x++){_7c8+=this.getCharacterLength(str[x],_7c8);}return _7c8;},getLeadingWhitespace:function(_7ca){var row=this.editor.model.getRowArray(_7ca).join("");var _7cc=/^(\s+).*/.exec(row);return (_7cc&&_7cc.length==2?this.getStringLength(_7cc[1]):0);},getContinuousSpaceCount:function(from,to,_7cf){_7cf=_7cf||this.position.row;var _7d0=bespin.get("settings");var row=this.editor.model.getRowArray(_7cf);var _7d2=(from<to?1:-1);var _7d3=row.length;from=from+(_7d2==1?0:-1);to=to+(_7d2==1?0:-1);from=this.getModelPosition({col:from,row:_7cf}).col;to=this.getModelPosition({col:to,row:_7cf}).col;if(_7d0&&_7d0.isSettingOn("strictlines")){from=Math.min(from,_7d3);to=Math.min(to,_7d3);}var _7d4=0;for(var x=from;x!=to;x+=_7d2){if(x<_7d3){if(row[x]!=" "){break;}}_7d4++;}return _7d4;},getNextTablevelLeft:function(col){var _7d7=this.editor.getTabSize();col=col||this.position.col;col--;return Math.floor(col/_7d7)*_7d7;},getNextTablevelRight:function(col){var _7d9=this.editor.getTabSize();col=col||this.position.col;col++;return Math.ceil(col/_7d9)*_7d9;},moveToLineStart:function(){var _7da=bespin.editor.utils.copyPos(this.position);var _7db=this.getLeadingWhitespace(_7da.row);if(this.position.col==0){this.moveCursor({col:_7db});}else{if(this.position.col==_7db){this.moveCursor({col:0});}else{if(_7db!=this.editor.ui.getRowScreenLength(this.editor.cursorManager.getCursorPosition().row)){this.moveCursor({col:_7db});}else{this.moveCursor({col:0});}}}return {oldPos:_7da,newPos:bespin.editor.utils.copyPos(this.position)};},moveToLineEnd:function(){var _7dc=bespin.editor.utils.copyPos(this.position);this.moveCursor({col:this.editor.ui.getRowScreenLength(_7dc.row)});return {oldPos:_7dc,newPos:bespin.editor.utils.copyPos(this.position)};},moveToTop:function(){var _7dd=bespin.editor.utils.copyPos(this.position);this.editor.cursorManager.moveCursor({row:0,col:0});return {oldPos:_7dd,newPos:bespin.editor.utils.copyPos(this.position)};},moveToBottom:function(){var _7de=bespin.editor.utils.copyPos(this.position);var row=this.editor.model.getRowCount()-1;this.editor.cursorManager.moveCursor({row:row,col:this.editor.ui.getRowScreenLength(row)});return {oldPos:_7de,newPos:bespin.editor.utils.copyPos(this.position)};},moveUp:function(){var _7e0=bespin.get("settings");var _7e1=this.editor.getSelection();var _7e2=bespin.editor.utils.copyPos(this.position);var _7e3=this.virtualCol;this.moveCursor({row:_7e2.row-1,col:Math.max(_7e2.col,this.virtualCol)});if((_7e0&&_7e0.isSettingOn("strictlines"))&&this.position.col>this.editor.ui.getRowScreenLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(_7e2.col,_7e3);}return {oldPos:_7e2,newPos:bespin.editor.utils.copyPos(this.position)};},moveDown:function(){var _7e4=bespin.get("settings");var _7e5=this.editor.getSelection();var _7e6=bespin.editor.utils.copyPos(this.position);var _7e7=this.virtualCol;this.moveCursor({row:Math.max(0,_7e6.row+1),col:Math.max(_7e6.col,this.virtualCol)});if((_7e4&&_7e4.isSettingOn("strictlines"))&&this.position.col>this.editor.ui.getRowScreenLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(_7e6.col,_7e7);}return {oldPos:_7e6,newPos:bespin.editor.utils.copyPos(this.position)};},moveLeft:function(args){var _7e9=bespin.get("settings");var _7ea=bespin.editor.utils.copyPos(this.position);var _7eb=(args.event?args.event.shiftKey:false);if(!this.editor.getSelection()||_7eb){if(_7e9&&_7e9.isSettingOn("smartmove")){var _7ec=this.getContinuousSpaceCount(_7ea.col,this.getNextTablevelLeft());if(_7ec==this.editor.getTabSize()){this.moveCursor({col:_7ea.col-_7ec});return {oldPos:_7ea,newPos:bespin.editor.utils.copyPos(this.position)};}}if((_7e9&&_7e9.isSettingOn("strictlines"))&&(this.position.col==0)){this.moveUp();if(_7ea.row>0){this.moveToLineEnd();}}else{this.moveCursor({row:_7ea.row,col:Math.max(0,_7ea.col-1)});}}else{this.moveCursor(this.editor.getSelection().startPos);}return {oldPos:_7ea,newPos:bespin.editor.utils.copyPos(this.position)};},moveRight:function(args){var _7ee=bespin.get("settings");var _7ef=bespin.editor.utils.copyPos(this.position);var _7f0=(args.event?args.event.shiftKey:false);if(!this.editor.getSelection()||_7f0){if((_7ee&&_7ee.isSettingOn("smartmove"))&&args!=true){var _7f1=this.getContinuousSpaceCount(_7ef.col,this.getNextTablevelRight());if(_7f1==this.editor.getTabSize()){this.moveCursor({col:_7ef.col+_7f1});return {oldPos:_7ef,newPos:bespin.editor.utils.copyPos(this.position)};}}if((_7ee&&_7ee.isSettingOn("strictlines"))&&(this.position.col>=this.editor.ui.getRowScreenLength(this.position.row))){this.moveDown();if(_7ef.row<this.editor.model.getRowCount()-1){this.moveToLineStart();}}else{this.moveCursor({col:this.position.col+1});}}else{this.moveCursor(this.editor.getSelection().endPos);}return {oldPos:_7ef,newPos:bespin.editor.utils.copyPos(this.position)};},movePageUp:function(){var _7f2=bespin.editor.utils.copyPos(this.position);this.moveCursor({row:Math.max(this.editor.ui.firstVisibleRow-this.editor.ui.visibleRows,0)});return {oldPos:_7f2,newPos:bespin.editor.utils.copyPos(this.position)};},movePageDown:function(){var _7f3=bespin.editor.utils.copyPos(this.position);this.moveCursor({row:Math.min(this.position.row+this.editor.ui.visibleRows,this.editor.model.getRowCount()-1)});return {oldPos:_7f3,newPos:bespin.editor.utils.copyPos(this.position)};},smartMoveLeft:function(){var _7f4=bespin.editor.utils.copyPos(this.position);var row=this.editor.ui.getRowString(_7f4.row);var c,_7f7;if(this.position.col==0){this.moveUp();this.moveToLineEnd();}else{if(row.length<this.position.col){this.moveToLineEnd();}var _7f8=this.position.col;var _7f9=false;while(_7f8>0){_7f8--;c=row.charAt(_7f8);_7f7=c.charCodeAt(0);if(_7f7==32){_7f9=true;}else{_7f8++;break;}}if(!_7f9){while(_7f8>0){_7f8--;c=row.charAt(_7f8);_7f7=c.charCodeAt(0);if((_7f7<65)||(_7f7>122)){if(_7f8!=this.position.col-1){_7f8++;}break;}}}this.moveCursor({col:_7f8});}return {oldPos:_7f4,newPos:bespin.editor.utils.copyPos(this.position)};},smartMoveRight:function(){var _7fa=bespin.editor.utils.copyPos(this.position);var row=this.editor.ui.getRowString(_7fa.row);if(row.length<=this.position.col){this.moveDown();this.moveToLineStart();}else{var c,_7fd;var _7fe=this.position.col;var _7ff=false;while(_7fe<row.length){c=row[_7fe];_7fd=c.charCodeAt(0);if(_7fd==32){_7ff=true;_7fe++;}else{break;}}if(!_7ff){while(_7fe<row.length){_7fe++;if(row.length==_7fe){this.moveToLineEnd();_7fe=-1;break;}c=row[_7fe];_7fd=c.charCodeAt(0);if((_7fd<65)||(_7fd>122)){break;}}}if(_7fe!=-1){this.moveCursor({col:_7fe});}}return {oldPos:_7fa,newPos:bespin.editor.utils.copyPos(this.position)};},moveCursor:function(_800){if(!_800){return;}if(_800.col===undefined){_800.col=this.position.col;}if(_800.row===undefined){_800.row=this.position.row;}this.virtualCol=0;var _801=this.position;var row=Math.min(_800.row,this.editor.model.getRowCount()-1);if(row<0){row=0;}var _803=this.isInvalidCursorPosition(row,_800.col);if(_803){if(_801.row!=_800.row){_800.col=_803.right;}else{if(_801.col<_800.col){_800.col=_803.right;}else{if(_801.col>_800.col){_800.col=_803.left;}else{_800.col=_803.right;}}}}this.position={row:row,col:_800.col};var _804=bespin.get("editor").ui;_804.showCursor=true;_804.toggleCursorAllowed=false;},isInvalidCursorPosition:function(row,col){var _807=this.editor.model.getRowArray(row);var _808=0;for(var i=0;i<_807.length;i++){if(_807[i].charCodeAt(0)==9){var _80a=this.editor.getTabSize()-(_808%this.editor.getTabSize());if((col>_808)&&(col<(_808+_80a))){return {left:_808,right:_808+_80a,half:_80a/2};}_808+=_80a-1;}_808++;}return undefined;}});}if(!dojo._hasResource["bespin.editor.editor"]){dojo._hasResource["bespin.editor.editor"]=true;dojo.provide("bespin.editor.editor");dojo.declare("bespin.editor.Scrollbar",null,{HORIZONTAL:"horizontal",VERTICAL:"vertical",MINIMUM_HANDLE_SIZE:20,constructor:function(ui,_80c,rect,_80e,min,max,_811){this.ui=ui;this.orientation=_80c;this.rect=rect;this.value=_80e;this.min=min;this.max=max;this.extent=_811;this.mousedownScreenPoint;this.mousedownValue;},getHandleBounds:function(){var sx=(this.isH())?this.rect.x:this.rect.y;var sw=(this.isH())?this.rect.w:this.rect.h;var _814=this.extent/(this.max+this.extent);var asw=_814*sw;if(asw<this.MINIMUM_HANDLE_SIZE){asw=this.MINIMUM_HANDLE_SIZE;}sx+=(sw-asw)*(this.value/(this.max-this.min));return (this.isH())?new bespin.editor.Rect(Math.floor(sx),this.rect.y,asw,this.rect.h):new bespin.editor.Rect(this.rect.x,sx,this.rect.w,asw);},isH:function(){return (!(this.orientation==this.VERTICAL));},fixValue:function(_816){if(_816<this.min){_816=this.min;}if(_816>this.max){_816=this.max;}return _816;},onmousewheel:function(e){var _818=bespin.util.mousewheelevent.wheel(e);var axis=bespin.util.mousewheelevent.axis(e);if(this.orientation==this.VERTICAL&&axis==this.VERTICAL){this.setValue(this.value+(_818*this.ui.lineHeight));}else{if(this.orientation==this.HORIZONTAL&&axis==this.HORIZONTAL){this.setValue(this.value+(_818*this.ui.charWidth));}}},onmousedown:function(e){var _81b=e.clientY-this.ui.getTopOffset();var _81c=e.clientX-this.ui.getLeftOffset();var bar=this.getHandleBounds();if(bar.contains({x:_81c,y:_81b})){this.mousedownScreenPoint=(this.isH())?e.screenX:e.screenY;this.mousedownValue=this.value;}else{var p=(this.isH())?_81c:_81b;var b1=(this.isH())?bar.x:bar.y;var b2=(this.isH())?bar.x2:bar.y2;if(p<b1){this.setValue(this.value-=this.extent);}else{if(p>b2){this.setValue(this.value+=this.extent);}}}},onmouseup:function(e){this.mousedownScreenPoint=null;this.mousedownValue=null;if(this.valueChanged){this.valueChanged();}},onmousemove:function(e){if(this.mousedownScreenPoint){var diff=((this.isH())?e.screenX:e.screenY)-this.mousedownScreenPoint;var _824=diff/(this.isH()?this.rect.w:this.rect.h);this.setValue(this.mousedownValue+Math.floor(((this.max+this.extent)-this.min)*_824));}},setValue:function(_825){this.value=this.fixValue(_825);if(this.valueChanged){this.valueChanged();}}});dojo.declare("bespin.editor.Rect",null,{constructor:function(x,y,w,h){this.x=x;this.y=y;this.w=w;this.h=h;this.x2=x+w;this.y2=y+h;},contains:function(_82a){if(!this.x){return false;}return ((this.x<=_82a.x)&&((this.x+this.w)>=_82a.x)&&(this.y<=_82a.y)&&((this.y+this.h)>=_82a.y));}});dojo.declare("bespin.editor.SelectionHelper",null,{constructor:function(_82b){this.editor=_82b;},getRowSelectionPositions:function(_82c){var _82d;var _82e;var _82f=this.editor.getSelection();if(!_82f){return undefined;}if((_82f.endPos.row<_82c)||(_82f.startPos.row>_82c)){return undefined;}_82d=(_82f.startPos.row<_82c)?0:_82f.startPos.col;_82e=(_82f.endPos.row>_82c)?-1:_82f.endPos.col;return {startCol:_82d,endCol:_82e};}});dojo.mixin(bespin.editor,{utils:{buildArgs:function(_830){return {pos:bespin.editor.utils.copyPos(_830||bespin.get("editor").getCursorPos())};},changePos:function(args,pos){return {pos:bespin.editor.utils.copyPos(oldPos||bespin.get("editor").getCursorPos())};},copyPos:function(_833){return {row:_833.row,col:_833.col};},posEquals:function(pos1,pos2){if(pos1==pos2){return true;}if(!pos1||!pos2){return false;}return (pos1.col==pos2.col)&&(pos1.row==pos2.row);},diffObjects:function(o1,o2){var _838={};if(!o1||!o2){return undefined;}for(var key in o1){if(o2[key]){if(o1[key]!=o2[key]){_838[key]=o1[key]+" => "+o2[key];}}else{_838[key]="o1: "+key+" = "+o1[key];}}for(var key2 in o2){if(!o1[key2]){_838[key2]="o2: "+key2+" = "+o2[key2];}}return _838;}}});dojo.declare("bespin.editor.DefaultEditorKeyListener",null,{constructor:function(_83b){this.editor=_83b;this.actions=_83b.ui.actions;this.skipKeypress=false;this.defaultKeyMap={};this.keyMap=this.defaultKeyMap;this.keyMapDescriptions={};},bindKey:function(_83c,_83d,_83e,_83f,_840,_841,name){this.defaultKeyMap[[_83c,_83d,_83e,_83f,_840]]=(typeof _841=="string")?function(){var _843=bespin.events.toFire(_841);bespin.publish(_843.name,_843.args);}:dojo.hitch(this.actions,_841);if(name){this.keyMapDescriptions[[_83c,_83d,_83e,_83f,_840]]=name;}},bindKeyString:function(_844,_845,_846,name){var _848=(_844.toUpperCase().indexOf("CTRL")!=-1);var _849=(_844.toUpperCase().indexOf("ALT")!=-1);var _84a=(_844.toUpperCase().indexOf("META")!=-1)||(_844.toUpperCase().indexOf("APPLE")!=-1);var _84b=(_844.toUpperCase().indexOf("SHIFT")!=-1);if(_844.toUpperCase().indexOf("CMD")!=-1){if(bespin.util.isMac()){_84a=true;}else{_848=true;}}return this.bindKey(_845,_84a,_848,_849,_84b,_846,name);},bindKeyStringSelectable:function(_84c,_84d,_84e,name){this.bindKeyString(_84c,_84d,_84e,name);this.bindKeyString("SHIFT "+_84c,_84d,_84e);},onkeydown:function(e){if(!this.editor.focus){return;}var args={event:e,pos:bespin.editor.utils.copyPos(this.editor.cursorManager.getCursorPosition())};this.skipKeypress=false;this.returnValue=false;var _852=this.keyMap[[e.keyCode,e.metaKey,e.ctrlKey,e.altKey,e.shiftKey]];var _853=false;if(dojo.isFunction(_852)){_853=true;_852(args);this.lastAction=_852;}if(e.metaKey||e.ctrlKey||e.altKey){this.skipKeypress=true;this.returnValue=true;}if(_853||!bespin.util.keys.passThroughToBrowser(e)){dojo.stopEvent(e);}},onkeypress:function(e){if(!this.editor.focus){return;}var _855=bespin.get("commandLine");if(_855&&e.charCode=="j".charCodeAt()&&e.ctrlKey){dojo.stopEvent(e);return false;}if([64,91,92,93,94,123,124,125,126].indexOf(e.charCode)!=-1){this.skipKeypress=false;}else{if(this.skipKeypress){if(!bespin.util.keys.passThroughToBrowser(e)){dojo.stopEvent(e);}return this.returnValue;}}var args={event:e,pos:bespin.editor.utils.copyPos(this.editor.cursorManager.getCursorPosition())};var _857=this.editor.ui.actions;if((e.charCode>=32)&&(e.charCode<=126)||e.charCode>=160){args.newchar=String.fromCharCode(e.charCode);_857.insertCharacter(args);}else{var _858=this.keyMap[[e.keyCode,e.metaKey,e.ctrlKey,e.altKey,e.shiftKey]];if(this.lastAction==_858){delete this.lastAction;}else{if(typeof _858=="function"){_858(args);}}}dojo.stopEvent(e);}});dojo.declare("bespin.editor.UI",null,{constructor:function(_859){this.editor=_859;this.model=this.editor.model;var _85a=bespin.get("settings");this.syntaxModel=bespin.syntax.Resolver.setEngine("simple").getModel();this.selectionHelper=new bespin.editor.SelectionHelper(_859);this.actions=new bespin.editor.Actions(_859);this.rowLengthCache=[];this.searchString=null;this.toggleCursorFullRepaintCounter=0;this.toggleCursorFrequency=250;this.toggleCursorAllowed=true;this.horizontalScrollCanvas=dojo.create("canvas");this.verticalScrollCanvas=dojo.create("canvas");this.gutterWidth=54;this.LINE_HEIGHT=23;this.GUTTER_INSETS={top:0,left:6,right:10,bottom:6};this.LINE_INSETS={top:0,left:5,right:0,bottom:6};this.FALLBACK_CHARACTER_WIDTH=10;this.NIB_WIDTH=15;this.NIB_INSETS={top:Math.floor(this.NIB_WIDTH/2),left:Math.floor(this.NIB_WIDTH/2),right:Math.floor(this.NIB_WIDTH/2),bottom:Math.floor(this.NIB_WIDTH/2)};this.NIB_ARROW_INSETS={top:3,left:3,right:3,bottom:5};this.DEBUG_GUTTER_WIDTH=18;this.DEBUG_GUTTER_INSETS={top:2,left:2,right:2,bottom:2};this.xoffset=0;this.yoffset=0;this.showCursor=true;this.overXScrollBar=false;this.overYScrollBar=false;this.hasFocus=false;var _85b=this.editor.container;dojo.connect(_85b,"mousemove",this,"handleScrollBars");dojo.connect(_85b,"mouseout",this,"handleScrollBars");dojo.connect(_85b,"click",this,"handleScrollBars");dojo.connect(_85b,"mousedown",this,"handleScrollBars");dojo.connect(_85b,"mousedown",this,"mouseDownSelect");dojo.connect(_85b,"mousemove",this,"mouseMoveSelect");dojo.connect(_85b,"mouseup",this,"mouseUpSelect");this.lastLineCount=0;this.lastCursorPos=null;this.lastxoffset=0;this.lastyoffset=0;this.xscrollbar=new bespin.editor.Scrollbar(this,"horizontal");this.xscrollbar.valueChanged=dojo.hitch(this,function(){this.xoffset=-this.xscrollbar.value;this.editor.paint();});dojo.connect(window,"mousemove",this.xscrollbar,"onmousemove");dojo.connect(window,"mouseup",this.xscrollbar,"onmouseup");dojo.connect(window,(!dojo.isMozilla?"onmousewheel":"DOMMouseScroll"),this.xscrollbar,"onmousewheel");this.yscrollbar=new bespin.editor.Scrollbar(this,"vertical");this.yscrollbar.valueChanged=dojo.hitch(this,function(){this.yoffset=-this.yscrollbar.value;this.editor.paint();});var _85c=_859.opts.actsAsComponent?_859.canvas:window;dojo.connect(_85c,"mousemove",this.yscrollbar,"onmousemove");dojo.connect(_85c,"mouseup",this.yscrollbar,"onmouseup");dojo.connect(_85c,(!dojo.isMozilla?"onmousewheel":"DOMMouseScroll"),this.yscrollbar,"onmousewheel");setTimeout(dojo.hitch(this,function(){this.toggleCursor(this);}),this.toggleCursorFrequency);},convertClientPointToCursorPoint:function(pos){var _85e=bespin.get("settings");var x,y;if(pos.y>(this.lineHeight*this.editor.model.getRowCount())){y=this.editor.model.getRowCount()-1;}else{var ty=pos.y;y=Math.floor(ty/this.lineHeight);}if(pos.x<=(this.gutterWidth+this.LINE_INSETS.left)){x=-1;}else{var tx=pos.x-this.gutterWidth-this.LINE_INSETS.left;x=Math.floor(tx/this.charWidth);if((_85e&&_85e.isSettingOn("strictlines"))){var _863=this.getRowScreenLength(y);if(x>=_863){x=this.getRowScreenLength(y);}}}return {row:y,col:x};},mouseDownSelect:function(e){if(!this.editor.focus){return;}var _865=e.clientY-this.getTopOffset();var _866=e.clientX-this.getLeftOffset();if(this.overXScrollBar||this.overYScrollBar){return;}if(this.editor.debugMode){if(_866<this.DEBUG_GUTTER_WIDTH){var _867={x:_866,y:_865};_867.y+=Math.abs(this.yoffset);var p=this.convertClientPointToCursorPoint(_867);var _869=bespin.get("editSession");if(p&&_869){bespin.debug.toggleBreakpoint({project:_869.project,path:_869.path,lineNumber:p.row});this.editor.paint(true);return;}}}if(e.shiftKey){this.selectMouseDownPos=(this.editor.selection)?this.editor.selection.startPos:this.editor.getCursorPos();this.setSelection(e);}else{var _867={x:_866,y:_865};_867.x+=Math.abs(this.xoffset);_867.y+=Math.abs(this.yoffset);if((this.xscrollbar.rect.contains(_867))||(this.yscrollbar.rect.contains(_867))){return;}this.selectMouseDownPos=this.convertClientPointToCursorPoint(_867);}},mouseMoveSelect:function(e){if(!this.editor.focus){return;}this.setSelection(e);},mouseUpSelect:function(e){if(!this.editor.focus){return;}this.setSelection(e);this.selectMouseDownPos=undefined;},setSelection:function(e){var _86d=e.clientY-this.getTopOffset();var _86e=e.clientX-this.getLeftOffset();if(!this.selectMouseDownPos){return;}var down=bespin.editor.utils.copyPos(this.selectMouseDownPos);var _870={x:_86e,y:_86d};_870.x+=Math.abs(this.xoffset);_870.y+=Math.abs(this.yoffset);var up=this.convertClientPointToCursorPoint(_870);if(down.col==-1){down.col=0;var _872=bespin.get("parser").getLineMarkers();var _873;for(var i=0;i<_872.length;i++){if(_872[i].line===down.row+1){_873=_872[i];bespin.publish("message",{msg:"Syntax "+_873.type+(isFinite(_873.line)?" at line "+_873.line+" character "+(_873.character+1):" ")+": "+_873.reason+"<p>"+(_873.evidence&&(_873.evidence.length>80?_873.evidence.slice(0,77)+"...":_873.evidence).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),tag:"autohide"});}}}if(up.col==-1){up.col=0;}if(!bespin.editor.utils.posEquals(down,up)){this.editor.setSelection({startPos:down,endPos:up});}else{if(e.detail==1){this.editor.setSelection(undefined);}else{if(e.detail==2){var row=this.editor.model.rows[down.row];var _876=row[down.col];if(!_876||_876.charAt(0)==" "){}else{var _877=(up=this.editor.model.findBefore(down.row,down.col));var _878=this.editor.model.findAfter(down.row,down.col);this.editor.setSelection({startPos:_877,endPos:_878});}}else{if(e.detail>2){this.editor.setSelection({startPos:{row:down.row,col:0},endPos:{row:down.row+1,col:0}});}}}}this.editor.cursorManager.moveCursor(up);this.editor.paint();},toggleCursor:function(ui){if(ui.toggleCursorAllowed){ui.showCursor=!ui.showCursor;}else{ui.toggleCursorAllowed=true;}if(++this.toggleCursorFullRepaintCounter>0){this.toggleCursorFullRepaintCounter=0;ui.editor.paint(true);}else{ui.editor.paint();}setTimeout(function(){ui.toggleCursor(ui);},ui.toggleCursorFrequency);},ensureCursorVisible:function(_87a){if((!this.lineHeight)||(!this.charWidth)){return;}if(bespin.get("settings")){var _87b=parseFloat(bespin.get("settings").get("pagescroll"))||0;}else{var _87b=0;}_87b=(!_87a?Math.max(0,Math.min(1,_87b)):0.25);var y=this.lineHeight*this.editor.cursorManager.getCursorPosition().row;var x=this.charWidth*this.editor.cursorManager.getCursorPosition().col;var _87e=this.getHeight();var _87f=this.getWidth()-this.gutterWidth;if(Math.abs(this.yoffset)>y){this.yoffset=Math.min(-y+_87e*_87b,0);}else{if((Math.abs(this.yoffset)+_87e)<(y+this.lineHeight)){this.yoffset=-((y+this.lineHeight)-_87e*(1-_87b));this.yoffset=Math.max(this.yoffset,_87e-this.lineHeight*this.model.getRowCount());}}if(Math.abs(this.xoffset)>x){this.xoffset=-x;}else{if((Math.abs(this.xoffset)+_87f)<(x+(this.charWidth*2))){this.xoffset=-((x+(this.charWidth*2))-_87f);}}},handleFocus:function(e){this.editor.model.clear();this.editor.model.insertCharacters({row:0,col:0},e.type);},handleScrollBars:function(e){var _882=e.clientY-this.getTopOffset();var _883=e.clientX-this.getLeftOffset();var oldX=this.overXScrollBar;var oldY=this.overYScrollBar;var _886=false;var w=this.editor.container.clientWidth;var h=this.editor.container.clientHeight;var sx=w-this.NIB_WIDTH-this.NIB_INSETS.right;var sy=h-this.NIB_WIDTH-this.NIB_INSETS.bottom;var p={x:_883,y:_882};if(e.type=="mousedown"){if((this.xscrollbar)&&(this.xscrollbar.rect.contains(p))){this.xscrollbar.onmousedown(e);}else{if((this.yscrollbar)&&(this.yscrollbar.rect.contains(p))){this.yscrollbar.onmousedown(e);}}}if(e.type=="mouseout"){this.overXScrollBar=false;this.overYScrollBar=false;}if((e.type=="mousemove")||(e.type=="click")){this.overYScrollBar=p.x>sx;this.overXScrollBar=p.y>sy;}if(e.type=="click"){if((typeof e.button!="undefined")&&(e.button==0)){var _88c;if(this.nibup.contains(p)){_88c="up";}else{if(this.nibdown.contains(p)){_88c="down";}else{if(this.nibleft.contains(p)){_88c="left";}else{if(this.nibright.contains(p)){_88c="right";}}}}if(_88c=="up"){this.yoffset+=this.lineHeight;_886=true;}else{if(_88c=="down"){this.yoffset-=this.lineHeight;_886=true;}else{if(_88c=="left"){this.xoffset+=this.charWidth*2;_886=true;}else{if(_88c=="right"){this.xoffset-=this.charWidth*2;_886=true;}}}}}}if((oldX!=this.overXScrollBar)||(oldY!=this.overYScrollBar)||_886){this.editor.paint();}},installKeyListener:function(_88d){var Key=bespin.util.keys.Key;if(this.oldkeydown){dojo.disconnect(this.oldkeydown);}if(this.oldkeypress){dojo.disconnect(this.oldkeypress);}this.oldkeydown=dojo.hitch(_88d,"onkeydown");this.oldkeypress=dojo.hitch(_88d,"onkeypress");var _88f=this.editor.opts.actsAsComponent?this.editor.canvas:document;dojo.connect(_88f,"keydown",this,"oldkeydown");dojo.connect(_88f,"keypress",this,"oldkeypress");_88d.bindKeyStringSelectable("",Key.LEFT_ARROW,this.actions.moveCursorLeft,"Move Cursor Left");_88d.bindKeyStringSelectable("",Key.RIGHT_ARROW,this.actions.moveCursorRight,"Move Cursor Right");_88d.bindKeyStringSelectable("",Key.UP_ARROW,this.actions.moveCursorUp,"Move Cursor Up");_88d.bindKeyStringSelectable("",Key.DOWN_ARROW,this.actions.moveCursorDown,"Move Cursor Down");_88d.bindKeyStringSelectable("ALT",Key.LEFT_ARROW,this.actions.moveWordLeft,"Move Word Left");_88d.bindKeyStringSelectable("ALT",Key.RIGHT_ARROW,this.actions.moveWordRight,"Move Word Right");_88d.bindKeyStringSelectable("",Key.HOME,this.actions.moveToLineStart,"Move to start of line");_88d.bindKeyStringSelectable("CMD",Key.LEFT_ARROW,this.actions.moveToLineStart,"Move to start of line");_88d.bindKeyStringSelectable("",Key.END,this.actions.moveToLineEnd,"Move to end of line");_88d.bindKeyStringSelectable("CMD",Key.RIGHT_ARROW,this.actions.moveToLineEnd,"Move to end of line");_88d.bindKeyString("CTRL",Key.K,this.actions.killLine,"Kill entire line");_88d.bindKeyString("CTRL",Key.L,this.actions.moveCursorRowToCenter,"Move cursor to center of page");_88d.bindKeyString("",Key.BACKSPACE,this.actions.backspace,"Backspace");_88d.bindKeyString("CTRL",Key.BACKSPACE,this.actions.deleteWordLeft,"Delete a word to the left");_88d.bindKeyString("",Key.DELETE,this.actions.deleteKey,"Delete");_88d.bindKeyString("CTRL",Key.DELETE,this.actions.deleteWordRight,"Delete a word to the right");_88d.bindKeyString("",Key.ENTER,this.actions.newline,"Insert newline");_88d.bindKeyString("",Key.TAB,this.actions.insertTab,"Indent / insert tab");_88d.bindKeyString("SHIFT",Key.TAB,this.actions.unindent,"Unindent");_88d.bindKeyString("",Key.ESCAPE,this.actions.escape,"Clear fields and dialogs");_88d.bindKeyString("CMD",Key.A,this.actions.selectAll,"Select All");_88d.bindKeyString("ALT",Key.O,this.actions.toggleQuickopen,"Toggle Quickopen");_88d.bindKeyString("CTRL",Key.J,this.actions.focusCommandline,"Focus Commandline");_88d.bindKeyString("CMD",Key.K,this.actions.togglePieMenu,"Open Pie Menu");_88d.bindKeyString("CMD",Key.Z,this.actions.undo,"Undo");_88d.bindKeyString("SHIFT CMD",Key.Z,this.actions.redo,"Redo");_88d.bindKeyString("CMD",Key.Y,this.actions.redo,"Redo");_88d.bindKeyStringSelectable("CMD",Key.UP_ARROW,this.actions.moveToFileTop,"Move to top of file");_88d.bindKeyStringSelectable("CMD",Key.DOWN_ARROW,this.actions.moveToFileBottom,"Move to bottom of file");_88d.bindKeyStringSelectable("CMD",Key.HOME,this.actions.moveToFileTop,"Move to top of file");_88d.bindKeyStringSelectable("CMD",Key.END,this.actions.moveToFileBottom,"Move to bottom of file");_88d.bindKeyStringSelectable("",Key.PAGE_UP,this.actions.movePageUp,"Move a page up");_88d.bindKeyStringSelectable("",Key.PAGE_DOWN,this.actions.movePageDown,"Move a page down");},getWidth:function(){return parseInt(dojo.style(this.editor.canvas.parentNode,"width"));},getHeight:function(){return parseInt(dojo.style(this.editor.canvas.parentNode,"height"));},getTopOffset:function(){return dojo.coords(this.editor.canvas.parentNode).y||this.editor.canvas.parentNode.offsetTop;},getLeftOffset:function(){return dojo.coords(this.editor.canvas.parentNode).x||this.editor.canvas.parentNode.offsetLeft;},getCharWidth:function(ctx){if(ctx.measureText){return ctx.measureText("M").width;}else{return this.FALLBACK_CHARACTER_WIDTH;}},getLineHeight:function(ctx){var lh=-1;if(ctx.measureText){var t=ctx.measureText("M");if(t.ascent){lh=Math.floor(t.ascent*2.8);}}if(lh==-1){lh=this.LINE_HEIGHT;}return lh;},paint:function(ctx,_895){var c=dojo.byId(this.editor.canvas);var _897=this.editor.theme;var ed=this.editor;var x,y;var cy;var _89c;var _89d;var Rect=bespin.editor.Rect;var _89f=_895;if(!_89f){_89f=(this.selectMouseDownPos);}if(!_89f){_89f=(this.lastLineCount!=ed.model.getRowCount());}this.lastLineCount=ed.model.getRowCount();ctx.font=_897.editorTextFont;this.charWidth=this.getCharWidth(ctx);this.lineHeight=this.getLineHeight(ctx);var _8a0=this.getWidth();var _8a1=this.getHeight();if(this.xoffset>0){this.xoffset=0;}if(this.yoffset>0){this.yoffset=0;}this.visibleRows=Math.ceil(_8a1/this.lineHeight);this.firstVisibleRow=Math.floor(Math.abs(this.yoffset/this.lineHeight));_89d=this.firstVisibleRow+this.visibleRows;if(_89d>(ed.model.getRowCount()-1)){_89d=ed.model.getRowCount()-1;}var _8a2=this.lineHeight*ed.model.getRowCount();var _8a3=this.charWidth*(Math.max(this.getMaxCols(this.firstVisibleRow,_89d),ed.cursorManager.getCursorPosition().col)+2);this.gutterWidth=this.GUTTER_INSETS.left+this.GUTTER_INSETS.right;this.gutterWidth+=(""+_89d).length*this.charWidth;if(this.editor.debugMode){this.gutterWidth+=this.DEBUG_GUTTER_WIDTH;}if(this.xoffset<0){if((Math.abs(this.xoffset))>(_8a3-(_8a0-this.gutterWidth))){this.xoffset=(_8a0-this.gutterWidth)-_8a3;}}if(this.yoffset<0){if((Math.abs(this.yoffset))>(_8a2-_8a1)){this.yoffset=_8a1-_8a2;}}if((this.xoffset!=this.lastxoffset)||(this.yoffset!=this.lastyoffset)){_89f=true;this.lastxoffset=this.xoffset;this.lastyoffset=this.yoffset;}var _8a4=((_8a0-this.gutterWidth)<_8a3);var _8a5=(_8a1<_8a2);var _8a6=_8a0-this.NIB_WIDTH-this.NIB_INSETS.right-2;var _8a7=_8a1-this.NIB_WIDTH-this.NIB_INSETS.bottom-2;var _8a8=(_8a4&&(this.xoffset!=0));var _8a9=(_8a4&&(this.xoffset>((_8a0-this.gutterWidth)-_8a3)));var _8aa=(_8a5&&(this.yoffset!=0));var _8ab=(_8a5&&(this.yoffset>(_8a1-_8a2)));if(((dojo.attr(c,"width"))!=_8a0)||(dojo.attr(c,"height")!=_8a1)){_89f=true;dojo.attr(c,{width:_8a0,height:_8a1});}var _8ac={};if(this.editor.debugMode&&bespin.get("editSession")){var _8ad=bespin.debug.getBreakpoints(bespin.get("editSession").project,bespin.get("editSession").path);dojo.forEach(_8ad,function(_8ae){_8ac[_8ae.lineNumber]=_8ae;});delete _8ad;}if(!_89f){var _8af=ed.model.getDirtyRows();if((this.lastCursorPos)&&(this.lastCursorPos.row!=ed.cursorManager.getCursorPosition().row)){_8af[this.lastCursorPos.row]=true;}_8af[ed.cursorManager.getCursorPosition().row]=true;}this.lastCursorPos=bespin.editor.utils.copyPos(ed.cursorManager.getCursorPosition());if(_89f){ctx.fillStyle=_897.backgroundStyle;ctx.fillRect(0,0,c.width,c.height);ctx.fillStyle=_897.gutterStyle;ctx.fillRect(0,0,this.gutterWidth,c.height);}ctx.save();ctx.translate(0,Math.round(this.yoffset));if(_89f){if(bespin.get("parser")){var _8b0=bespin.get("parser").getLineMarkers();for(var i=0;i<_8b0.length;i++){if(_8b0[i].line>=this.firstVisibleRow&&_8b0[i].line<=_89d+1){y=this.lineHeight*(_8b0[i].line-1);cy=y+(this.lineHeight-this.LINE_INSETS.bottom);if(_8b0[i].type==="error"){ctx.fillStyle=this.editor.theme.lineMarkerErrorColor;}else{ctx.fillStyle=this.editor.theme.lineMarkerWarningColor;}ctx.fillRect(0,y,this.gutterWidth,this.lineHeight);}}}y=(this.lineHeight*this.firstVisibleRow);for(_89c=this.firstVisibleRow;_89c<=_89d;_89c++){x=0;if(this.editor.debugMode){if(_8ac[_89c]){var bpx=x+this.DEBUG_GUTTER_INSETS.left;var bpy=y+this.DEBUG_GUTTER_INSETS.top;var bpw=this.DEBUG_GUTTER_WIDTH-this.DEBUG_GUTTER_INSETS.left-this.DEBUG_GUTTER_INSETS.right;var bph=this.lineHeight-this.DEBUG_GUTTER_INSETS.top-this.DEBUG_GUTTER_INSETS.bottom;var _8b6=bpx+parseInt(bpw/2);var _8b7=bpy+parseInt(bph/2);ctx.strokeStyle="rgb(128, 0, 0)";ctx.fillStyle="rgb(255, 102, 102)";ctx.beginPath();ctx.arc(_8b6,_8b7,bpw/2,0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.stroke();}x+=this.DEBUG_GUTTER_WIDTH;}x+=this.GUTTER_INSETS.left;cy=y+(this.lineHeight-this.LINE_INSETS.bottom);ctx.fillStyle=_897.lineNumberColor;ctx.font=this.editor.theme.lineNumberFont;ctx.fillText(_89c+1,x,cy);y+=this.lineHeight;}}ctx.save();ctx.beginPath();ctx.rect(this.gutterWidth,-this.yoffset,_8a0-this.gutterWidth,_8a1);ctx.closePath();ctx.translate(this.xoffset,0);ctx.clip();var _8b8=Math.floor(Math.abs(this.xoffset/this.charWidth));var _8b9=_8b8+(Math.ceil((_8a0-this.gutterWidth)/this.charWidth));y=(this.lineHeight*this.firstVisibleRow);var cc;var ce;var ri;var _8bd;var tx,tw,tsel;var _8c1=bespin.get("settings");var _8c2=(this.searchString?this.searchString.length:-1);for(_89c=this.firstVisibleRow;_89c<=_89d;_89c++){x=this.gutterWidth;if(!_89f){if(!_8af[_89c]){y+=this.lineHeight;continue;}ctx.save();ctx.beginPath();ctx.rect(x+(Math.abs(this.xoffset)),y,_8a0,this.lineHeight);ctx.closePath();ctx.clip();if((_89c%2)==1){ctx.fillStyle=_897.backgroundStyle;ctx.fillRect(x+(Math.abs(this.xoffset)),y,_8a0,this.lineHeight);}}if((_8c1&&_8c1.isSettingOn("highlightline"))&&(_89c==ed.cursorManager.getCursorPosition().row)){ctx.fillStyle=_897.highlightCurrentLineColor;ctx.fillRect(x+(Math.abs(this.xoffset)),y,_8a0,this.lineHeight);}else{if((_89c%2)==0){ctx.fillStyle=_897.zebraStripeColor;ctx.fillRect(x+(Math.abs(this.xoffset)),y,_8a0,this.lineHeight);}}x+=this.LINE_INSETS.left;cy=y+(this.lineHeight-this.LINE_INSETS.bottom);var _8c3=this.selectionHelper.getRowSelectionPositions(_89c);if(_8c3){tx=x+(_8c3.startCol*this.charWidth);tw=(_8c3.endCol==-1)?(_8b9-_8b8)*this.charWidth:(_8c3.endCol-_8c3.startCol)*this.charWidth;ctx.fillStyle=_897.editorSelectedTextBackground;ctx.fillRect(tx,y,tw,this.lineHeight);}var _8c4=this.model.getRowMetadata(_89c);var _8c5=_8c4.lineText;var _8c6=_8c4.searchIndices;var _8c7=this.syntaxModel.getSyntaxStylesPerLine(_8c5,_89c,this.editor.language);for(ri=0;ri<_8c7.regions.length;ri++){var _8c8=_8c7.regions[ri];for(var _8c9 in _8c8){if(!_8c8.hasOwnProperty(_8c9)){continue;}var _8ca="";var _8cb=_8c8[_8c9];var _8cc=0;for(var si=0;si<_8cb.length;si++){var _8ce=_8cb[si];for(;_8cc<_8ce.start;_8cc++){_8ca+=" ";}_8ca+=_8c7.text.substring(_8ce.start,_8ce.stop);_8cc=_8ce.stop;}ctx.fillStyle=this.editor.theme[_8c9]||"white";ctx.font=this.editor.theme.editorTextFont;ctx.fillText(_8ca,x,cy);}}if(_8c6){if(_8c3){tsel={startCol:0,endCol:_8c5.length};if(_8c3.startCol!=-1){tsel.startCol=_8c3.startCol;}if(_8c3.endCol!=-1){tsel.endCol=_8c3.endCol;}}else{tsel=false;}for(var i=0;i<_8c6.length;i++){var _8cf=ed.cursorManager.getCursorPosition({col:_8c6[i],row:_89c}).col;tx=x+_8cf*this.charWidth;ctx.fillStyle=this.editor.theme.searchHighlight;ctx.fillRect(tx,y,_8c2*this.charWidth,this.lineHeight);if(tsel){var _8d0=_8cf;var _8d1=_8cf+_8c2;if(tsel.startCol<_8d1&&tsel.endCol>_8d0){_8d0=Math.max(_8d0,tsel.startCol);_8d1=Math.min(_8d1,tsel.endCol);ctx.fillStyle=this.editor.theme.searchHighlightSelected;ctx.fillRect(x+_8d0*this.charWidth,y,(_8d1-_8d0)*this.charWidth,this.lineHeight);}}ctx.fillStyle=this.editor.theme.editorTextColor||"white";ctx.fillText(_8c5.substring(_8cf,_8cf+_8c2),tx,cy);}}if(_8c1&&(_8c1.isSettingOn("tabarrow")||_8c1.isSettingOn("tabshowspace"))){if(_8c4.tabExpansions.length>0){for(var i=0;i<_8c4.tabExpansions.length;i++){var _8d2=_8c4.tabExpansions[i];var lx=x+(_8d2.start*this.charWidth);var _8d4=_8c1&&_8c1.isSettingOn("tabshowspace");if(_8d4){var sw=(_8d2.end-_8d2.start)*this.charWidth;ctx.fillStyle=this.editor.theme["tabSpace"]||"white";ctx.fillRect(lx,y,sw,this.lineHeight);}var _8d6=_8c1&&_8c1.isSettingOn("tabarrow");if(_8d6){var cy=y+(this.lineHeight/2);var cx=lx+(this.charWidth/2);var tw=4;var th=6;var tx=parseInt(cx-(tw/2));var ty=parseInt(cy-(th/2));ctx.beginPath();ctx.fillStyle=this.editor.theme["plain"]||"white";ctx.moveTo(tx,ty);ctx.lineTo(tx,ty+th);ctx.lineTo(tx+tw,ty+parseInt(th/2));ctx.closePath();ctx.fill();}}}}if(!_89f){ctx.drawImage(this.verticalScrollCanvas,_8a6+Math.abs(this.xoffset),Math.abs(this.yoffset));ctx.restore();}y+=this.lineHeight;}if(this.editor.focus){if(this.showCursor){if(ed.theme.cursorType=="underline"){x=this.gutterWidth+this.LINE_INSETS.left+ed.cursorManager.getCursorPosition().col*this.charWidth;y=(ed.getCursorPos().row*this.lineHeight)+(this.lineHeight-5);ctx.fillStyle=ed.theme.cursorStyle;ctx.fillRect(x,y,this.charWidth,3);}else{x=this.gutterWidth+this.LINE_INSETS.left+ed.cursorManager.getCursorPosition().col*this.charWidth;y=(ed.cursorManager.getCursorPosition().row*this.lineHeight);ctx.fillStyle=ed.theme.cursorStyle;ctx.fillRect(x,y,1,this.lineHeight);}}}else{x=this.gutterWidth+this.LINE_INSETS.left+ed.cursorManager.getCursorPosition().col*this.charWidth;y=(ed.cursorManager.getCursorPosition().row*this.lineHeight);ctx.fillStyle=ed.theme.unfocusedCursorFillStyle;ctx.strokeStyle=ed.theme.unfocusedCursorStrokeStyle;ctx.fillRect(x,y,this.charWidth,this.lineHeight);ctx.strokeRect(x,y,this.charWidth,this.lineHeight);}ctx.restore();ctx.restore();if(!_89f){return;}if(this.horizontalScrollCanvas.width!=_8a0){this.horizontalScrollCanvas.width=_8a0;}if(this.horizontalScrollCanvas.height!=this.NIB_WIDTH+4){this.horizontalScrollCanvas.height=this.NIB_WIDTH+4;}if(this.verticalScrollCanvas.height!=_8a1){this.verticalScrollCanvas.height=_8a1;}if(this.verticalScrollCanvas.width!=this.NIB_WIDTH+4){this.verticalScrollCanvas.width=this.NIB_WIDTH+4;}var hctx=this.horizontalScrollCanvas.getContext("2d");hctx.clearRect(0,0,this.horizontalScrollCanvas.width,this.horizontalScrollCanvas.height);hctx.save();var vctx=this.verticalScrollCanvas.getContext("2d");vctx.clearRect(0,0,this.verticalScrollCanvas.width,this.verticalScrollCanvas.height);vctx.save();var _8dc=(this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null)?{n:ed.theme.fullNibStyle,a:ed.theme.fullNibArrowStyle,s:ed.theme.fullNibStrokeStyle}:{n:ed.theme.partialNibStyle,a:ed.theme.partialNibArrowStyle,s:ed.theme.partialNibStrokeStyle};var _8dd=(this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null)?{n:ed.theme.fullNibStyle,a:ed.theme.fullNibArrowStyle,s:ed.theme.fullNibStrokeStyle}:{n:ed.theme.partialNibStyle,a:ed.theme.partialNibArrowStyle,s:ed.theme.partialNibStrokeStyle};var _8de=Math.floor(this.NIB_WIDTH/2);this.nibup=new Rect(_8a0-this.NIB_INSETS.right-this.NIB_WIDTH,this.NIB_INSETS.top,this.NIB_WIDTH,this.NIB_WIDTH);this.nibdown=new Rect(_8a0-this.NIB_INSETS.right-this.NIB_WIDTH,_8a1-(this.NIB_WIDTH*2)-(this.NIB_INSETS.bottom*2),this.NIB_INSETS.top,this.NIB_WIDTH,this.NIB_WIDTH);this.nibleft=new Rect(this.gutterWidth+this.NIB_INSETS.left,_8a1-this.NIB_INSETS.bottom-this.NIB_WIDTH,this.NIB_WIDTH,this.NIB_WIDTH);this.nibright=new Rect(_8a0-(this.NIB_INSETS.right*2)-(this.NIB_WIDTH*2),_8a1-this.NIB_INSETS.bottom-this.NIB_WIDTH,this.NIB_WIDTH,this.NIB_WIDTH);vctx.translate(-_8a6,0);hctx.translate(0,-_8a7);if(_8a4&&((this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null))){hctx.save();hctx.beginPath();hctx.rect(this.nibleft.x+_8de+2,0,this.nibright.x-this.nibleft.x-1,_8a1);hctx.closePath();hctx.clip();hctx.fillStyle=ed.theme.scrollTrackFillStyle;hctx.fillRect(this.nibleft.x,this.nibleft.y-1,this.nibright.x2-this.nibleft.x,this.nibleft.h+1);hctx.strokeStyle=ed.theme.scrollTrackStrokeStyle;hctx.strokeRect(this.nibleft.x,this.nibleft.y-1,this.nibright.x2-this.nibleft.x,this.nibleft.h+1);hctx.restore();}if(_8a5&&((this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null))){vctx.save();vctx.beginPath();vctx.rect(0,this.nibup.y+_8de+2,_8a0,this.nibdown.y-this.nibup.y-1);vctx.closePath();vctx.clip();vctx.fillStyle=ed.theme.scrollTrackFillStyle;vctx.fillRect(this.nibup.x-1,this.nibup.y,this.nibup.w+1,this.nibdown.y2-this.nibup.y);vctx.strokeStyle=ed.theme.scrollTrackStrokeStyle;vctx.strokeRect(this.nibup.x-1,this.nibup.y,this.nibup.w+1,this.nibdown.y2-this.nibup.y);vctx.restore();}if(_8a5){if((_8aa)||(this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null)){vctx.save();vctx.translate(this.nibup.x+_8de,this.nibup.y+_8de);this.paintNib(vctx,_8dc.n,_8dc.a,_8dc.s);vctx.restore();}if((_8ab)||(this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null)){vctx.save();vctx.translate(this.nibdown.x+_8de,this.nibdown.y+_8de);vctx.rotate(Math.PI);this.paintNib(vctx,_8dc.n,_8dc.a,_8dc.s);vctx.restore();}}if(_8a4){if((_8a8)||(this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null)){hctx.save();hctx.translate(this.nibleft.x+_8de,this.nibleft.y+_8de);hctx.rotate(Math.PI*1.5);this.paintNib(hctx,_8dd.n,_8dd.a,_8dd.s);hctx.restore();}if((_8a9)||(this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null)){hctx.save();hctx.translate(this.nibright.x+_8de,this.nibright.y+_8de);hctx.rotate(Math.PI*0.5);this.paintNib(hctx,_8dd.n,_8dd.a,_8dd.s);hctx.restore();}}var sx=this.nibleft.x2+4;var sw=this.nibright.x-this.nibleft.x2-9;this.xscrollbar.rect=new Rect(sx,this.nibleft.y-1,sw,this.nibleft.h+1);this.xscrollbar.value=-this.xoffset;this.xscrollbar.min=0;this.xscrollbar.max=_8a3-(_8a0-this.gutterWidth);this.xscrollbar.extent=_8a0-this.gutterWidth;if(_8a4){var _8e0=(((this.overXScrollBar)&&(_8a3>_8a0))||((this.xscrollbar)&&(this.xscrollbar.mousedownValue!=null)));if(!_8e0){hctx.globalAlpha=0.3;}this.paintScrollbar(hctx,this.xscrollbar);hctx.globalAlpha=1;}var sy=this.nibup.y2+4;var sh=this.nibdown.y-this.nibup.y2-9;this.yscrollbar.rect=new Rect(this.nibup.x-1,sy,this.nibup.w+1,sh);this.yscrollbar.value=-this.yoffset;this.yscrollbar.min=0;this.yscrollbar.max=_8a2-_8a1;this.yscrollbar.extent=_8a1;if(_8a5){var _8e3=((this.overYScrollBar)&&(_8a2>_8a1))||((this.yscrollbar)&&(this.yscrollbar.mousedownValue!=null));if(!_8e3){vctx.globalAlpha=0.3;}this.paintScrollbar(vctx,this.yscrollbar);vctx.globalAlpha=1;}ctx.drawImage(this.verticalScrollCanvas,_8a6,0);ctx.drawImage(this.horizontalScrollCanvas,0,_8a7);hctx.restore();vctx.restore();if(!_8aa){this.nibup=new Rect();}if(!_8ab){this.nibdown=new Rect();}if(!_8a8){this.nibleft=new Rect();}if(!_8a9){this.nibright=new Rect();}},paintScrollbar:function(ctx,_8e5){var bar=_8e5.getHandleBounds();var _8e7=(ctx.globalAlpha)?ctx.globalAlpha:1;if(!_8e5.isH()){ctx.save();ctx.translate(bar.x+Math.floor(bar.w/2),bar.y+Math.floor(bar.h/2));ctx.rotate(Math.PI*1.5);ctx.translate(-(bar.x+Math.floor(bar.w/2)),-(bar.y+Math.floor(bar.h/2)));bar=new bespin.editor.Rect(bar.x-Math.floor(bar.h/2)+Math.floor(bar.w/2),bar.y+Math.floor(bar.h/2)-Math.floor(bar.w/2),bar.h,bar.w);}var _8e8=bar.h/2;ctx.beginPath();ctx.arc(bar.x+_8e8,bar.y+_8e8,_8e8,Math.PI/2,3*(Math.PI/2),false);ctx.arc(bar.x2-_8e8,bar.y+_8e8,_8e8,3*(Math.PI/2),Math.PI/2,false);ctx.lineTo(bar.x+_8e8,bar.y+bar.h);ctx.closePath();var _8e9=ctx.createLinearGradient(bar.x,bar.y,bar.x,bar.y+bar.h);_8e9.addColorStop(0,this.editor.theme.scrollBarFillGradientTopStart.replace(/%a/,_8e7));_8e9.addColorStop(0.4,this.editor.theme.scrollBarFillGradientTopStop.replace(/%a/,_8e7));_8e9.addColorStop(0.41,this.editor.theme.scrollBarFillStyle.replace(/%a/,_8e7));_8e9.addColorStop(0.8,this.editor.theme.scrollBarFillGradientBottomStart.replace(/%a/,_8e7));_8e9.addColorStop(1,this.editor.theme.scrollBarFillGradientBottomStop.replace(/%a/,_8e7));ctx.fillStyle=_8e9;ctx.fill();ctx.save();ctx.clip();ctx.fillStyle=this.editor.theme.scrollBarFillStyle.replace(/%a/,_8e7);ctx.beginPath();ctx.moveTo(bar.x+(_8e8*0.4),bar.y+(_8e8*0.6));ctx.lineTo(bar.x+(_8e8*0.9),bar.y+(bar.h*0.4));ctx.lineTo(bar.x,bar.y+(bar.h*0.4));ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(bar.x+bar.w-(_8e8*0.4),bar.y+(_8e8*0.6));ctx.lineTo(bar.x+bar.w-(_8e8*0.9),bar.y+(bar.h*0.4));ctx.lineTo(bar.x+bar.w,bar.y+(bar.h*0.4));ctx.closePath();ctx.fill();ctx.restore();ctx.beginPath();ctx.arc(bar.x+_8e8,bar.y+_8e8,_8e8,Math.PI/2,3*(Math.PI/2),false);ctx.arc(bar.x2-_8e8,bar.y+_8e8,_8e8,3*(Math.PI/2),Math.PI/2,false);ctx.lineTo(bar.x+_8e8,bar.y+bar.h);ctx.closePath();ctx.strokeStyle=this.editor.theme.scrollTrackStrokeStyle;ctx.stroke();if(!_8e5.isH()){ctx.restore();}},paintNib:function(ctx,_8eb,_8ec,_8ed){var _8ee=Math.floor(this.NIB_WIDTH/2);ctx.fillStyle=_8eb;ctx.beginPath();ctx.arc(0,0,Math.floor(this.NIB_WIDTH/2),0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.strokeStyle=_8ed;ctx.stroke();ctx.fillStyle=_8ec;ctx.beginPath();ctx.moveTo(0,-_8ee+this.NIB_ARROW_INSETS.top);ctx.lineTo(-_8ee+this.NIB_ARROW_INSETS.left,_8ee-this.NIB_ARROW_INSETS.bottom);ctx.lineTo(_8ee-this.NIB_ARROW_INSETS.right,_8ee-this.NIB_ARROW_INSETS.bottom);ctx.closePath();ctx.fill();},getRowString:function(row){return this.model.getRowMetadata(row).lineText;},getRowScreenLength:function(row){return this.getRowString(row).length;},getMaxCols:function(_8f1,_8f2){var cols=0;for(var i=_8f1;i<=_8f2;i++){cols=Math.max(cols,this.getRowScreenLength(i));}return cols;},setSearchString:function(str){if(str&&str!=""){this.searchString=str;}else{delete this.searchString;}this.model.searchStringChanged(this.searchString);this.editor.paint(true);}});dojo.declare("bespin.editor.API",null,{constructor:function(_8f6,opts){this.opts=opts||{};this.debugMode=false;this.container=dojo.byId(_8f6);this.model=new bespin.editor.DocumentModel(this);dojo.byId(_8f6).innerHTML="<canvas id=\"canvas\" moz-opaque=\"true\" tabindex=\"-1\"></canvas>";this.canvas=dojo.byId(_8f6).firstChild;while(this.canvas&&this.canvas.nodeType!=1){this.canvas=this.canvas.nextSibling;}this.cursorManager=new bespin.editor.CursorManager(this);this.ui=new bespin.editor.UI(this);this.theme=bespin.themes["default"];this.editorKeyListener=new bespin.editor.DefaultEditorKeyListener(this);this.undoManager=new bespin.editor.UndoManager(this);this.customEvents=new bespin.editor.Events(this);this.ui.installKeyListener(this.editorKeyListener);this.model.insertCharacters({row:0,col:0}," ");dojo.connect(this.canvas,"blur",dojo.hitch(this,function(e){this.setFocus(false);}));dojo.connect(this.canvas,"focus",dojo.hitch(this,function(e){this.setFocus(true);}));bespin.editor.clipboard.setup(this);this.paint();if(!this.opts.dontfocus){this.setFocus(true);}},getSelection:function(_8fa){_8fa=(_8fa!=undefined)?_8fa:this.selection;if(!_8fa){return undefined;}var _8fb=_8fa.startPos;var _8fc=_8fa.endPos;if((_8fc.row<_8fb.row)||((_8fc.row==_8fb.row)&&(_8fc.col<_8fb.col))){var foo=_8fb;_8fb=_8fc;_8fc=foo;}return {startPos:bespin.editor.utils.copyPos(_8fb),endPos:bespin.editor.utils.copyPos(_8fc),startModelPos:this.getModelPos(_8fb),endModelPos:this.getModelPos(_8fc)};},getCursorPos:function(_8fe){return this.cursorManager.getCursorPosition(_8fe);},getModelPos:function(pos){return this.cursorManager.getModelPosition(pos);},resetView:function(data){this.cursorManager.moveCursor(data.cursor);this.setSelection(data.selection);this.ui.yoffset=data.offset.y;this.ui.xoffset=data.offset.x;this.paint();},basicView:function(){this.cursorManager.moveCursor({row:0,col:0});this.setSelection(undefined);this.ui.yoffset=0;this.ui.xoffset=0;this.paint();},getCurrentView:function(){return {cursor:this.getCursorPos(),offset:{x:this.ui.xoffset,y:this.ui.yoffset},selection:this.selection};},getTabSize:function(){var _901=bespin.get("settings");var size=bespin.defaultTabSize;if(_901){var _903=parseInt(_901.get("tabsize"));if(_903>0){size=_903;}}return size;},getSelectionAsText:function(){var _904="";var _905=this.getSelection();if(_905){_904=this.model.getChunk(_905);}return _904;},setSelection:function(_906){this.selection=_906;if(this.undoManager.syncHelper){this.undoManager.syncHelper.queueSelect(_906);}},paint:function(_907){var ctx=bespin.util.canvas.fix(this.canvas.getContext("2d"));this.ui.paint(ctx,_907);},changeKeyListener:function(_909){this.ui.installKeyListener(_909);this.editorKeyListener=_909;},setFocus:function(_90a){this.focus=_90a;},setReadOnly:function(_90b){this.readonly=_90b;}});}if(!dojo._hasResource["bespin.editor.events"]){dojo._hasResource["bespin.editor.events"]=true;dojo.provide("bespin.editor.events");dojo.declare("bespin.editor.Events",null,{constructor:function(_90c){bespin.subscribe("editor:openfile:opensuccess",function(_90d){var _90e=_90d.file.content||"";_90c.model.insertDocument(_90e);_90c.cursorManager.moveCursor({row:0,col:0});});bespin.subscribe("editor:doaction",function(_90f){var _910=_90f.action;var args=_90f.args||bespin.editor.utils.buildArgs();if(_910){_90c.ui.actions[_910](args);}});bespin.subscribe("editor:setaction",function(_912){var _913=_912.action;var code=_912.code;if(_913&&dojo.isFunction(code)){_90c.ui.actions[_913]=code;}});bespin.subscribe("editor:bindkey",function(_915){var _916=_915.modifiers||"";if(!_915.key){return;}var _917=bespin.util.keys.Key[_915.key.toUpperCase()];var _918=_90c.ui.actions[_915.action]||_915.action;if(_917&&_918){var _919="User key to execute: "+_915.action.replace("command:execute;name=","");if(_915.selectable){_90c.editorKeyListener.bindKeyStringSelectable(_916,_917,_918,_919);}else{_90c.editorKeyListener.bindKeyString(_916,_917,_918,_919);}}});bespin.subscribe("editor:openfile",function(_91a){var _91b=_91a.filename;var _91c=bespin.get("editSession");var _91d=bespin.get("files");var _91e=_91a.project||_91c.project;if(_91c.checkSameFile(_91e,_91b)){return;}bespin.publish("editor:openfile:openbefore",{project:_91e,filename:_91b});_91d.collaborateOnFile(_91e,_91b,function(file){if(!file){bespin.publish("editor:openfile:openfail",{project:_91e,filename:_91b});}else{bespin.publish("editor:openfile:opensuccess",{project:_91e,file:file});var _920=bespin.get("settings");var _921=_920.getObject("lastused");if(!_921){_921=[];}var _922={project:_91e,filename:_91b};var _923=[];dojo.forEach(_921,function(item){if(item.project!=_922.project||item.filename!=_922.filename){_923.unshift(item);}});_923.unshift(_922);_921=_923;if(_921.length>10){_921=_921.slice(0,10);}_920.setObject("lastused",_921);}});});bespin.subscribe("editor:forceopenfile",function(_925){var _926=_925.filename;var _927=_925.project;var _928=_925.content||" ";var _929=bespin.get("editSession");if(_929){if(!_927){_927=_929.project;}if(_929.checkSameFile(_927,_926)){return;}}if(!_927){return;}bespin.get("files").forceOpenFile(_927,_926,_928);});bespin.subscribe("editor:newfile",function(_92a){var _92b=_92a.project||bespin.get("editSession").project;var _92c=_92a.newfilename||"new.txt";var _92d=_92a.content||" ";bespin.get("files").newFile(_92b,_92c,function(){bespin.publish("editor:openfile:opensuccess",{file:{name:_92c,content:_92d,timestamp:new Date().getTime()}});bespin.publish("editor:dirty");});});bespin.subscribe("editor:savefile",function(_92e){var _92f=_92e.project||bespin.get("editSession").project;var _930=_92e.filename||bespin.get("editSession").path;bespin.publish("editor:savefile:before",{filename:_930});dojo.cookie("viewData_"+_92f+"_"+_930.split("/").join("_"),dojo.toJson(bespin.get("editor").getCurrentView()),{expires:7});var file={name:_930,content:_90c.model.getDocument(),timestamp:new Date().getTime()};if(_90c.undoManager.syncHelper){file.lastOp=_90c.undoManager.syncHelper.lastOp;}bespin.get("files").saveFile(_92f,file);bespin.publish("editor:titlechange",{filename:_930});bespin.publish("message",{msg:"Saved file: "+file.name,tag:"autohide"});bespin.publish("editor:clean");});bespin.subscribe("editor:moveandcenter",function(_932){var row=_932.row;if(!row){return;}var _934=row-1;_90c.cursorManager.moveCursor({row:_934,col:0});if((_934<_90c.ui.firstVisibleRow)||(_934>=_90c.ui.firstVisibleRow+_90c.ui.visibleRows)){bespin.publish("editor:doaction",{action:"moveCursorRowToCenter"});}});bespin.subscribe("editor:openfile:opensuccess",function(_935){var _936=_935.project||bespin.get("editSession").project;var _937=_935.file.name;var data=dojo.cookie("viewData_"+_936+"_"+_937.split("/").join("_"));if(data){bespin.get("editor").resetView(dojo.fromJson(data));}else{bespin.get("editor").basicView();}bespin.publish("editor:titlechange",{filename:_937});bespin.publish("url:change",{project:_936,path:_937});});bespin.subscribe("url:change",function(_939){var _93a=dojo.queryToObject(location.hash.substring(1));_93a.project=_939.project;_93a.path=_939.path;var _93b=[];for(var name in _93a){var _93d=_93a[name];_93b.push(name+"="+_93d);}window.location.hash=_93b.join("&");});bespin.subscribe("url:changed",function(_93e){bespin.publish("editor:openfile",{filename:_93e.now.get("path")});});bespin.subscribe("session:status",function(_93f){var _940=bespin.get("editSession");var file=_940.path||"a new scratch file";bespin.publish("message",{msg:"Hey "+_940.username+", you are editing "+file+" in project "+_940.project});});bespin.subscribe("cmdline:focus",function(_942){_90c.setFocus(false);});bespin.subscribe("cmdline:blur",function(_943){_90c.setFocus(true);});bespin.subscribe("ui:escape",function(_944){if(_90c.ui.searchString){_90c.ui.setSearchString(false);dojo.byId("searchresult").style.display="none";}});bespin.subscribe("editor:document:changed",function(_945){bespin.publish("editor:dirty");});bespin.subscribe("editor:dirty",function(_946){_90c.dirty=true;});bespin.subscribe("editor:clean",function(_947){_90c.dirty=false;});}});}if(!dojo._hasResource["bespin.editor.model"]){dojo._hasResource["bespin.editor.model"]=true;dojo.provide("bespin.editor.model");dojo.declare("bespin.editor.DocumentModel",null,{constructor:function(_948){this.editor=_948;this.rows=[];this.cacheRowMetadata=[];},isEmpty:function(){if(this.rows.length>1){return false;}if(this.rows.length==1&&this.rows[0].length>0){return false;}return true;},getDirtyRows:function(){var dr=(this.dirtyRows)?this.dirtyRows:[];this.dirtyRows=null;return dr;},setRowDirty:function(row){if(!this.dirtyRows){this.dirtyRows=new Array(this.rows.length);}this.dirtyRows[row]=true;},isRowDirty:function(row){if(!this.dirtyRows){return true;}return this.dirtyRows[row];},setRowArray:function(_94c,row){if(!dojo.isArray(row)){row=row.split("");}this.rows[_94c]=row;},getRowArray:function(_94e){while(this.rows.length<=_94e){this.rows.push([]);}return this.rows[_94e];},hasRow:function(_94f){return (this.rows[_94f]);},insertCharacters:function(_950,_951){var row=this.getRowArray(_950.row);while(row.length<_950.col){row.push(" ");}var _953=(_950.col>0)?row.splice(0,_950.col):[];_953=_953.concat(_951.split(""));this.rows[_950.row]=_953.concat(row);this.setRowDirty(_950.row);this.editor.ui.syntaxModel.invalidateCache(_950.row);},getDocument:function(){var file=[];for(var x=0;x<this.getRowCount();x++){file[x]=this.getRowArray(x).join("");}return file.join("\n");},insertDocument:function(_956){this.clear();var rows=_956.split("\n");for(var x=0;x<rows.length;x++){this.insertCharacters({row:x,col:0},rows[x]);}},changeEachRow:function(_959){for(var x=0;x<this.getRowCount();x++){var row=this.getRowArray(x);row=_959(row);this.setRowArray(x,row);}},replace:function(_95c,_95d){for(var x=0;x<this.getRowCount();x++){var line=this.getRowArray(x).join("");if(line.match(_95c)){var _960=new RegExp(_95c,"g");var _961=line.replace(_960,_95d);if(_961!=line){this.rows[x]=_961.split("");}}}},deleteCharacters:function(_962,_963){var row=this.getRowArray(_962.row);var diff=(_962.col+_963-1)-row.length;if(diff>0){_963-=diff;}if(_963>0){this.setRowDirty(_962.row);this.editor.ui.syntaxModel.invalidateCache(_962.row);return row.splice(_962.col,_963).join("");}return "";},clear:function(){this.rows=[];},deleteRows:function(row,_967){var diff=(row+_967-1)-this.rows.length;if(diff>0){_967-=diff;}if(_967>0){this.rows.splice(row,_967);this.cacheRowMetadata.splice(row,_967);}},splitRow:function(_969,_96a){this.editor.ui.syntaxModel.invalidateCache(_969.row);this.setRowDirty(_969.row);var row=this.getRowArray(_969.row);var _96c;if(_96a>0){_96c=bespin.util.makeArray(_96a);}else{_96c=[];}if(_969.col<row.length){_96c=_96c.concat(row.splice(_969.col));}if(_969.row==(this.rows.length-1)){this.rows.push(_96c);}else{var _96d=this.rows.splice(0,_969.row+1);_96d.push(_96c);_96d=_96d.concat(this.rows);this.rows=_96d;var _96e=this.cacheRowMetadata.splice(0,_969.row+1);_96e.push(undefined);this.cacheRowMetadata=_96e.concat(this.cacheRowMetadata);}},joinRow:function(_96f){this.editor.ui.syntaxModel.invalidateCache(_96f);this.setRowDirty(_96f);if(_96f>=this.rows.length-1){return;}var row=this.getRowArray(_96f);this.rows[_96f]=row.concat(this.rows[_96f+1]);this.rows.splice(_96f+1,1);this.cacheRowMetadata.splice(_96f+1,1);},getRowCount:function(){return this.rows.length;},getChunk:function(_971){var _972=_971.startModelPos;var _973=_971.endModelPos;var _974,_975;var _976="";_974=_972.col;var row=this.getRowArray(_972.row);_975=(_973.row==_972.row)?_973.col:row.length;if(_975>row.length){_975=row.length;}_976+=row.join("").substring(_974,_975);for(var i=_972.row+1;i<_973.row;i++){_976+="\n";_976+=this.getRowArray(i).join("");}if(_972.row!=_973.row){_974=0;_975=_973.col;row=this.getRowArray(_973.row);if(_975>row.length){_975=row.length;}_976+="\n"+row.join("").substring(_974,_975);}return _976;},deleteChunk:function(_979){var _97a=this.getChunk(_979);var _97b=_979.startModelPos;var _97c=_979.endModelPos;this.editor.ui.syntaxModel.invalidateCache(_97b.row);var _97d,_97e;_97d=_97b.col;var row=this.getRowArray(_97b.row);_97e=(_97c.row==_97b.row)?_97c.col:row.length;if(_97e>row.length){_97e=row.length;}this.deleteCharacters({row:_97b.row,col:_97d},_97e-_97d);if(_97b.row!=_97c.row){_97d=0;_97e=_97c.col;row=this.getRowArray(_97c.row);if(_97e>row.length){_97e=row.length;}this.deleteCharacters({row:_97c.row,col:_97d},_97e-_97d);}if((_97c.row-_97b.row)>1){this.deleteRows(_97b.row+1,_97c.row-_97b.row-1);}if(_97c.row!=_97b.row){this.joinRow(_97b.row);}return _97a;},insertChunk:function(_980,_981){this.editor.ui.syntaxModel.invalidateCache(_980.row);var _982=_981.split("\n");var _983=bespin.editor.utils.copyPos(_980);for(var i=0;i<_982.length;i++){this.insertCharacters(_983,_982[i]);_983.col=_983.col+_982[i].length;if(i<_982.length-1){this.splitRow(_983);_983.col=0;_983.row=_983.row+1;}}return _983;},getStringIndicesInRow:function(row,str){str=str.toLowerCase();var row=this.getRowArray(row).join("").toLowerCase();if(row.indexOf(str)==-1){return false;}var _987=new Array();var _988=0;var _989=row.indexOf(str);do{_987.push(_989);_989=row.indexOf(str,_989+1);}while(_989!=-1);return _987;},getCountOfString:function(str){var _98b=0;var line;var _98d;for(var x=0;x<this.getRowCount();x++){_98d=this.getStringIndicesInRow(x,str);if(_98d){_98b+=_98d.length;}}return _98b;},searchStringChanged:function(str){for(var row=0;row<this.cacheRowMetadata.length;row++){if(this.cacheRowMetadata[row]){if(str){this.cacheRowMetadata[row].searchIndices=this.getStringIndicesInRow(row,str);}else{this.cacheRowMetadata[row].searchIndices=false;}}}},findPrev:function(row,col,str){var _994;var _995=str.length;for(var x=row;x>-1;x--){_994=this.getStringIndicesInRow(x,str);if(!_994){continue;}for(var y=_994.length-1;y>-1;y--){if(_994[y]<(col-_995)||row!=x){return {startPos:{col:_994[y],row:x},endPos:{col:_994[y]+_995,row:x}};}}}return false;},findNext:function(row,col,str){var _99b;for(var x=row;x<this.getRowCount();x++){_99b=this.getStringIndicesInRow(x,str);if(!_99b){continue;}for(var y=0;y<_99b.length;y++){if(_99b[y]>col||row!=x){return {startPos:{col:_99b[y],row:x},endPos:{col:_99b[y]+str.length,row:x}};}}}return false;},findBefore:function(row,col,_9a0){var line=this.getRowArray(row);if(!dojo.isFunction(_9a0)){_9a0=function(_9a2){if(_9a2.charAt(0)==" "){return true;}var _9a3=_9a2.charCodeAt(0);return (_9a3<48)||(_9a3>122);};}while(col>0){var _9a4=line[col];if(!_9a4){continue;}if(_9a0(_9a4)){col++;break;}col--;}return {row:row,col:col};},findAfter:function(row,col,_9a7){var line=this.getRowArray(row);if(!dojo.isFunction(_9a7)){_9a7=function(_9a9){if(_9a9.charAt(0)==" "){return true;}var _9aa=_9a9.charCodeAt(0);return (_9aa<48)||(_9aa>122);};}while(col<line.length){col++;var _9ab=line[col];if(!_9ab){continue;}if(_9a7(_9ab)){break;}}return {row:row,col:col};},getRowMetadata:function(row){if(!this.isRowDirty(row)&&this.cacheRowMetadata[row]){return this.cacheRowMetadata[row];}var meta={tabExpansions:[]};var _9ae=this.editor.model.getRowArray(row);var _9af=_9ae.join("");var _9b0=this.editor.getTabSize();meta.lineTextWithoutTabExpansion=_9af;meta.lineLengthWithoutTabExpansion=_9ae.length;for(var ti=0;ti<_9af.length;ti++){if(_9af.charCodeAt(ti)==9){var _9b2=_9b0-(ti%_9b0);var _9b3="";for(var si=1;si<_9b2;si++){_9b3+=" ";}var left=(ti==0)?"":_9af.substring(0,ti);var _9b6=(ti<_9af.length-1)?_9af.substring(ti+1):"";_9af=left+" "+_9b3+_9b6;meta.tabExpansions.push({start:left.length,end:left.length+_9b3.length+1});ti+=_9b2-1;}}meta.lineText=_9af;if(this.editor.ui.searchString){meta.searchIndices=this.getStringIndicesInRow(row,this.editor.ui.searchString);}else{meta.searchIndices=false;}this.cacheRowMetadata[row]=meta;return meta;},});}if(!dojo._hasResource["bespin.editor.toolbar"]){dojo._hasResource["bespin.editor.toolbar"]=true;dojo.provide("bespin.editor.toolbar");dojo.declare("bespin.editor.Toolbar",null,{DEFAULT_TOOLBAR:["collaboration","dashboard","target_browsers","save","close","undo","redo","preview","fontsize"],showCollab:false,showFiles:false,showTarget:false,showCollabHotCounter:0,constructor:function(_9b7,opts){this.editor=_9b7||bespin.get("editor");if(opts.setupDefault){this.setupDefault();}bespin.publish("toolbar:init",{toolbar:this});},setup:function(type,el,_9bb){if(dojo.isFunction(_9bb)){this.addComponent(type,_9bb);}if(dojo.isFunction(this.components[type])){this.components[type](this,el);}},setupDefault:function(){dojo.forEach(this.DEFAULT_TOOLBAR,dojo.hitch(this,function(item){var _9bd=dojo.byId("toolbar_"+item);if(_9bd){this.setup(item,_9bd);}}));},addComponent:function(type,_9bf){this.components[type]=_9bf;},components:{collaboration:function(_9c0,el){var _9c2=dojo.byId(el)||dojo.byId("toolbar_collaboration");dojo.connect(_9c2,"click",function(){_9c0.showCollab=!_9c0.showCollab;_9c2.src="images/"+((_9c0.showCollab)?"icn_collab_on.png":(_9c0.showCollabHotCounter==0)?"icn_collab_off.png":"icn_collab_watching.png");bespin.page.editor.recalcLayout();});dojo.connect(_9c2,"mouseover",function(){_9c2.style.cursor="pointer";_9c2.src="images/icn_collab_on.png";});dojo.connect(_9c2,"mouseout",function(){_9c2.style.cursor="default";_9c2.src="images/icn_collab_off.png";});},dashboard:function(_9c3,el){var _9c5=dojo.byId(el)||dojo.byId("toolbar_dashboard");dojo.connect(_9c5,"mouseover",function(){_9c5.style.cursor="pointer";_9c5.src="images/icn_dashboard_on.png";});dojo.connect(_9c5,"mouseout",function(){_9c5.style.cursor="default";_9c5.src="images/icn_dashboard_off.png";});},target_browsers:function(_9c6,el){var _9c8=dojo.byId(el)||dojo.byId("toolbar_target_browsers");dojo.connect(_9c8,"click",function(){_9c6._showTarget=!_9c6._showTarget;_9c8.src="images/"+((_9c6._showTarget)?"icn_target_on.png":"icn_target_off.png");bespin.page.editor.recalcLayout();});dojo.connect(_9c8,"mouseover",function(){_9c8.style.cursor="pointer";_9c8.src="images/icn_target_on.png";});dojo.connect(_9c8,"mouseout",function(){_9c8.style.cursor="default";_9c8.src="images/icn_target_off.png";});},save:function(_9c9,el){var save=dojo.byId(el)||dojo.byId("toolbar_save");dojo.connect(save,"mouseover",function(){save.src="images/icn_save_on.png";});dojo.connect(save,"mouseout",function(){save.src="images/icn_save.png";});dojo.connect(save,"click",function(){bespin.publish("editor:savefile");});},close:function(_9cc,el){var _9ce=dojo.byId(el)||dojo.byId("toolbar_close");dojo.connect(_9ce,"mouseover",function(){_9ce.src="images/icn_close_on.png";});dojo.connect(_9ce,"mouseout",function(){_9ce.src="images/icn_close.png";});dojo.connect(_9ce,"click",function(){bespin.publish("editor:closefile");});},undo:function(_9cf,el){var undo=dojo.byId(el)||dojo.byId("toolbar_undo");dojo.connect(undo,"mouseover",function(){undo.src="images/icn_undo_on.png";});dojo.connect(undo,"mouseout",function(){undo.src="images/icn_undo.png";});dojo.connect(undo,"click",function(){_9cf.editor.ui.actions.undo();});},redo:function(_9d2,el){var redo=dojo.byId(el)||dojo.byId("toolbar_undo");dojo.connect(redo,"mouseover",function(){redo.src="images/icn_redo_on.png";});dojo.connect(redo,"mouseout",function(){redo.src="images/icn_redo.png";});dojo.connect(redo,"click",function(){_9d2.editor.ui.actions.redo();});},preview:function(_9d5,el){var _9d7=dojo.byId(el)||dojo.byId("toolbar_preview");dojo.connect(_9d7,"mouseover",function(){_9d7.src="images/icn_preview_on.png";});dojo.connect(_9d7,"mouseout",function(){_9d7.src="images/icn_preview.png";});dojo.connect(_9d7,"click",function(){bespin.publish("editor:preview");});},fontsize:function(_9d8,el){var _9da=dojo.byId(el)||dojo.byId("toolbar_fontsize");dojo.connect(_9da,"mouseover",function(){_9da.src="images/icn_fontsize_on.png";});dojo.connect(_9da,"mouseout",function(){_9da.src="images/icn_fontsize.png";});(function(){var _9db=2;var _9dc={1:8,2:10,3:14};dojo.connect(_9da,"click",function(){_9db=(_9db>2)?1:_9db+1;bespin.publish("settings:set:fontsize",[{value:_9dc[_9db]}]);});})();}}});}if(!dojo._hasResource["bespin.editor.undo"]){dojo._hasResource["bespin.editor.undo"]=true;dojo.provide("bespin.editor.undo");dojo.declare("bespin.editor.UndoManager",null,{constructor:function(_9dd){this.editor=_9dd;this.undoStack=[];this.redoStack=[];this.syncHelper=undefined;},maxUndoLength:100,canUndo:function(){return this.undoStack.length>0;},undo:function(){if(this.undoStack.length==0){return;}var item=this.undoStack.pop();this.editor.cursorManager.moveCursor(item.undoOp.pos);item.undo();this.redoStack.push(item);if(this.syncHelper){this.syncHelper.undo();}bespin.publish("editor:document:changed");},redo:function(){if(this.redoStack.length==0){return;}var item=this.redoStack.pop();this.editor.cursorManager.moveCursor(item.redoOp.pos);item.redo();this.undoStack.push(item);if(this.syncHelper){this.syncHelper.redo();}bespin.publish("editor:document:changed");},addUndoOperation:function(item){if(item.undoOp.queued){return;}if(this.redoStack.length>0){this.redoStack=[];}while(this.undoStack.length+1>this.maxUndoLength){this.undoStack.shift();}this.undoStack.push(item);item.editor=this.editor;item.undoOp.queued=true;item.redoOp.queued=true;if(this.syncHelper){this.syncHelper.queueUndoOp(item);}bespin.publish("editor:undooperation");bespin.publish("editor:document:changed");}});dojo.declare("bespin.editor.UndoItem",null,{constructor:function(_9e1,_9e2){this.undoOp=_9e1;this.redoOp=_9e2;},undo:function(){this.editor.ui.actions[this.undoOp.action](this.undoOp);},redo:function(){this.editor.ui.actions[this.redoOp.action](this.redoOp);}});}if(!dojo._hasResource["bespin.themes.default"]){dojo._hasResource["bespin.themes.default"]=true;dojo.provide("bespin.themes.default");bespin.themes.coffee={backgroundStyle:"#2A211C",gutterStyle:"#4c4a41",lineNumberColor:"#e5c138",lineNumberFont:"10pt Monaco, Lucida Console, monospace",lineMarkerErrorColor:"#CC4444",lineMarkerWarningColor:"#B8860B",zebraStripeColor:"#2A211C",highlightCurrentLineColor:"#3a312b",editorTextFont:"10pt Monaco, Lucida Console, monospace",editorTextColor:"rgb(230, 230, 230)",editorSelectedTextColor:"rgb(240, 240, 240)",editorSelectedTextBackground:"#526DA5",cursorStyle:"#879aff",cursorType:"ibeam",unfocusedCursorStrokeStyle:"#FF0033",unfocusedCursorFillStyle:"#73171E",partialNibStyle:"rgba(100, 100, 100, 0.3)",partialNibArrowStyle:"rgba(255, 255, 255, 0.3)",partialNibStrokeStyle:"rgba(150, 150, 150, 0.3)",fullNibStyle:"rgb(100, 100, 100)",fullNibArrowStyle:"rgb(255, 255, 255)",fullNibStrokeStyle:"rgb(150, 150, 150)",scrollTrackFillStyle:"rgba(50, 50, 50, 0.8)",scrollTrackStrokeStyle:"rgb(150, 150, 150)",scrollBarFillStyle:"rgba(0, 0, 0, %a)",scrollBarFillGradientTopStart:"rgba(90, 90, 90, %a)",scrollBarFillGradientTopStop:"rgba(40, 40, 40, %a)",scrollBarFillGradientBottomStart:"rgba(22, 22, 22, %a)",scrollBarFillGradientBottomStop:"rgba(44, 44, 44, %a)",tabSpace:"#392A25",searchHighlight:"#B55C00",searchHighlightSelected:"#FF9A00",plain:"#bdae9d",keyword:"#42a8ed",string:"#039a0a",comment:"#666666","c-comment":"#666666",punctuation:"#888888",attribute:"#BF9464",test:"rgb(255,0,0)",cdata:"#bdae9d","attribute-value":"#039a0a",tag:"#46a8ed",color:"#c4646b","tag-name":"#46a8ed",value:"#039a0a",important:"#990000",sizes:"#990000",cssclass:"#BF9464",cssid:"#46a8ed",atom:"#aa4444",variable:"#00cccc",variabledef:"#4422cc",localvariable:"#cc2277",property:"#66bb33",operator:"#88bbff",error:"#FF0000",processing:"#999999",entity:"#AA2222",text:"#00BB00","compile-time-constant":"#776088","predefined-constant":"#33CC33","reserved-language-construct":"#00FF00","predefined-function":"#22FF22","predefined-class":"#22FF22",literal:"#DD4411",identifier:"#22FF22",func:"#2200FF",type:"#8822FF",decorator:"#2222FF"};bespin.themes.coffeezebra={};dojo.mixin(bespin.themes.coffeezebra,bespin.themes.coffee);bespin.themes.coffeezebra.zebraStripeColor="#FFFFFF";bespin.themes["default"]=bespin.themes.coffee;}if(!dojo._hasResource["bespin.syntax.base"]){dojo._hasResource["bespin.syntax.base"]=true;dojo.provide("bespin.syntax.base");dojo.declare("bespin.syntax.Model",null,{language:"",lineCache:[],invalidateCache:function(_9e3){delete this.lineCache[_9e3];},invalidateEntireCache:function(){this.lineCache=[];},addToCache:function(_9e4,line){this.lineCache[_9e4]=line;},getFromCache:function(_9e6){return this.lineCache[_9e6];},mergeSyntaxResults:function(_9e7){var base=0;for(var i=0;i<_9e7.length;i++){var _9ea=_9ea[i];}},getSyntaxStylesPerLine:function(_9eb,_9ec,_9ed){return {regions:{plain:[{start:0,stop:_9eb.length}]}};},getSyntaxStyles:function(rows,_9ef,_9f0,_9f1){var _9f2={};for(var i=_9ef;i<=_9f0;i++){_9f2[i]=this.getSyntaxStylesPerLine(rows[i],i,_9f1);}return _9f2;}});bespin.syntax.Resolver=(function(){var _9f4,_9f5;return {setEngine:function(name){var _9f7=bespin.syntax[name];if(name==_9f4){return this;}if(_9f7){_9f4=name;if(_9f5){delete _9f5;}if(_9f7.worker){_9f5=new bespin.worker.WorkerFacade(bespin.syntax[name].Model());_9f5.workerEnabled=true;}else{_9f5=new bespin.syntax[name].Model();_9f5.workerEnabled=false;}}else{console.log("no such engine: ",name);}return this;},getModel:function(){return _9f5;}};})();}if(!dojo._hasResource["bespin.syntax.simple._base"]){dojo._hasResource["bespin.syntax.simple._base"]=true;dojo.provide("bespin.syntax.simple._base");dojo.declare("bespin.syntax.simple.Model",bespin.syntax.Model,{lineMetaInfo:[],setLineMetaInfo:function(_9f8,meta){this.lineMetaInfo[_9f8]=meta;},getLineMetaInfo:function(_9fa){return this.lineMetaInfo[_9fa];},getSyntaxStylesPerLine:function(_9fb,_9fc,_9fd){if(this.language!=_9fd){this.engine=bespin.syntax.simple.Resolver.resolve(_9fd);this.language=_9fd;}var _9fe={text:_9fb,regions:[]};var meta;if(typeof this.engine["innertypes"]=="function"){var _a00=this.engine.innertypes(_9fb);for(var i=0;i<_a00.length;i++){var type=_a00[i];meta={inMultiLineComment:this.inMultiLineComment(),offset:type.start};var _a03=[];var _a04=bespin.syntax.simple.Resolver.highlight(type.type,_9fb.substring(type.start,type.stop),meta);if(_a04.meta&&(i==_a00.length-1)){this.setLineMetaInfo(_9fc,_a04.meta);}_a03.push(_a04);}_9fe.regions.push(this.mergeSyntaxResults(_a03));}else{meta=(_9fc>0)?this.getLineMetaInfo(_9fc-1):{};var _a05=this.engine.highlight(_9fb,meta);this.setLineMetaInfo(_9fc,_a05.meta);_9fe.regions.push(_a05.regions);}return _9fe;}});bespin.syntax.simple.Resolver=new function(){var _a06={};var _a07={highlight:function(line,meta){return {regions:{plain:[{start:0,stop:line.length}]}};}};return {highlight:function(type,line,meta,_a0d){this.resolve(type).highlight(line,meta,_a0d);},register:function(_a0e,_a0f){for(var i=0;i<_a0f.length;i++){_a06[_a0f[i]]=_a0e;}},resolve:function(type){return _a06[type]||_a07;}};}();}if(!dojo._hasResource["bespin.syntax.simple.javascript"]){dojo._hasResource["bespin.syntax.simple.javascript"]=true;dojo.provide("bespin.syntax.simple.javascript");bespin.syntax.JavaScriptConstants={C_STYLE_COMMENT:"c-comment",LINE_COMMENT:"comment",STRING:"string",KEYWORD:"keyword",PUNCTUATION:"punctuation",OTHER:"plain"};dojo.declare("bespin.syntax.simple.JavaScript",null,{keywords:"abstract boolean break byte case catch char class const continue debugger "+"default delete do double else enum export extends false final finally float "+"for function goto if implements import in instanceof int interface let long native "+"new null package private protected public return short static super switch "+"synchronized this throw throws transient true try typeof var void volatile while with".split(" "),punctuation:"{ } > < / + - % * . , ; ( ) ? : = \" '".split(" "),highlight:function(line,meta){if(!meta){meta={};}var K=bespin.syntax.JavaScriptConstants;var _a15={};var _a16=(meta.inMultilineComment)?K.C_STYLE_COMMENT:undefined;var _a17={};var _a18="";var _a19="";var _a1a=meta.inMultilineComment;for(var i=0;i<line.length;i++){var c=line.charAt(i);if(_a16==K.C_STYLE_COMMENT){if(c=="/"&&/\*$/.test(_a18)){_a17.stop=i+1;this.addRegion(_a15,_a16,_a17);_a17={};_a16=undefined;_a1a=false;_a18="";}else{if(_a18==""){_a17={start:i};}_a18+=c;}continue;}if(this.isWhiteSpaceOrPunctuation(c)){if(_a16==K.STRING){if(!(c==_a19&&!/\\$/.test(_a18))){if(_a18==""){_a17={start:i};}_a18+=c;continue;}}if(_a18!=""){_a17.stop=i;if(_a16!=K.STRING){if(this.keywords.indexOf(_a18)!=-1){_a16=K.KEYWORD;}else{_a16=K.OTHER;}}this.addRegion(_a15,_a16,_a17);_a17={};_a19="";_a18="";}if(this.isPunctuation(c)){if(c=="*"&&i>0&&(line.charAt(i-1)=="/")){_a15[K.PUNCTUATION].pop();_a1a=true;_a16=K.C_STYLE_COMMENT;_a17={start:i-1};_a18="/*";continue;}if(c=="/"&&i>0&&(line.charAt(i-1)=="/")){_a17={start:i-1,stop:line.length};_a16=K.LINE_COMMENT;this.addRegion(_a15,_a16,_a17);_a18="";_a16=undefined;_a17={};break;}this.addRegion(_a15,K.PUNCTUATION,{start:i,stop:i+1});}if((c=="'"||c=="\"")&&(_a16!=K.STRING)){_a16=K.STRING;_a19=c;}else{_a16=undefined;}continue;}if(_a18==""){_a17={start:i};}_a18+=c;}if(_a18!=""){if(!_a16){_a16=K.OTHER;}_a17.stop=line.length;this.addRegion(_a15,_a16,_a17);}var _a1d={inMultilineComment:_a1a};if(meta.inJavaScript){_a1d.inJavaScript=meta.inJavaScript;}return {regions:_a15,meta:_a1d};},addRegion:function(_a1e,type,data){if(!_a1e[type]){_a1e[type]=[];}_a1e[type].push(data);},isWhiteSpaceOrPunctuation:function(ch){return this.isPunctuation(ch)||this.isWhiteSpace(ch);},isPunctuation:function(ch){return this.punctuation.indexOf(ch)!=-1;},isWhiteSpace:function(ch){return ch==" ";}});bespin.syntax.simple.Resolver.register(new bespin.syntax.simple.JavaScript(),["js","javascript","ecmascript","jsm","java"]);}if(!dojo._hasResource["bespin.syntax.simple.css"]){dojo._hasResource["bespin.syntax.simple.css"]=true;dojo.provide("bespin.syntax.simple.css");bespin.syntax.Constants={C_STYLE_COMMENT:"c-comment",STRING:"string",KEYWORD:"keyword",PUNCTUATION:"punctuation",OTHER:"plain",NAME:"attribute-name",VALUE:"attribute-value",IMPORTANT:"important",COLOR:"color",SIZES:"sizes",ID:"cssid",COLOR_OR_ID:"color_or_id"};dojo.declare("bespin.syntax.simple.CSS",null,{keywords:["ascent","azimuth","background-attachment","background-color","background-image","background-position","background-repeat","background","baseline","bbox","border-collapse","border-color","border-spacing","border-style","border-top","border-right","border-bottom","border-left","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-width","border-right-width","border-bottom-width","border-left-width","border-width","border","cap-height","caption-side","centerline","clear","clip","color","content","counter-increment","counter-reset","cue-after","cue-before","cue","cursor","definition-src","descent","direction","display","elevation","empty-cells","float","font-size-adjust","font-family","font-size","font-stretch","font-style","font-variant","font-weight","font","height","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","margin-top","margin-right","margin-bottom","margin-left","margin","marker-offset","marks","mathline","max-height","max-width","min-height","min-width","orphans","outline-color","outline-style","outline-width","outline","overflow","padding-top","padding-right","padding-bottom","padding-left","padding","page","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","pitch","pitch-range","play-during","position","quotes","richness","size","slope","src","speak-header","speak-numeral","speak-punctuation","speak","speech-rate","stemh","stemv","stress","table-layout","text-align","text-decoration","text-indent","text-shadow","text-transform","unicode-bidi","unicode-range","units-per-em","vertical-align","visibility","voice-family","volume","white-space","widows","width","widths","word-spacing","x-height","z-index"],values:["above","absolute","all","always","aqua","armenian","attr","aural","auto","avoid","baseline","behind","below","bidi-override","black","blink","block","blue","bold","bolder","both","bottom","braille","capitalize","caption","center","center-left","center-right","circle","close-quote","code","collapse","compact","condensed","continuous","counter","counters","crop","cross","crosshair","cursive","dashed","decimal","decimal-leading-zero","default","digits","disc","dotted","double","embed","embossed","e-resize","expanded","extra-condensed","extra-expanded","fantasy","far-left","far-right","fast","faster","fixed","format","fuchsia","gray","green","groove","handheld","hebrew","help","hidden","hide","high","higher","icon","inline-table","inline","inset","inside","invert","italic","justify","landscape","large","larger","left-side","left","leftwards","level","lighter","lime","line-through","list-item","local","loud","lower-alpha","lowercase","lower-greek","lower-latin","lower-roman","lower","low","ltr","marker","maroon","medium","message-box","middle","mix","move","narrower","navy","ne-resize","no-close-quote","none","no-open-quote","no-repeat","normal","nowrap","n-resize","nw-resize","oblique","olive","once","open-quote","outset","outside","overline","pointer","portrait","pre","print","projection","purple","red","relative","repeat","repeat-x","repeat-y","rgb","ridge","right","right-side","rightwards","rtl","run-in","screen","scroll","semi-condensed","semi-expanded","separate","se-resize","show","silent","silver","slower","slow","small","small-caps","small-caption","smaller","soft","solid","speech","spell-out","square","s-resize","static","status-bar","sub","super","sw-resize","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","teal","text-bottom","text-top","thick","thin","top","transparent","tty","tv","ultra-condensed","ultra-expanded","underline","upper-alpha","uppercase","upper-latin","upper-roman","url","visible","wait","white","wider","w-resize","x-fast","x-high","x-large","x-loud","x-low","x-slow","x-small","x-soft","xx-large","xx-small","yellow","monospace","tahoma","verdana","arial","helvetica","sans-serif","serif"],sizeRegex:"(?:em|pt|px|%)",important:"!important",punctuation:"{ } / + * . , ; ( ) ? : = \" '".split(" "),highlight:function(line,meta){var K=bespin.syntax.Constants;var _a27={};if(!meta){meta={};}var _a28=(meta.inMultilineComment)?K.C_STYLE_COMMENT:undefined;var _a29={};var _a2a="";var _a2b="";var _a2c=meta.inMultilineComment;for(var i=0;i<line.length;i++){var c=line.charAt(i);if(_a28==K.C_STYLE_COMMENT){if(c=="/"&&/\*$/.test(_a2a)){_a29.stop=i+1;this.addRegion(_a27,_a28,_a29);_a29={};_a28=undefined;_a2c=false;_a2a="";}else{if(_a2a==""){_a29={start:i};}_a2a+=c;}continue;}if(this.isHashChar(c)){_a28=K.COLOR_OR_ID;if(_a2a==""){_a29={start:i};}_a2a+=c;continue;}if(this.isWhiteSpaceOrPunctuation(c)){if(_a28==K.STRING){if(!(c==_a2b&&!/\\$/.test(_a2a))){if(_a2a==""){_a29={start:i};}_a2a+=c;continue;}}if(_a28==K.COLOR_OR_ID){if(_a2a.match(/#[0-9AaBbCcDdEeFf]{3,6}/)){_a28=K.COLOR;}else{_a28=K.OTHER;}_a29.stop=i;this.addRegion(_a27,_a28,_a29);_a29={start:i};_a2b="";_a2a=c;_a28=undefined;continue;}if(_a2a!=""){_a29.stop=i;if(_a28!=K.STRING){if(this.keywords.indexOf(_a2a)!=-1){_a28=K.KEYWORD;}else{if(this.values.indexOf(_a2a.toLowerCase())!=-1){_a28=K.VALUE;}else{if(_a2a.match(this.sizeRegex)){_a28=K.SIZE;}else{if(this.important.indexOf(_a2a)!=-1){_a28=K.IMPORTANT;}else{_a28=K.OTHER;}}}}}this.addRegion(_a27,_a28,_a29);_a29={};_a2b="";_a2a="";}if(this.isPunctuation(c)){if(c=="*"&&i>0&&(line.charAt(i-1)=="/")){_a27[K.PUNCTUATION].pop();_a2c=true;_a28=K.C_STYLE_COMMENT;_a29={start:i-1};_a2a="/*";continue;}this.addRegion(_a27,K.PUNCTUATION,{start:i,stop:i+1});}if((c=="'"||c=="\"")&&(_a28!=K.STRING)){_a28=K.STRING;_a2b=c;}else{_a28=undefined;}continue;}if(_a2a==""){_a29={start:i};}_a2a+=c;}if(_a2a!=""){if(!_a28){_a28=K.OTHER;}_a29.stop=line.length;this.addRegion(_a27,_a28,_a29);}return {regions:_a27,meta:{inMultilineComment:_a2c}};},addRegion:function(_a2f,type,data){if(!_a2f[type]){_a2f[type]=[];}_a2f[type].push(data);},isHashChar:function(ch){return ch=="#";},isWhiteSpaceOrPunctuation:function(ch){return this.isPunctuation(ch)||this.isWhiteSpace(ch);},isPunctuation:function(ch){return this.punctuation.indexOf(ch)!=-1;},isWhiteSpace:function(ch){return ch==" ";}});bespin.syntax.simple.Resolver.register(new bespin.syntax.simple.CSS(),["css"]);}if(!dojo._hasResource["bespin.syntax.simple.html"]){dojo._hasResource["bespin.syntax.simple.html"]=true;dojo.provide("bespin.syntax.simple.html");bespin.syntax.HTMLConstants={HTML_STYLE_COMMENT:"comment",STRING:"string",KEYWORD:"keyword",PUNCTUATION:"punctuation",OTHER:"plain",ATTR_NAME:"attname"};dojo.declare("bespin.syntax.simple.HTML",null,{punctuation:"< > = \" '",highlight:function(line,meta){if(!meta){meta={};}var K=bespin.syntax.HTMLConstants;var _a39={};var _a3a=(meta.inMultilineComment)?K.HTML_STYLE_COMMENT:undefined;var _a3b={};var _a3c="";var _a3d="";var _a3e=meta.inMultilineComment;if(meta.inJavaScript){if(line.indexOf("</script>")>0){meta.inJavaScript=false;}else{return bespin.syntax.simple.Resolver.resolve("js").highlight(line,meta);}}else{meta.inJavaScript=false;}if(line.indexOf("<script")>0){meta.inJavaScript=true;}for(var i=0;i<line.length;i++){var c=line.charAt(i);if(_a3a==K.HTML_STYLE_COMMENT){if(c==">"&&bespin.util.endsWith(_a3c,"--")&&!(/<!--/.test(_a3c)&&!meta.inMultiLineComment&&_a3b.start==i-4)&&!(/<!---/.test(_a3c)&&!meta.inMultiLineComment&&_a3b.start==i-5)){_a3b.stop=i+1;this.addRegion(_a39,_a3a,_a3b);_a3b={};_a3a=undefined;_a3e=false;_a3c="";}else{if(_a3c==""){_a3b={start:i};}_a3c+=c;}continue;}if(this.isWhiteSpaceOrPunctuation(c)){if(_a3a==K.STRING){if(!(c==_a3d&&!/\\$/.test(_a3c))){if(_a3c==""){_a3b={start:i};}_a3c+=c;continue;}}if(_a3c!=""){_a3b.stop=i;if(_a3a!=K.STRING){if(line.charAt(_a3b.start-1)=="<"){_a3a=K.KEYWORD;}else{if(line.charAt(_a3b.stop)=="="){_a3a=K.ATTR_NAME;}else{_a3a=K.OTHER;}}}this.addRegion(_a39,_a3a,_a3b);_a3b={};_a3d="";_a3c="";}if(this.isPunctuation(c)){if(c=="<"&&(line.length>i+3)&&(line.substring(i,i+4)=="<!--")){_a3e=true;_a3a=K.HTML_STYLE_COMMENT;_a3b={start:i};_a3c="<!--";i+=3;continue;}this.addRegion(_a39,K.PUNCTUATION,{start:i,stop:i+1});}if((c=="'"||c=="\"")&&(_a3a!=K.STRING)){_a3a=K.STRING;_a3d=c;}else{_a3a=undefined;}continue;}if(_a3c==""){_a3b={start:i};}_a3c+=c;}if(_a3c!=""){if(!_a3a){_a3a=K.OTHER;}_a3b.stop=line.length;this.addRegion(_a39,_a3a,_a3b);}return {regions:_a39,meta:{inMultilineComment:_a3e,inJavaScript:meta.inJavaScript}};},addRegion:function(_a41,type,data){if(!_a41[type]){_a41[type]=[];}_a41[type].push(data);},isWhiteSpaceOrPunctuation:function(ch){return this.isPunctuation(ch)||this.isWhiteSpace(ch);},isPunctuation:function(ch){return this.punctuation.indexOf(ch)!=-1;},isWhiteSpace:function(ch){return ch==" ";}});bespin.syntax.simple.Resolver.register(new bespin.syntax.simple.HTML(),["html","htm","xml","xhtml","shtml"]);}if(!dojo._hasResource["bespin.syntax.simple.php"]){dojo._hasResource["bespin.syntax.simple.php"]=true;dojo.provide("bespin.syntax.simple.php");bespin.syntax.PHPConstants={C_STYLE_COMMENT:"c-comment",LINE_COMMENT:"comment",STRING:"string",KEYWORD:"keyword",PUNCTUATION:"punctuation",OTHER:"plain"};dojo.declare("bespin.syntax.simple.PHP",null,{keywords:"include require include_once require_once for foreach as if elseif else while do endwhile "+"endif switch case endswitch endfor endforeach "+"return break continue "+"language class const "+"default DEFAULT_INCLUDE_PATH extends "+"E_ALL E_COMPILE_ERROR E_COMPILE_WARNING "+"E_CORE_ERROR E_CORE_WARNING E_ERROR "+"E_NOTICE E_PARSE E_STRICT E_USER_ERROR "+"E_USER_NOTICE E_USER_WARNING E_WARNING "+"false function interface new null "+"PEAR_EXTENSION_DIR PEAR_INSTALL_DIR "+"PHP_BINDIR PHP_CONFIG_FILE_PATH PHP_DATADIR "+"PHP_EXTENSION_DIR PHP_LIBDIR "+"PHP_LOCALSTATEDIR PHP_OS "+"PHP_OUTPUT_HANDLER_CONT PHP_OUTPUT_HANDLER_END "+"PHP_OUTPUT_HANDLER_START PHP_SYSCONFDIR "+"PHP_VERSION private public self true "+"var __CLASS__ __FILE__ __LINE__ __METHOD__ __FUNCTION__ "+"abs acos acosh addcslashes addslashes aggregate "+"aggregate_methods aggregate_methods_by_list "+"aggregate_methods_by_regexp "+"aggregate_properties "+"aggregate_properties_by_list "+"aggregate_properties_by_regexp aggregation_info "+"apache_child_terminate apache_get_version "+"apache_lookup_uri apache_note "+"apache_request_headers apache_response_headers "+"apache_setenv array array_change_key_case "+"array_chunk array_count_values array_diff "+"array_diff_assoc array_fill array_filter "+"array_flip array_intersect "+"array_intersect_assoc array_keys "+"array_key_exists array_map array_merge "+"array_merge_recursive array_multisort "+"array_pad array_pop array_push array_rand "+"array_reduce array_reverse array_search "+"array_shift array_slice array_splice "+"array_sum array_unique array_unshift "+"array_values array_walk arsort asin "+"asinh asort assert assert_options atan "+"atan2 atanh base64_decode base64_encode "+"basename base_convert bcadd bccomp "+"bcdiv bcmod bcmul bcpow bcscale "+"bcsqrt bcsub bin2hex bindec "+"bindtextdomain bind_textdomain_codeset "+"bzclose bzcompress bzdecompress bzerrno "+"bzerror bzerrstr bzflush bzopen bzread "+"bzwrite call_user_func call_user_func_array "+"call_user_method call_user_method_array "+"cal_days_in_month cal_from_jd cal_info "+"cal_to_jd ceil chdir checkdate "+"checkdnsrr chgrp chmod chop chown "+"chr chunk_split class_exists "+"clearstatcache closedir closelog compact "+"connection_aborted connection_status "+"constant convert_cyr_string copy cos "+"cosh count count_chars crc32 "+"create_function crypt ctype_alnum "+"ctype_alpha ctype_cntrl ctype_digit "+"ctype_graph ctype_lower ctype_print "+"ctype_punct ctype_space ctype_upper "+"ctype_xdigit current date dba_close "+"dba_delete dba_exists dba_fetch "+"dba_firstkey dba_handlers dba_insert "+"dba_list dba_nextkey dba_open "+"dba_optimize dba_popen dba_replace "+"dba_sync dcgettext dcngettext deaggregate "+"debug_backtrace debug_zval_dump decbin "+"dechex decoct define defined "+"define_syslog_variables deg2rad dgettext "+"die dir dirname diskfreespace "+"disk_free_space disk_total_space dl "+"dngettext doubleval each easter_date "+"easter_days echo empty end ereg "+"eregi eregi_replace ereg_replace "+"error_log error_reporting escapeshellarg "+"escapeshellcmd eval exec exif_imagetype "+"exif_read_data exif_tagname exif_thumbnail "+"exit exp explode expm1 "+"extension_loaded extract ezmlm_hash "+"fclose feof fflush fgetc fgetcsv "+"fgets fgetss file fileatime filectime "+"filegroup fileinode filemtime fileowner "+"fileperms filepro filepro_fieldcount "+"filepro_fieldname filepro_fieldtype "+"filepro_fieldwidth filepro_retrieve "+"filepro_rowcount filesize filetype "+"file_exists file_get_contents floatval "+"flock floor flush fmod fnmatch "+"fopen fpassthru fputs fread frenchtojd "+"fscanf fseek fsockopen fstat ftell "+"ftok ftp_cdup ftp_chdir ftp_close "+"ftp_connect ftp_delete ftp_exec ftp_fget "+"ftp_fput ftp_get ftp_get_option ftp_login "+"ftp_mdtm ftp_mkdir ftp_nb_continue "+"ftp_nb_fget ftp_nb_fput ftp_nb_get "+"ftp_nb_put ftp_nlist ftp_pasv ftp_put "+"ftp_pwd ftp_quit ftp_rawlist ftp_rename "+"ftp_rmdir ftp_set_option ftp_site "+"ftp_size ftp_ssl_connect ftp_systype "+"ftruncate function_exists func_get_arg "+"func_get_args func_num_args fwrite "+"getallheaders getcwd getdate getenv "+"gethostbyaddr gethostbyname gethostbynamel "+"getimagesize getlastmod getmxrr getmygid "+"getmyinode getmypid getmyuid getopt "+"getprotobyname getprotobynumber getrandmax "+"getrusage getservbyname getservbyport "+"gettext gettimeofday gettype get_browser "+"get_cfg_var get_class get_class_methods "+"get_class_vars get_current_user "+"get_declared_classes get_defined_constants "+"get_defined_functions get_defined_vars "+"get_extension_funcs get_html_translation_table "+"get_included_files get_include_path "+"get_loaded_extensions get_magic_quotes_gpc "+"get_magic_quotes_runtime get_meta_tags "+"get_object_vars get_parent_class "+"get_required_files get_resource_type glob "+"global gmdate gmmktime gmstrftime "+"gregoriantojd gzclose gzcompress "+"gzdeflate gzencode gzeof gzfile gzgetc "+"gzgets gzgetss gzinflate gzopen "+"gzpassthru gzputs gzread gzrewind "+"gzseek gztell gzuncompress gzwrite "+"header headers_sent hebrev hebrevc "+"hexdec highlight_file highlight_string "+"htmlentities htmlspecialchars "+"html_entity_decode hypot i18n_convert "+"i18n_discover_encoding i18n_http_input "+"i18n_http_output i18n_internal_encoding "+"i18n_ja_jp_hantozen i18n_mime_header_decode "+"i18n_mime_header_encode iconv "+"iconv_get_encoding iconv_set_encoding "+"ignore_user_abort image_type_to_mime_type "+"implode import_request_variables ini_alter "+"ini_get ini_get_all ini_restore ini_set "+"intval in_array ip2long iptcembed "+"iptcparse isset is_a is_array is_bool "+"is_callable is_dir is_double "+"is_executable is_file is_finite is_float "+"is_infinite is_int is_integer is_link "+"is_long is_nan is_null is_numeric "+"is_object is_readable is_real is_resource "+"is_scalar is_string is_subclass_of "+"is_uploaded_file is_writable is_writeable "+"jddayofweek jdmonthname jdtofrench "+"jdtogregorian jdtojewish jdtojulian "+"jdtounix jewishtojd join juliantojd "+"key key_exists krsort ksort lcg_value "+"levenshtein link linkinfo list "+"localeconv localtime log log1p log10 "+"long2ip lstat ltrim magic_quotes_runtime "+"mail max mbereg mberegi "+"mberegi_replace mbereg_match mbereg_replace "+"mbereg_search mbereg_search_getpos "+"mbereg_search_getregs mbereg_search_init "+"mbereg_search_pos mbereg_search_regs "+"mbereg_search_setpos mbregex_encoding "+"mbsplit mbstrcut mbstrlen mbstrpos "+"mbstrrpos mbsubstr mb_convert_case "+"mb_convert_encoding mb_convert_kana "+"mb_convert_variables mb_decode_mimeheader "+"mb_decode_numericentity mb_detect_encoding "+"mb_detect_order mb_encode_mimeheader "+"mb_encode_numericentity mb_ereg mb_eregi "+"mb_eregi_replace mb_ereg_match "+"mb_ereg_replace mb_ereg_search "+"mb_ereg_search_getpos mb_ereg_search_getregs "+"mb_ereg_search_init mb_ereg_search_pos "+"mb_ereg_search_regs mb_ereg_search_setpos "+"mb_get_info mb_http_input mb_http_output "+"mb_internal_encoding mb_language "+"mb_output_handler mb_parse_str "+"mb_preferred_mime_name mb_regex_encoding "+"mb_regex_set_options mb_send_mail mb_split "+"mb_strcut mb_strimwidth mb_strlen "+"mb_strpos mb_strrpos mb_strtolower "+"mb_strtoupper mb_strwidth "+"mb_substitute_character mb_substr "+"mb_substr_count md5 md5_file "+"memory_get_usage metaphone method_exists "+"microtime min mkdir mktime "+"money_format move_uploaded_file "+"mt_getrandmax mt_rand mt_srand mysql "+"mysql_affected_rows mysql_client_encoding "+"mysql_close mysql_connect mysql_createdb "+"mysql_create_db mysql_data_seek mysql_dbname "+"mysql_db_name mysql_db_query mysql_dropdb "+"mysql_drop_db mysql_errno mysql_error "+"mysql_escape_string mysql_fetch_array "+"mysql_fetch_assoc mysql_fetch_field "+"mysql_fetch_lengths mysql_fetch_object "+"mysql_fetch_row mysql_fieldflags "+"mysql_fieldlen mysql_fieldname "+"mysql_fieldtable mysql_fieldtype "+"mysql_field_flags mysql_field_len "+"mysql_field_name mysql_field_seek "+"mysql_field_table mysql_field_type "+"mysql_freeresult mysql_free_result "+"mysql_get_client_info mysql_get_host_info "+"mysql_get_proto_info mysql_get_server_info "+"mysql_info mysql_insert_id mysql_listdbs "+"mysql_listfields mysql_listtables "+"mysql_list_dbs mysql_list_fields "+"mysql_list_processes mysql_list_tables "+"mysql_numfields mysql_numrows "+"mysql_num_fields mysql_num_rows "+"mysql_pconnect mysql_ping mysql_query "+"mysql_real_escape_string mysql_result "+"mysql_selectdb mysql_select_db mysql_stat "+"mysql_tablename mysql_table_name "+"mysql_thread_id mysql_unbuffered_query "+"natcasesort natsort next ngettext "+"nl2br nl_langinfo number_format ob_clean "+"ob_end_clean ob_end_flush ob_flush "+"ob_get_clean ob_get_contents ob_get_flush "+"ob_get_length ob_get_level ob_get_status "+"ob_gzhandler ob_iconv_handler "+"ob_implicit_flush ob_list_handlers ob_start "+"octdec opendir openlog openssl_csr_export "+"openssl_csr_export_to_file openssl_csr_new "+"openssl_csr_sign openssl_error_string "+"openssl_free_key openssl_get_privatekey "+"openssl_get_publickey openssl_open "+"openssl_pkcs7_decrypt openssl_pkcs7_encrypt "+"openssl_pkcs7_sign openssl_pkcs7_verify "+"openssl_pkey_export openssl_pkey_export_to_file "+"openssl_pkey_free openssl_pkey_get_private "+"openssl_pkey_get_public openssl_pkey_new "+"openssl_private_decrypt openssl_private_encrypt "+"openssl_public_decrypt openssl_public_encrypt "+"openssl_seal openssl_sign openssl_verify "+"openssl_x509_checkpurpose "+"openssl_x509_check_private_key "+"openssl_x509_export openssl_x509_export_to_file "+"openssl_x509_free openssl_x509_parse "+"openssl_x509_read ord output_add_rewrite_var "+"output_reset_rewrite_vars overload pack "+"parse_ini_file parse_str parse_url "+"passthru pathinfo pclose pfsockopen "+"pg_affected_rows pg_cancel_query "+"pg_clientencoding pg_client_encoding "+"pg_close pg_cmdtuples pg_connect "+"pg_connection_busy pg_connection_reset "+"pg_connection_status pg_convert pg_copy_from "+"pg_copy_to pg_dbname pg_delete "+"pg_end_copy pg_errormessage pg_escape_bytea "+"pg_escape_string pg_exec pg_fetch_all "+"pg_fetch_array pg_fetch_assoc "+"pg_fetch_object pg_fetch_result pg_fetch_row "+"pg_fieldisnull pg_fieldname pg_fieldnum "+"pg_fieldprtlen pg_fieldsize pg_fieldtype "+"pg_field_is_null pg_field_name pg_field_num "+"pg_field_prtlen pg_field_size pg_field_type "+"pg_freeresult pg_free_result pg_getlastoid "+"pg_get_notify pg_get_pid pg_get_result "+"pg_host pg_insert pg_last_error "+"pg_last_notice pg_last_oid pg_loclose "+"pg_locreate pg_loexport pg_loimport "+"pg_loopen pg_loread pg_loreadall "+"pg_lounlink pg_lowrite pg_lo_close "+"pg_lo_create pg_lo_export pg_lo_import "+"pg_lo_open pg_lo_read pg_lo_read_all "+"pg_lo_seek pg_lo_tell pg_lo_unlink "+"pg_lo_write pg_meta_data pg_numfields "+"pg_numrows pg_num_fields pg_num_rows "+"pg_options pg_pconnect pg_ping pg_port "+"pg_put_line pg_query pg_result "+"pg_result_error pg_result_seek "+"pg_result_status pg_select pg_send_query "+"pg_setclientencoding pg_set_client_encoding "+"pg_trace pg_tty pg_unescape_bytea "+"pg_untrace pg_update phpcredits phpinfo "+"phpversion php_ini_scanned_files "+"php_logo_guid php_sapi_name php_uname pi "+"popen pos posix_ctermid posix_errno "+"posix_getcwd posix_getegid posix_geteuid "+"posix_getgid posix_getgrgid posix_getgrnam "+"posix_getgroups posix_getlogin posix_getpgid "+"posix_getpgrp posix_getpid posix_getppid "+"posix_getpwnam posix_getpwuid "+"posix_getrlimit posix_getsid posix_getuid "+"posix_get_last_error posix_isatty posix_kill "+"posix_mkfifo posix_setegid posix_seteuid "+"posix_setgid posix_setpgid posix_setsid "+"posix_setuid posix_strerror posix_times "+"posix_ttyname posix_uname pow preg_grep "+"preg_match preg_match_all preg_quote "+"preg_replace preg_replace_callback "+"preg_split prev print printf print_r "+"proc_close proc_open putenv "+"quoted_printable_decode quotemeta rad2deg "+"rand range rawurldecode rawurlencode "+"readdir readfile readgzfile readlink "+"read_exif_data realpath "+"register_shutdown_function "+"register_tick_function rename reset "+"restore_error_handler restore_include_path "+"rewind rewinddir rmdir round rsort "+"rtrim sem_acquire sem_get sem_release "+"sem_remove serialize session_cache_expire "+"session_cache_limiter session_decode "+"session_destroy session_encode "+"session_get_cookie_params session_id "+"session_is_registered session_module_name "+"session_name session_regenerate_id "+"session_register session_save_path "+"session_set_cookie_params "+"session_set_save_handler session_start "+"session_unregister session_unset "+"session_write_close setcookie setlocale "+"settype set_error_handler set_file_buffer "+"set_include_path set_magic_quotes_runtime "+"set_socket_blocking set_time_limit sha1 "+"sha1_file shell_exec shmop_close "+"shmop_delete shmop_open shmop_read "+"shmop_size shmop_write shm_attach "+"shm_detach shm_get_var shm_put_var "+"shm_remove shm_remove_var show_source "+"shuffle similar_text sin sinh sizeof "+"sleep socket_accept socket_bind "+"socket_clear_error socket_close "+"socket_connect socket_create "+"socket_create_listen socket_create_pair "+"socket_getopt socket_getpeername "+"socket_getsockname socket_get_option "+"socket_get_status socket_iovec_add "+"socket_iovec_alloc socket_iovec_delete "+"socket_iovec_fetch socket_iovec_free "+"socket_iovec_set socket_last_error "+"socket_listen socket_read socket_readv "+"socket_recv socket_recvfrom socket_recvmsg "+"socket_select socket_send socket_sendmsg "+"socket_sendto socket_setopt socket_set_block "+"socket_set_blocking socket_set_nonblock "+"socket_set_option socket_set_timeout "+"socket_shutdown socket_strerror socket_write "+"socket_writev sort soundex split "+"spliti sprintf sql_regcase sqrt srand "+"sscanf stat static strcasecmp strchr "+"strcmp strcoll strcspn "+"stream_context_create "+"stream_context_get_options "+"stream_context_set_option "+"stream_context_set_params stream_filter_append "+"stream_filter_prepend stream_get_meta_data "+"stream_register_wrapper stream_select "+"stream_set_blocking stream_set_timeout "+"stream_set_write_buffer stream_wrapper_register "+"strftime stripcslashes stripslashes "+"strip_tags stristr strlen strnatcasecmp "+"strnatcmp strncasecmp strncmp strpos "+"strrchr strrev strrpos strspn strstr "+"strtok strtolower strtotime strtoupper "+"strtr strval str_pad str_repeat "+"str_replace str_rot13 str_shuffle "+"str_word_count substr substr_count "+"substr_replace symlink syslog system "+"tan tanh tempnam textdomain time "+"tmpfile token_get_all token_name touch "+"trigger_error trim uasort ucfirst "+"ucwords uksort umask uniqid unixtojd "+"unlink unpack unregister_tick_function "+"unserialize unset urldecode urlencode "+"user_error usleep usort utf8_decode "+"utf8_encode var_dump var_export "+"version_compare virtual vprintf vsprintf "+"wddx_add_vars wddx_deserialize "+"wddx_packet_end wddx_packet_start "+"wddx_serialize_value wddx_serialize_vars "+"wordwrap xml_error_string "+"xml_get_current_byte_index "+"xml_get_current_column_number "+"xml_get_current_line_number xml_get_error_code "+"xml_parse xml_parser_create "+"xml_parser_create_ns xml_parser_free "+"xml_parser_get_option xml_parser_set_option "+"xml_parse_into_struct "+"xml_set_character_data_handler "+"xml_set_default_handler xml_set_element_handler "+"xml_set_end_namespace_decl_handler "+"xml_set_external_entity_ref_handler "+"xml_set_notation_decl_handler xml_set_object "+"xml_set_processing_instruction_handler "+"xml_set_start_namespace_decl_handler "+"xml_set_unparsed_entity_decl_handler yp_all "+"yp_cat yp_errno yp_err_string yp_first "+"yp_get_default_domain yp_master yp_match "+"yp_next yp_order zend_logo_guid "+"zend_version zlib_get_coding_type".split(" "),punctuation:"{ } ?> <?= <?php > < / + - % * . , ; ( ) ? : = \" '".split(" "),highlight:function(line,meta){if(!meta){meta={};}var K=bespin.syntax.PHPConstants;var _a4a={};var _a4b=(meta.inMultilineComment)?K.C_STYLE_COMMENT:undefined;var _a4c={};var _a4d="";var _a4e="";var _a4f=meta.inMultilineComment;for(var i=0;i<line.length;i++){var c=line.charAt(i);if(_a4b==K.C_STYLE_COMMENT){if(c=="/"&&/\*$/.test(_a4d)){_a4c.stop=i+1;this.addRegion(_a4a,_a4b,_a4c);_a4c={};_a4b=undefined;_a4f=false;_a4d="";}else{if(_a4d==""){_a4c={start:i};}_a4d+=c;}continue;}if(this.isWhiteSpaceOrPunctuation(c)){if(_a4b==K.STRING){if(!(c==_a4e&&!/\\$/.test(_a4d))){if(_a4d==""){_a4c={start:i};}_a4d+=c;continue;}}if(_a4d!=""){_a4c.stop=i;if(_a4b!=K.STRING){if(this.keywords.indexOf(_a4d)!=-1){_a4b=K.KEYWORD;}else{_a4b=K.OTHER;}}this.addRegion(_a4a,_a4b,_a4c);_a4c={};_a4e="";_a4d="";}if(this.isPunctuation(c)){if(c=="*"&&i>0&&(line.charAt(i-1)=="/")){_a4a[K.PUNCTUATION].pop();_a4f=true;_a4b=K.C_STYLE_COMMENT;_a4c={start:i-1};_a4d="/*";continue;}if(c=="/"&&i>0&&(line.charAt(i-1)=="/")){_a4c={start:i-1,stop:line.length};_a4b=K.LINE_COMMENT;this.addRegion(_a4a,_a4b,_a4c);_a4d="";_a4b=undefined;_a4c={};break;}this.addRegion(_a4a,K.PUNCTUATION,{start:i,stop:i+1});}if((c=="'"||c=="\"")&&(_a4b!=K.STRING)){_a4b=K.STRING;_a4e=c;}else{_a4b=undefined;}continue;}if(_a4d==""){_a4c={start:i};}_a4d+=c;}if(_a4d!=""){if(!_a4b){_a4b=K.OTHER;}_a4c.stop=line.length;this.addRegion(_a4a,_a4b,_a4c);}return {regions:_a4a,meta:{inMultilineComment:_a4f}};},addRegion:function(_a52,type,data){if(!_a52[type]){_a52[type]=[];}_a52[type].push(data);},isWhiteSpaceOrPunctuation:function(ch){return this.isPunctuation(ch)||this.isWhiteSpace(ch);},isPunctuation:function(ch){return this.punctuation.indexOf(ch)!=-1;},isWhiteSpace:function(ch){return ch==" ";}});bespin.syntax.simple.Resolver.register(new bespin.syntax.simple.PHP(),["php","php3","php4","php5"]);}if(!dojo._hasResource["bespin.cmd.commandline"]){dojo._hasResource["bespin.cmd.commandline"]=true;dojo.provide("bespin.cmd.commandline");dojo.declare("bespin.cmd.commandline.CommandStore",null,{constructor:function(opts){this.commands={};this.aliases={};if(opts.subCommand){this.subcommandFor=opts.subCommand.name;opts.subCommand.takes=["*"];opts.subCommand.subcommands=this;bespin.cmd.commands.add(opts.subCommand);}if(opts.initCommands){this.addCommands(opts.initCommands);}},splitCommandAndArgs:function(_a59){var data=_a59.split(/\s+/);var _a5b=data.shift();var _a5c;var _a5d=data.join(" ");if(this.commands[_a5b]){_a5c=this.commands[_a5b];}else{if(this.aliases[_a5b]){var _a5e=this.aliases[_a5b].split(" ");var _a5f=_a5e.shift();if(_a5e.length>0){_a5d=_a5e.join(" ")+" "+_a5d;}_a5c=this.commands[_a5f];}else{bespin.get("commandLine").showInfo("Sorry, no command '"+_a5b+"'. Maybe try to run &raquo; help",true);return;}}if(_a5c.subcommands){if(data.length<1||data[0]==""){data[0]=_a5c.subcommanddefault||"help";}return _a5c.subcommands.splitCommandAndArgs(data.join(" "));}return [_a5c,this.getArgs(_a5d.split(" "),_a5c)];},addCommand:function(_a60){if(!_a60){return;}if(_a60.takes&&dojo.isArray(_a60.takes)){_a60=this.normalizeTakes(_a60);}if(_a60.withKey){var args=bespin.util.keys.fillArguments(_a60.withKey);args.action="command:execute;name="+_a60.name;bespin.publish("editor:bindkey",args);}this.commands[_a60.name]=_a60;if(_a60["aliases"]){dojo.forEach(_a60["aliases"],function(_a62){this.aliases[_a62]=_a60.name;},this);}},addCommands:function(_a63){dojo.forEach(_a63,dojo.hitch(this,function(_a64){if(dojo.isString(_a64)){_a64=bespin.cmd.commands.get(_a64);}this.addCommand(_a64);}));},hasCommand:function(_a65){if(this.commands[_a65]){return true;}for(command in this.commands){if(this.commands[command]["aliases"]){if(bespin.util.include(this.commands[command]["aliases"],_a65)){return true;}}}return false;},findCompletions:function(_a66,root){var _a68={};if(root){_a68.root=root;}if(_a66.match(" ")){var _a69=this.rootCommand(_a66);if(_a69&&_a69.subcommands){return _a69.subcommands.findCompletions(_a66.replace(new RegExp("^"+_a69.name+"\\s*"),""),_a69.name);}}var _a6a=[];if(_a66.length>0){for(var _a69 in this.commands){if(_a69.indexOf(_a66)==0){_a6a.push(_a69);}}for(var _a6b in this.aliases){if(_a6b.indexOf(_a66)==0){_a6a.push(_a6b);}}}_a68.matches=_a6a;return _a68;},commandTakesArgs:function(_a6c){return _a6c.takes!=undefined;},getArgs:function(_a6d,_a6e){if(!_a6e.takes){return undefined;}var args;var _a70=_a6d.join(" ");if(_a6e.takes["*"]){args=new bespin.util.TokenObject(_a70);args.rawinput=_a70;args.varargs=args.pieces;}else{if(_a6e.takes&&_a6e.takes.order.length<2){args=_a70;}else{args=new bespin.util.TokenObject(_a70,{params:_a6e.takes.order.join(" ")});args.rawinput=_a70;}}return args;},normalizeTakes:function(_a71){var _a72=_a71.takes;_a71.takes={order:_a72};dojo.forEach(_a72,function(item){_a71.takes[item]={"short":item[0]};});return _a71;},rootCommand:function(_a74){return this.commands[dojo.trim(_a74.substring(0,_a74.indexOf(" ")))];}});dojo.declare("bespin.cmd.commandline.Interface",null,{constructor:function(_a75,_a76){this.commandLine=dojo.byId(_a75);if(bespin.get("files")){this.files=bespin.get("files");}if(bespin.get("settings")){this.settings=bespin.get("settings");}if(bespin.get("editor")){this.editor=bespin.get("editor");}this.inCommandLine=false;this.suppressInfo=false;this.commandStore=new bespin.cmd.commandline.CommandStore({initCommands:_a76});this.commandLineKeyBindings=new bespin.cmd.commandline.KeyBindings(this);this.commandLineHistory=new bespin.cmd.commandline.History(this);this.customEvents=new bespin.cmd.commandline.Events(this);this.setInfoAtBottom();},showUsage:function(_a77,_a78){var _a79=_a77.usage||"no usage information found for "+_a77.name;this.showInfo("Usage: "+_a77.name+" "+_a79,_a78);},showInfo:function(html,_a7b){if(this.suppressInfo){return;}this.hideInfo();dojo.byId("info_text").innerHTML=html;dojo.style("info","display","block");this.infoResizer();dojo.connect(dojo.byId("info"),"onclick",this,"hideInfo");if(_a7b){this.infoTimeout=setTimeout(dojo.hitch(this,function(){this.hideInfo();}),4600);}},hideInfo:function(){dojo.style("info","display","none");if(this.infoTimeout){clearTimeout(this.infoTimeout);}},infoResizer:function(){if(dojo.style("info","display")!="none"){dojo.style("info","height","");var _a7c=window.innerHeight-dojo.style("commandline","height")-dojo.style("header","height");var _a7d=dojo.style("info","height");if(_a7d>_a7c){dojo.style("info","height",(_a7c-30)+"px");}if(this.maxInfoHeight&&_a7d>this.maxInfoHeight){dojo.style("info","height",(this.maxInfoHeight-30)+"px");}}},setInfoInSlice:function(left,_a7f,_a80,_a81){dojo.style("info",{left:left+"px",bottom:_a7f+"px",width:_a80+"px",backgroundImage:""});this.maxInfoHeight=_a81;},setInfoAtBottom:function(){dojo.style("info",{left:"51px",bottom:"0px",width:"431px",backgroundImage:"url(http://localhost:8080/images/info_popup.png)"});this.maxInfoHeight=null;},complete:function(_a82){var _a83=this.commandStore.findCompletions(_a82);var _a84=_a83.matches;if(_a84.length==1){var _a85=_a84[0];var _a86=this.commandStore.commands[_a85]||this.commandStore.rootCommand(_a82).subcommands.commands[_a85];if(_a86){if(this.commandStore.commandTakesArgs(_a86)){_a85+=" ";}if(_a86["completeText"]){this.showInfo(_a86["completeText"]);}if(_a86["complete"]){this.showInfo(_a86.complete(this,_a82));}}else{this.showInfo(_a85+" is an alias for: "+this.commandStore.aliases[_a85]);_a85+=" ";}this.commandLine.value=(_a83.root?(_a83.root+" "):"")+_a85;}},executeCommand:function(_a87){var ca=this.commandStore.splitCommandAndArgs(_a87);if(typeof ca==="undefined"){return;}var _a89=ca[0];var args=ca[1];bespin.publish("command:executed",{command:_a89,args:args,commandString:_a87});var _a8b=_a89.execute(this,args,_a89);this.commandLine.value="";return _a8b;},handleCommandLineFocus:function(e){if(this.inCommandLine){return true;}if(e.keyChar=="j"&&e.ctrlKey){this.commandLine.focus();dojo.stopEvent(e);return true;}}});dojo.declare("bespin.cmd.commandline.KeyBindings",null,{constructor:function(cl){var _a8e=bespin.get("settings");dojo.connect(cl.commandLine,"onfocus",cl,function(){bespin.publish("cmdline:focus");this.inCommandLine=true;if(dojo.byId("promptimg")){dojo.byId("promptimg").src="images/icn_command_on.png";}});dojo.connect(cl.commandLine,"onblur",cl,function(){this.inCommandLine=false;if(dojo.byId("promptimg")){dojo.byId("promptimg").src="images/icn_command.png";}});dojo.connect(cl.commandLine,"onkeyup",cl,function(e){var _a90;if(e.keyCode>="A".charCodeAt()&&e.keyCode<"Z".charCodeAt()){var _a91=this.commandStore.findCompletions(dojo.byId("command").value).matches;var _a92=_a91[0];if(_a91.length>0){var _a93=(_a8e&&_a8e.isSettingOn("autocomplete"));if(_a93&&_a91.length==1){_a90=this.commandStore.commands[_a92]||this.commandStore.commands[this.commandStore.aliases[_a92]];var _a94=(this.commandStore.commandTakesArgs(_a90))?" ":"";dojo.byId("command").value=_a92+_a94;if(_a90["completeText"]){this.showInfo(_a90["completeText"]);}else{this.hideInfo();}}else{if(_a91.length==1){if(_a91[0]!=dojo.byId("command").value){this.showInfo(_a91.join(", "));}else{_a90=this.commandStore.commands[_a91[0]]||this.commandStore.commands[this.commandStore.aliases[_a91[0]]];if(this.commandStore.commandTakesArgs(_a90)){this.complete(dojo.byId("command").value);}else{this.hideInfo();}}}else{this.showInfo(_a91.join(", "));}}}}});dojo.connect(cl.commandLine,"onkeypress",cl,function(e){var Key=bespin.util.keys.Key;if(e.keyChar=="j"&&e.ctrlKey){dojo.stopEvent(e);dojo.byId("command").blur();bespin.publish("cmdline:blur");return false;}else{if((e.keyChar=="n"&&e.ctrlKey)||e.keyCode==Key.DOWN_ARROW){dojo.stopEvent(e);this.commandLineHistory.setNext();return false;}else{if((e.keyChar=="p"&&e.ctrlKey)||e.keyCode==Key.UP_ARROW){dojo.stopEvent(e);this.commandLineHistory.setPrevious();return false;}else{if(e.keyChar=="u"&&e.ctrlKey){dojo.stopEvent(e);cl.commandLine.value="";return false;}else{if(e.keyCode==Key.ENTER){this.executeCommand(dojo.byId("command").value);return false;}else{if(e.keyCode==Key.TAB){dojo.stopEvent(e);this.complete(dojo.byId("command").value);return false;}}}}}}});dojo.connect(cl.commandLine,"onkeydown",cl,function(e){if(e.keyCode==bespin.util.keys.Key.ESCAPE){this.hideInfo();}});}});dojo.declare("bespin.cmd.commandline.History",null,{constructor:function(cl){this.commandLine=cl;this.history=[];this.historySize=50;this.pointer=0;this.store=new bespin.cmd.commandline.ServerHistoryStore(this);},seed:function(_a99){this.history=_a99;this.trim();this.pointer=this.history.length;},trim:function(){if(this.history.length>this.historySize){this.history.splice(0,this.history.length-this.historySize);}},add:function(_a9a){_a9a=dojo.trim(_a9a);if(this.last()!=_a9a){this.history.push(_a9a);this.trim();this.pointer=this.history.length;this.store.save(this.history);}},next:function(){if(this.pointer<this.history.length-1){this.pointer++;return this.history[this.pointer];}},previous:function(){if(this.pointer>0){this.pointer--;return this.history[this.pointer];}},last:function(){return this.history[this.history.length-1];},first:function(){return this.history[0];},set:function(_a9b){var _a9c=this.commandLine.commandLine;_a9c.value=_a9b;},setNext:function(){var next=this.next();if(next){this.set(next);}},setPrevious:function(){var prev=this.previous();if(prev){this.set(prev);}}});dojo.declare("bespin.cmd.commandline.SimpleHistoryStore",null,{constructor:function(_a9f){_a9f.seed(["ls","clear","status"]);},save:function(_aa0){}});dojo.declare("bespin.cmd.commandline.ServerHistoryStore",null,{constructor:function(_aa1){this.history=_aa1;var self=this;if(bespin.authenticated){self.seed();}else{bespin.subscribe("authenticated",function(){self.seed();});}},seed:function(){bespin.get("files").loadContents(bespin.userSettingsProject,"command.history",dojo.hitch(this,function(file){this.history.seed(file.content.split(/\n/));}));},save:function(_aa4){bespin.get("files").saveFile(bespin.userSettingsProject,{name:"command.history",content:_aa4.join("\n")||"help",timestamp:new Date().getTime()});}});dojo.declare("bespin.cmd.commandline.Events",null,{constructor:function(_aa5){bespin.subscribe("message",function(_aa6){var msg=_aa6.msg;var _aa8=(_aa6.tag=="autohide");if(msg){_aa5.showInfo(msg,_aa8);}});bespin.subscribe("cmdline:suppressinfo",function(_aa9){_aa5.suppressInfo=true;});bespin.subscribe("cmdline:unsuppressinfo",function(_aaa){_aa5.suppressInfo=false;});bespin.subscribe("command:executed",function(_aab){var _aac=_aab.commandString||(_aab.command.name+" "+_aab.args.join(" "));try{_aa5.commandLineHistory.add(_aac);}catch(c){}});bespin.subscribe("command:execute",function(_aad){var _aae=_aad.name;var args=_aad.args;if(_aae&&args){_aae+=" "+args;}if(_aae){_aa5.executeCommand(_aae);}});bespin.subscribe("editor:openfile:openfail",function(_ab0){_aa5.showInfo("Could not open file: "+_ab0.filename+"<br/><br/><em>(maybe try &raquo; list)</em>");});bespin.subscribe("editor:openfile:opensuccess",function(_ab1){_aa5.showInfo("Loaded file: "+_ab1.file.name,true);});bespin.subscribe("project:set",function(_ab2){var _ab3=_ab2.project;bespin.get("editSession").project=_ab3;if(!_ab2.suppressPopup){_aa5.showInfo("Changed project to "+_ab3,true);}});}});}if(!dojo._hasResource["dojo.AdapterRegistry"]){dojo._hasResource["dojo.AdapterRegistry"]=true;dojo.provide("dojo.AdapterRegistry");dojo.AdapterRegistry=function(_ab4){this.pairs=[];this.returnWrappers=_ab4||false;};dojo.extend(dojo.AdapterRegistry,{register:function(name,_ab6,wrap,_ab8,_ab9){this.pairs[((_ab9)?"unshift":"push")]([name,_ab6,wrap,_ab8]);},match:function(){for(var i=0;i<this.pairs.length;i++){var pair=this.pairs[i];if(pair[1].apply(this,arguments)){if((pair[3])||(this.returnWrappers)){return pair[2];}else{return pair[2].apply(this,arguments);}}}throw new Error("No match found");},unregister:function(name){for(var i=0;i<this.pairs.length;i++){var pair=this.pairs[i];if(pair[0]==name){this.pairs.splice(i,1);return true;}}return false;}});}if(!dojo._hasResource["dijit._base.place"]){dojo._hasResource["dijit._base.place"]=true;dojo.provide("dijit._base.place");dijit.getViewport=function(){var _abf=(dojo.doc.compatMode=="BackCompat")?dojo.body():dojo.doc.documentElement;var _ac0=dojo._docScroll();return {w:_abf.clientWidth,h:_abf.clientHeight,l:_ac0.x,t:_ac0.y};};dijit.placeOnScreen=function(node,pos,_ac3,_ac4){var _ac5=dojo.map(_ac3,function(_ac6){var c={corner:_ac6,pos:{x:pos.x,y:pos.y}};if(_ac4){c.pos.x+=_ac6.charAt(1)=="L"?_ac4.x:-_ac4.x;c.pos.y+=_ac6.charAt(0)=="T"?_ac4.y:-_ac4.y;}return c;});return dijit._place(node,_ac5);};dijit._place=function(node,_ac9,_aca){var view=dijit.getViewport();if(!node.parentNode||String(node.parentNode.tagName).toLowerCase()!="body"){dojo.body().appendChild(node);}var best=null;dojo.some(_ac9,function(_acd){var _ace=_acd.corner;var pos=_acd.pos;if(_aca){_aca(node,_acd.aroundCorner,_ace);}var _ad0=node.style;var _ad1=_ad0.display;var _ad2=_ad0.visibility;_ad0.visibility="hidden";_ad0.display="";var mb=dojo.marginBox(node);_ad0.display=_ad1;_ad0.visibility=_ad2;var _ad4=(_ace.charAt(1)=="L"?pos.x:Math.max(view.l,pos.x-mb.w)),_ad5=(_ace.charAt(0)=="T"?pos.y:Math.max(view.t,pos.y-mb.h)),endX=(_ace.charAt(1)=="L"?Math.min(view.l+view.w,_ad4+mb.w):pos.x),endY=(_ace.charAt(0)=="T"?Math.min(view.t+view.h,_ad5+mb.h):pos.y),_ad8=endX-_ad4,_ad9=endY-_ad5,_ada=(mb.w-_ad8)+(mb.h-_ad9);if(best==null||_ada<best.overflow){best={corner:_ace,aroundCorner:_acd.aroundCorner,x:_ad4,y:_ad5,w:_ad8,h:_ad9,overflow:_ada};}return !_ada;});node.style.left=best.x+"px";node.style.top=best.y+"px";if(best.overflow&&_aca){_aca(node,best.aroundCorner,best.corner);}return best;};dijit.placeOnScreenAroundNode=function(node,_adc,_add,_ade){_adc=dojo.byId(_adc);var _adf=_adc.style.display;_adc.style.display="";var _ae0=_adc.offsetWidth;var _ae1=_adc.offsetHeight;var _ae2=dojo.coords(_adc,true);_adc.style.display=_adf;return dijit._placeOnScreenAroundRect(node,_ae2.x,_ae2.y,_ae0,_ae1,_add,_ade);};dijit.placeOnScreenAroundRectangle=function(node,_ae4,_ae5,_ae6){return dijit._placeOnScreenAroundRect(node,_ae4.x,_ae4.y,_ae4.width,_ae4.height,_ae5,_ae6);};dijit._placeOnScreenAroundRect=function(node,x,y,_aea,_aeb,_aec,_aed){var _aee=[];for(var _aef in _aec){_aee.push({aroundCorner:_aef,corner:_aec[_aef],pos:{x:x+(_aef.charAt(1)=="L"?0:_aea),y:y+(_aef.charAt(0)=="T"?0:_aeb)}});}return dijit._place(node,_aee,_aed);};dijit.placementRegistry=new dojo.AdapterRegistry();dijit.placementRegistry.register("node",function(n,x){return typeof x=="object"&&typeof x.offsetWidth!="undefined"&&typeof x.offsetHeight!="undefined";},dijit.placeOnScreenAroundNode);dijit.placementRegistry.register("rect",function(n,x){return typeof x=="object"&&"x" in x&&"y" in x&&"width" in x&&"height" in x;},dijit.placeOnScreenAroundRectangle);dijit.placeOnScreenAroundElement=function(node,_af5,_af6,_af7){return dijit.placementRegistry.match.apply(dijit.placementRegistry,arguments);};}if(!dojo._hasResource["bespin.util.webpieces"]){dojo._hasResource["bespin.util.webpieces"]=true;dojo.provide("bespin.util.webpieces");dojo.mixin(bespin.util.webpieces,{showCenterPopup:function(el,_af9){if(_af9){this.showOverlay();}dojo.style(el,"display","block");var _afa=dojo.coords(el);var _afb=dijit.getViewport();var y=(_afb.h-_afa.h)/2;var x=(_afb.w-_afa.w)/2;dojo.style(el,{position:"absolute",top:y+"px",left:x+"px"});},hideCenterPopup:function(el){dojo.style(el,"display","none");this.hideOverlay();},showOverlay:function(){dojo.style("overlay","display","block");},hideOverlay:function(){dojo.style("overlay","display","none");},fillScreenOverlay:function(){var _aff=dojo.coords(document.body);if(_aff.h){dojo.style(dojo.byId("overlay"),"height",_aff.h+"px");}},showStatus:function(msg){dojo.byId("status").innerHTML=msg;dojo.style("status","display","block");},showContentOverlay:function(msg,_b02){_b02=_b02||{};var el=dojo.byId("centerpopup");var _b04="";var _b05="";if(_b02.pre){_b04=_b04+"<pre>";_b05="</pre>"+_b05;}el.innerHTML="<div style='background-color: #fff; border: 1px solid #000; height: 100%; overflow: auto'>"+_b04+msg+_b05+"</div>";oldwidth=el.style.width;oldheight=el.style.height;el.style.width="80%";el.style.height="80%";bespin.util.webpieces.showCenterPopup(el);var _b06=dojo.connect(el,"onclick",function(){bespin.util.webpieces.hideCenterPopup(el);el.style.width=oldwidth;el.style.height=oldheight;dojo.disconnect(_b06);});}});}if(!dojo._hasResource["dojo.io.iframe"]){dojo._hasResource["dojo.io.iframe"]=true;dojo.provide("dojo.io.iframe");dojo.io.iframe={create:function(_b07,_b08,uri){if(window[_b07]){return window[_b07];}if(window.frames[_b07]){return window.frames[_b07];}var _b0a=null;var turi=uri;if(!turi){if(dojo.config["useXDomain"]&&!dojo.config["dojoBlankHtmlUrl"]){console.warn("dojo.io.iframe.create: When using cross-domain Dojo builds,"+" please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl"+" to the path on your domain to blank.html");}turi=(dojo.config["dojoBlankHtmlUrl"]||dojo.moduleUrl("dojo","resources/blank.html"));}var _b0c=dojo.isIE?"<iframe name=\""+_b07+"\" src=\""+turi+"\" onload=\""+_b08+"\">":"iframe";_b0a=dojo.doc.createElement(_b0c);with(_b0a){name=_b07;setAttribute("name",_b07);id=_b07;}dojo.body().appendChild(_b0a);window[_b07]=_b0a;with(_b0a.style){if(!(dojo.isSafari<3)){position="absolute";}left=top="1px";height=width="1px";visibility="hidden";}if(!dojo.isIE){this.setSrc(_b0a,turi,true);_b0a.onload=new Function(_b08);}return _b0a;},setSrc:function(_b0d,src,_b0f){try{if(!_b0f){if(dojo.isWebKit){_b0d.location=src;}else{frames[_b0d.name].location=src;}}else{var idoc;if(dojo.isIE||dojo.isWebKit>521){idoc=_b0d.contentWindow.document;}else{if(dojo.isSafari){idoc=_b0d.document;}else{idoc=_b0d.contentWindow;}}if(!idoc){_b0d.location=src;return;}else{idoc.location.replace(src);}}}catch(e){console.log("dojo.io.iframe.setSrc: ",e);}},doc:function(_b11){var doc=_b11.contentDocument||(((_b11.name)&&(_b11.document)&&(document.getElementsByTagName("iframe")[_b11.name].contentWindow)&&(document.getElementsByTagName("iframe")[_b11.name].contentWindow.document)))||((_b11.name)&&(document.frames[_b11.name])&&(document.frames[_b11.name].document))||null;return doc;},send:function(args){if(!this["_frame"]){this._frame=this.create(this._iframeName,dojo._scopeName+".io.iframe._iframeOnload();");}var dfd=dojo._ioSetArgs(args,function(dfd){dfd.canceled=true;dfd.ioArgs._callNext();},function(dfd){var _b17=null;try{var _b18=dfd.ioArgs;var dii=dojo.io.iframe;var ifd=dii.doc(dii._frame);var _b1b=_b18.handleAs;_b17=ifd;if(_b1b!="html"){if(_b1b=="xml"){if(dojo.isIE){dojo.query("a",dii._frame.contentWindow.document.documentElement).orphan();var _b1c=(dii._frame.contentWindow.document).documentElement.innerText;_b1c=_b1c.replace(/>\s+</g,"><");_b1c=dojo.trim(_b1c);var _b1d={responseText:_b1c};_b17=dojo._contentHandlers["xml"](_b1d);}}else{_b17=ifd.getElementsByTagName("textarea")[0].value;if(_b1b=="json"){_b17=dojo.fromJson(_b17);}else{if(_b1b=="javascript"){_b17=dojo.eval(_b17);}}}}}catch(e){_b17=e;}finally{_b18._callNext();}return _b17;},function(_b1e,dfd){dfd.ioArgs._hasError=true;dfd.ioArgs._callNext();return _b1e;});dfd.ioArgs._callNext=function(){if(!this["_calledNext"]){this._calledNext=true;dojo.io.iframe._currentDfd=null;dojo.io.iframe._fireNextRequest();}};this._dfdQueue.push(dfd);this._fireNextRequest();dojo._ioWatch(dfd,function(dfd){return !dfd.ioArgs["_hasError"];},function(dfd){return (!!dfd.ioArgs["_finished"]);},function(dfd){if(dfd.ioArgs._finished){dfd.callback(dfd);}else{dfd.errback(new Error("Invalid dojo.io.iframe request state"));}});return dfd;},_currentDfd:null,_dfdQueue:[],_iframeName:dojo._scopeName+"IoIframe",_fireNextRequest:function(){try{if((this._currentDfd)||(this._dfdQueue.length==0)){return;}var dfd=this._currentDfd=this._dfdQueue.shift();var _b24=dfd.ioArgs;var args=_b24.args;_b24._contentToClean=[];var fn=dojo.byId(args["form"]);var _b27=args["content"]||{};if(fn){if(_b27){var _b28=function(name,_b2a){var tn;if(dojo.isIE){tn=dojo.doc.createElement("<input type='hidden' name='"+name+"'>");}else{tn=dojo.doc.createElement("input");tn.type="hidden";tn.name=name;}tn.value=_b2a;fn.appendChild(tn);_b24._contentToClean.push(name);};for(var x in _b27){var val=_b27[x];if(dojo.isArray(val)&&val.length>1){var i;for(i=0;i<val.length;i++){_b28(x,val[i]);}}else{if(!fn[x]){_b28(x,val);}else{fn[x].value=val;}}}}var _b2f=fn.getAttributeNode("action");var _b30=fn.getAttributeNode("method");var _b31=fn.getAttributeNode("target");if(args["url"]){_b24._originalAction=_b2f?_b2f.value:null;if(_b2f){_b2f.value=args.url;}else{fn.setAttribute("action",args.url);}}if(!_b30||!_b30.value){if(_b30){_b30.value=(args["method"])?args["method"]:"post";}else{fn.setAttribute("method",(args["method"])?args["method"]:"post");}}_b24._originalTarget=_b31?_b31.value:null;if(_b31){_b31.value=this._iframeName;}else{fn.setAttribute("target",this._iframeName);}fn.target=this._iframeName;fn.submit();}else{var _b32=args.url+(args.url.indexOf("?")>-1?"&":"?")+_b24.query;this.setSrc(this._frame,_b32,true);}}catch(e){dfd.errback(e);}},_iframeOnload:function(){var dfd=this._currentDfd;if(!dfd){this._fireNextRequest();return;}var _b34=dfd.ioArgs;var args=_b34.args;var _b36=dojo.byId(args.form);if(_b36){var _b37=_b34._contentToClean;for(var i=0;i<_b37.length;i++){var key=_b37[i];if(dojo.isSafari<3){for(var j=0;j<_b36.childNodes.length;j++){var _b3b=_b36.childNodes[j];if(_b3b.name==key){dojo.destroy(_b3b);break;}}}else{dojo.destroy(_b36[key]);_b36[key]=null;}}if(_b34["_originalAction"]){_b36.setAttribute("action",_b34._originalAction);}if(_b34["_originalTarget"]){_b36.setAttribute("target",_b34._originalTarget);_b36.target=_b34._originalTarget;}}_b34._finished=true;}};}if(!dojo._hasResource["bespin.cmd.commands"]){dojo._hasResource["bespin.cmd.commands"]=true;dojo.provide("bespin.cmd.commands");bespin.cmd.commands.store={};bespin.cmd.commands.add=function(_b3c){bespin.cmd.commands.store[_b3c.name]=_b3c;};bespin.cmd.commands.get=function(_b3d){return bespin.cmd.commands.store[_b3d];};bespin.cmd.commands.toArgArray=function(args){if(args==null){return [];}else{var _b3f=args.split(" ");if(_b3f.length==1&&_b3f[0]==""){return [];}else{return _b3f;}}};bespin.cmd.displayHelp=function(_b40,_b41,_b42,_b43){var _b44=[];var _b45,name;if(_b40.commands[_b42]){_b44.push("<u>Help for the command: <em>"+_b42+"</em></u><br/>");_b45=_b40.commands[_b42];_b44.push(_b45["description"]?_b45.description:_b45.preview);}else{var _b47=false;var _b48="";if(_b40.subcommandFor){_b48=" for "+_b40.subcommandFor;}_b44.push("<u>Commands Available"+_b48+"</u><br/>");if(_b42){if(_b42=="hidden"){_b42="";_b47=true;}_b44.push("<em>(starting with</em> "+_b42+" <em>)</em><br/>");}var _b49=[];for(name in _b40.commands){_b49.push(name);}var _b4a=_b49.sort();for(var i=0;i<_b4a.length;i++){name=_b4a[i];_b45=_b40.commands[name];if(!_b47&&_b45.hidden){continue;}if(_b42&&name.indexOf(_b42)!=0){continue;}var args=(_b45.takes)?" ["+_b45.takes.order.join("] [")+"]":"";_b44.push("<b>"+name+args+"</b>: "+_b45.preview);}}_b41.showInfo("<div style='font-size: 0.80em'>"+_b44.join("<br/>")+(_b43||"")+"</div>");};bespin.cmd.commands.add({name:"help",takes:["search"],preview:"show commands",description:"The <u>help</u> gives you access to the various commands in the Bespin system.<br/><br/>You can narrow the search of a command by adding an optional search params.<br/><br/>If you pass in the magic <em>hidden</em> parameter, you will find subtle hidden commands.<br/><br/>Finally, pass in the full name of a command and you can get the full description, which you just did to see this!",completeText:"optionally, narrow down the search",execute:function(self,_b4e){bespin.cmd.displayHelp(self.commandStore,self,_b4e);}});bespin.cmd.commands.add({name:"eval",takes:["js-code"],preview:"evals given js code and show the result",completeText:"evals given js code and show the result",execute:function(self,_b50){try{var _b51=eval(_b50);}catch(err){var _b51="<b>Error: "+err.message+"</b>";}var msg="";var type="";if(dojo.isFunction(_b51)){msg=(_b51+"").replace(/\n/g,"<br>").replace(/ /g,"&#160");type="function";}else{if(dojo.isObject(_b51)){if(dojo.isArray(_b51)){type="array";}else{type="object";}var _b54=[];var _b55;for(x in _b51){if(dojo.isFunction(_b51[x])){_b55="[function]";}else{if(dojo.isObject(_b51[x])){_b55="[object]";}else{_b55=_b51[x];}}_b54.push({name:x,value:_b55});}_b54.sort(function(a,b){return (a.name.toLowerCase()<b.name.toLowerCase())?-1:1;});for(var x=0;x<_b54.length;x++){msg+="<b>"+_b54[x].name+"</b>: "+_b54[x].value+"<br>";}}else{msg=_b51;type=typeof _b51;}}self.showInfo("<div style='font-size: 0.80em'><u>Result for eval <b>\""+_b50+"\"</b> (type: "+type+"): </u><br><br>"+msg+"</div>");}});bespin.cmd.commands.add({name:"set",takes:["key","value"],preview:"define and show settings",completeText:"optionally, add a key and/or a value, else you will see all settings",execute:function(self,_b5a){var _b5b;if(!_b5a.key){var _b5c=self.settings.list();_b5b="<u>Your Settings</u><br/><br/>";dojo.forEach(_b5c.sort(function(a,b){if(a.key<b.key){return -1;}else{if(a.key==b.key){return 0;}else{return 1;}}}),function(_b5f){if(_b5f.key[0]!="_"){_b5b+=_b5f.key+": "+_b5f.value+"<br/>";}});}else{var key=_b5a.key;if(_b5a.value===undefined){var _b61=self.settings.get(key);if(_b61){_b5b="<u>Your setting</u><br/><br/>";_b5b+=key+": "+_b61;}else{_b5b="You do not have a setting for <em>"+key+"</em>";}}else{_b5b="<u>Saving setting</u><br/><br/>";_b5b+=key+": "+_b5a.value;self.settings.set(key,_b5a.value);}}self.showInfo(_b5b);}});bespin.cmd.commands.add({name:"unset",takes:["key"],preview:"unset a setting entirely",completeText:"add a key for the setting to delete entirely",execute:function(self,key){self.settings.unset(key);self.showInfo("Unset the setting for "+key+".");}});bespin.cmd.commands.add({name:"search",takes:["searchString"],preview:"searches the current file for the given searchString",completeText:"type in a string to search",execute:function(self,str){bespin.get("actions").startSearch(str,"commandLine");}});bespin.cmd.commands.add({name:"files",aliases:["ls","list"],takes:["project"],preview:"show files",completeText:"optionally, add the project name of your choice",execute:function(self,_b67){if(!_b67){bespin.withComponent("editSession",function(_b68){_b67=_b68.project;});}if(!_b67){self.showInfo("You need to pass in a project");return;}self.files.fileNames(_b67,function(_b69){var _b6a="<u>Files in project: "+_b67+"</u><br/><br/>";for(var x=0;x<_b69.length;x++){_b6a+=_b69[x].name+"<br/>";}self.showInfo(_b6a);});}});bespin.cmd.commands.add({name:"status",preview:"get info on the current project and file",execute:function(self){bespin.publish("session:status");}});bespin.cmd.commands.add({name:"project",takes:["projectname"],preview:"show the current project, or set to a new one",completeText:"optionally, add the project name to change to that project",execute:function(self,_b6e){if(_b6e){bespin.publish("project:set",{project:_b6e});}else{self.executeCommand("status");}}});bespin.cmd.commands.add({name:"projects",preview:"show projects",execute:function(self,_b70){self.files.projects(function(_b71){var _b72="<u>Your projects</u><br/><br/>";for(var x=0;x<_b71.length;x++){_b72+=_b71[x].name+"<br/>";}self.showInfo(_b72);});}});bespin.cmd.commands.add({name:"createproject",takes:["projectname"],preview:"create a new project",usage:"[newprojectname]",execute:function(self,_b75){if(!_b75){self.showUsage(this);return;}bespin.publish("project:create",{project:_b75});}});bespin.cmd.commands.add({name:"deleteproject",takes:["projectname"],preview:"delete a project",usage:"[projectname]",execute:function(self,_b77){if(!_b77){self.showUsage(this);return;}bespin.publish("project:delete",{project:_b77});}});bespin.cmd.commands.add({name:"renameproject",takes:["currentProject","newProject"],preview:"rename a project",usage:"[currentProject], [newProject]",execute:function(self,args){if(!args.currentProject||!args.newProject){self.showUsage(this);return;}bespin.publish("project:rename",{currentProject:args.currentProject,newProject:args.newProject});}});bespin.cmd.commands.add({name:"mkdir",takes:["path","projectname"],preview:"create a new directory in the given project",usage:"[path] [projectname]",execute:function(self,args){if(!args.path){self.showUsage(this);return;}var opts={path:args.path};if(args.projectname){opts.project=args.projectname;}bespin.publish("directory:create",opts);}});bespin.cmd.commands.add({name:"save",takes:["filename"],preview:"save the current contents",completeText:"add the filename to save as, or use the current file",withKey:"CMD S",execute:function(self,_b7e){bespin.publish("editor:savefile",{filename:_b7e});}});bespin.cmd.commands.add({name:"load",aliases:["open"],takes:["filename","project"],preview:"load up the contents of the file",completeText:"add the filename to open",execute:function(self,opts){bespin.publish("editor:openfile",opts);}});bespin.cmd.commands.add({name:"preview",takes:["filename"],preview:"view the file in a new browser window",completeText:"add the filename to view or use the current file",execute:function(self,_b82){bespin.publish("editor:preview",{filename:_b82});}});bespin.cmd.commands.add({name:"editconfig",aliases:["config"],preview:"load up the config file",execute:function(self){bespin.publish("editor:config:edit");}});bespin.cmd.commands.add({name:"runconfig",preview:"run your config file",execute:function(self){bespin.publish("editor:config:run");}});bespin.cmd.commands.add({name:"cmdload",takes:["commandname"],preview:"load up a new command",completeText:"command name to load (required)",usage:"[commandname]: Command name required.",execute:function(self,_b86){if(!_b86){self.showUsage(this);return;}bespin.publish("command:load",{commandname:_b86});}});bespin.cmd.commands.add({name:"cmdedit",takes:["commandname"],aliases:["cmdadd"],preview:"edit the given command (force if doesn't exist",completeText:"command name to edit (required)",usage:"[commandname]: Command name required.",execute:function(self,_b88){if(!_b88){self.showUsage(this);return;}bespin.publish("command:edit",{commandname:_b88});}});bespin.cmd.commands.add({name:"cmdlist",preview:"list my custom commands",execute:function(self){bespin.publish("command:list");}});bespin.cmd.commands.add({name:"cmdrm",takes:["commandname"],preview:"delete a custom command",completeText:"command name to delete (required)",usage:"[commandname]: Command name required.",execute:function(self,_b8b){if(!_b8b){self.showUsage(this);return;}bespin.publish("command:delete",{commandname:_b8b});}});bespin.cmd.commands.add({name:"newfile",takes:["filename","project"],preview:"create a new buffer for file",completeText:"optionally, name the new filename first, and then the name of the project second",withKey:"CTRL SHIFT N",execute:function(self,args){if(args.filename){args.newfilename=args.filename;delete args.filename;}bespin.publish("editor:newfile",args||{});}});bespin.cmd.commands.add({name:"rm",aliases:["remove","del"],takes:["filename","project"],preview:"remove the file",completeText:"add the filename to remove, and optionally a specific project at the end",execute:function(self,args){var _b90=args.project||bespin.get("editSession").project;var _b91=args.filename;if(!_b90){self.showInfo("rm only works with the project is set.");return;}if(!_b91){self.showInfo("give me a filename or directory to delete");return;}self.files.removeFile(_b90,_b91,function(){if(bespin.get("editSession").checkSameFile(_b90,_b91)){self.editor.model.clear();}self.showInfo("Removed file: "+_b91,true);},function(xhr){self.showInfo("Wasn't able to remove the file <b>"+_b91+"</b><br/><em>Error</em> (probably doesn't exist): "+xhr.responseText);});}});bespin.cmd.commands.add({name:"closefile",takes:["filename","project"],preview:"close the file (may lose edits)",completeText:"add the filename to close (defaults to this file).<br>also, optional project name.",execute:function(self,args){bespin.publish("editor:closefile",args);}});bespin.cmd.commands.add({name:"dashboard",preview:"navigate to the file",execute:function(self){bespin.util.navigate.dashboard();}});bespin.cmd.commands.add({name:"version",takes:["command"],preview:"show the version for Bespin or a command",completeText:"optionally, a command name",execute:function(self,_b97){var _b98="Your Bespin is at version "+bespin.versionNumber+", Code name: \""+bespin.versionCodename+"\"";var _b99;if(_b97){var _b9a=self.commandStore.commands[_b97];if(!_b9a){_b99="It appears that there is no command named '"+_b97+"', but "+_b98;}else{_b99=(_b9a.version)?"The command named '"+_b97+"' is at version "+_b9a.version:"The command named '"+_b97+"' is a core command in Bespin version "+bespin.versionNumber;}}else{_b99=_b98;}self.showInfo(_b99);}});bespin.cmd.commands.add({name:"clear",aliases:["cls"],preview:"clear the file",execute:function(self){self.editor.model.clear();}});(function(){var _b9c="move it! make the editor head to a line number or a function name.";var _b9d="move it! make the editor head to a line number.";var _b9e="add the line number to move to, or the name of a function in the file";var _b9f="add the line number to move to in the file";var _ba0={name:"goto",takes:["value"],preview:_b9c,completeText:_b9e,execute:function(self,_ba2){var _ba3=bespin.get("settings");if(_ba2){var _ba4=parseInt(_ba2,10);if(isNaN(_ba4)){if(_ba3.isOn(_ba3.get("syntaxcheck"))){bespin.publish("parser:gotofunction",{functionName:_ba2});}else{bespin.publish("message",{msg:"Please enter a valid line number."});}}else{bespin.publish("editor:moveandcenter",{row:_ba4});}}}};bespin.cmd.commands.add(_ba0);bespin.subscribe("settings:set:syntaxcheck",function(){var _ba5=bespin.get("settings");if(_ba5.isOn(_ba5.get("syntaxcheck"))){_ba0.preview=_b9c;_ba0.completeText=_b9e;}else{_ba0.preview=_b9d;_ba0.completeText=_b9f;}});})();bespin.cmd.commands.add({name:"replace",takes:["search","replace"],preview:"s/foo/bar/g",completeText:"add the search regex, and then the replacement text",execute:function(self,args){self.editor.model.replace(args.search,args.replace);}});bespin.cmd.commands.add({name:"login",hidden:true,takes:{order:["username","password"],username:{"short":"u"},password:{"short":"p",optional:true}},preview:"login to the service",completeText:"pass in your username and password",execute:function(self,args){if(!args){self.executeCommand("status");return;}bespin.get("editSession").username=args.user;bespin.get("server").login(args.user,args.pass);}});bespin.cmd.commands.add({name:"logout",preview:"log out",execute:function(self){delete bespin.get("editSession").username;bespin.get("server").logout(function(){window.location.href="/";});}});bespin.cmd.commands.add({name:"bespin",preview:"has",hidden:true,messages:["really wants you to trick it out in some way.","is your Web editor.","would love to be like Emacs on the Web.","is written on the Web platform, so you can tweak it."],execute:function(self){self.showInfo("Bespin "+this.messages[Math.floor(Math.random()*this.messages.length)]);}});bespin.cmd.commands.add({name:"action",takes:["actionname"],preview:"execute any editor action",hidden:true,execute:function(self,_bad){bespin.publish("editor:doaction",{action:_bad});}});bespin.cmd.commands.add({name:"sort",takes:["direction"],preview:"sort the current buffer",completeText:"optionally, sort descending",execute:function(self,_baf){var _bb0=self.editor.model.getDocument().split(/\n/);_bb0.sort();if(_baf&&/^desc/.test(_baf.toLowerCase())){_bb0.reverse();}self.editor.model.insertDocument(_bb0.join("\n"));}});bespin.cmd.commands.add({name:"quota",preview:"show your quota info",megabytes:function(_bb1){return (_bb1/1024/1024).toFixed(2);},execute:function(self){var _bb3=bespin.get("editSession");self.showInfo("You have "+this.megabytes(_bb3.quota-_bb3.amountUsed)+" MB free space to put some great code!<br><br> <em style='font-size: smaller'>Used "+this.megabytes(_bb3.amountUsed)+" MB out of your "+this.megabytes(_bb3.quota)+" MB quota</em>");}});bespin.cmd.commands.add({name:"export",takes:["project","archivetype"],preview:"export the given project with an archivetype of zip or tgz",completeText:"project name, archivetype (zip | tgz, defaults to zip)",execute:function(self,args){var _bb6=args.project||bespin.get("editSession").project;var type=args.archivetype;if(!bespin.util.include(["zip","tgz","tar.gz"],type)){type="zip";}bespin.get("server").exportProject(_bb6,type);}});bespin.cmd.commands.add({name:"import",takes:["url","project"],preview:"import the given url as a project.<br>If a project name isn't given it will use the filename<br>If no URL is given to import, a file upload box will be shown to import.",completeText:"url (to an archive zip | tgz) and/or project name",usage:"[url of archive] [projectname]<br><br><em>If only a URL is given, the projectname will be implied<br><br>If only a project name is given, a file upload window will be shown to upload.</em>",calculateProjectName:function(url){var _bb9=url.split("/");var _bba=_bb9[_bb9.length-1].split(".");_bba.pop();return _bba.join("_");},isURL:function(url){return (url&&(/^http(:|s:)/.test(url)));},upload:function(_bbc){var el=dojo.byId("centerpopup");el.innerHTML="<div id='upload-container'><form method='POST' name='upload' id='upload' enctype='multipart/form-data'><div id='upload-header'>Import project via upload <img id='upload-close' src='images/icn_close_x.png' align='right'></div><div id='upload-content'><div id='upload-status'></div><p>Browse to find the project archive that you wish to archive<br>and then click on the <code>Upload</code> button.</p><center><input type='file' id='filedata' name='filedata' accept='application/zip,application/x-gzip'> <input type='submit' value='Upload'></center></div></form></div>";dojo.connect(dojo.byId("upload"),"submit",function(){dojo.byId("upload-status").innerHTML="Importing file into new project "+_bbc;dojo.io.iframe.send({url:"/project/import/"+_bbc,form:dojo.byId("upload"),method:"POST",handleAs:"text",preventCache:true,contentType:"multipart/form-data",load:function(data,_bbf){dojo.byId("upload-status").innerHTML="Thanks for uploading the file!";},error:function(_bc0,_bc1){setTimeout(function(){bespin.get("files").projects(function(_bc2){if(dojo.some(_bc2,function(_bc3){return _bbc+"/"==_bc3.name;})){dojo.byId("upload-status").innerHTML="Archive imported and project "+_bbc+" has been created!";}else{dojo.byId("upload-status").innerHTML="Error uploading the file. Sorry, try again!";}});},100);}});});bespin.util.webpieces.showCenterPopup(el,true);var _bc4,_bc5;var _bc6=function(){el.removeChild(el.firstChild);bespin.util.webpieces.hideCenterPopup(el);dojo.disconnect(_bc4);dojo.disconnect(_bc5);};_bc4=dojo.connect(dojo.byId("upload-close"),"onclick",_bc6);_bc5=dojo.connect(dojo.byId("overlay"),"onclick",_bc6);},execute:function(self,args){var _bc9,url;if(!args.url){self.showUsage(this);return;}else{if(!args.project&&this.isURL(args.url)){args.project=this.calculateProjectName(args.url);}else{if(this.isURL(args.project)){_bc9=args.project;url=args.url;args.project=url;args.url=_bc9;}else{if(!this.isURL(args.url)){var _bc9=args.url;this.upload(_bc9);}else{_bc9=args.project;url=args.url;self.showInfo("About to import "+_bc9+" from:<br><br>"+url+"<br><br><em>It can take awhile to download the project, so be patient!</em>");bespin.publish("project:import",{project:_bc9,url:url});}}}}}});bespin.cmd.commands.add({name:"trim",takes:["side"],preview:"trim trailing or leading whitespace",completeText:"optionally, give a side of left, right, or both (defaults to right)",execute:function(self,side){self.editor.model.changeEachRow(function(row){if(!side){side="right";}if(bespin.util.include(["left","both"],side)){while(row[0]==" "){row.shift();}}if(bespin.util.include(["right","both"],side)){var i=row.length-1;while(row[i]==" "){delete row[i];i--;}}return bespin.util.shrinkArray(row);});}});bespin.cmd.commands.add({name:"bindkey",takes:["modifiers","key","action"],preview:"Bind a key to an action, or show bindings",completeText:"With no arguments show bindings, else give modifier(s), key, and action name to set",execute:function(self,args){if(args.key&&args.action){if(args.modifiers=="none"){args.modifiers="";}bespin.publish("editor:bindkey",args);}else{var _bd1=bespin.get("editor").editorKeyListener.keyMapDescriptions;var _bd2="<u>Your Key Bindings</u><br><br><table>";for(var keys in _bd1){var _bd4=keys.split(",");var _bd5=parseInt(_bd4[0]);var _bd6=[];if(_bd4[1]==="true"){_bd6.push("CMD");}if(_bd4[2]==="true"){_bd6.push("CTRL");}if(_bd4[3]==="true"){_bd6.push("ALT");}if(_bd4[4]==="true"){_bd6.push("SHIFT");}var _bd7=_bd6.length>0?_bd6.join(", ")+" ":"";var _bd8=_bd7+bespin.util.keys.KeyCodeToName[_bd5]||_bd5;_bd2+="<tr style='font-size: x-small'><td style='color: #eee; padding-right: 20px;'>"+_bd8+"</td><td>"+_bd1[keys]+"</td></tr>";}_bd2+="</table>";self.showInfo(_bd2);}}});bespin.cmd.commands.add({name:"insert",takes:["text"],preview:"insert the given text at this point.",hidden:true,execute:function(self,text){self.editor.model.insertChunk(self.editor.cursorPosition,text);}});bespin.cmd.commands.add({name:"typingtest",preview:"type in the alphabet a few times",hidden:true,execute:function(self){var _bdc=Date.now();for(var i=0;i<3;i++){dojo.forEach(["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],function(c){var args={pos:bespin.editor.utils.copyPos(self.editor.cursorPosition)};args.newchar=c;self.editor.ui.actions.insertCharacter(args);});}var stop=Date.now();self.showInfo("It took "+(stop-_bdc)+" milliseconds to do this");}});bespin.cmd.commands.add({name:"template",takes:["type"],preview:"insert templates",completeText:"pass in the template name",templates:{"in":"for (var key in object) {\n\n}"},execute:function(_be1,type){_be1.editor.model.insertChunk(_be1.editor.cursorPosition,this.templates[type]);}});bespin.cmd.commands.add({name:"alias",takes:["alias","command"],preview:"define and show aliases for commands",completeText:"optionally, add your alias name, and then the command name",execute:function(self,args){var _be5;var _be6=self.commandStore.aliases;if(!args.alias){_be5="<u>Your Aliases</u><br/><br/>";for(var x in _be6){_be5+=x+": "+_be6[x]+"<br/>";}}else{if(args.command===undefined){_be5="<u>Your alias</u><br/><br/>";var _be8=_be6[args.alias];if(_be8){_be5+=args.alias+": "+_be6[args.alias];}else{_be5+="No alias set for "+args.alias;}}else{var key=args.alias;var _bea=args.command;var _beb=_bea.split(" ")[0];_be5="<u>Saving setting</u><br/><br/>";if(self.commandStore.commands[key]){_be5+="Sorry, there is already a command with the name: "+key;}else{if(self.commandStore.commands[_beb]){_be5+=key+": "+_bea;_be6[key]=_bea;}else{if(_be6[_beb]){_be5+=key+": "+_be6[_bea]+" ("+_bea+" was an alias itself)";_be6[key]=_bea;}else{_be5+="Sorry, no command or alias with that name.";}}}}}self.showInfo(_be5);}});bespin.cmd.commands.add({name:"history",preview:"show history of the commands",execute:function(self){self.showInfo("<u>Command History</u><br/><br/>"+self.commandLineHistory.history.join("<br/>"));}});bespin.cmd.commands.add({name:"use",takes:["type"],preview:"use patterns to bring in code",completeText:"\"sound\" will add sound support",libnames:{"jquery":"jquery.min.js"},execute:function(self,type){if(type=="sound"){self.editor.model.insertChunk({row:3,col:0},"  <script type=\"text/javascript\" src=\"soundmanager2.js\"></script>\n");self.editor.model.insertChunk({row:4,col:0},"  <script>\n  var sound; \n  soundManager.onload = function() {\n    sound =  soundManager.createSound('mySound','/path/to/mysoundfile.mp3');\n  }\n  </script>\n");}else{if(type=="js"){var _bef="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js";var _bf0="<script type=\"text/javascript\" src=\""+_bef+"\"></script>\n";self.editor.model.insertChunk({row:3,col:0},_bf0);}}}});bespin.cmd.commands.add({name:"uc",preview:"Change all selected text to uppercase",withKey:"CMD SHIFT U",execute:function(self){var args={stringCase:"u"};self.editor.ui.actions.selectionChangeCase(args);}});bespin.cmd.commands.add({name:"lc",preview:"Change all selected text to lowercase",withKey:"CMD SHIFT L",execute:function(self){var args={stringCase:"l"};self.editor.ui.actions.selectionChangeCase(args);}});bespin.cmd.commands.add({name:"complete",takes:["startsWith"],preview:"auto complete a piece of code",completeText:"enter the start of the string",withKey:"CTRL SPACE",execute:function(self,args){console.log("Complete");}});bespin.cmd.commands.add({name:"outline",preview:"show outline of source code",withKey:"ALT SHIFT O",execute:function(self){bespin.publish("parser:showoutline");}});}if(!dojo._hasResource["bespin.vcs"]){dojo._hasResource["bespin.vcs"]=true;dojo.provide("bespin.vcs");bespin.vcs.commands=new bespin.cmd.commandline.CommandStore({subCommand:{name:"vcs",preview:"run a version control command",completeText:"subcommands: add, clone, commit, diff, getkey, help, push, remove, resolved, update",subcommanddefault:"help"}});bespin.vcs.standardHandler={evalJSON:true,onSuccess:function(_bf8){},onFailure:function(_bf9){bespin.publish("vcs:error",_bf9);}};bespin.vcs._remoteauthCache={};bespin.vcs.getRemoteauth=function(_bfa,_bfb){var _bfc=bespin.vcs._remoteauthCache[_bfa];if(_bfc===undefined){bespin.get("server").remoteauth(_bfa,_bfb);return;}_bfb(_bfc);};bespin.subscribe("vcs:remoteauthUpdate",function(_bfd){bespin.vcs._remoteauthCache[_bfd.project]=_bfd.remoteauth;});bespin.vcs.clone=function(url){var el=dojo.byId("centerpopup");el.innerHTML="<form method=\"POST\" id=\"vcsauth\">"+"<table><tbody><tr><td>Keychain password</td><td>"+"<input type=\"password\" name=\"kcpass\" id=\"kcpass\"></td></tr>"+"<tr><td>URL</td>"+"<td><input type=\"text\" name=\"source\" value=\""+url+"\" style=\"width: 85%\"></td></tr>"+"<tr><td style=\"width: 25%\">Project name (defaults to last part of URL path)</td>"+"<td><input type=\"text\" name=\"dest\" value=\"\"></td></tr>"+"<tr><td>Authentication</td><td><select name=\"remoteauth\" id=\"remoteauth\">"+"<option value=\"\">None (read-only access to the remote repo)</option>"+"<option value=\"write\">Only for writing</option>"+"<option value=\"both\">For reading and writing</option>"+"</select></td></tr>"+"<tr id=\"push_row\" style=\"display:none\" class=\"authfields\"><td>Push to URL</td>"+"<td><input type=\"text\" name=\"push\" style=\"width: 85%\" value=\""+url+"\"></td></tr>"+"<tr id=\"authtype_row\" style=\"display:none\" class=\"authfields\"><td>Authentication type</td>"+"<td><select name=\"authtype\" id=\"authtype\">"+"<option value=\"ssh\">SSH</option>"+"<option value=\"password\">Username/Password</option>"+"</select></td></tr>"+"<tr id=\"username_row\" style=\"display:none\" class=\"authfields\"><td>Username</td>"+"<td><input type=\"text\" name=\"username\">"+"</td></tr>"+"<tr id=\"password_row\" style=\"display:none\" class=\"authfields userfields\"><td>Password</td><td>"+"<input type=\"password\" name=\"password\">"+"</td></tr><tr><td>&nbsp;</td><td>"+"<input type=\"button\" id=\"vcsauthsubmit\" value=\"Clone\">"+"<input type=\"button\" id=\"vcsauthcancel\" value=\"Cancel\">"+"</td></tr></tbody></table></form>";dojo.connect(dojo.byId("remoteauth"),"onchange",function(){var _c00=dojo.byId("remoteauth").value;if(_c00==""){dojo.query("tr.authfields").style("display","none");}else{dojo.query("tr.authfields").style("display","table-row");if(dojo.byId("authtype").value=="ssh"){dojo.query("tr.userfields").style("display","none");}}});dojo.connect(dojo.byId("authtype"),"onchange",function(){var _c01=dojo.byId("authtype").value;if(_c01=="ssh"){dojo.query("tr.userfields").style("display","none");}else{dojo.query("tr.userfields").style("display","table-row");}});dojo.connect(dojo.byId("vcsauthcancel"),"onclick",function(){bespin.util.webpieces.hideCenterPopup(el);});dojo.connect(dojo.byId("vcsauthsubmit"),"onclick",function(){bespin.util.webpieces.hideCenterPopup(el);var data=dojo.formToObject("vcsauth");if(data.remoteauth==""){delete data.push;delete data.authtype;delete data.username;delete data.password;}else{if(data.authtype=="ssh"){delete data.password;}}data=dojo.objectToQuery(data);bespin.get("server").clone(data,{evalJSON:true,onSuccess:function(_c03){},onFailure:function(_c04){bespin.publish("vcs:error",_c04);}});});bespin.util.webpieces.showCenterPopup(el,true);dojo.byId("kcpass").focus();};bespin.vcs.setProjectPassword=function(_c05){var el=dojo.byId("centerpopup");el.innerHTML="<form method=\"POST\" id=\"vcsauth\">"+"<table><tbody><tr><td>Keychain password</td><td>"+"<input type=\"password\" name=\"kcpass\"></td></tr>"+"<tr><td>Username</td><td><input type=\"text\" name=\"username\">"+"</td></tr><tr><td>Password</td><td>"+"<input type=\"password\" name=\"password\">"+"</td></tr><tr><td>&nbsp;</td><td>"+"<input type=\"hidden\" name=\"type\" value=\"password\">"+"<input type=\"button\" id=\"vcsauthsubmit\" value=\"Save\">"+"<input type=\"button\" id=\"vcsauthcancel\" value=\"Cancel\">"+"</td></tr></tbody></table></form>";dojo.connect(dojo.byId("vcsauthcancel"),"onclick",function(){bespin.util.webpieces.hideCenterPopup(el);});dojo.connect(dojo.byId("vcsauthsubmit"),"onclick",function(){bespin.util.webpieces.hideCenterPopup(el);bespin.get("server").setauth(_c05,"vcsauth",{onSuccess:function(){bespin.publish("message",{msg:"Password saved for "+_c05});},onFailure:function(xhr){bespin.publish("message",{msg:"Password save failed: "+xhr.responseText});}});});bespin.util.webpieces.showCenterPopup(el,true);};bespin.vcs.getKeychainPassword=function(_c08){var el=dojo.byId("centerpopup");el.innerHTML="<form id=\"vcsauth\">"+"<table><tbody><tr><td>Keychain password</td><td>"+"<input type=\"password\" id=\"kcpass\">"+"</td></tr><tr><td>&nbsp;</td><td>"+"<input type=\"button\" id=\"vcsauthsubmit\" value=\"Submit\">"+"<input type=\"button\" id=\"vcsauthcancel\" value=\"Cancel\">"+"</td></tr></tbody></table></form>";dojo.connect(dojo.byId("vcsauthcancel"),"onclick",function(){bespin.util.webpieces.hideCenterPopup(el);});function _c0a(){bespin.util.webpieces.hideCenterPopup(el);var _c0b=dojo.byId("kcpass").value;el.innerHTML="";_c08(_c0b);return false;};dojo.connect(dojo.byId("vcsauthsubmit"),"onclick",_c0a);dojo.connect(dojo.byId("vcsauth"),"onsubmit",_c0a);bespin.util.webpieces.showCenterPopup(el,true);dojo.byId("kcpass").focus();};bespin.vcs.commands.addCommand({name:"clone",takes:["url"],aliases:["checkout"],preview:"checkout or clone the project into a new Bespin project",execute:function(self,url){url=url||"";bespin.vcs.clone(url);}});bespin.vcs.commands.addCommand({name:"push",preview:"push to the remote repository",execute:function(self,args){var _c10;bespin.withComponent("editSession",function(_c11){_c10=_c11.project;});if(!_c10){self.showInfo("You need to pass in a project");return;}bespin.vcs.getKeychainPassword(function(_c12){bespin.get("server").vcs(_c10,{command:["push","_BESPIN_PUSH"],kcpass:_c12},bespin.vcs.standardHandler);});}});bespin.vcs.commands.addCommand({name:"diff",preview:"Display the differences in the checkout out files",takes:["*"],completeText:"Use the current file, add -a for all files or add filenames",description:"Without any options, the vcs diff command will diff the currently selected file against the repository copy. If you pass in -a, the command will diff <em>all</em> files. Finally, you can list files to diff individually.",execute:function(self,args){bespin.vcs._performVCSCommandWithFiles("diff",self,args);}});bespin.vcs.commands.addCommand({name:"remove",preview:"Remove a file from version control (also deletes it)",takes:["*"],description:"The files presented will be deleted and removed from version control.",execute:function(self,args){bespin.vcs._performVCSCommandWithFiles("remove",self,args,{acceptAll:false});}});bespin.vcs.commands.addCommand({name:"status",preview:"Display the status of the repository files.",description:"Shows the current state of the files in the repository<br>M for modified, ? for unknown (you may need to add), R for removed, ! for files that are deleted but not removed",execute:function(self,args){var _c19;bespin.withComponent("editSession",function(_c1a){_c19=_c1a.project;});if(!_c19){self.showInfo("You need to pass in a project");return;}bespin.get("server").vcs(_c19,{command:["status"]},bespin.vcs.standardHandler);}});bespin.vcs.commands.addCommand({name:"resolved",takes:["*"],preview:"Mark files as resolved",completeText:"Use the current file, add -a for all files or add filenames",description:"Without any options, the vcs resolved command will mark the currently selected file as resolved. If you pass in -a, the command will resolve <em>all</em> files. Finally, you can list files individually.",execute:function(self,args){bespin.vcs._performVCSCommandWithFiles("resolved",self,args);}});bespin.vcs.commands.addCommand({name:"update",preview:"Update your working copy from the remote repository",execute:function(self){var _c1e;bespin.withComponent("editSession",function(_c1f){_c1e=_c1f.project;});if(!_c1e){self.showInfo("You need to pass in a project");return;}var _c20=function(_c21){var _c22={command:["update","_BESPIN_REMOTE_URL"]};if(_c21!==undefined){_c22.kcpass=_c21;}bespin.get("server").vcs(_c1e,_c22,bespin.vcs.standardHandler);};bespin.vcs.getRemoteauth(_c1e,function(_c23){console.log("remote auth is: "+_c23);if(_c23=="both"){bespin.vcs.getKeychainPassword(_c20);}else{_c20(undefined);}});}});bespin.vcs._performVCSCommandWithFiles=function(_c24,self,args,_c27){_c27=_c27||{acceptAll:true};var _c28;var path;bespin.withComponent("editSession",function(_c2a){_c28=_c2a.project;path=_c2a.path;});if(!_c28){self.showInfo("You need to pass in a project");return;}if(args.varargs.length==0){if(!path){var _c2b="";if(_c27.acceptAll){_c2b=", or use -a for all files.";}self.showInfo("You must select a file to "+_c24+_c2b);return;}var _c2c=[_c24,path];}else{if(args.varargs[0]=="-a"&&_c27.acceptAll){var _c2c=[_c24];}else{var _c2c=[_c24];_c2c.concat(args.varargs);}}bespin.get("server").vcs(_c28,{command:_c2c},bespin.vcs.standardHandler);};bespin.vcs.commands.addCommand({name:"add",preview:"Adds missing files to the project",takes:["*"],completeText:"Use the current file, add -a for all files or add filenames",description:"Without any options, the vcs add command will add the currently selected file. If you pass in -a, the command will add <em>all</em> files. Finally, you can list files individually.",execute:function(self,args){bespin.vcs._performVCSCommandWithFiles("add",self,args);}});bespin.vcs.commands.addCommand({name:"commit",takes:["message"],preview:"Commit to the repository",execute:function(self,_c30){if(!_c30){self.showInfo("You must enter a log message");return;}var _c31;bespin.withComponent("editSession",function(_c32){_c31=_c32.project;});if(!_c31){self.showInfo("You need to pass in a project");return;}bespin.get("server").vcs(_c31,{command:["commit","-m",_c30]},bespin.vcs.standardHandler);}});bespin.vcs._displaySSHKey=function(_c33){bespin.util.webpieces.showContentOverlay("<h2>Your Bespin SSH public key</h2><input type=\"text\" value=\""+_c33+"\" id=\"sshkey\" style=\"width: 95%\">");dojo.byId("sshkey").select();};bespin.vcs._getSSHKeyAuthenticated=function(){bespin.vcs.getKeychainPassword(function(_c34){bespin.get("server").getkey(_c34,{onSuccess:bespin.vcs._displaySSHKey,on401:function(_c35){self.showInfo("Bad keychain password.");},onFailure:function(_c36){self.showInfo("getkey failed: "+_c36);}});});};bespin.vcs.commands.addCommand({name:"getkey",preview:"Get your SSH public key that Bespin can use for remote repository authentication. This will prompt for your keychain password.",execute:function(self){bespin.get("server").getkey(null,{onSuccess:bespin.vcs._displaySSHKey,on401:bespin.vcs._getSSHKeyAuthenticated,onFailure:function(_c38){self.showInfo("getkey failed: "+_c38);}});}});bespin.vcs.commands.addCommand({name:"help",takes:["search"],preview:"show commands for vcs subcommand",description:"The <u>help</u> gives you access to the various commands in the vcs subcommand space.<br/><br/>You can narrow the search of a command by adding an optional search params.<br/><br/>Finally, pass in the full name of a command and you can get the full description, which you just did to see this!",completeText:"optionally, narrow down the search",execute:function(self,_c3a){bespin.cmd.displayHelp(bespin.vcs.commands,self,_c3a);}});bespin.vcs.hgCommands=new bespin.cmd.commandline.CommandStore({subCommand:{name:"hg",preview:"run a Mercurial command",subcommanddefault:"help"}});bespin.vcs.hgCommands.addCommand({name:"help",takes:["search"],preview:"show commands for hg subcommand",description:"The <u>help</u> gives you access to the various commands in the hg subcommand space.<br/><br/>You can narrow the search of a command by adding an optional search params.<br/><br/>Finally, pass in the full name of a command and you can get the full description, which you just did to see this!",completeText:"optionally, narrow down the search",execute:function(self,_c3c){bespin.cmd.displayHelp(bespin.vcs.hgCommands,self,_c3c);}});bespin.vcs.hgCommands.addCommand({name:"init",preview:"initialize a new hg repository",description:"This will create a new repository in this project.",execute:function(self){var _c3e;bespin.withComponent("editSession",function(_c3f){_c3e=_c3f.project;});if(!_c3e){self.showInfo("You need to pass in a project");return;}bespin.get("server").vcs(_c3e,{command:["hg","init"]},bespin.vcs.standardHandler);}});bespin.subscribe("vcs:response",function(_c40){var _c41=_c40.output;if(/^\s*$/.exec(_c41)){_c41="(Successful command with no visible output)";}bespin.util.webpieces.showContentOverlay("<h2>vcs "+_c40.command+" output</h2><pre>"+_c41+"</pre>");if(_c40.command){var _c42=_c40.command;if(_c42=="clone"){bespin.publish("project:create",{project:_c40.project});}}});bespin.subscribe("vcs:error",function(_c43){bespin.util.webpieces.showContentOverlay("<h2>Error in VCS command</h2><pre>"+_c43.output+"</pre>");});}if(!dojo._hasResource["bespin.jetpack"]){dojo._hasResource["bespin.jetpack"]=true;dojo.provide("bespin.jetpack");bespin.jetpack.projectName="jetpacks";bespin.jetpack.commands=new bespin.cmd.commandline.CommandStore({subCommand:{name:"jetpack",preview:"play with jetpack features",completeText:"jetpack subcommands:<br><br> create [name] [type]<br> install [name]<br> list<br> edit [name]",subcommanddefault:"help"}});bespin.jetpack.commands.addCommand({name:"help",takes:["search"],preview:"show commands for jetpack subcommand",description:"The <u>help</u> gives you access to the various commands in the Bespin system.<br/><br/>You can narrow the search of a command by adding an optional search params.<br/><br/>Finally, pass in the full name of a command and you can get the full description, which you just did to see this!",completeText:"optionally, narrow down the search",execute:function(self,_c45){bespin.cmd.displayHelp(bespin.jetpack.commands,self,_c45,"<br><br>For more info and help on the available API, <a href='https://wiki.mozilla.org/Labs/Jetpack/API'>check out the Reference</a>");}});bespin.jetpack.commands.addCommand({name:"create",takes:["feature","type"],preview:"create a new jetpack feature of the given type (defaults to sidebar)",description:"Create a new jetpack feature that you can install into Firefox with the new Jetpack goodness.",completeText:"name of your feature, type of JetPack template (sidebar, content, toolbar)",execute:function(self,opts){var _c48=opts.feature||"newjetpack";var type=opts.type||"sidebar";var _c4a=bespin.jetpack.projectName;var _c4b=_c48+".html";var _c4c={stdtemplate:"jetpacks/"+type+".html",values:{templateName:_c48}};bespin.get("server").fileTemplate(_c4a,_c4b,_c4c,{onSuccess:function(xhr){bespin.publish("editor:openfile",{project:_c4a,filename:_c4b});},onFailure:function(xhr){self.showInfo("Unable to create "+_c4b+": "+xhr.responseText);}});}});bespin.jetpack.commands.addCommand({name:"install",takes:["feature"],preview:"install a jetpack feature",description:"Install a Jetpack feature, either the current file, or the named feature",completeText:"optionally, the name of the feature to install",execute:function(self,_c50){_c50=_c50||(function(){var _c51=bespin.get("editSession");if(_c51.project!=bespin.jetpack.projectName){return;}var bits=_c51.path.split(".");return bits[bits.length-2];})();if(!_c50){bespin.publish("message",{msg:"Please pass in the name of the Jetpack feature you would like to install"});}else{var _c53=document.createEvent("Events");var _c54=dojo.byId("jetpackInstallEvent");if(!_c54){_c54=dojo.create("div",{id:"jetpackEvent",},dojo.body());_c54.setAttribute("hidden",true);}_c54.setAttribute("mozjpcode",bespin.get("editor").model.getDocument());_c53.initEvent("mozjpinstall",true,false);_c54.dispatchEvent(_c53);}}});bespin.jetpack.commands.addCommand({name:"list",preview:"list out the Jetpacks that you have written",description:"Which Jetpacks have you written and have available in BespinSettings/jetpacks. NOTE: This is not the same as which Jetpacks you have installed in Firefox!",execute:function(self,_c56){bespin.get("server").list(bespin.jetpack.projectName,"",function(_c57){var _c58;if(!_c57||_c57.length<1){_c58="You haven't installed any Jetpacks. Run '> jetpack create' to get going.";}else{_c58="<u>Your Jetpack Features</u><br/><br/>";_c58+=dojo.map(dojo.filter(_c57,function(file){return bespin.util.endsWith(file.name,"\\.html");}),function(c){return "<a href=\"javascript:bespin.get('commandLine').executeCommand('open "+c.name+" "+bespin.jetpack.projectName+"');\">"+c.name.replace(/\.html$/,"")+"</a>";}).join("<br>");}bespin.publish("message",{msg:_c58});});}});bespin.jetpack.commands.addCommand({name:"edit",takes:["feature"],preview:"edit the given Jetpack feature",completeText:"feature name to edit (required)",usage:"[feature]: feature name required.",execute:function(self,_c5c){if(!_c5c){self.showUsage(this);return;}var path=_c5c+".html";bespin.get("files").whenFileExists(bespin.jetpack.projectName,path,{execute:function(){bespin.publish("editor:openfile",{project:bespin.jetpack.projectName,filename:path});},elseFailed:function(){bespin.publish("message",{msg:"No feature called "+_c5c+".<br><br><em>Run 'jetpack list' to see what is available.</em>"});}});}});bespin.subscribe("settings:set:jetpack",function(_c5e){var _c5f=bespin.get("settings").isOff(_c5e.value);var jptb=dojo.byId("toolbar_jetpack");if(_c5f){if(jptb){jptb.style.display="none";}}else{if(jptb){jptb.style.display="inline";}else{dojo.byId("toolbar").appendChild(dojo.create("img",{id:"toolbar_jetpack",src:"images/icn_jetpack.png",alt:"Jetpack",style:"padding-left: 10px",title:"Jetpack (show or hide menu)"}));bespin.get("toolbar").setup("jetpack","toolbar_jetpack");}}});bespin.subscribe("toolbar:init",function(_c61){_c61.toolbar.addComponent("jetpack",function(_c62,el){var _c64=dojo.byId(el)||dojo.byId("toolbar_jetpack");var _c65=function(){_c64.src="images/icn_jetpack_on.png";};var _c66=function(){_c64.src="images/icn_jetpack.png";};dojo.connect(_c64,"mouseover",_c65);dojo.connect(_c64,"mouseout",function(){var _c67=dojo.byId("jetpack_dropdown");if(!_c67||_c67.style.display=="none"){_c66();}});dojo.connect(_c64,"click",function(){var _c68=dojo.byId("jetpack_dropdown");if(!_c68||_c68.style.display=="none"){_c65();_c68=_c68||(function(){var dd=dojo.create("div",{id:"jetpack_dropdown",});var _c6a=dojo.coords("editor");var _c6b=dojo.coords(_c64);dojo.style(dd,{position:"absolute",padding:"0px",top:_c6a.y+"px",left:(_c6b.x-30)+"px",display:"none",zIndex:"150"});dd.innerHTML="<table id=\"jetpack_dropdown_content\"><tr><th colspan=\"3\">Jetpack Actions</th></tr><tr><td>create</td><td><input type=\"text\" size=\"7\" id=\"jetpack_dropdown_input_create\" value=\"myjetpack\"></td><td><input id=\"jetpack_dropdown_now_create\" type=\"button\" value=\"now &raquo;\"></td></tr><tr id=\"jetpack_dropdown_or\"><td colspan=\"3\" align=\"center\">or</td></tr><tr><td>install</td><td><select id=\"jetpack_dropdown_input_install\"><option></option></select></td><td><input id=\"jetpack_dropdown_now_install\" type=\"button\" value=\"now &raquo;\"></td></tr></table><div id=\"jetpack_dropdown_border\">&nbsp;</div>";document.body.appendChild(dd);bespin.jetpack.sizeDropDownBorder(dd);var cl=bespin.get("commandLine");dojo.connect(dojo.byId("jetpack_dropdown_now_create"),"click",function(){cl.executeCommand("jetpack create "+dojo.byId("jetpack_dropdown_input_create").value);_c68.style.display="none";});dojo.connect(dojo.byId("jetpack_dropdown_now_install"),"click",function(){cl.executeCommand("jetpack install "+dojo.byId("jetpack_dropdown_input_install").value);_c68.style.display="none";});return dd;})();_c68.style.display="block";bespin.jetpack.loadInstallScripts();}else{_c66();_c68.style.display="none";}});});});bespin.jetpack.sizeDropDownBorder=function(dd){var _c6e=false;if(dd){_c6e=true;}else{dd=dojo.byId("jetpack_dropdown");}if(_c6e){dd.style.right="-50000px";dd.style.display="block";}var _c6f=dojo.coords("jetpack_dropdown_content");if(_c6e){dd.style.right="";dd.style.display="none";}dojo.style("jetpack_dropdown_border",{width:_c6f.w+"px",height:_c6f.h+"px"});};bespin.jetpack.loadInstallScripts=function(){bespin.get("server").list(bespin.jetpack.projectName,"",function(_c70){var _c71;if(_c70&&_c70.length>1){_c71+=dojo.map(dojo.filter(_c70,function(file){return bespin.util.endsWith(file.name,"\\.html");}),function(c){return "<option>"+c.name.replace(/\.html$/,"")+"</option>";}).join("");}dojo.byId("jetpack_dropdown_input_install").innerHTML=_c71;bespin.jetpack.sizeDropDownBorder();});};}if(!dojo._hasResource["bespin.cmd.editorcommands"]){dojo._hasResource["bespin.cmd.editorcommands"]=true;dojo.provide("bespin.cmd.editorcommands");(function(){var keys=[];for(var i in bespin.cmd.commands.store){keys.push(i);}bespin.cmd.editorcommands.Commands=keys;})();}if(!dojo._hasResource["th.helpers"]){dojo._hasResource["th.helpers"]=true;dojo.provide("th.helpers");dojo.mixin(th.helpers,{isPercentage:function(str){return (str.indexOf&&str.indexOf("%")!=-1);},isCssPixel:function(str){str=dojo.trim(str).toLowerCase();return (str.indexOf("px")==str.length-2);}});dojo.declare("th.helpers.EventHelpers",null,{wrapEvent:function(e,root){var _c7a=dojo.coords(this.canvas,true);var x=e.clientX-_c7a.x;var y=e.clientY-_c7a.y;var _c7d=root.getComponentForPosition(x,y,true);e.thComponent=_c7d;this.addComponentXY(e,root,_c7d);},addComponentXY:function(e,_c7f,dest){if(!dest.bounds){console.log("No dest bounds - "+dest.declaredClass);console.log(dest.bounds);console.log(dest);return;}var _c81=dojo.coords(this.canvas,true);var x=e.clientX-_c81.x;var y=e.clientY-_c81.y;var nxy={x:x,y:y};var c=dest;while(c){nxy.x-=c.bounds.x;nxy.y-=c.bounds.y;c=c.parent;if(c==_c7f){e.componentX=nxy.x;e.componentY=nxy.y;return;}}}});dojo.declare("th.helpers.ComponentHelpers",null,{d:function(){return {b:(this.bounds)?{x:this.bounds.x,y:this.bounds.y,w:this.bounds.width,h:this.bounds.height,iw:this.bounds.width-this.getInsets().left-this.getInsets().right,ih:this.bounds.height-this.getInsets().top-this.getInsets().bottom}:{},i:{l:this.getInsets().left,r:this.getInsets().right,t:this.getInsets().top,b:this.getInsets().bottom,w:this.getInsets().left+this.getInsets().right,h:this.getInsets().top+this.getInsets().bottom}};},shouldPaint:function(){return (this.shouldLayout()&&this.style.visibility!="hidden");},shouldLayout:function(){return (this.style.display!="none");},emptyInsets:function(){return {left:0,right:0,bottom:0,top:0};},resolveCss:function(){var _c86=th.global_resources;var _c87={};var _c88;var _c89=["userAgentCss","userCss","authorCss"];for(var i=0;i<_c89.length;i++){var _c8b=_c89[i];dojo.forEach(_c86[_c8b],function(css){for(var _c8d in css){var _c8e=_c8d.split(",");for(var s=0;s<_c8e.length;s++){var _c90=dojo.trim(_c8e[s]);if(this.matchesSelector(_c90)){var _c91=css[_c8d];for(_c88 in _c91){_c87[_c88]=_c91[_c88];}}}}},this);}this.styles=_c87;},matchesSelector:function(_c92){var s=_c92.toLowerCase();if(s=="*"){return true;}if(s.indexOf(".")==0){if(!this.className){return false;}if(this.className.toLowerCase()==s.substring(1)){return true;}}if(s.indexOf("#")==0){if(!this.id){return false;}return ("#"+this.id)==s;}var _c94=this.declaredClass.split(".");var _c95=_c94[_c94.length-1].toLowerCase();if(_c95==s){return true;}if(this.id&&(s==(_c95+"#"+this.id))){return true;}if(this.className&&(s==(_c95+"."+this.className.toLowerCase()))){return true;}if(s.indexOf(">")!=-1){var ss=s.split(">");if(ss.length!=2){console.log("unsupported child selector syntax; must be SEL1 > SEL2, was '"+_c92+"'");return false;}if(this.matchesSelector(dojo.trim(ss[1]))){if(!this.parent){return false;}return (this.parent.matchesSelector(dojo.trim(ss[0])));}return false;}if(s.indexOf(" ")!=-1){var ss=s.split(" ");if(ss.length!=2){console.log("unsupported ancestor selector syntax; must be SEL1 SEL2, was '"+_c92+"'");return false;}if(this.matchesSelector(ss[1].trim())){var _c97=this.parent;while(_c97){if(_c97.matchesSelector(ss[0].trim())){return true;}_c97=_c97.parent;}return false;}}return false;},getSpecificityIndex:function(_c98,_c99){if(_c98==_c99){return 0;}if(_c98.indexOf("#")==0){return 1;}if(_c99.indexOf("#")==0){return -1;}return 0;},paintBackground:function(ctx,x,y,w,h){if(!x){x=0;}if(!y){y=0;}if(!w){w=this.bounds.width;}if(!h){h=this.bounds.height;}if(this.styles["background-color"]){ctx.fillStyle=this.styles["background-color"];ctx.fillRect(x,y,w,h);}if(this.styles["background-image"]){var img=this.styles["background-image"];this.paintImage(ctx,img,this.styles["background-repeat"],this.styles["background-position"],x,y,w,h);}},paintImage:function(ctx,img,_ca2,_ca3,x,y,w,h){if(!_ca2){_ca2="repeat";}if(!_ca3){_ca3="0% 0%";}if(!x){x=0;}if(!y){y=0;}if(!w){w=this.bounds.width;}if(!h){h=this.bounds.height;}ctx.save();try{if((x!=0)||(y!=0)){ctx.translate(x,y);}var pos=_ca3.toLowerCase().split(" ");if(pos.length==1){pos.push("50%");}if(pos.length!=2){console.log("Unsupported position syntax; only \"X\" or \"X Y\" supported, you passed in \" + position + \"");return;}var xy=[];xy[0]=(pos[0]=="top"||pos[0]=="bottom")?pos[1]:pos[0];xy[1]=(pos[0]=="top"||pos[0]=="bottom")?pos[0]:pos[1];dojo.forEach(xy,function(p,_cab){if(p=="top"){xy[_cab]="0%";}if(p=="right"){xy[_cab]="100%";}if(p=="bottom"){xy[_cab]="100%";}if(p=="left"){xy[_cab]="0%";}if(p=="center"){xy[_cab]="50%";}});var txy=[0,0];for(var i=0;i<xy.length;i++){var _cae=th.helpers.isPercentage(xy[i]);var _caf=this.convertPositionToPixel(xy[i],(i==0)?w:h);if(_cae){txy[i]=this.convertPositionToPixel(xy[i],(i==0)?img.width:img.height);}xy[i]=_caf;}ctx.drawImage(img,xy[0],xy[1]);}finally{ctx.restore();}},convertPositionToPixel:function(_cb0,_cb1){if(th.helpers.isPercentage(pos)){var per=pos.substring(0,pos.length-1)/100;return _cb1*per;}else{if(th.helpers.isCssPixel(pos)){return pos.substring(0,pos.length-2);}}}});dojo.declare("th.helpers.ContainerHelpers",null,{getScene:function(){var _cb3=this;while(!_cb3.scene&&_cb3.parent){_cb3=_cb3.parent;}return _cb3.scene;},getChildById:function(id){for(var i=0;i<this.children.length;i++){if(this.children[i].id==id){return this.children[i];}}},getComponentForPosition:function(x,y,_cb8){for(var i=0;i<this.children.length;i++){if(!this.children[i].bounds){continue;}if(this.children[i].bounds.x<=x&&this.children[i].bounds.y<=y&&(this.children[i].bounds.x+this.children[i].bounds.width)>=x&&(this.children[i].bounds.y+this.children[i].bounds.height)>=y){if(!_cb8){return this.children[i];}return (this.children[i].getComponentForPosition)?this.children[i].getComponentForPosition(x-this.children[i].bounds.x,y-this.children[i].bounds.y,_cb8):this.children[i];}}return this;},removeAll:function(){this.remove(this.children);}});}if(!dojo._hasResource["th.css"]){dojo._hasResource["th.css"]=true;dojo.provide("th.css");dojo.declare("th.css.CSSParser",null,{parse:function(str,ret){if(!ret){ret={};}dojo.forEach(this.munge(str,false).split("`b%"),function(css){css=css.split("%b`");if(css.length<2){return;}css[0]=this.restore(css[0]);var obj=ret[css[0]]||{};ret[css[0]]=dojo.mixin(obj,this.parsedeclarations(css[1]));},this);return ret;},REbraces:/{[^{}]*}/,REfull:/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,REatcomment:/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,REcomment_string:/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,REmunged:/%\w`(\d+)`\w%/,uid:0,munged:{},munge:function(str,full){str=str.replace(this.REatcomment,"$1").replace(this.REcomment_string,dojo.hitch(this,function(s,_cc1){if(!_cc1){return "";}var _cc2="%s`"+(++this.uid)+"`s%";this.munged[this.uid]=_cc1.replace(/^\\/,"");return _cc2;}));var RE=full?this.REfull:this.REbraces;while(match=RE.exec(str)){replacement="%b`"+(++this.uid)+"`b%";this.munged[this.uid]=match[0];str=str.replace(RE,replacement);}return str;},restore:function(str){if(str===undefined){return str;}while(match=this.REmunged.exec(str)){str=str.replace(this.REmunged,this.munged[match[1]]);}return dojo.trim(str);},parsedeclarations:function(_cc5){var str=this.munged[_cc5].replace(/(?:^\s*[{'"]\s*)|(?:\s*([^\\])[}'"]\s*$)/g,"$1");str=this.munge(str);var _cc7={};dojo.forEach(str.split(";"),function(decl){decl=decl.split(":");if(decl.length<2){return;}_cc7[this.restore(decl[0])]=this.restore(decl[1]);},this);return _cc7;}});}if(!dojo._hasResource["th.th"]){dojo._hasResource["th.th"]=true;dojo.provide("th.th");dojo.mixin(th,{VERTICAL:"v",HORIZONTAL:"h"});dojo.declare("th.Resources",null,{constructor:function(){this.loading=false;this.userAgentCss=[];this.authorCss=[];this.userCss=[];this.blockUntilImagesLoaded=true;this.images={};this.sheetCount=0;this.currentSheet=0;this.imageCount=0;this.currentImage=0;this.loaded=false;this.cssLoaded=false;this.imagesLoaded=false;this.callbacks=[];},load:function(){if(this.loaded){return;}this.loading=true;this.parseCSS();},processImage:function(){this.currentImage++;if(this.imageCount==this.currentImage){this.imagesLoaded=true;this.onLoaded();}},onLoaded:function(){if(this.cssLoaded&&((this.blockUntilImagesLoaded&&this.imagesLoaded)||!this.blockUntilImagesLoaded)){this.loaded=true;this.loading=false;if(this.callbacks){dojo.forEach(this.callbacks,function(item){if(item.context){item.callback.apply(item.context);}else{item.callback();}});}}},registerOnLoadCallback:function(_cca,_ccb){this.callbacks.push({callback:_cca,context:_ccb});},parseCSS:function(){var _ccc=[];_ccc.push({url:"/js/th/default.css",array:this.userAgentCss,index:0});var s,l=document.getElementsByTagName("link"),_ccf=0;for(var i=0;i<l.length;i++){s=l[i];if(s.rel.toLowerCase().indexOf("thstylesheet")>=0&&s.href){_ccc.push({url:s.href,array:this.authorCss,index:_ccf++});}}if(_ccc.length==0){this.cssLoaded=true;return this.onLoaded();}this.sheetCount=_ccc.length;dojo.forEach(_ccc,function(link){dojo.xhrGet({url:link.url,load:dojo.hitch(this,function(_cd2){this.processCSS(_cd2,link.array,link.index);})});},this);},processCSS:function(_cd3,_cd4,_cd5){_cd4[_cd5]=new th.css.CSSParser().parse(_cd3);for(var rule in _cd4[_cd5]){for(var _cd7 in _cd4[_cd5][rule]){var _cd8=_cd4[_cd5][rule][_cd7];if(_cd8.indexOf("url(")==0&&_cd8.indexOf(")")==_cd8.length-1){var url=_cd8.substring(4,_cd8.length-1);this.imageCount++;var _cda=new Image();if(this.blockUntilImagesLoaded){this.imagesLoaded=false;dojo.connect(_cda,"onload",this,this.processImage);}_cda.src="."+url;this.images[_cd8]=_cda;_cd4[_cd5][rule][_cd7]=_cda;}}}if(++this.currentSheet==this.sheetCount){this.cssLoaded=true;this.onLoaded();}}});dojo.declare("th.Bus",null,{constructor:function(){this.events={};},bind:function(_cdb,_cdc,_cdd,_cde){var _cdf=this.events[_cdb];if(!_cdf){_cdf=[];this.events[_cdb]=_cdf;}_cdc=dojo.isArray(_cdc)?_cdc:[_cdc];for(var z=0;z<_cdc.length;z++){for(var i=0;i<_cdf.length;i++){if(_cdf[i].selector==_cdc[z]&&_cdf[i].listenerFn==_cdd){return;}}_cdf.push({selector:_cdc[z],listenerFn:_cdd,context:_cde});}},unbind:function(_ce2){for(var _ce3 in this.events){var _ce4=this.events[_ce3];for(var i=0;i<_ce4.length;i++){if(_ce4[i].selector===_ce2){this.events[_ce3]=dojo.filter(_ce4,function(item){return item!=_ce4[i];});_ce4=this.events[_ce3];i--;}}}},fire:function(_ce7,_ce8,_ce9){var _cea=this.events[_ce7];if(!_cea||_cea.length==0){return;}for(var i=0;i<_cea.length;i++){if(_cea[i].selector.constructor==String){if(_cea[i].selector.charAt(0)=="#"){if(_ce9.id==_cea[i].selector.substring(1)){this.dispatchEvent(_ce7,_ce8,_ce9,_cea[i]);}}else{if(_cea[i].selector==_ce9.declaredClass){this.dispatchEvent(_ce7,_ce8,_ce9,_cea[i]);}}}else{if(_cea[i].selector==_ce9){this.dispatchEvent(_ce7,_ce8,_ce9,_cea[i]);}}}},dispatchEvent:function(_cec,_ced,_cee,_cef){_ced.thComponent=_cee;if(_cef.context){_cef.listenerFn.apply(_cef.context,[_ced]);}else{_cef.listenerFn(_ced);}}});th.global_event_bus=new th.Bus();th.global_resources=new th.Resources();dojo.declare("th.Scene",th.helpers.EventHelpers,{bus:th.global_event_bus,constructor:function(_cf0){this.canvas=_cf0;this.smartRedraw=false;this.resources=th.global_resources;this.resourceCallbackRegistered=false;if(!this.resources.loaded&&!this.resources.loading){this.resources.load();}dojo.connect(window,"resize",dojo.hitch(this,function(){this.render();}));this.root=new th.components.Panel({id:"root"});this.root.scene=this;var _cf1=document.createElement("canvas");this.scratchContext=_cf1.getContext("2d");bespin.util.canvas.fix(this.scratchContext);dojo.connect(window,"mousedown",dojo.hitch(this,function(e){this.wrapEvent(e,this.root);this.mouseDownComponent=e.thComponent;th.global_event_bus.fire("mousedown",e,e.thComponent);}));dojo.connect(window,"dblclick",dojo.hitch(this,function(e){this.wrapEvent(e,this.root);th.global_event_bus.fire("dblclick",e,e.thComponent);}));dojo.connect(window,"click",dojo.hitch(this,function(e){this.wrapEvent(e,this.root);th.global_event_bus.fire("click",e,e.thComponent);}));dojo.connect(window,"mousemove",dojo.hitch(this,function(e){this.wrapEvent(e,this.root);th.global_event_bus.fire("mousemove",e,e.thComponent);if(this.mouseDownComponent){this.addComponentXY(e,this.root,this.mouseDownComponent);th.global_event_bus.fire("mousedrag",e,this.mouseDownComponent);}}));dojo.connect(window,"mouseup",dojo.hitch(this,function(e){if(!this.mouseDownComponent){return;}this.addComponentXY(e,this.root,this.mouseDownComponent);th.global_event_bus.fire("mouseup",e,this.mouseDownComponent);delete this.mouseDownComponent;}));},render:function(){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);this.resourceCallbackRegistered=true;}return;}this.layout();this.paint();},layout:function(){if(this.root){this.root.bounds={x:0,y:0,width:this.canvas.width,height:this.canvas.height};this.root.layoutTree();}},paint:function(_cf7){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);this.resourceCallbackRegistered=true;}return;}if(!_cf7){_cf7=this.root;}if(_cf7){if(!_cf7.opaque&&_cf7.parent){return this.paint(_cf7.parent);}var ctx=this.canvas.getContext("2d");bespin.util.canvas.fix(ctx);ctx.save();var _cf9=_cf7.parent;var _cfa=_cf7;while(_cf9){try{ctx.translate(_cfa.bounds.x,_cfa.bounds.y);}catch(e){console.log("translate error ("+_cfa.type+")");console.log("child bounds:",_cfa.bounds);return;}_cfa=_cf9;_cf9=_cf9.parent;}if(!this.smartRedraw){ctx.clearRect(0,0,_cf7.bounds.width,_cf7.bounds.height);}ctx.beginPath();ctx.rect(0,0,_cf7.bounds.width,_cf7.bounds.height);ctx.closePath();ctx.clip();_cf7.paint(ctx);ctx.restore();}}});dojo.declare("th.Border",th.helpers.ComponentHelpers,{constructor:function(_cfb){if(!_cfb){_cfb={};}this.style=_cfb.style||{};this.attributes=_cfb.attributes||{};},getInsets:function(){return this.emptyInsets();},paint:function(ctx){}});dojo.declare("th.Component",th.helpers.ComponentHelpers,{constructor:function(_cfd){if(!_cfd){_cfd={};}this.bounds=_cfd.bounds||{};this.style=_cfd.style||{};this.styles=_cfd.styles||{};this.className=_cfd.className;this.attributes=_cfd.attributes||{};this.id=_cfd.id;this.border=_cfd.border;this.opaque=_cfd.opaque||true;this.bus=th.global_event_bus;},getScratchContext:function(){var _cfe=this.getScene();if(_cfe){return _cfe.scratchContext;}},getPreferredHeight:function(_cff){},getPreferredWidth:function(_d00){},getInsets:function(){return (this.border)?this.border.getInsets():this.emptyInsets();},paint:function(ctx){},repaint:function(){if(!this.getScene()){return;}this.getScene().paint(this);}});dojo.declare("th.Container",[th.Component,th.helpers.ContainerHelpers],{constructor:function(){this.children=[];},add:function(){for(var z=0;z<arguments.length;z++){component=dojo.isArray(arguments[z])?arguments[z]:[arguments[z]];this.children=this.children.concat(component);for(var i=0;i<component.length;i++){component[i].parent=this;}}},remove:function(){for(var z=0;z<arguments.length;z++){component=dojo.isArray(arguments[z])?arguments[z]:[arguments[z]];for(var i=0;i<component.length;i++){var _d06=this.children.length;this.children=dojo.filter(this.children,function(item){return item!=component[i];});if(_d06!=this.children.length){delete component[i].parent;}}}},replace:function(_d08,_d09){this.bus.unbind(this.children[_d09]);_d08.parent=this;this.children[_d09]=_d08;},paint:function(ctx){if(this.shouldPaint()){this.paintSelf(ctx);this.paintChildren(ctx);}},paintSelf:function(ctx){},paintChildren:function(ctx){for(var i=0;i<this.children.length;i++){if(!this.children[i].shouldPaint()){continue;}if(!this.children[i].bounds){continue;}ctx.save();try{ctx.translate(this.children[i].bounds.x,this.children[i].bounds.y);}catch(error){ctx.restore();continue;}try{if(!this.children[i].style["noClip"]){ctx.beginPath();ctx.rect(0,0,this.children[i].bounds.width,this.children[i].bounds.height);ctx.closePath();ctx.clip();}}catch(ex){}ctx.save();this.children[i].resolveCss();this.children[i].paint(ctx);ctx.restore();if(this.children[i].style.border){this.children[i].style.border.component=this.children[i];ctx.save();this.children[i].style.border.paint(ctx);ctx.restore();}ctx.restore();}},layoutTree:function(){this.layout();for(var i=0;i<this.children.length;i++){if(this.children[i].layoutTree){this.children[i].layoutTree();}}},layout:function(){var d=this.d();if(this.children.length>0){var _d10=this.bounds.width-d.i.w;var _d11=_d10/this.children.length;for(var i=0;i<this.children.length;i++){this.children[i].bounds={x:(i*_d11)+d.i.l,y:d.i.t,width:_d11,height:this.bounds.height-d.i.h};}}},render:function(){if(!th.global_resources.loaded){return;}this.layoutTree();this.repaint();}});dojo.declare("th.Window",null,{constructor:function(_d13){_d13=_d13||{};this.containerId=_d13.containerId||false;this.width=_d13.width||200;this.height=_d13.height||300;this.title=_d13.title||"NO TITLE GIVEN!";this.y=_d13.top||50;this.x=_d13.left||50;this.isVisible=false;this.closeOnClickOutside=!!_d13.closeOnClickOutside;if(!_d13.containerId){console.error("The \"containerId\" must be given!");return;}if(!_d13.userPanel){console.error("The \"userPanel\" must be given!");return;}this.container=dojo.byId(this.containerId);dojo.attr(this.container,{width:this.width,height:this.height,tabindex:"-1"});this.container.innerHTML+="<canvas id='"+this.containerId+"_canvas'></canvas>";this.canvas=dojo.byId(this.containerId+"_canvas");dojo.attr(this.canvas,{width:this.width,height:this.height,tabindex:"-1"});this.scene=new th.Scene(this.canvas);this.windowPanel=new th.components.WindowPanel(_d13.title,_d13.userPanel);this.windowPanel.windowBar.parentWindow=this;this.scene.root.add(this.windowPanel);this.move(this.x,this.y);dojo.connect(window,"mousedown",dojo.hitch(this,function(e){if(!this.isVisible||!this.closeOnClickOutside){return;}var d=dojo.coords(this.container);if(e.clientX<d.l||e.clientX>(d.l+d.w)||e.clientY<d.t||e.clientY>(d.t+d.h)){this.toggle();}}));dojo.connect(window,"keydown",dojo.hitch(this,function(e){if(!this.isVisible){return;}if(e.keyCode==bespin.util.keys.Key.ESCAPE){this.toggle();dojo.stopEvent(e);}}));},toggle:function(){this.isVisible=!this.isVisible;if(this.isVisible){this.container.style.display="block";this.layoutAndRender();}else{this.container.style.display="none";}this.scene.bus.fire("toggle",{isVisible:this.isVisible},this);},layoutAndRender:function(){this.scene.layout();this.scene.render();},centerUp:function(){this.move(Math.round((window.innerWidth-this.width)*0.5),Math.round((window.innerHeight-this.height)*0.25));},center:function(){this.move(Math.round((window.innerWidth-this.width)*0.5),Math.round((window.innerHeight-this.height)*0.5));},move:function(x,y){this.y=y;this.x=x;this.container.style.top=y+"px";this.container.style.left=x+"px";},getPosition:function(){return {x:this.x,y:this.y};}});}if(!dojo._hasResource["th.models"]){dojo._hasResource["th.models"]=true;dojo.provide("th.models");dojo.declare("th.models.LazyTreeModel",null,{placeholder:"(placeholder)",loading:"(loading)",root:this.placeholder,getRoot:function(){return this.root;},getChildren:function(_d19){},loadChildren:function(_d1a){},childrenLoaded:function(_d1b,_d1c){}});}if(!dojo._hasResource["th.borders"]){dojo._hasResource["th.borders"]=true;dojo.provide("th.borders");dojo.declare("th.borders.SimpleBorder",th.Border,{getInsets:function(){return {left:1,right:1,top:1,bottom:1};},paint:function(ctx){var b=this.component.bounds;ctx.strokeStyle=this.style.color;ctx.strokeRect(0,0,b.width,b.height);}});dojo.declare("th.borders.EmptyBorder",th.Border,{constructor:function(_d1f){if(!_d1f){_d1f={};}if(_d1f.size){this.insets={left:_d1f.size,right:_d1f.size,top:_d1f.size,bottom:_d1f.size};}else{this.insets=_d1f.insets;}},getInsets:function(){return this.insets;}});}if(!dojo._hasResource["th.components"]){dojo._hasResource["th.components"]=true;dojo.provide("th.components");dojo.declare("th.components.Button",th.Component,{paint:function(ctx){var d=this.d();var top=this.styles["-th-top-image"];var mid=this.styles["-th-middle-image"];var bot=this.styles["-th-bottom-image"];var back=this.styles["background-image"];if(top&&mid&&bot){if(d.b.h>=top.height+bot.height){ctx.drawImage(top,0,0);if(d.b.h>top.height+bot.height){ctx.drawImage(mid,0,top.height,mid.width,d.b.h-top.height-bot.height);}ctx.drawImage(bot,0,d.b.h-bot.height);}}else{if(back){ctx.drawImage(back,0,0);}else{ctx.fillStyle=this.styles["background-color"]||"red";ctx.fillRect(0,0,d.b.w,d.b.h);}}}});dojo.declare("th.components.Scrollbar",th.Container,{constructor:function(_d26){if(!_d26){_d26={};}this.orientation=_d26.orientation||th.VERTICAL;this.value=_d26.value||0;this.min=_d26.min||0;this.max=_d26.max||100;this.extent=_d26.extent||0.1;this.increment=_d26.increment||2;this.style=_d26.style||{};this.up=new th.components.Button({className:"up"});this.down=new th.components.Button({className:"down"});this.bar=new th.components.Button({className:"bar"});this.add([this.up,this.down,this.bar]);this.bus.bind("click",this.up,this.scrollup,this);this.bus.bind("click",this.down,this.scrolldown,this);this.bus.bind("mousedrag",this.bar,this.onmousedrag,this);this.bus.bind("mouseup",this.bar,this.onmouseup,this);},onmousedrag:function(e){var _d28=(this.orientation==th.VERTICAL)?e.clientY:e.clientX;if(this.dragstart_value==undefined){this.dragstart_value=this.value;this.dragstart_mouse=_d28;return;}var diff=_d28-this.dragstart_mouse;var _d2a=this.bounds.height-this.up.bounds.height-this.down.bounds.height-this.bar.bounds.height;var _d2b=(this.max-this.min)/_d2a;this.value=this.dragstart_value+Math.floor(diff*_d2b);if(this.value<this.min){this.value=this.min;}if(this.value>this.max){this.value=this.max;}if(this.scrollable){this.scrollable.scrollTop=this.value;}this.render();if(this.scrollable){this.scrollable.repaint();}},onmouseup:function(e){delete this.dragstart_value;delete this.dragstart_mouse;},scrollup:function(e){if(this.value>this.min){this.value=Math.max(this.min,this.value-this.increment);if(this.scrollable){this.scrollable.scrollTop=this.value;}this.render();if(this.scrollable){this.scrollable.repaint();}}},scrolldown:function(e){if(this.value<this.max){this.value=Math.min(this.max,this.value+this.increment);if(this.scrollable){this.scrollable.scrollTop=this.value;}this.render();if(this.scrollable){this.scrollable.repaint();}}},layout:function(){var d=this.d();if(this.scrollable){var _d30=this.scrollable.bounds.height;var _d31=this.scrollable.getScrollInfo();this.min=0;this.max=_d31.scrollHeight-_d30;this.value=_d31.scrollTop;this.extent=(_d31.scrollHeight-_d30)/_d31.scrollHeight;}if(this.max<this.min){for(var i=0;i<this.children.length;i++){delete this.children[i].bounds;}return;}if(this.orientation==th.VERTICAL){var w=d.b.iw;var h=12;this.up.bounds={x:d.i.l+1,y:d.i.t,width:w,height:h};this.down.bounds={x:d.i.l+1,y:d.b.ih-h,width:w,height:h};var _d35=d.b.ih-this.up.bounds.height-this.down.bounds.height;var _d36=Math.min(Math.floor(_d35-(this.extent*_d35),d.b.ih-this.up.bounds.height-this.down.bounds.height));var _d37=Math.floor(this.up.bounds.height+Math.min((this.value/(this.max-this.min))*(_d35-_d36)));this.bar.bounds={x:d.i.l+1,y:_d37,width:d.b.iw,height:_d36};}else{}},paint:function(ctx){if(this.max<0){return;}var top=this.styles["-th-vertical-top-image"];var mid=this.styles["-th-vertical-middle-image"];var bot=this.styles["-th-vertical-bottom-image"];if(top){ctx.drawImage(top,1,this.up.bounds.height);}if(mid){ctx.drawImage(mid,1,this.up.bounds.height+top.height,mid.width,this.down.bounds.y-this.down.bounds.height-(this.up.bounds.x-this.up.bounds.height));}if(bot){ctx.drawImage(bot,1,this.down.bounds.y-bot.height);}this.inherited(arguments);}});dojo.declare("th.components.Panel",th.Container,{paintSelf:function(ctx){this.paintBackground(ctx);}});dojo.declare("th.components.ResizeNib",th.Component,{constructor:function(_d3d){this.bus.bind("mousedown",this,this.onmousedown,this);this.bus.bind("mouseup",this,this.onmouseup,this);this.bus.bind("mousedrag",this,this.onmousedrag,this);},onmousedown:function(e){this.startPos={x:e.clientX,y:e.clientY};},onmousedrag:function(e){if(this.startPos){if(!this.firedDragStart){this.bus.fire("dragstart",this.startPos,this);this.firedDragStart=true;}this.bus.fire("drag",{startPos:this.startPos,currentPos:{x:e.clientX,y:e.clientY}},this);}},onmouseup:function(e){if(this.startPos&&this.firedDragStart){this.bus.fire("dragstop",{startPos:this.startPos,currentPos:{x:e.clientX,y:e.clientY}},this);delete this.firedDragStart;}delete this.startPos;},paint:function(ctx){var d=this.d();if(this.attributes.orientation==th.VERTICAL){var bw=7;var x=Math.floor((d.b.w/2)-(bw/2));var y=7;ctx.fillStyle=this.styles["-th-vertical-bar-shadow-color"];for(var i=0;i<3;i++){ctx.fillRect(x,y,bw,1);y+=3;}y=8;ctx.fillStyle=this.styles["-th-vertical-bar-color"];for(var i=0;i<3;i++){ctx.fillRect(x,y,bw,1);y+=3;}}else{var bh=7;var dw=8;var dh=bh+2;var x=Math.floor(d.b.w/2-(dw/2));var y=Math.floor(d.b.h/2-(dh/2));var cx=x;if(this.styles["-th-horizontal-bar-subtle-shadow-color"]){ctx.fillStyle=this.styles["-th-horizontal-bar-subtle-shadow-color"];for(var i=0;i<3;i++){ctx.fillRect(cx,y,1,dh);cx+=3;}}cx=x+1;ctx.fillStyle=this.styles["-th-horizontal-bar-shadow-color"];for(var i=0;i<3;i++){ctx.fillRect(cx,y+dh-1,1,1);cx+=3;}cx=x+1;ctx.fillStyle=this.styles["-th-horizontal-bar-color"];for(var i=0;i<3;i++){ctx.fillRect(cx,y+1,1,bh);cx+=3;}}}});dojo.declare("th.components.Splitter",th.Container,{constructor:function(_d4b){this.topNib=new th.components.ResizeNib({attributes:{orientation:this.attributes.orientation}});this.bottomNib=new th.components.ResizeNib({attributes:{orientation:this.attributes.orientation}});this.add(this.topNib,this.bottomNib);this.label=_d4b.label;if(this.label){this.add(this.label);}this.scrollbar=_d4b.scrollbar;if(this.scrollbar){this.add(this.scrollbar);}this.bus.bind("drag",[this.topNib,this.bottomNib],this.ondrag,this);this.bus.bind("dragstart",[this.topNib,this.bottomNib],this.ondragstart,this);this.bus.bind("dragstop",[this.topNib,this.bottomNib],this.ondragstop,this);},ondrag:function(e){this.bus.fire("drag",e,this);},ondragstart:function(e){this.bus.fire("dragstart",e,this);},ondragstop:function(e){this.bus.fire("dragstop",e,this);},getPreferredHeight:function(_d4f){return 20;},getPreferredWidth:function(_d50){return 16;},layout:function(){var d=this.d();if(!this.attributes.orientation){this.attributes.orientation=(this.bounds.height>this.bounds.width)?th.HORIZONTAL:th.VERTICAL;}if(this.attributes.orientation==th.HORIZONTAL){this.topNib.bounds={x:0,y:0,height:d.b.w,width:d.b.w};this.bottomNib.bounds={x:0,y:this.bounds.height-d.b.w,height:d.b.w,width:d.b.w};if(this.scrollbar&&this.scrollbar.shouldLayout()){this.scrollbar.bounds={x:0,y:this.topNib.bounds.height,height:d.b.h-(this.topNib.bounds.height*2),width:d.b.w};}}else{this.topNib.bounds={x:0,y:0,height:d.b.h,width:d.b.h};this.bottomNib.bounds={x:d.b.w-d.b.h,y:0,height:d.b.h,width:d.b.h};if(this.label){this.label.bounds={x:this.topNib.bounds.x+this.topNib.bounds.width,y:0,height:d.b.h,width:d.b.w-(d.b.h*2)};}}},paintSelf:function(ctx){var d=this.d();if(this.attributes.orientation==th.VERTICAL){ctx.fillStyle="rgb(73, 72, 66)";ctx.fillRect(0,0,d.b.w,1);ctx.fillStyle="black";ctx.fillRect(0,d.b.h-1,d.b.w,1);var _d54=ctx.createLinearGradient(0,1,0,d.b.h-1);_d54.addColorStop(0,"rgb(50, 48, 42)");_d54.addColorStop(1,"rgb(22, 22, 19)");ctx.fillStyle=_d54;ctx.fillRect(0,1,d.b.w,d.b.h-2);}else{ctx.fillStyle="rgb(105, 105, 99)";ctx.fillRect(0,0,1,d.b.h);ctx.fillStyle="black";ctx.fillRect(d.b.w-1,0,1,d.b.h);var _d54=ctx.createLinearGradient(1,0,d.b.w-2,0);_d54.addColorStop(0,"rgb(56, 55, 49)");_d54.addColorStop(1,"rgb(62, 61, 55)");ctx.fillStyle=_d54;ctx.fillRect(1,0,d.b.w-2,d.b.h);}}});dojo.declare("th.components.SplitPanelContainer",th.components.Panel,{constructor:function(_d55){this.splitter=new th.components.Splitter({attributes:{orientation:this.attributes.orientation},label:_d55.label});},getContents:function(){var _d56=dojo.filter(this.children,dojo.hitch(this,function(item){return item!=this.splitter;}));if(_d56.length>0){return _d56[0];}},layout:function(){var _d58=dojo.filter(this.children,dojo.hitch(this,function(item){return item!=this.splitter;}));if(this.children.length==_d58.length){this.add(this.splitter);}var _d5a=(this.attributes.orientation==th.HORIZONTAL)?this.splitter.getPreferredWidth(this.bounds.height):this.splitter.getPreferredHeight(this.bounds.width);if(this.splitter.shouldLayout()){if(this.attributes.orientation==th.HORIZONTAL){this.splitter.bounds={x:this.bounds.width-_d5a,y:0,height:this.bounds.height,width:_d5a};}else{this.splitter.bounds={x:0,y:this.bounds.height-_d5a,height:_d5a,width:this.bounds.width};}}else{_d5a=0;}if(_d58.length>0){if(this.attributes.orientation==th.HORIZONTAL){_d58[0].bounds={x:0,y:0,height:this.bounds.height,width:this.bounds.width-_d5a};}else{_d58[0].bounds={x:0,y:0,height:this.bounds.height-_d5a,width:this.bounds.width};}}}});dojo.declare("th.components.SplitPanel",th.components.Panel,{constructor:function(_d5b){if(!this.attributes.orientation){this.attributes.orientation=th.HORIZONTAL;}if(!this.attributes.regions){this.attributes.regions=[{},{}];}},ondragstart:function(e){var _d5d=e.thComponent.parent;_d5d.region.startSize=_d5d.region.size;},ondrag:function(e){var _d5f=e.thComponent.parent;var _d60=(this.attributes.orientation==th.HORIZONTAL)?e.currentPos.x-e.startPos.x:e.currentPos.y-e.startPos.y;_d5f.region.size=_d5f.region.startSize+_d60;this.render();},ondragstop:function(e){var _d62=e.thComponent.parent;delete _d62.region.startSize;},layout:function(){this.remove(this.children);var i;for(i=0;i<this.attributes.regions.length;i++){var _d64=this.attributes.regions[i];if(!_d64.container){_d64.container=new th.components.SplitPanelContainer({attributes:{orientation:this.attributes.orientation},label:_d64.label});_d64.container.region=_d64;this.bus.bind("dragstart",_d64.container.splitter,this.ondragstart,this);this.bus.bind("drag",_d64.container.splitter,this.ondrag,this);this.bus.bind("dragstop",_d64.container.splitter,this.ondragstop,this);}if(_d64.contents&&(_d64.contents!=_d64.container.getContents())){_d64.container.removeAll();_d64.container.add(_d64.contents);}if(i==this.attributes.regions.length-1){_d64.container.splitter.style.display="none";}this.add(_d64.container);}var _d65=(this.attributes.orientation==th.HORIZONTAL)?this.bounds.width:this.bounds.height;var _d66=0;for(i=0;i<this.attributes.regions.length;i++){var r=this.attributes.regions[i];if(!r.size){r.size=(this.attributes.defaultSize||(100/this.attributes.regions.length)+"%");}if(th.helpers.isPercentage(r.size)){r.size=Math.floor((parseInt(r.size)/100)*_d65);}if(r.size<30){r.size=30;}_d66+=r.size;}if(_d66>_d65){var diff=_d66-_d65;for(i=this.attributes.regions.length-1;i>=0;i--){var r=this.attributes.regions[i];var _d69=r.size;r.size-=diff;if(r.size<30){r.size=30;}diff-=(_d69-r.size);if(diff<=0){break;}}}else{if(_d66<_d65){this.attributes.regions[this.attributes.regions.length-1].size+=(_d65-_d66);}}var _d6a=0;for(i=0;i<this.attributes.regions.length;i++){var _d64=this.attributes.regions[i];if(this.attributes.orientation==th.HORIZONTAL){_d64.container.bounds={x:_d6a,y:0,width:_d64.size,height:this.bounds.height};}else{_d64.container.bounds={x:0,y:_d6a,width:this.bounds.width,height:_d64.size};}_d6a+=_d64.size;}}});dojo.declare("th.components.Label",th.components.Panel,{constructor:function(_d6b){if(!_d6b){_d6b={};}if(!this.border){this.border=new th.borders.EmptyBorder({insets:{left:5,right:5,top:2,bottom:2}});}this.attributes.text=_d6b.text||"";if(!this.style.font){this.style.font="12pt Arial";}if(!this.style.color){this.style.color="black";}},styleContext:function(ctx){if(!ctx){return;}ctx.font=this.style.font;ctx.fillStyle=this.style.color;return ctx;},getPreferredWidth:function(_d6d){var ctx=this.styleContext(this.parent.getScratchContext());var w=ctx.measureText(this.attributes.text).width+2;return w+this.getInsets().left+this.getInsets().right;},getPreferredHeight:function(_d70){var ctx=this.styleContext(this.parent.getScratchContext());var h=Math.floor(ctx.measureText(this.attributes.text).ascent*1.5);return h+this.getInsets().top+this.getInsets().bottom;},paint:function(ctx){var d=this.d();if(this.style.backgroundColor){if(!dojo.isObject(this.stlyes)){this.styles={};}this.styles["background-color"]=this.style.backgroundColor;this.inherited(arguments);}this.styleContext(ctx);var _d75=ctx.measureText(this.attributes.text);var _d76=this.attributes.text;var _d77=_d76.length-2;while(_d75.width>(d.b.w-d.i.w)){if(_d77==0){_d76="...";break;}var left=Math.floor(_d77/2);var _d79=left+(_d77%2);_d76=this.attributes.text.substring(0,left)+"..."+this.attributes.text.substring(this.attributes.text.length-_d79);_d75=ctx.measureText(_d76);_d77-=1;}var y=this.getInsets().top+_d75.ascent;if(dojo.isWebKit){y+=1;}ctx.fillText(_d76,this.getInsets().left,y);}});dojo.declare("th.components.ExpandingInfoPanel",th.components.Panel,{getMinimumRowHeight:function(){return 40;},getMinimumColumnWidth:function(){},layout:function(){if(this.children.length==0){return;}var d=this.d();var rows=Math.floor(Math.sqrt(this.children.length));var _d7d=Math.floor(d.b.h/rows);while(_d7d<this.getMinimumRowHeight()&&rows>1){rows--;_d7d=Math.floor(d.b.h/rows);}var _d7e=Math.floor(this.children.length/rows);var _d7f=this.children.length%rows;var _d80=0;var _d81=d.b.h%rows;var _d82=0;for(var i=0;i<rows;i++){var h=(i==rows-1)?_d7d+_d81:_d7d;var cols=(_d7f>0)?_d7e+1:_d7e;_d7f--;var _d86=Math.floor(d.b.w/cols);var _d87=d.b.w%cols;var _d88=0;for(var z=0;z<cols;z++){var w=(z==cols-1)?_d86+_d87:_d86;this.children[_d80++].bounds={x:_d88,y:_d82,width:w,height:h};_d88+=w;}_d82+=h;}}});dojo.declare("th.components.List",th.Container,{constructor:function(_d8b){if(!_d8b){_d8b={};}this.items=_d8b.items||[];this.scrollTop=0;this.allowDeselection=_d8b.allowDeselection||false;this.bus.bind("mousedown",this,this.onmousedown,this);this.renderer=new th.components.Label({style:{border:new th.borders.EmptyBorder({size:3})}});if(_d8b.topLabel){this.label=_d8b.topLabel;this.label.height=16;}},onmousedown:function(e){var item=this.getItemForPosition({x:e.componentX,y:e.componentY});if(item!=this.selected){if(item){this.selected=item;this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint();}else{if(this.allowDeselection){delete this.selected;}}}},selectItemByText:function(text){if(this.items.length==0){return false;}var item=null;if(dojo.isObject(this.items[0])){for(var x=0;x<this.items.length;x++){if(this.items[x].name==text){item=this.items[x];break;}}if(item==null){return false;}}else{if(this.items.indexOf(text)==-1){return false;}item=this.items[this.items.indexOf(text)];}if(this.selected!=item){this.selected=item;this.repaint();}return true;},moveSelectionUp:function(){if(!this.selected||this.items.length==0){return;}var x=0;while(this.items[x]!=this.selected){x++;}if(x!=0){this.selected=this.items[x-1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint();}},moveSelectionDown:function(){if(!this.selected||this.items.length==0){return;}var x=0;while(this.items[x]!=this.selected){x++;}if(x!=this.items.length-1){this.selected=this.items[x+1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint();}},getItemForPosition:function(pos){pos.y+=this.scrollTop-(this.label?this.label.height:0);var y=this.getInsets().top;for(var i=0;i<this.items.length;i++){var h=this.heights[i];if(pos.y>=y&&pos.y<=y+h){return this.items[i];}y+=h;}},getRenderer:function(rctx){this.renderer.attributes.text=rctx.item.toString();this.renderer.style.font=this.style.font;this.renderer.style.color=this.style.color;this.renderer.selected=rctx.selected;this.renderer.item=rctx.item;return this.renderer;},getRenderContext:function(item,row){return {item:item,even:row%2==0,selected:this.selected==item};},getRowHeight:function(){if(!this.rowHeight){var d=this.d();var _d9b=(this.items.length>0)?this.items[0]:undefined;if(_d9b){var _d9c=this.getRenderer(this.getRenderContext(_d9b,0));this.add(_d9c);this.rowHeight=_d9c.getPreferredHeight(d.b.w-d.i.w);this.remove(_d9c);}}return this.rowHeight||0;},getScrollInfo:function(){return {scrollTop:this.scrollTop,scrollHeight:this.getRowHeight()*this.items.length};},paint:function(ctx){var d=this.d();var _d9f=Math.max(this.getScrollInfo().scrollHeight,d.b.h);var _da0=this.getScrollInfo();ctx.save();if(this.label){var _da1=this.label.height;this.label.bounds={y:y,x:d.i.l,height:_da1,width:d.b.w};this.label.paint(ctx);d.i.t=_da1;}ctx.translate(0,-this.scrollTop);try{if(this.style.backgroundColor){ctx.fillStyle=this.style.backgroundColor;ctx.fillRect(0,d.i.t,d.b.w,_d9f);}if(this.style.backgroundColorOdd){var _da3=this.rowHeight;if(!_da3){var _da4=(this.items.length>0)?this.items[0]:undefined;if(_da4){var _da5=this.getRenderer(this.getRenderContext(_da4,0));this.add(_da5);_da3=_da5.getPreferredHeight(d.b.w-d.i.w);this.remove(_da5);}}if(_da3){var y=d.i.t+_da3;ctx.fillStyle=this.style.backgroundColorOdd;while(y<_d9f){ctx.fillRect(d.i.l,y,d.b.w-d.i.w,_da3);y+=_da3*2;}}}if(this.items.length==0){return;}if(!this.renderer){console.log("No renderer for List of type "+this.declaredClass+" with id "+this.id+"; cannot paint contents");return;}this.heights=[];var y=d.i.t;for(var i=0;i<this.items.length;i++){var _da7=this.getRenderer(this.getRenderContext(this.items[i],i));if(!_da7){break;}this.add(_da7);var w=d.b.w-d.i.w;var h=(this.rowHeight)?this.rowHeight:_da7.getPreferredHeight(w);this.heights.push(h);_da7.bounds={x:0,y:0,height:h,width:w};ctx.save();ctx.translate(d.i.l,y);ctx.beginPath();ctx.rect(0,0,w,h);ctx.closePath();ctx.clip();_da7.paint(ctx);ctx.restore();this.remove(_da7);y+=h;}}finally{ctx.restore();}}});dojo.declare("th.components.HorizontalTree",th.Container,{constructor:function(_daa){if(!_daa){_daa={};}if(!this.style.defaultSize){this.style.defaultSize=150;}this.attributes.orientation=th.HORIZONTAL;this.lists=[];this.splitters=[];this.listWidths=[];},setData:function(data){for(var i=0;i<this.lists.length;i++){this.remove(this.lists[i]);this.remove(this.splitters[i]);this.bus.unbind(this.lists[i]);this.bus.unbind(this.splitters[i]);}this.lists=[];this.splitters=[];this.data=data;this.showChildren(null,data);},ondragstart:function(e){var _dae=this.splitters.indexOf(e.thComponent);this.startSize=this.listWidths[_dae];},ondrag:function(e){var _db0=this.splitters.indexOf(e.thComponent);var _db1=(this.attributes.orientation==th.HORIZONTAL)?e.currentPos.x-e.startPos.x:e.currentPos.y-e.startPos.y;this.listWidths[_db0]=this.startSize+_db1;this.render();},ondragstop:function(e){delete this.startSize;},updateData:function(_db3,_db4){_db3.contents=_db4;if(this.getSelectedItem()==_db3){this.showChildren(_db3,_db3.contents);}},replaceList:function(_db5,_db6){this.lists[_db5].items=_db6;delete this.lists[_db5].selected;this.render();},removeListsFrom:function(_db7){for(var x=_db7;x<this.lists.length;x++){this.bus.unbind(this.lists[x]);this.bus.unbind(this.splitters[x]);this.remove(this.lists[x]);this.remove(this.splitters[x]);}this.lists=this.lists.slice(0,_db7);this.splitters=this.splitters.slice(0,_db7);},showChildren:function(_db9,_dba){if(this.details){this.remove(this.details);delete this.details;}if(!dojo.isArray(_dba)){_dba(this.getSelectedPath(),this);return;}if(!_dba||_dba.length==0){return;}var list=this.createList(_dba);list.id="list "+(this.lists.length+1);this.bus.bind("itemselected",list,this.itemSelected,this);var tree=this;this.bus.bind("dblclick",list,function(e){tree.bus.fire("dblclick",e,tree);});this.lists.push(list);this.add(list);var _dbe=new th.components.Splitter({attributes:{orientation:th.HORIZONTAL},scrollbar:new th.components.Scrollbar()});_dbe.scrollbar.style=this.style;_dbe.scrollbar.scrollable=list;_dbe.scrollbar.opaque=false;this.bus.bind("dragstart",_dbe,this.ondragstart,this);this.bus.bind("drag",_dbe,this.ondrag,this);this.bus.bind("dragstop",_dbe,this.ondragstop,this);this.splitters.push(_dbe);this.add(_dbe);if(this.parent){this.render();}},showDetails:function(item){if(this.details){this.remove(this.details);}if(this.parent){this.repaint();}},createList:function(_dc0){var list=new th.components.List({items:_dc0,style:this.style});if(this.renderer){list.renderer=this.renderer;}list.oldGetRenderer=list.getRenderer;list.getRenderer=function(rctx){var _dc3=list.oldGetRenderer(rctx);_dc3.attributes.text=rctx.item.name;return _dc3;};return list;},getSelectedItem:function(){var _dc4=this.getSelectedPath();if(_dc4.length>0){return _dc4[_dc4.length-1];}},getSelectedPath:function(_dc5){_dc5=_dc5||false;var path=[];for(var i=0;i<this.lists.length;i++){if(this.lists[i].selected){path.push(this.lists[i].selected);}else{break;}}if(path.length==0){return;}if(_dc5){var _dc8="";for(var i=0;i<path.length-1;i++){_dc8+=path[i].name+"/";}if(!path[path.length-1].contents){_dc8+=path[path.length-1].name;}else{_dc8+=path[path.length-1].name+"/";}return _dc8;}else{return path;}},itemSelected:function(e){var list=e.thComponent;if(!list.selected){return;}var path=[];for(var i=0;i<this.lists.length;i++){path.push(this.lists[i].selected);if(this.lists[i]==list){for(var j=i+1;j<this.lists.length&&this.lists[j].selected;j++){this.lists[j-1].selected.lastSelected=this.lists[j].selected.name;delete this.lists[j].selected;}break;}}this.bus.fire("itemselected",{e:e},this);if(path.length<this.lists.length){var _dce=this.lists.slice(0,path.length);var _dcf=this.splitters.slice(0,path.length);for(var z=path.length;z<this.lists.length;z++){this.bus.unbind(this.lists[z]);this.bus.unbind(this.splitters[z]);this.remove(this.lists[z]);this.remove(this.splitters[z]);}this.lists=_dce;this.splitters=_dcf;}var _dd1=path[path.length-1];if(_dd1&&_dd1.contents){this.showChildren(_dd1,_dd1.contents);}else{this.showDetails(_dd1);}},getItem:function(_dd2){var _dd3=this.data;var item;for(var i=0;i<_dd2.length;i++){for(var z=0;z<_dd3.length;z++){if(_dd3[z]==_dd2[i]){item=_dd3[z];_dd3=item.contents;break;}}}return item;},layout:function(){var d=this.d();var x=d.i.l;for(var i=0;i<this.lists.length;i++){var list=this.lists[i];if(!this.listWidths){this.listWidths=[];}if(!this.listWidths[i]){this.listWidths[i]=this.style.defaultSize;}var w=this.listWidths[i];list.bounds={x:x,y:d.i.t,width:w,height:d.b.h-d.i.h};x+=w;var _ddc=this.splitters[i];w=_ddc.getPreferredWidth(-1);_ddc.bounds={x:x,y:d.i.t,width:w,height:d.b.h-d.i.h};x+=w;}if(this.details){this.details.bounds={x:x,y:d.i.t,width:150,height:d.b.h-d.i.h};}},paintSelf:function(ctx){var d=this.d();if(this.style.backgroundColor){ctx.fillStyle=this.style.backgroundColor;ctx.fillRect(0,0,d.b.w,d.b.h);}}});dojo.declare("th.components.WindowBar",th.Container,{constructor:function(_ddf){if(!_ddf){_ddf={};}function _de0(url){var img=new Image();img.src=url;return img;};this.imgBackgroundRight=_de0("../images/window_top_right.png");this.imgBackgroundMiddle=_de0("../images/window_top_middle.png");this.imgBackgroundLeft=_de0("../images/window_top_left.png");this.label=new th.components.Label({text:_ddf.title||"NO TEXT",style:{color:"white",font:"8pt Tahoma"}});this.label.getInsets=function(){return {top:4,left:6};};this.imgCloseButton=_de0("../images/icn_close_x.png");this.closeButton=new th.components.Button({style:{backgroundImage:this.imgCloseButton}});this.add(this.label,this.closeButton);this.bus.bind("mousedown",this.closeButton,dojo.hitch(this,function(){this.parentWindow.toggle();delete this.startValue;}));this.bus.bind("mousedown",this,this.onmousedown,this);this.bus.bind("mouseup",this,this.onmouseup,this);dojo.connect(window,"mousemove",dojo.hitch(this,this.onmousemove));},onmousedown:function(e){this.startValue={mouse:{x:e.clientX,y:e.clientY},window:this.parentWindow.getPosition()};},onmousemove:function(e){if(this.startValue){var s=this.startValue;var x=s.window.x-(s.mouse.x-e.clientX);var y=s.window.y-(s.mouse.y-e.clientY);this.parentWindow.move(x,y);dojo.stopEvent(e);}},onmouseup:function(e){delete this.startValue;},getPreferredHeight:function(){return 21;},layout:function(){var d=this.d();var lh=this.label.getPreferredHeight(d.b.w-30);this.label.bounds={y:0,x:3,height:lh,width:d.b.w-20};this.closeButton.bounds={x:d.b.w-14,y:6,height:8,width:8};},paint:function(ctx){var d=this.d();ctx.drawImage(this.imgBackgroundLeft,0,0);ctx.drawImage(this.imgBackgroundMiddle,3,0,d.b.w-6,21);ctx.drawImage(this.imgBackgroundRight,d.b.w-3,0);this.label.paint(ctx);ctx.drawImage(this.imgCloseButton,d.b.w-14,6);}});dojo.declare("th.components.WindowPanel",th.components.Panel,{constructor:function(_ded,_dee){if(!_dee){console.error("The \"userPanel\" must be given!");return;}this.userPanel=_dee;this.windowBar=new th.components.WindowBar({title:_ded});this.add([this.windowBar,this.userPanel]);delete this.add;delete this.remove;},layout:function(){var d=this.d();this.width=d.b.w;this.height=d.b.h;var y=this.windowBar.getPreferredHeight();this.windowBar.bounds={x:0,y:0,height:y,width:d.b.w};this.userPanel.bounds={x:1,y:y,height:d.b.h-y-1,width:d.b.w-2};},paintSelf:function(ctx){ctx.lineWidth=2;ctx.strokeStyle="black";ctx.strokeStyle="#2E1F1A";ctx.strokeRect(0,0,this.width,this.height);}});}if(!dojo._hasResource["bespin.editor.component"]){dojo._hasResource["bespin.editor.component"]=true;dojo.provide("bespin.editor.component");dojo.declare("bespin.editor.Component",null,{constructor:function(_df2,opts){opts.actsAsComponent=true;var _df4;if(opts.loadfromdiv){if(dojo.byId("BESPIN_EDITOR_CODE")){var code=dojo.byId("BESPIN_EDITOR_CODE");_df4=code.value;}else{_df4=dojo.byId(_df2).innerHTML;}}else{if(opts.content){_df4=opts.content;}}this.editor=bespin.register("editor",opts.editor||new bespin.editor.API(_df2,opts));this.editSession=bespin.register("editSession",opts.editSession||new bespin.client.session.EditSession(this.editor));this.server=bespin.register("server",opts.server||new bespin.client.Server());this.files=bespin.register("files",opts.files||new bespin.client.FileSystem());if(opts.commandline){var _df6;if(typeof opts.commandline=="boolean"){_df6=dojo.create("div",{id:"commandlinewrapper",hidden:true,},dojo.body());_df6.innerHTML="<table style=\"display: none;\" cellpadding=\"0\"><tr><td id=\"prompt\"><img id=\"promptimg\" src=\"https://bespin.mozilla.com/images/icn_command.png\" alt=\">\" ></td><td id=\"commandline\"><input id=\"command\" spellcheck=\"false\"></td></tr></table>";}else{_df6=dojo.byId(opts.commandline);}this.commandLine=bespin.register("commandLine",new bespin.cmd.commandline.Interface(_df6,bespin.cmd.editorcommands.Commands));}bespin.register("settings",opts.settings||new bespin.client.settings.Core(bespin.client.settings.InMemory));if(opts.jetpack){var _df7=dojo.create("div",{id:"jetpacktoolbar"},dojo.byId(_df2));_df7.innerHTML="<div class=\"button\"><button id=\"install\" onclick=\"_editorComponent.executeCommand('jetpack install yourfirstjetpack')\">&uarr; Install This JetPack Feature</button></div>            <div>Hey, <a href=\"http://labs.mozilla.com/jetpack\">install JetPack first</a>.</div>            <style type=\"text/css\">                #jetpacktoolbar {                    position: relative;                    top: -15px;                    left: 0;                    height: 40px;                    background-image: url(https://bespin.mozilla.com/images/footer_bg.png);                    background-repeat: repeat-x;                    color: white;                    font-family: Helvetica, Arial, sans-serif;                    font-size: 11px;                }                #jetpacktoolbar div {                    padding: 17px 12px;                    float: left;                }                #jetpacktoolbar div.button {                    float: right;                    padding: 13px 0;                }                #jetpacktoolbar button {                    margin:0 7px 0 0;                }                #jetpacktoolbar a {                    color: #eee;                }            </style>";}dojo.connect(window,"resize",opts.resize||dojo.hitch(this,function(){this.editor.paint();}));if(_df4){this.setContent(_df4);}if(opts.language){bespin.publish("settings:language",{language:opts.language});}if(!opts.dontstealfocus){this.editor.canvas.focus();}if(opts.set){for(var key in opts.set){if(opts.set.hasOwnProperty(key)){this.set(key,opts.set[key]);}}}},getContent:function(){return this.editor.model.getDocument();},setContent:function(_df9){return this.editor.model.insertDocument(_df9);},setFocus:function(bool){return this.editor.setFocus(bool);},setLineNumber:function(_dfb){bespin.publish("editor:moveandcenter",{row:_dfb});},set:function(key,_dfd){bespin.publish("settings:set",{key:key,value:_dfd});},onchange:function(_dfe){bespin.subscribe("editor:document:changed",_dfe);},bindKey:function(opts){bespin.publish("editor:bindkey",opts);},executeCommand:function(_e00){try{this.commandLine.executeCommand(_e00);}catch(e){}}});}if(dojo.config.afterOnLoad&&dojo.isBrowser){window.setTimeout(dojo._loadInit,1000);}})();
